"use strict";(()=>{var et=Object.defineProperty,nr=Object.defineProperties;var ir=Object.getOwnPropertyDescriptors;var Qe=Object.getOwnPropertySymbols;var sr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable;var Je=(e,t,r)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ee=(e,t)=>{for(var r in t||(t={}))sr.call(t,r)&&Je(e,r,t[r]);if(Qe)for(var r of Qe(t))ar.call(t,r)&&Je(e,r,t[r]);return e},ye=(e,t)=>nr(e,ir(t));var Y=(e,t)=>{for(var r in t)et(e,r,{get:t[r],enumerable:!0})};var tt=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],or=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"],Ne=class{constructor(){this._onFullScreenChangeCallbacks=[];this._isInitialized=!1}_initialize(){if(this._isInitialized)return;this._isInitialized=!0;let t=()=>{this._onFullScreenChangeCallbacks.forEach(r=>r())};for(let r of or)document.addEventListener(r,t,!1)}isCompatible(t){for(let r of tt)if(r in t)return!0;return!1}isFullScreen(t){return document.fullscreenElement===t}async requestFullScreen(t){if(this.isFullScreen(t))return{success:!1,message:"element already in full screen"};this._initialize();for(let r of tt)if(r in t)return t[r](),{success:!0,message:"request for full screen done"};return{success:!1,message:"unsupported request for full screen"}}addOnFullScreenChange(t){this._onFullScreenChangeCallbacks.push(t)}removeOnFullScreenChange(t){let r=this._onFullScreenChangeCallbacks.indexOf(t);r<0||this._onFullScreenChangeCallbacks.splice(r,1)}},Me=new Ne;var Re={Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,BackQuote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Shift:16,Ctrl:17,Alt:18,CapsLock:20,Tab:9,Enter:13,Pause:19,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,PrintScreen:44,Insert:45,Delete:46,ContextMenu:93,ScrollLock:145,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,NumPadMultiply:106,NumPadAdd:107,NumPadSubtract:109,NumPadDecimal:110,NumPadDivide:111,NumLock:144,NumPadComma:194,NumPadEqual:12};var We=class{constructor(){this._pressedKeysSet=new Set;this._preventDefaultKeysSet=new Set;this._activated=!1;let t=n=>{let{keyCode:i}=n;this._preventDefaultKeysSet.has(i)&&n.preventDefault(),this._pressedKeysSet.add(i)},r=n=>{let{keyCode:i}=n;this._preventDefaultKeysSet.has(i)&&n.preventDefault(),this._pressedKeysSet.delete(i)};this._activated=!1,this._handleKeyDown=t.bind(this),this._handleKeyUp=r.bind(this)}isPressed(...t){for(let r of t)if(this._pressedKeysSet.has(Re[r]))return!0;return!1}preventDefault(t){this._preventDefaultKeysSet.add(Re[t])}enableDefault(t){this._preventDefaultKeysSet.delete(Re[t])}activate(){this._activated||(this._pressedKeysSet.clear(),document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("keyup",this._handleKeyUp),this._activated=!0)}deactivate(){this._activated&&(this._pressedKeysSet.clear(),document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("keyup",this._handleKeyUp),this._activated=!1)}},I=new We;var fr={Left:0,Middle:1,Right:2},Oe=class{constructor(){this._pressedButtonsSet=new Set;this._activated=!1;this._deltaX=0;this._deltaY=0;let t=i=>{this._pressedButtonsSet.add(i.button)},r=i=>{this._pressedButtonsSet.delete(i.button)},n=i=>{this._deltaX+=i.movementX||i.mozMovementX||i.webkitMovementX||0,this._deltaY+=i.movementY||i.mozMovementY||i.webkitMovementY||0};this._activated=!1,this._handleMouseDown=t.bind(this),this._handleMouseUp=r.bind(this),this._handleMouseMove=n.bind(this)}activate(){this._activated||(this._pressedButtonsSet.clear(),document.addEventListener("mousedown",this._handleMouseDown),document.addEventListener("mouseup",this._handleMouseUp),document.addEventListener("mousemove",this._handleMouseMove),this._activated=!0)}deactivate(){this._activated&&(this._pressedButtonsSet.clear(),document.removeEventListener("mousedown",this._handleMouseDown),document.removeEventListener("mouseup",this._handleMouseUp),document.removeEventListener("mousemove",this._handleMouseMove),this._activated=!1)}isButtonPressed(t){return this._pressedButtonsSet.has(fr[t])}deltaX(){return this._deltaX}deltaY(){return this._deltaY}resetDelta(){this._deltaX=0,this._deltaY=0}},te=new Oe;var rt=["requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock"],dr=["exitPointerLock","mozExitPointerLock","webkitExitPointerLock"],cr=["pointerLockElement","mozPointerLockElement","webkitPointerLockElement"],lr=[{methodName:"onpointerlockchange",propertyName:"pointerlockchange"},{methodName:"onmozpointerlockchange",propertyName:"mozpointerlockchange"},{methodName:"onwebkitpointerlockchange",propertyName:"webkitpointerlockchange"}],hr=[{methodName:"onpointerlockerror",propertyName:"pointerlockerror"},{methodName:"onmozpointerlockerror",propertyName:"mozpointerlockerror"},{methodName:"onwebkitpointerlockerror",propertyName:"webkitpointerlockerror"}],Xe=class{constructor(){this._onLockChangeCallbacks=[];this._onLockErrorCallbacks=[];this._timeSinceLastLockChange=0;this._isInitialized=!1}_initialize(){if(this._isInitialized)return;this._isInitialized=!0;let t=()=>{this._timeSinceLastLockChange=Date.now(),this._onLockChangeCallbacks.forEach(n=>n())},r=n=>{this._timeSinceLastLockChange=Date.now(),this._onLockErrorCallbacks.forEach(i=>i(n))};for(let n of lr)if(n.methodName in document){document.addEventListener(n.propertyName,t,!1);break}for(let n of hr)if(n.methodName in document){document.addEventListener(n.propertyName,r,!1);break}}canBePointerLocked(t){for(let r of rt)if(r in t)return!0;return!1}isPointerLocked(t){for(let r of cr)if(r in document)return document[r]===t;return!1}async requestPointerLock(t){if(this.isPointerLocked(t))return{success:!1,message:"element already locked"};if(this._initialize(),this._timeSinceLastLockChange>0){let r=(Date.now()-this._timeSinceLastLockChange)/1e3;if(r<1.1)return{success:!1,message:"request for lock was too early, time to wait: ".concat(r.toFixed(2),"sec")}}this._timeSinceLastLockChange=Date.now();for(let r of rt)if(r in t){let n={unadjustedMovement:!1};try{await t[r](n)}catch(i){let s=(Date.now()-this._timeSinceLastLockChange)/1e3;return{success:!1,message:"request for lock was too early, time to wait: ".concat(s.toFixed(2),"sec")}}return this._timeSinceLastLockChange=Date.now(),{success:!0,message:"request for lock done"}}return{success:!1,message:"unsupported request for lock"}}allowPointerLockedOnClickEvent(t){if(t===this._latestRequestHtmlElement)return;this._latestRequestHtmlElement=t;let r=async()=>{t.removeEventListener("click",r);let n=await this.requestPointerLock(t);this._latestRequestHtmlElement=void 0,n.success||this.allowPointerLockedOnClickEvent(t)};t.addEventListener("click",r)}exitPointerLock(){for(let t of dr)if(t in document){document[t]();break}}addOnLockChange(t){this._onLockChangeCallbacks.push(t)}removeOnLockChange(t){let r=this._onLockChangeCallbacks.indexOf(t);r<0||this._onLockChangeCallbacks.splice(r,1)}addOnLockError(t){this._onLockErrorCallbacks.push(t)}removeOnLockError(t){let r=this._onLockErrorCallbacks.indexOf(t);r<0||this._onLockErrorCallbacks.splice(r,1)}},re=new Xe;var Ye=class{constructor(t,r,n){this.createdAt=Date.now();this.deltaX=0;this.deltaY=0;this.id=t,this.positionX=r,this.positionY=n}resetDelta(){this.deltaX=0,this.deltaY=0}},He=class{constructor(){this._activated=!1;this._allTouchDataMap=new Map;this._allCachedTouchDataArray=[];let t=i=>{i.preventDefault();for(let s=0;s<i.changedTouches.length;++s){let{identifier:a,pageX:o,pageY:f}=i.changedTouches[s],d=new Ye(a,o,f);this._allTouchDataMap.set("".concat(a),d),this._allCachedTouchDataArray.length=0}},r=i=>{i.preventDefault();for(let s=0;s<i.changedTouches.length;++s){let{identifier:a}=i.changedTouches[s];this._allTouchDataMap.delete("".concat(a)),this._allCachedTouchDataArray.length=0}},n=i=>{i.preventDefault();for(let s=0;s<i.changedTouches.length;++s){let{identifier:a,pageX:o,pageY:f}=i.changedTouches[s],d=this._allTouchDataMap.get("".concat(a));if(!d)continue;let c=o-d.positionX,h=f-d.positionY;d.deltaX+=c,d.deltaY+=h,d.positionX=o,d.positionY=f}};this._activated=!1,this._handleTouchStart=t.bind(this),this._handleTouchEnd=r.bind(this),this._handleTouchMove=n.bind(this)}isSupported(t){return"ontouchstart"in t}activate(t){this.isSupported(t)&&(this._activated||(this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,t.addEventListener("touchstart",this._handleTouchStart),t.addEventListener("touchend",this._handleTouchEnd),t.addEventListener("touchcancel",this._handleTouchEnd),t.addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._activated=!0))}deactivate(t){this._activated&&(this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,t.removeEventListener("touchstart",this._handleTouchStart),t.removeEventListener("touchend",this._handleTouchEnd),t.removeEventListener("touchcancel",this._handleTouchEnd),t.removeEventListener("touchmove",this._handleTouchMove),this._activated=!1)}_refreshCache(){this._allCachedTouchDataArray.length===0&&(this._allCachedTouchDataArray=[...this._allTouchDataMap.values()])}getTouchData(){return this._refreshCache(),this._allCachedTouchDataArray}resetDeltas(){this._refreshCache(),this._allCachedTouchDataArray.forEach(t=>t.resetDelta())}},O=new He;var nt=()=>!!window.Worker;var it=()=>!!window.WebGL2RenderingContext;var ge={};Y(ge,{ColorTextureType:()=>st,DepthTextureType:()=>at,FrameBuffer:()=>qe,GeometryWrapper:()=>L,ShaderProgram:()=>N,Texture:()=>X,WebGLContext:()=>S});var U=class U{static initialize(t){let r={alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!1};if(U._gl=t.getContext("webgl2",r),!U._gl)throw new Error("could not create webgl context");U._extensionLoseContext=U._gl.getExtension("WEBGL_lose_context"),U._gl.getExtension("EXT_color_buffer_float"),U._gl.getExtension("EXT_float_blend")}static getContext(){if(!U._gl)throw new Error("webgl context not initialized");return U._gl}static getExtensionLoseContext(){return U._extensionLoseContext}static getExtensionLoseContextStrict(){if(!U._extensionLoseContext)throw new Error("lose context extension not available");return U._extensionLoseContext}};U._gl=null,U._extensionLoseContext=null;var S=U;var st=(r=>(r[r.RBGA_UBYTES=0]="RBGA_UBYTES",r[r.RBGA_FLOAT=1]="RBGA_FLOAT",r))(st||{}),at=(t=>(t[t.FLOAT=0]="FLOAT",t))(at||{}),qe=class{constructor(t){this._colorsTex=[];this._def=ee({},t);let r=S.getContext(),n=r.createFramebuffer();if(n===null)throw new Error("null frame buffer object");this._fbo=n,r.bindFramebuffer(r.FRAMEBUFFER,this._fbo);{let s=r.createTexture();if(s===null)throw new Error("null texture object");this._depthTex=s;let a=0,o=0,f=r.DEPTH_COMPONENT,d=r.DEPTH_COMPONENT32F,c=r.FLOAT;r.bindTexture(r.TEXTURE_2D,this._depthTex),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,a,d,this._def.width,this._def.height,o,f,c,null),r.bindFramebuffer(r.FRAMEBUFFER,this._fbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,this._depthTex,0)}this._def.colorTextures.forEach(s=>{let a=r.createTexture();if(a===null)throw new Error("null texture object");this._colorsTex.push(a);let o=0,f=0,d=r.RGBA,c=r.RGBA32F,h=r.FLOAT;s.type===0&&(c=r.RGBA,h=r.UNSIGNED_BYTE),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,o,c,this._def.width,this._def.height,f,d,h,null),r.bindFramebuffer(r.FRAMEBUFFER,this._fbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+s.index,r.TEXTURE_2D,a,0)});{let s=r.checkFramebufferStatus(r.FRAMEBUFFER);if(s==r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(s==r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");if(s==r.FRAMEBUFFER_UNSUPPORTED)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_UNSUPPORTED");if(s==r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE");if(s!=r.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer incomplete -> ???")}let i=t.colorTextures.map(s=>r.COLOR_ATTACHMENT0+s.index);r.drawBuffers(i),r.bindFramebuffer(r.FRAMEBUFFER,null)}resize(t,r){this._def.width=t,this._def.height=r;let n=S.getContext();{let a=n.DEPTH_COMPONENT,o=n.DEPTH_COMPONENT32F,f=n.FLOAT;n.bindTexture(n.TEXTURE_2D,this._depthTex),n.texImage2D(n.TEXTURE_2D,0,o,this._def.width,this._def.height,0,a,f,null)}{let a=n.RGBA;this._colorsTex.forEach((o,f)=>{let d=n.RGBA32F,c=n.FLOAT;this._def.colorTextures[f].type===0&&(d=n.RGBA,c=n.UNSIGNED_BYTE),n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,d,this._def.width,this._def.height,0,a,c,null)})}}bind(){let t=S.getContext();t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)}static unbind(){let t=S.getContext();t.bindFramebuffer(t.FRAMEBUFFER,null)}get depthTexture(){return this._depthTex}get colorsTextures(){return this._colorsTex}get width(){return this._def.width}get height(){return this._def.height}};var L;(a=>{a.BytesPerPixel=4;let t;(p=>(p[p.float=0]="float",p[p.vec2f=1]="vec2f",p[p.vec3f=2]="vec3f",p[p.vec4f=3]="vec4f",p[p.mat3f=4]="mat3f",p[p.mat4f=5]="mat4f"))(t=a.AttributeType||(a.AttributeType={}));let r=o=>{switch(o){case 0:return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 9;case 5:return 16}},n;(c=>(c[c.lines=0]="lines",c[c.triangles=1]="triangles",c[c.triangleStrip=2]="triangleStrip"))(n=a.PrimitiveType||(a.PrimitiveType={}));class i{constructor(f,d){this._primitiveStart=0;this._primitiveCount=0;this._instanceCount=0;this._isInstanced=!1;let c=S.getContext();if(d.vbos.length===0)throw new Error("empty vbo definition");for(let u of d.vbos){if(u.attrs.length===0)throw new Error("empty vbo attribute definition");for(let p of u.attrs)if(!f.hasAttribute(p.name))throw new Error('attribute not found, name="'.concat(p.name,'"'))}switch(this._def=d,d.primitiveType){case 0:this._primitiveType=c.LINES;break;case 1:this._primitiveType=c.TRIANGLES;break;case 2:this._primitiveType=c.TRIANGLE_STRIP;break;default:throw new Error("primitive type not found")}let h=c.createVertexArray();if(!h)throw new Error("fail o create a vao unit");this._vao=h,c.bindVertexArray(this._vao),this._vbos=[];for(let u of this._def.vbos){let p=c.createBuffer();if(!p)throw new Error("fail o create a vbo unit");this._vbos.push({object:p,maxSize:0,dynamic:u.dynamic||!1}),c.bindBuffer(c.ARRAY_BUFFER,p);let _=u.stride||0;if(!_){for(let v of u.attrs)switch(v.type){case 0:_+=1;break;case 1:_+=2;break;case 2:_+=3;break;case 3:_+=4;break;case 4:_+=9;break;case 5:_+=16;break}_*=4}for(let v of u.attrs){let m=1,g=1;switch(v.type){case 0:m=1,g=1;break;case 1:m=2,g=1;break;case 2:m=3,g=1;break;case 3:m=4,g=1;break;case 4:m=3,g=3;break;case 5:m=4,g=4;break}let T=f.getAttribute(v.name);for(let x=0;x<g;++x){let b=T+x,y=(v.index+x*m)*4;c.enableVertexAttribArray(b),c.vertexAttribPointer(b,m,c.FLOAT,!1,_,y),u.instanced===!0&&(c.vertexAttribDivisor(b,1),this._isInstanced=!0)}}}c.bindVertexArray(null)}dispose(){let f=S.getContext();for(let d of this._vbos)f.deleteBuffer(d.object);this._vbos.length=0,f.deleteVertexArray(this._vao)}setBufferSize(f,d){if(f<0||f>=this._vbos.length)throw new Error("no buffer available to that index");if(d<=0)return;let c=this._vbos[f];if(d<c.maxSize)return;c.maxSize=d;let h=S.getContext(),u=c.dynamic?h.DYNAMIC_DRAW:h.STATIC_DRAW;h.bindBuffer(h.ARRAY_BUFFER,c.object),h.bufferData(h.ARRAY_BUFFER,d,u),h.bindBuffer(h.ARRAY_BUFFER,null)}setFloatBufferSize(f,d){this.setBufferSize(f,d*4)}updateBuffer(f,d,c){if(f<0||f>=this._vbos.length)throw new Error("no buffer available to that index");if(c<=0)return;let h=S.getContext(),u=d instanceof Float32Array?d:new Float32Array(d),p=this._vbos[f];if(h.bindBuffer(h.ARRAY_BUFFER,p.object),c>p.maxSize){p.maxSize=c;let _=p.dynamic?h.DYNAMIC_DRAW:h.STATIC_DRAW;h.bufferData(h.ARRAY_BUFFER,u,_,0,c)}else h.bufferSubData(h.ARRAY_BUFFER,0,u,0,c);h.bindBuffer(h.ARRAY_BUFFER,null)}render(){if(this._primitiveCount==0||this._isInstanced&&this._instanceCount==0)return;let f=S.getContext();f.bindVertexArray(this._vao),this._isInstanced===!0?f.drawArraysInstanced(this._primitiveType,this._primitiveStart,this._primitiveCount,this._instanceCount):f.drawArrays(this._primitiveType,this._primitiveStart,this._primitiveCount),f.bindVertexArray(null)}setPrimitiveStart(f){this._primitiveStart=f}setPrimitiveCount(f){this._primitiveCount=f}setInstancedCount(f){this._instanceCount=f}}a.Geometry=i;class s{constructor(){this._def={vbos:[],primitiveType:0}}reset(){return this._def={vbos:[],primitiveType:0},this}getDef(){return this._def}setPrimitiveType(f){return this._def.primitiveType=n[f],this}addVbo(){return this._def.vbos.push({attrs:[],instanced:!1}),this}setVboAsInstanced(){return this._getLastVbo().instanced=!0,this}setVboAsDynamic(){return this._getLastVbo().dynamic=!0,this}setStride(f){return this._getLastVbo().stride=f,this}addVboAttribute(f,d){let c=this._getLastVbo(),h=c.attrs.length>0?c.attrs[c.attrs.length-1]:null;return c.attrs.push({name:f,type:t[d],index:h?h.index+r(h.type):0}),this}_getLastVbo(){if(this._def.vbos.length===0)throw new Error("no VBO setup");return this._def.vbos[this._def.vbos.length-1]}}a.GeometryBuilder=s})(L||(L={}));var $=class ${constructor(t,r){this._attributes=new Map;this._uniforms=new Map;this._name=t;let n=S.getContext(),i=this._getShader(r.vertexSrc,n.VERTEX_SHADER),s=this._getShader(r.fragmentSrc,n.FRAGMENT_SHADER),a=n.createProgram();if(!a)throw new Error("could not create a shader program");if(n.attachShader(a,i),n.attachShader(a,s),n.linkProgram(a),n.deleteShader(i),n.deleteShader(s),!n.getProgramParameter(a,n.LINK_STATUS)){let o=n.getProgramInfoLog(a);throw new Error("Failed to initialized shaders, Error linking:"+o)}this._program=a,this.bind(()=>{this._getAttributes(r.attributes),this._getUniforms(r.uniforms)})}async bind(t){if($._isBound!==null)throw new Error("Double shader binding (bound: ".concat($._isBound._name,", binding: ").concat(this._name,")"));$._isBound=this,S.getContext().useProgram(this._program),t(),$.unbind()}static unbind(){S.getContext().useProgram(null),$._isBound=null}isBound(){return $._isBound===this}hasAttribute(t){return this._attributes.has(t)}getAttribute(t){let r=this._attributes.get(t);if(r===void 0)throw new Error("attribute not found: ".concat(t));return r}getUniform(t){let r=this._uniforms.get(t);if(r===void 0)throw new Error("uniform not found: ".concat(t));return r}setTextureUniform(t,r,n){let i=S.getContext();i.activeTexture(i.TEXTURE0+n),i.uniform1i(this.getUniform(t),n),r.bind()}setInteger1Uniform(t,r){S.getContext().uniform1i(this.getUniform(t),r)}setInteger2Uniform(t,r,n){S.getContext().uniform2i(this.getUniform(t),r,n)}setInteger3Uniform(t,r,n,i){S.getContext().uniform3i(this.getUniform(t),r,n,i)}setFloat1Uniform(t,r){S.getContext().uniform1f(this.getUniform(t),r)}setFloat2Uniform(t,r,n){S.getContext().uniform2f(this.getUniform(t),r,n)}setFloat3Uniform(t,r,n,i){S.getContext().uniform3f(this.getUniform(t),r,n,i)}setMatrix4Uniform(t,r){S.getContext().uniformMatrix4fv(this.getUniform(t),!1,r)}_getAttributes(t){let r=S.getContext();for(let n=0;n<t.length;++n){let i=r.getAttribLocation(this._program,t[n]);if(i<0)throw new Error("attribute not found => ".concat(t[n]));this._attributes.set(t[n],i)}}_getUniforms(t){let r=S.getContext();for(let n=0;n<t.length;++n){let i=r.getUniformLocation(this._program,t[n]);if(i===null)throw new Error("uniform not found => ".concat(t[n]));this._uniforms.set(t[n],i)}}_getShader(t,r){let n=S.getContext(),i=n.createShader(r);if(!i)throw new Error("could not create a shader");if(n.shaderSource(i,t),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS)){let s=n.getShaderInfoLog(i);throw s||(s="failed to compile a shader"),new Error(s)}return i}};$._isBound=null;var N=$;var X=class{constructor(){this._width=0;this._height=0;this._texture=null}async load(t,r=!1){let n=S.getContext();this._texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this._texture);let i=0,s=n.RGBA,a=1,o=1,f=0,d=n.RGBA,c=n.UNSIGNED_BYTE,h=new Uint8Array([0,0,255,255]);return n.texImage2D(n.TEXTURE_2D,i,s,a,o,f,d,c,h),n.bindTexture(n.TEXTURE_2D,null),new Promise((u,p)=>{let _=new Image;_.onerror=p,_.onload=()=>{this._width=_.width,this._height=_.height,n.bindTexture(n.TEXTURE_2D,this._texture),n.texImage2D(n.TEXTURE_2D,i,s,d,c,_),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);let v=r?n.NEAREST:n.LINEAR;n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,v),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,v),n.bindTexture(n.TEXTURE_2D,null),u()},_.src=t})}loadFromMemory(t,r,n,i=!1){let s=S.getContext();this._texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);let a=i?s.NEAREST:s.LINEAR;s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a);let o=0,f=s.RGBA,d=0,c=s.RGBA,h=s.UNSIGNED_BYTE;s.texImage2D(s.TEXTURE_2D,o,f,t,r,d,c,h,n),s.bindTexture(s.TEXTURE_2D,null)}getWidth(){if(!this._texture)throw new Error("texture not initialized");return this._width}getHeight(){if(!this._texture)throw new Error("texture not initialized");return this._height}bind(){if(!this._texture)throw new Error("texture not initialized");let t=S.getContext();t.bindTexture(t.TEXTURE_2D,this._texture)}static unbind(){let t=S.getContext();t.bindTexture(t.TEXTURE_2D,null)}};var ot=Math.PI*.45,ft=.3,dt="./dist/worker.js",ct=2;var C=1e-6,P=typeof Float32Array<"u"?Float32Array:Array,H=Math.random;var pa=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var F={};Y(F,{add:()=>Zr,adjoint:()=>yr,clone:()=>pr,copy:()=>_r,create:()=>ur,determinant:()=>Mr,equals:()=>tn,exactEquals:()=>en,frob:()=>$r,fromQuat:()=>Br,fromQuat2:()=>Pr,fromRotation:()=>Vr,fromRotationTranslation:()=>mt,fromRotationTranslationScale:()=>Gr,fromRotationTranslationScaleOrigin:()=>Ur,fromScaling:()=>Ar,fromTranslation:()=>wr,fromValues:()=>vr,fromXRotation:()=>Dr,fromYRotation:()=>Lr,fromZRotation:()=>zr,frustum:()=>Nr,getRotation:()=>Ir,getScaling:()=>ut,getTranslation:()=>Fr,identity:()=>lt,invert:()=>br,lookAt:()=>qr,mul:()=>rn,multiply:()=>ht,multiplyScalar:()=>Qr,multiplyScalarAndAdd:()=>Jr,ortho:()=>Yr,orthoNO:()=>_t,orthoZO:()=>Hr,perspective:()=>Wr,perspectiveFromFieldOfView:()=>Xr,perspectiveNO:()=>pt,perspectiveZO:()=>Or,rotate:()=>Er,rotateX:()=>Sr,rotateY:()=>Cr,rotateZ:()=>kr,scale:()=>Tr,set:()=>gr,str:()=>Kr,sub:()=>nn,subtract:()=>vt,targetTo:()=>jr,translate:()=>Rr,transpose:()=>xr});function ur(){var e=new P(16);return P!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function pr(e){var t=new P(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vr(e,t,r,n,i,s,a,o,f,d,c,h,u,p,_,v){var m=new P(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=i,m[5]=s,m[6]=a,m[7]=o,m[8]=f,m[9]=d,m[10]=c,m[11]=h,m[12]=u,m[13]=p,m[14]=_,m[15]=v,m}function gr(e,t,r,n,i,s,a,o,f,d,c,h,u,p,_,v,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=s,e[5]=a,e[6]=o,e[7]=f,e[8]=d,e[9]=c,e[10]=h,e[11]=u,e[12]=p,e[13]=_,e[14]=v,e[15]=m,e}function lt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xr(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function br(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],f=t[6],d=t[7],c=t[8],h=t[9],u=t[10],p=t[11],_=t[12],v=t[13],m=t[14],g=t[15],T=r*o-n*a,x=r*f-i*a,b=r*d-s*a,y=n*f-i*o,M=n*d-s*o,A=i*d-s*f,k=c*v-h*_,w=c*m-u*_,V=c*g-p*_,D=h*m-u*v,z=h*g-p*v,G=u*g-p*m,E=T*G-x*z+b*D+y*V-M*w+A*k;return E?(E=1/E,e[0]=(o*G-f*z+d*D)*E,e[1]=(i*z-n*G-s*D)*E,e[2]=(v*A-m*M+g*y)*E,e[3]=(u*M-h*A-p*y)*E,e[4]=(f*V-a*G-d*w)*E,e[5]=(r*G-i*V+s*w)*E,e[6]=(m*b-_*A-g*x)*E,e[7]=(c*A-u*b+p*x)*E,e[8]=(a*z-o*V+d*k)*E,e[9]=(n*V-r*z-s*k)*E,e[10]=(_*M-v*b+g*T)*E,e[11]=(h*b-c*M-p*T)*E,e[12]=(o*w-a*D-f*k)*E,e[13]=(r*D-n*w+i*k)*E,e[14]=(v*x-_*y-m*T)*E,e[15]=(c*y-h*x+u*T)*E,e):null}function yr(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],f=t[6],d=t[7],c=t[8],h=t[9],u=t[10],p=t[11],_=t[12],v=t[13],m=t[14],g=t[15];return e[0]=o*(u*g-p*m)-h*(f*g-d*m)+v*(f*p-d*u),e[1]=-(n*(u*g-p*m)-h*(i*g-s*m)+v*(i*p-s*u)),e[2]=n*(f*g-d*m)-o*(i*g-s*m)+v*(i*d-s*f),e[3]=-(n*(f*p-d*u)-o*(i*p-s*u)+h*(i*d-s*f)),e[4]=-(a*(u*g-p*m)-c*(f*g-d*m)+_*(f*p-d*u)),e[5]=r*(u*g-p*m)-c*(i*g-s*m)+_*(i*p-s*u),e[6]=-(r*(f*g-d*m)-a*(i*g-s*m)+_*(i*d-s*f)),e[7]=r*(f*p-d*u)-a*(i*p-s*u)+c*(i*d-s*f),e[8]=a*(h*g-p*v)-c*(o*g-d*v)+_*(o*p-d*h),e[9]=-(r*(h*g-p*v)-c*(n*g-s*v)+_*(n*p-s*h)),e[10]=r*(o*g-d*v)-a*(n*g-s*v)+_*(n*d-s*o),e[11]=-(r*(o*p-d*h)-a*(n*p-s*h)+c*(n*d-s*o)),e[12]=-(a*(h*m-u*v)-c*(o*m-f*v)+_*(o*u-f*h)),e[13]=r*(h*m-u*v)-c*(n*m-i*v)+_*(n*u-i*h),e[14]=-(r*(o*m-f*v)-a*(n*m-i*v)+_*(n*f-i*o)),e[15]=r*(o*u-f*h)-a*(n*u-i*h)+c*(n*f-i*o),e}function Mr(e){var t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],f=e[7],d=e[8],c=e[9],h=e[10],u=e[11],p=e[12],_=e[13],v=e[14],m=e[15],g=t*a-r*s,T=t*o-n*s,x=t*f-i*s,b=r*o-n*a,y=r*f-i*a,M=n*f-i*o,A=d*_-c*p,k=d*v-h*p,w=d*m-u*p,V=c*v-h*_,D=c*m-u*_,z=h*m-u*v;return g*z-T*D+x*V+b*w-y*k+M*A}function ht(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],f=t[5],d=t[6],c=t[7],h=t[8],u=t[9],p=t[10],_=t[11],v=t[12],m=t[13],g=t[14],T=t[15],x=r[0],b=r[1],y=r[2],M=r[3];return e[0]=x*n+b*o+y*h+M*v,e[1]=x*i+b*f+y*u+M*m,e[2]=x*s+b*d+y*p+M*g,e[3]=x*a+b*c+y*_+M*T,x=r[4],b=r[5],y=r[6],M=r[7],e[4]=x*n+b*o+y*h+M*v,e[5]=x*i+b*f+y*u+M*m,e[6]=x*s+b*d+y*p+M*g,e[7]=x*a+b*c+y*_+M*T,x=r[8],b=r[9],y=r[10],M=r[11],e[8]=x*n+b*o+y*h+M*v,e[9]=x*i+b*f+y*u+M*m,e[10]=x*s+b*d+y*p+M*g,e[11]=x*a+b*c+y*_+M*T,x=r[12],b=r[13],y=r[14],M=r[15],e[12]=x*n+b*o+y*h+M*v,e[13]=x*i+b*f+y*u+M*m,e[14]=x*s+b*d+y*p+M*g,e[15]=x*a+b*c+y*_+M*T,e}function Rr(e,t,r){var n=r[0],i=r[1],s=r[2],a,o,f,d,c,h,u,p,_,v,m,g;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*s+t[12],e[13]=t[1]*n+t[5]*i+t[9]*s+t[13],e[14]=t[2]*n+t[6]*i+t[10]*s+t[14],e[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],f=t[2],d=t[3],c=t[4],h=t[5],u=t[6],p=t[7],_=t[8],v=t[9],m=t[10],g=t[11],e[0]=a,e[1]=o,e[2]=f,e[3]=d,e[4]=c,e[5]=h,e[6]=u,e[7]=p,e[8]=_,e[9]=v,e[10]=m,e[11]=g,e[12]=a*n+c*i+_*s+t[12],e[13]=o*n+h*i+v*s+t[13],e[14]=f*n+u*i+m*s+t[14],e[15]=d*n+p*i+g*s+t[15]),e}function Tr(e,t,r){var n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Er(e,t,r,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),f,d,c,h,u,p,_,v,m,g,T,x,b,y,M,A,k,w,V,D,z,G,E,B;return o<C?null:(o=1/o,i*=o,s*=o,a*=o,f=Math.sin(r),d=Math.cos(r),c=1-d,h=t[0],u=t[1],p=t[2],_=t[3],v=t[4],m=t[5],g=t[6],T=t[7],x=t[8],b=t[9],y=t[10],M=t[11],A=i*i*c+d,k=s*i*c+a*f,w=a*i*c-s*f,V=i*s*c-a*f,D=s*s*c+d,z=a*s*c+i*f,G=i*a*c+s*f,E=s*a*c-i*f,B=a*a*c+d,e[0]=h*A+v*k+x*w,e[1]=u*A+m*k+b*w,e[2]=p*A+g*k+y*w,e[3]=_*A+T*k+M*w,e[4]=h*V+v*D+x*z,e[5]=u*V+m*D+b*z,e[6]=p*V+g*D+y*z,e[7]=_*V+T*D+M*z,e[8]=h*G+v*E+x*B,e[9]=u*G+m*E+b*B,e[10]=p*G+g*E+y*B,e[11]=_*G+T*E+M*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Sr(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[4],a=t[5],o=t[6],f=t[7],d=t[8],c=t[9],h=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+d*n,e[5]=a*i+c*n,e[6]=o*i+h*n,e[7]=f*i+u*n,e[8]=d*i-s*n,e[9]=c*i-a*n,e[10]=h*i-o*n,e[11]=u*i-f*n,e}function Cr(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],f=t[3],d=t[8],c=t[9],h=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-d*n,e[1]=a*i-c*n,e[2]=o*i-h*n,e[3]=f*i-u*n,e[8]=s*n+d*i,e[9]=a*n+c*i,e[10]=o*n+h*i,e[11]=f*n+u*i,e}function kr(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],f=t[3],d=t[4],c=t[5],h=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+d*n,e[1]=a*i+c*n,e[2]=o*i+h*n,e[3]=f*i+u*n,e[4]=d*i-s*n,e[5]=c*i-a*n,e[6]=h*i-o*n,e[7]=u*i-f*n,e}function wr(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ar(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vr(e,t,r){var n=r[0],i=r[1],s=r[2],a=Math.hypot(n,i,s),o,f,d;return a<C?null:(a=1/a,n*=a,i*=a,s*=a,o=Math.sin(t),f=Math.cos(t),d=1-f,e[0]=n*n*d+f,e[1]=i*n*d+s*o,e[2]=s*n*d-i*o,e[3]=0,e[4]=n*i*d-s*o,e[5]=i*i*d+f,e[6]=s*i*d+n*o,e[7]=0,e[8]=n*s*d+i*o,e[9]=i*s*d-n*o,e[10]=s*s*d+f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Dr(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lr(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mt(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=n+n,f=i+i,d=s+s,c=n*o,h=n*f,u=n*d,p=i*f,_=i*d,v=s*d,m=a*o,g=a*f,T=a*d;return e[0]=1-(p+v),e[1]=h+T,e[2]=u-g,e[3]=0,e[4]=h-T,e[5]=1-(c+v),e[6]=_+m,e[7]=0,e[8]=u+g,e[9]=_-m,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Pr(e,t){var r=new P(3),n=-t[0],i=-t[1],s=-t[2],a=t[3],o=t[4],f=t[5],d=t[6],c=t[7],h=n*n+i*i+s*s+a*a;return h>0?(r[0]=(o*a+c*n+f*s-d*i)*2/h,r[1]=(f*a+c*i+d*n-o*s)*2/h,r[2]=(d*a+c*s+o*i-f*n)*2/h):(r[0]=(o*a+c*n+f*s-d*i)*2,r[1]=(f*a+c*i+d*n-o*s)*2,r[2]=(d*a+c*s+o*i-f*n)*2),mt(e,t,r),e}function Fr(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ut(e,t){var r=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],f=t[8],d=t[9],c=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(f,d,c),e}function Ir(e,t){var r=new P(3);ut(r,t);var n=1/r[0],i=1/r[1],s=1/r[2],a=t[0]*n,o=t[1]*i,f=t[2]*s,d=t[4]*n,c=t[5]*i,h=t[6]*s,u=t[8]*n,p=t[9]*i,_=t[10]*s,v=a+c+_,m=0;return v>0?(m=Math.sqrt(v+1)*2,e[3]=.25*m,e[0]=(h-p)/m,e[1]=(u-f)/m,e[2]=(o-d)/m):a>c&&a>_?(m=Math.sqrt(1+a-c-_)*2,e[3]=(h-p)/m,e[0]=.25*m,e[1]=(o+d)/m,e[2]=(u+f)/m):c>_?(m=Math.sqrt(1+c-a-_)*2,e[3]=(u-f)/m,e[0]=(o+d)/m,e[1]=.25*m,e[2]=(h+p)/m):(m=Math.sqrt(1+_-a-c)*2,e[3]=(o-d)/m,e[0]=(u+f)/m,e[1]=(h+p)/m,e[2]=.25*m),e}function Gr(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=t[3],f=i+i,d=s+s,c=a+a,h=i*f,u=i*d,p=i*c,_=s*d,v=s*c,m=a*c,g=o*f,T=o*d,x=o*c,b=n[0],y=n[1],M=n[2];return e[0]=(1-(_+m))*b,e[1]=(u+x)*b,e[2]=(p-T)*b,e[3]=0,e[4]=(u-x)*y,e[5]=(1-(h+m))*y,e[6]=(v+g)*y,e[7]=0,e[8]=(p+T)*M,e[9]=(v-g)*M,e[10]=(1-(h+_))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ur(e,t,r,n,i){var s=t[0],a=t[1],o=t[2],f=t[3],d=s+s,c=a+a,h=o+o,u=s*d,p=s*c,_=s*h,v=a*c,m=a*h,g=o*h,T=f*d,x=f*c,b=f*h,y=n[0],M=n[1],A=n[2],k=i[0],w=i[1],V=i[2],D=(1-(v+g))*y,z=(p+b)*y,G=(_-x)*y,E=(p-b)*M,B=(1-(u+g))*M,J=(m+T)*M,ae=(_+x)*A,xe=(m-T)*A,be=(1-(u+v))*A;return e[0]=D,e[1]=z,e[2]=G,e[3]=0,e[4]=E,e[5]=B,e[6]=J,e[7]=0,e[8]=ae,e[9]=xe,e[10]=be,e[11]=0,e[12]=r[0]+k-(D*k+E*w+ae*V),e[13]=r[1]+w-(z*k+B*w+xe*V),e[14]=r[2]+V-(G*k+J*w+be*V),e[15]=1,e}function Br(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r+r,o=n+n,f=i+i,d=r*a,c=n*a,h=n*o,u=i*a,p=i*o,_=i*f,v=s*a,m=s*o,g=s*f;return e[0]=1-h-_,e[1]=c+g,e[2]=u-m,e[3]=0,e[4]=c-g,e[5]=1-d-_,e[6]=p+v,e[7]=0,e[8]=u+m,e[9]=p-v,e[10]=1-d-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nr(e,t,r,n,i,s,a){var o=1/(r-t),f=1/(i-n),d=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*f,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(i+n)*f,e[10]=(a+s)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*d,e[15]=0,e}function pt(e,t,r,n,i){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var Wr=pt;function Or(e,t,r,n,i){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=i*a,e[14]=i*n*a):(e[10]=-1,e[14]=-n),e}function Xr(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),f=2/(a+o),d=2/(i+s);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=-((a-o)*f*.5),e[9]=(i-s)*d*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function _t(e,t,r,n,i,s,a){var o=1/(t-r),f=1/(n-i),d=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*d,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*f,e[14]=(a+s)*d,e[15]=1,e}var Yr=_t;function Hr(e,t,r,n,i,s,a){var o=1/(t-r),f=1/(n-i),d=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=d,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*f,e[14]=s*d,e[15]=1,e}function qr(e,t,r,n){var i,s,a,o,f,d,c,h,u,p,_=t[0],v=t[1],m=t[2],g=n[0],T=n[1],x=n[2],b=r[0],y=r[1],M=r[2];return Math.abs(_-b)<C&&Math.abs(v-y)<C&&Math.abs(m-M)<C?lt(e):(c=_-b,h=v-y,u=m-M,p=1/Math.hypot(c,h,u),c*=p,h*=p,u*=p,i=T*u-x*h,s=x*c-g*u,a=g*h-T*c,p=Math.hypot(i,s,a),p?(p=1/p,i*=p,s*=p,a*=p):(i=0,s=0,a=0),o=h*a-u*s,f=u*i-c*a,d=c*s-h*i,p=Math.hypot(o,f,d),p?(p=1/p,o*=p,f*=p,d*=p):(o=0,f=0,d=0),e[0]=i,e[1]=o,e[2]=c,e[3]=0,e[4]=s,e[5]=f,e[6]=h,e[7]=0,e[8]=a,e[9]=d,e[10]=u,e[11]=0,e[12]=-(i*_+s*v+a*m),e[13]=-(o*_+f*v+d*m),e[14]=-(c*_+h*v+u*m),e[15]=1,e)}function jr(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=n[0],f=n[1],d=n[2],c=i-r[0],h=s-r[1],u=a-r[2],p=c*c+h*h+u*u;p>0&&(p=1/Math.sqrt(p),c*=p,h*=p,u*=p);var _=f*u-d*h,v=d*c-o*u,m=o*h-f*c;return p=_*_+v*v+m*m,p>0&&(p=1/Math.sqrt(p),_*=p,v*=p,m*=p),e[0]=_,e[1]=v,e[2]=m,e[3]=0,e[4]=h*m-u*v,e[5]=u*_-c*m,e[6]=c*v-h*_,e[7]=0,e[8]=c,e[9]=h,e[10]=u,e[11]=0,e[12]=i,e[13]=s,e[14]=a,e[15]=1,e}function Kr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function $r(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Zr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function vt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Qr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Jr(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function en(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function tn(e,t){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],f=e[6],d=e[7],c=e[8],h=e[9],u=e[10],p=e[11],_=e[12],v=e[13],m=e[14],g=e[15],T=t[0],x=t[1],b=t[2],y=t[3],M=t[4],A=t[5],k=t[6],w=t[7],V=t[8],D=t[9],z=t[10],G=t[11],E=t[12],B=t[13],J=t[14],ae=t[15];return Math.abs(r-T)<=C*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-x)<=C*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-b)<=C*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-y)<=C*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(a-M)<=C*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-A)<=C*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(f-k)<=C*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-w)<=C*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(c-V)<=C*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(h-D)<=C*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(u-z)<=C*Math.max(1,Math.abs(u),Math.abs(z))&&Math.abs(p-G)<=C*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(_-E)<=C*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(v-B)<=C*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(m-J)<=C*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(g-ae)<=C*Math.max(1,Math.abs(g),Math.abs(ae))}var rn=ht,nn=vt;var R={};Y(R,{add:()=>dn,angle:()=>Vn,bezier:()=>Rn,ceil:()=>cn,clone:()=>sn,copy:()=>on,create:()=>gt,cross:()=>bn,dist:()=>Un,distance:()=>Rt,div:()=>Gn,divide:()=>Mt,dot:()=>St,equals:()=>Pn,exactEquals:()=>zn,floor:()=>ln,forEach:()=>On,fromValues:()=>an,hermite:()=>Mn,inverse:()=>gn,len:()=>Nn,length:()=>xt,lerp:()=>yn,max:()=>mn,min:()=>hn,mul:()=>In,multiply:()=>yt,negate:()=>vn,normalize:()=>xn,random:()=>Tn,rotateX:()=>kn,rotateY:()=>wn,rotateZ:()=>An,round:()=>un,scale:()=>pn,scaleAndAdd:()=>_n,set:()=>fn,sqrDist:()=>Bn,sqrLen:()=>Wn,squaredDistance:()=>Tt,squaredLength:()=>Et,str:()=>Ln,sub:()=>Fn,subtract:()=>bt,transformMat3:()=>Sn,transformMat4:()=>En,transformQuat:()=>Cn,zero:()=>Dn});function gt(){var e=new P(3);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function sn(e){var t=new P(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function xt(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function an(e,t,r){var n=new P(3);return n[0]=e,n[1]=t,n[2]=r,n}function on(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function fn(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function dn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function bt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function yt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Mt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function cn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function ln(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function hn(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function mn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function un(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function pn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function _n(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Rt(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function Tt(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function Et(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function vn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function gn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function xn(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function St(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function bn(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],f=r[2];return e[0]=i*f-s*o,e[1]=s*a-n*f,e[2]=n*o-i*a,e}function yn(e,t,r,n){var i=t[0],s=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=a+n*(r[2]-a),e}function Mn(e,t,r,n,i,s){var a=s*s,o=a*(2*s-3)+1,f=a*(s-2)+s,d=a*(s-1),c=a*(3-2*s);return e[0]=t[0]*o+r[0]*f+n[0]*d+i[0]*c,e[1]=t[1]*o+r[1]*f+n[1]*d+i[1]*c,e[2]=t[2]*o+r[2]*f+n[2]*d+i[2]*c,e}function Rn(e,t,r,n,i,s){var a=1-s,o=a*a,f=s*s,d=o*a,c=3*s*o,h=3*f*a,u=f*s;return e[0]=t[0]*d+r[0]*c+n[0]*h+i[0]*u,e[1]=t[1]*d+r[1]*c+n[1]*h+i[1]*u,e[2]=t[2]*d+r[2]*c+n[2]*h+i[2]*u,e}function Tn(e,t){t=t||1;var r=H()*2*Math.PI,n=H()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function En(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a,e}function Sn(e,t,r){var n=t[0],i=t[1],s=t[2];return e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8],e}function Cn(e,t,r){var n=r[0],i=r[1],s=r[2],a=r[3],o=t[0],f=t[1],d=t[2],c=i*d-s*f,h=s*o-n*d,u=n*f-i*o,p=i*u-s*h,_=s*c-n*u,v=n*h-i*c,m=a*2;return c*=m,h*=m,u*=m,p*=2,_*=2,v*=2,e[0]=o+c+p,e[1]=f+h+_,e[2]=d+u+v,e}function kn(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function wn(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function An(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Vn(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],a=t[1],o=t[2],f=Math.sqrt(r*r+n*n+i*i),d=Math.sqrt(s*s+a*a+o*o),c=f*d,h=c&&St(e,t)/c;return Math.acos(Math.min(Math.max(h,-1),1))}function Dn(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ln(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function zn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Pn(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=C*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=C*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=C*Math.max(1,Math.abs(i),Math.abs(o))}var Fn=bt,In=yt,Gn=Mt,Un=Rt,Bn=Tt,Nn=xt,Wn=Et,On=function(){var e=gt();return function(t,r,n,i,s,a){var o,f;for(r||(r=3),n||(n=0),i?f=Math.min(i*r+n,t.length):f=t.length,o=n;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();var Z={};Y(Z,{add:()=>jn,ceil:()=>Kn,clone:()=>Xn,copy:()=>Hn,create:()=>Ct,cross:()=>ai,dist:()=>gi,distance:()=>Vt,div:()=>vi,divide:()=>At,dot:()=>si,equals:()=>ui,exactEquals:()=>mi,floor:()=>$n,forEach:()=>Mi,fromValues:()=>Yn,inverse:()=>ni,len:()=>bi,length:()=>Lt,lerp:()=>oi,max:()=>Qn,min:()=>Zn,mul:()=>_i,multiply:()=>wt,negate:()=>ri,normalize:()=>ii,random:()=>fi,round:()=>Jn,scale:()=>ei,scaleAndAdd:()=>ti,set:()=>qn,sqrDist:()=>xi,sqrLen:()=>yi,squaredDistance:()=>Dt,squaredLength:()=>zt,str:()=>hi,sub:()=>pi,subtract:()=>kt,transformMat4:()=>di,transformQuat:()=>ci,zero:()=>li});function Ct(){var e=new P(4);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Xn(e){var t=new P(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Yn(e,t,r,n){var i=new P(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function Hn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function qn(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function jn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function kt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function wt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function At(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Kn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function $n(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Zn(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Qn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Jn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function ei(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ti(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Vt(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,n,i,s)}function Dt(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return r*r+n*n+i*i+s*s}function Lt(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function zt(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function ri(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ni(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ii(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r*r+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=s*a,e}function si(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ai(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],f=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],c=t[0],h=t[1],u=t[2],p=t[3];return e[0]=h*d-u*f+p*o,e[1]=-(c*d)+u*a-p*s,e[2]=c*f-h*a+p*i,e[3]=-(c*o)+h*s-u*i,e}function oi(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=t[3];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=a+n*(r[2]-a),e[3]=o+n*(r[3]-o),e}function fi(e,t){t=t||1;var r,n,i,s,a,o;do r=H()*2-1,n=H()*2-1,a=r*r+n*n;while(a>=1);do i=H()*2-1,s=H()*2-1,o=i*i+s*s;while(o>=1);var f=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*n,e[2]=t*i*f,e[3]=t*s*f,e}function di(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*a,e}function ci(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],f=r[2],d=r[3],c=d*n+o*s-f*i,h=d*i+f*n-a*s,u=d*s+a*i-o*n,p=-a*n-o*i-f*s;return e[0]=c*d+p*-a+h*-f-u*-o,e[1]=h*d+p*-o+u*-a-c*-f,e[2]=u*d+p*-f+c*-o-h*-a,e[3]=t[3],e}function li(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function hi(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ui(e,t){var r=e[0],n=e[1],i=e[2],s=e[3],a=t[0],o=t[1],f=t[2],d=t[3];return Math.abs(r-a)<=C*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=C*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-f)<=C*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-d)<=C*Math.max(1,Math.abs(s),Math.abs(d))}var pi=kt,_i=wt,vi=At,gi=Vt,xi=Dt,bi=Lt,yi=zt,Mi=function(){var e=Ct();return function(t,r,n,i,s,a){var o,f;for(r||(r=4),n||(n=0),i?f=Math.min(i*r+n,t.length):f=t.length,o=n;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();var q={};Y(q,{add:()=>Ci,angle:()=>qi,ceil:()=>ki,clone:()=>Ri,copy:()=>Ei,create:()=>Pt,cross:()=>Ui,dist:()=>rs,distance:()=>Ut,div:()=>ts,divide:()=>Gt,dot:()=>Gi,equals:()=>Zi,exactEquals:()=>$i,floor:()=>wi,forEach:()=>ss,fromValues:()=>Ti,inverse:()=>Fi,len:()=>Qi,length:()=>Nt,lerp:()=>Bi,max:()=>Vi,min:()=>Ai,mul:()=>es,multiply:()=>It,negate:()=>Pi,normalize:()=>Ii,random:()=>Ni,rotate:()=>Hi,round:()=>Di,scale:()=>Li,scaleAndAdd:()=>zi,set:()=>Si,sqrDist:()=>ns,sqrLen:()=>is,squaredDistance:()=>Bt,squaredLength:()=>Wt,str:()=>Ki,sub:()=>Ji,subtract:()=>Ft,transformMat2:()=>Wi,transformMat2d:()=>Oi,transformMat3:()=>Xi,transformMat4:()=>Yi,zero:()=>ji});function Pt(){var e=new P(2);return P!=Float32Array&&(e[0]=0,e[1]=0),e}function Ri(e){var t=new P(2);return t[0]=e[0],t[1]=e[1],t}function Ti(e,t){var r=new P(2);return r[0]=e,r[1]=t,r}function Ei(e,t){return e[0]=t[0],e[1]=t[1],e}function Si(e,t,r){return e[0]=t,e[1]=r,e}function Ci(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Ft(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function It(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Gt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function ki(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function wi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Ai(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Vi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Di(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Li(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function zi(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function Ut(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function Bt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Nt(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Wt(e){var t=e[0],r=e[1];return t*t+r*r}function Pi(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Fi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ii(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Gi(e,t){return e[0]*t[0]+e[1]*t[1]}function Ui(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Bi(e,t,r,n){var i=t[0],s=t[1];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e}function Ni(e,t){t=t||1;var r=H()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Wi(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function Oi(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function Xi(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function Yi(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function Hi(e,t,r,n){var i=t[0]-r[0],s=t[1]-r[1],a=Math.sin(n),o=Math.cos(n);return e[0]=i*o-s*a+r[0],e[1]=i*a+s*o+r[1],e}function qi(e,t){var r=e[0],n=e[1],i=t[0],s=t[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+s*s),o=a&&(r*i+n*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function ji(e){return e[0]=0,e[1]=0,e}function Ki(e){return"vec2("+e[0]+", "+e[1]+")"}function $i(e,t){return e[0]===t[0]&&e[1]===t[1]}function Zi(e,t){var r=e[0],n=e[1],i=t[0],s=t[1];return Math.abs(r-i)<=C*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=C*Math.max(1,Math.abs(n),Math.abs(s))}var Qi=Nt,Ji=Ft,es=It,ts=Gt,rs=Ut,ns=Bt,is=Wt,ss=function(){var e=Pt();return function(t,r,n,i,s,a){var o,f;for(r||(r=2),n||(n=0),i?f=Math.min(i*r+n,t.length):f=t.length,o=n;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}();var fe={X:0,Y:1,Z:2},Ee=class{constructor(t){this._isActivated=!1;this._theta=0;this._phi=0;this._touchWasActive=!1;this._touchStartTime=0;this._touchMoveForward=!1;this._position=R.fromValues(0,0,0);this._target=R.fromValues(0,0,0);this._forwardAxis=R.fromValues(1,0,0);this._leftAxis=R.fromValues(0,0,1);this._upAxis=R.fromValues(0,1,0);this._mouseSensibility=t.mouseSensibility,this._keyboardSensibility=t.keyboardSensibility,this._touchSensibility=t.touchSensibility,this._movingSpeed=t.movingSpeed,R.copy(this._position,t.position),this._axisIndices=[t.coordinates?fe[t.coordinates[0]]:fe.X,t.coordinates?fe[t.coordinates[1]]:fe.Y,t.coordinates?fe[t.coordinates[2]]:fe.Z],this._theta=t.theta,this._phi=t.phi}isActivated(){return this._isActivated}update(t,r){let n=!1,i=!1,s=!1,a=!1,o=0,f=0,d=Math.PI/180;{let k=te.deltaX()*this._mouseSensibility,w=te.deltaY()*this._mouseSensibility;o-=k*d,f-=w*d}let c=O.getTouchData().length>0;if(c){if(!this._touchWasActive){let D=Date.now();(D-this._touchStartTime)/1e3<.25?this._touchMoveForward=!0:this._touchStartTime=D}let k=O.getTouchData()[0],w=k.deltaX*this._touchSensibility,V=k.deltaY*this._touchSensibility;o-=w*d,f-=V*d}else this._touchMoveForward=!1;this._touchWasActive=c,this._touchMoveForward&&(n=!0);let h=this._movingSpeed*t,u=R.fromValues(0,0,0);R.scale(u,this._forwardAxis,h);let p=R.fromValues(0,0,0);R.scale(p,this._leftAxis,h),I.isPressed("Z","W")&&(n=!0),I.isPressed("S")&&(i=!0),I.isPressed("A","Q")&&(s=!0),I.isPressed("D")&&(a=!0);let _=this._keyboardSensibility*t;I.isPressed("ArrowUp")?f+=_:I.isPressed("ArrowDown")&&(f-=_),I.isPressed("ArrowLeft")?o+=_:I.isPressed("ArrowRight")&&(o-=_),this._theta+=o,this._phi+=f;let v=Math.PI*.5,m=v*.95;this._phi=Math.min(Math.max(this._phi,-m),+m);let g=Math.cos(this._theta),T=Math.sin(this._theta),[x,b,y]=this._axisIndices,M=Math.cos(this._phi+v);this._upAxis[x]=M*g,this._upAxis[b]=M*T,this._upAxis[y]=Math.sin(this._phi+v);let A=Math.cos(this._phi);this._forwardAxis[x]=A*g,this._forwardAxis[b]=A*T,this._forwardAxis[y]=Math.sin(this._phi),R.cross(this._leftAxis,this._upAxis,this._forwardAxis),n?R.add(this._position,this._position,u):i&&R.sub(this._position,this._position,u),s?R.add(this._position,this._position,p):a&&R.sub(this._position,this._position,p),R.add(this._target,this._position,this._forwardAxis)}getPosition(){return this._position}setPosition(t){R.copy(this._position,t)}getTarget(){return this._target}getForwardAxis(){return this._forwardAxis}getLeftAxis(){return this._leftAxis}getUpAxis(){return this._upAxis}getTheta(){return this._theta}getPhi(){return this._phi}getTouchMoveForward(){return this._touchMoveForward}};var Se=class{constructor(t,r){this._size=r,this._buffer=t}copy(t){for(let r=0;r<this._size;++r)this._buffer[r]=t[r]}get(t,r,n){return t<0||t>=this._size||r<0||r>=this._size||n<0||n>=this._size?1:this._buffer[this._getIndex(t,r,n)]}_getIndex(t,r,n){return n*this._size*this._size+r*this._size+t}};var Ot=(e,t,r)=>{let n=[0,0,0];for(n[2]=e[2];n[2]<=t[2];++n[2])for(n[1]=e[1];n[1]<=t[1];++n[1])for(n[0]=e[0];n[0]<=t[0];++n[0])r(n)};var Ce=class e{constructor(){this._hashSet=new Set}clear(){this._hashSet.clear()}add(t){this._hashSet.add(e._getName(t))}delete(t){this._hashSet.delete(e._getName(t))}has(t){this._hashSet.has(e._getName(t))}static _getName(t){return"".concat(t[0],"/").concat(t[1],"/").concat(t[2])}};var ke=class{constructor(t){this._unusedWorkers=[];this._inUseWorkers=[];this._onWorkerResult=t}areAllWorkerAvailable(){return this._inUseWorkers.length===0}isWorkerAvailable(){return this._unusedWorkers.length>0}getInUseWorkersData(){return this._inUseWorkers.map(t=>t.data)}pushTask(t){if(!this.isWorkerAvailable())return!1;let r=this._unusedWorkers.pop();return this._inUseWorkers.push(r),t(r.data,(n,i)=>{r.instance.postMessage(n,i)}),!0}addOneWorker(t,r){let n={instance:new Worker(t),data:r};this._unusedWorkers.push(n);let i=s=>{let a=this._inUseWorkers.indexOf(n);a>=0&&(this._unusedWorkers.push(n),this._inUseWorkers.splice(a,1)),this._onWorkerResult(n.data,s.data)};n.instance.addEventListener("message",i,!1)}};var we=class{constructor(t){this._cameraPosition=R.fromValues(0,0,0);this._chunkPositionQueue=[];this._savedIndex=[999,999,999];this._unusedChunks=[];this._usedChunks=[];this._usedSet=new Ce;this._def=t}clear(){this._chunkPositionQueue.length=0,this._unusedChunks.forEach(t=>this._def.releaseGeometry(t.geometry)),this._unusedChunks.length=0,this._usedChunks.forEach(t=>this._def.releaseGeometry(t.geometry)),this._usedChunks.length=0,this._usedSet.clear()}isEmpty(){return this._usedChunks.length===0}isNotDone(){return this._chunkPositionQueue.length>0}getChunks(){return this._usedChunks}pushNew(t,r,n,i,s,a){let o=this._def.acquireGeometry(a);if(o.update(r,n,i),this._unusedChunks.length===0)this._usedChunks.push({realPosition:r,indexPosition:t,geometry:o,isVisible:!1,data:new Se(new Float32Array(s),this._def.chunkLogicSize+1+1)});else{let f=this._unusedChunks.pop();f.realPosition=r,f.indexPosition=t,f.isVisible=!1,f.data.copy(s),this._usedChunks.push(f)}this._usedSet.add(t),this._def.onChunkCreated&&this._def.onChunkCreated()}update(t,r){this._updateGeneration(t,r);for(let n of this._usedChunks){let i=this._def.chunkIsVisible(n.realPosition);n.isVisible=i,n.geometry.setVisibility(i)}}_updateGeneration(t,r){R.copy(this._cameraPosition,t);let n=[Math.floor(t[0]/this._def.chunkGraphicSize),Math.floor(t[1]/this._def.chunkGraphicSize),Math.floor(t[2]/this._def.chunkGraphicSize)],i=!1;if(this._usedChunks.length===0&&r.areAllWorkerAvailable()&&(i=!0),!i&&!R.exactEquals(n,this._savedIndex)&&(i=!0),i===!1)return;R.copy(this._savedIndex,n),this._chunkPositionQueue.length=0;let{chunkGenerationRange:s}=this._def,a=[Math.floor(n[0]-s),Math.floor(n[1]-s),Math.floor(n[2]-s)],o=[Math.floor(n[0]+s),Math.floor(n[1]+s),Math.floor(n[2]+s)];for(let f=0;f<this._usedChunks.length;){let{indexPosition:d}=this._usedChunks[f];if(d[0]<a[0]||d[0]>o[0]||d[1]<a[1]||d[1]>o[1]||d[2]<a[2]||d[2]>o[2]){this._def.releaseGeometry(this._usedChunks[f].geometry);let h=this._usedChunks.splice(f,1);this._unusedChunks.push(h[0]),this._usedSet.delete(d),this._def.onChunkDiscarded&&this._def.onChunkDiscarded()}else++f}Ot(a,o,f=>{this._usedChunks.findIndex(c=>this._usedSet.has(c.indexPosition))>=0||r.getInUseWorkersData().findIndex(c=>R.exactEquals(c.processing.indexPosition,f))>=0||this._chunkPositionQueue.push({indexPosition:[...f],realPosition:[f[0]*this._def.chunkGraphicSize,f[1]*this._def.chunkGraphicSize,f[2]*this._def.chunkGraphicSize]})})}getBestNextChunkPosition(){if(this._chunkPositionQueue.length===0)return;let t=i=>{let s=this._def.chunkGraphicSize*.5,a=[this._cameraPosition[0]-(i[0]+s),this._cameraPosition[1]-(i[1]+s),this._cameraPosition[2]-(i[2]+s)];return R.length(a)},r=-1,n=-1;for(let i=0;i<this._chunkPositionQueue.length;++i){let{realPosition:s}=this._chunkPositionQueue[i];if(!this._def.chunkIsVisible(s))continue;let a=t(s);n>=0&&n<a||(r=i,n=a)}if(!(r<0))return this._chunkPositionQueue.splice(r,1)[0]}};var de=class{constructor(){this._framesDelta=[];this._averageDelta=0;this._minDelta=0;this._maxDelta=0}pushDelta(t){this._framesDelta.length>=100&&this._framesDelta.shift(),this._framesDelta.push(t),this._minDelta=999999999,this._maxDelta=-999999999,this._averageDelta=0;for(let r of this._framesDelta)this._minDelta=Math.min(this._minDelta,r),this._maxDelta=Math.max(this._maxDelta,r),this._averageDelta+=r;this._averageDelta/=this._framesDelta.length}get framesDelta(){return this._framesDelta}get averageDelta(){return this._averageDelta}get minDelta(){return this._minDelta}get maxDelta(){return this._maxDelta}};var Ae=class{constructor(t){this._running=!1;this._frameProfiler=new de;this._def=t,this._chunkManager=new we({chunkGraphicSize:t.chunkGraphicSize,chunkGenerationRange:t.chunkGenerationRange,chunkLogicSize:t.chunkLogicSize,chunkIsVisible:t.chunkIsVisible,acquireGeometry:t.acquireGeometry,releaseGeometry:t.releaseGeometry}),this._workerManager=new ke((r,n)=>{let{indexPosition:i,realPosition:s,geometryFloat32buffer:a,dataFloat32buffer:o,sizeUsed:f}=n,c=Date.now()-n.time;this._frameProfiler.pushDelta(c),r.geometryFloat32buffer=a,r.dataFloat32buffer=o,r.processing=void 0,this._running&&(this._chunkManager.pushNew(i,s,r.geometryFloat32buffer,f,r.dataFloat32buffer,this._geometryBufferSize),this._launchWorker())}),this._dataBufferSize=Math.pow(this._def.chunkLogicSize+1+1,3),this._geometryBufferSize=this._dataBufferSize*20*6*3;for(let r=0;r<this._def.workerTotal;++r)this._workerManager.addOneWorker(this._def.workerFile,{geometryFloat32buffer:new Float32Array(this._geometryBufferSize),dataFloat32buffer:new Float32Array(this._dataBufferSize)})}start(){this._running=!0}stop(){this._running&&(this._running=!1,this._chunkManager.clear())}update(t){this._running&&(this._chunkManager.update(t,this._workerManager),this._launchWorker())}_launchWorker(){for(;this._chunkManager.isNotDone()&&this._workerManager.isWorkerAvailable();){let t=this._chunkManager.getBestNextChunkPosition();if(!t)break;this._workerManager.pushTask((r,n)=>{r.processing=t;let i={realPosition:t.realPosition,indexPosition:t.indexPosition,geometryFloat32buffer:r.geometryFloat32buffer,geometryBufferSize:this._geometryBufferSize,dataFloat32buffer:r.dataFloat32buffer,sizeUsed:0,time:Date.now()};n(i,[r.geometryFloat32buffer.buffer,r.dataFloat32buffer.buffer])})}}getChunks(){return this._chunkManager.getChunks()}getFrameProfiler(){return this._frameProfiler}getProcessingRealPositions(){return this._workerManager.getInUseWorkersData().map(t=>t.processing.realPosition)}};var Ve=class{constructor(){this._frustum=new Float32Array(24)}_setPlane(t,r,n,i){let s=t*4;this._frustum[s+0]=r[0]+n[0]*i,this._frustum[s+1]=r[1]+n[1]*i,this._frustum[s+2]=r[2]+n[2]*i,this._frustum[s+3]=r[3]+n[3]*i;let a=Math.sqrt(this._frustum[s+0]*this._frustum[s+0]+this._frustum[s+1]*this._frustum[s+1]+this._frustum[s+2]*this._frustum[s+2]);a!==0&&(this._frustum[s+0]/=a,this._frustum[s+1]/=a,this._frustum[s+2]/=a,this._frustum[s+3]/=a)}calculateFrustum(t,r){let n=F.multiply(F.create(),t,r),i=Z.fromValues(n[0],n[4],n[8],n[12]),s=Z.fromValues(n[1],n[5],n[9],n[13]),a=Z.fromValues(n[2],n[6],n[10],n[14]),o=Z.fromValues(n[3],n[7],n[11],n[15]);this._setPlane(0,o,i,-1),this._setPlane(1,o,i,1),this._setPlane(2,o,s,1),this._setPlane(3,o,s,-1),this._setPlane(4,o,a,-1),this._setPlane(5,o,a,1)}sphereInFrustum(t,r,n,i){for(let s=0;s<6;++s){let a=s*4;if(this._frustum[a+0]*t+this._frustum[a+1]*r+this._frustum[a+2]*n+this._frustum[a+3]<=-i)return!1}return!0}pointInFrustum(t,r,n){return this.sphereInFrustum(t,r,n,0)}cubeInFrustum(t,r,n,i){let s=t-i,a=r-i,o=n-i,f=t+i,d=r+i,c=n+i;for(let h=0;h<6;++h){let u=h*4,p=this._frustum[u+0],_=this._frustum[u+1],v=this._frustum[u+2],m=this._frustum[u+3];if(!(p*s+_*a+v*o+m>0||p*f+_*a+v*o+m>0||p*s+_*d+v*o+m>0||p*f+_*d+v*o+m>0||p*s+_*a+v*c+m>0||p*f+_*a+v*c+m>0||p*s+_*d+v*c+m>0||p*f+_*d+v*c+m>0))return!1}return!0}};var oe=class{constructor(){this._projectionType=0;this._viewportPos=q.fromValues(0,0);this._viewportSize=q.fromValues(0,0);this._projectionMatrix=F.create();this._viewMatrix=F.create();this._composedMatrix=F.create();this._eye=R.fromValues(0,0,0);this._target=R.fromValues(0,0,0);this._upAxis=R.fromValues(0,0,0)}setAsPerspective(t){this._projectionType=0;let r=t.aspectRatio;r===void 0&&(r=this._viewportSize[0]/this._viewportSize[1]),this._perspectiveData={fovy:t.fovy,aspectRatio:r,near:t.near,far:t.far}}setAsOrthogonal(t){this._projectionType=1,this._orthogonalData=ee({},t)}setViewportPos(t,r){this._viewportPos[0]=t,this._viewportPos[1]=r}getViewportPos(){return this._viewportPos}setViewportSize(t,r){this._viewportSize[0]=t,this._viewportSize[1]=r,this._projectionType!==0&&this._perspectiveData&&(this._perspectiveData.aspectRatio=this._viewportSize[0]/this._viewportSize[1])}getViewportSize(){return this._viewportSize}lookAt(t,r,n){R.copy(this._eye,t),R.copy(this._target,r),R.copy(this._upAxis,n)}setEye(t){R.copy(this._eye,t)}setTarget(t){R.copy(this._target,t)}setUpAxis(t){R.copy(this._upAxis,t)}getEye(){return this._eye}getTarget(){return this._target}getUpAxis(){return this._upAxis}computeMatrices(){if(this._projectionType===0){let{fovy:t,aspectRatio:r,near:n,far:i}=this._perspectiveData;F.perspective(this._projectionMatrix,t,r,n,i)}else if(this._projectionType===1){let{left:t,right:r,top:n,bottom:i,near:s,far:a}=this._orthogonalData;F.ortho(this._projectionMatrix,t,r,n,i,s,a)}F.lookAt(this._viewMatrix,this._eye,this._target,this._upAxis),this.computeComposedMatrix()}computeComposedMatrix(){F.multiply(this._composedMatrix,this._projectionMatrix,this._viewMatrix)}setProjectionMatrix(t){F.copy(this._projectionMatrix,t)}setViewMatrix(t){F.copy(this._viewMatrix,t)}setComposedMatrix(t){F.copy(this._composedMatrix,t)}getProjectionMatrix(){return this._projectionMatrix}getViewMatrix(){return this._viewMatrix}getComposedMatrix(){return this._composedMatrix}getPerspectiveData(){if(this._projectionType!==0)throw new Error("not a perspective projection");return this._perspectiveData}getOrthogonalData(){if(this._projectionType!==1)throw new Error("not an orthogonal projection");return this._orthogonalData}};var ce={};Y(ce,{fragment:()=>os,vertex:()=>as});var as="\n#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_composedMatrix;\nuniform float u_sceneScale;\nuniform float u_tileRepeat;\n\nin vec3 a_vertex_position;\nin vec3 a_vertex_normal;\nin vec3 a_offset_origin;\n\nout vec3 v_chunkSpacePosition;\nout vec3 v_worldSpacePosition;\nout vec3 v_worldSpaceNormal;\n\nvoid main(void)\n{\n  vec3 chunkSpacePosition = a_vertex_position * u_sceneScale;\n\n  v_chunkSpacePosition = a_vertex_position * u_tileRepeat;\n  v_worldSpacePosition = a_offset_origin + chunkSpacePosition;\n  v_worldSpaceNormal = a_vertex_normal;\n\n  gl_Position = u_composedMatrix * vec4(v_worldSpacePosition, 1.0);\n}\n".trim(),os="\n#version 300 es\n\nprecision lowp float;\n\nconst float k_ambiantCoef = 0.1;\nconst vec3 k_specColor = vec3(1.0, 1.0, 1.0);\n\nuniform sampler2D u_texture_dirt;\nuniform sampler2D u_texture_grass;\nuniform sampler2D u_texture_stoneWall;\nuniform sampler2D u_texture_stoneWallBump;\nuniform vec3 u_eyePosition;\n\nin vec3 v_chunkSpacePosition;\nin vec3 v_worldSpacePosition;\nin vec3 v_worldSpaceNormal;\n\nout vec4 o_color;\n\nvec4 _getColorValue()\n{\n\n  // current 3d texture coordinate\n  vec3 flooredPos = vec3(\n    v_chunkSpacePosition.x - floor(v_chunkSpacePosition.x),\n    v_chunkSpacePosition.y - floor(v_chunkSpacePosition.y),\n    v_chunkSpacePosition.z - floor(v_chunkSpacePosition.z)\n  );\n\n  vec3 blendWeights = abs( normalize( v_worldSpaceNormal.xyz ) );\n  blendWeights = max( ( blendWeights - 0.2 ) * 7.0, 0.0 );\n  blendWeights /= ( blendWeights.x + blendWeights.y + blendWeights.z );\n\n  // horizontal texture coordinates -> should be a wall\n  vec2 texCoordX = vec2(flooredPos.y, flooredPos.z);\n  vec2 texCoordY = vec2(flooredPos.x, flooredPos.z);\n\n  // vertical texture coord -> should be green grass\n  vec2 texCoordZ = vec2(flooredPos.x, flooredPos.y);\n\n  // horizontal color\n  vec3 texColorX = texture( u_texture_stoneWall, texCoordX ).rgb;\n  vec3 texColorY = texture( u_texture_stoneWall, texCoordY ).rgb;\n\n  float specularRatioX = texture( u_texture_stoneWallBump, texCoordX ).r * blendWeights.x;\n  float specularRatioY = texture( u_texture_stoneWallBump, texCoordY ).r * blendWeights.y;\n  float specularRatio = max( specularRatioX, specularRatioY );\n\n  // vertical color\n  vec3 texColorZ = vec3(0.0);\n  if (v_worldSpaceNormal.z < 0.0)\n  {\n    texColorZ = texture( u_texture_dirt, texCoordZ ).rgb;\n  }\n  else\n  {\n    texColorZ = texture( u_texture_grass, texCoordZ ).rgb;\n  }\n\n  return vec4(\n    texColorX * blendWeights.xxx +\n    texColorY * blendWeights.yyy +\n    texColorZ * blendWeights.zzz,\n    specularRatio\n  );\n}\n\nvec3 _getLightColor(vec4 currentColor)\n{\n  vec3 normal = normalize(v_worldSpaceNormal);\n  vec3 lightDir = normalize(u_eyePosition - v_worldSpacePosition);\n\n  float diffuseCoef = max(dot(lightDir,v_worldSpaceNormal.xyz), 0.0);\n  float specularCoef = 0.0;\n\n  if (diffuseCoef > 0.0)\n  {\n    // specular\n\n    vec3 reflectDir = reflect(-lightDir, normal);\n    vec3 viewDir = normalize(u_eyePosition - v_worldSpacePosition);\n\n    float specAngle = max(dot(reflectDir, viewDir), 0.0);\n    specularCoef = pow(specAngle, 16.0);\n  }\n\n  vec3 diffuseColor = currentColor.rgb * (k_ambiantCoef + diffuseCoef);\n  vec3 specularColor = k_specColor * specularCoef * currentColor.a;\n\n  return diffuseColor + specularColor;\n}\n\nvoid main(void)\n{\n  o_color = vec4(_getLightColor(_getColorValue()), 1.0);\n}\n".trim();var je=class{constructor(t,r,n){this._isVisible=!1;this._geometry=new L.Geometry(t,r),this._geometry.setFloatBufferSize(0,n)}update(t,r,n){this._geometry.updateBuffer(0,r,n),this._geometry.setPrimitiveCount(n/6);let i=new Float32Array([t[0],t[1],t[2]]);this._geometry.updateBuffer(1,i,i.length),this._geometry.setInstancedCount(1)}render(){this._isVisible&&this._geometry.render()}setVisibility(t){this._isVisible=t}},De=class{constructor(){this._textureDirt=new X;this._textureGrass=new X;this._textureStoneWall=new X;this._textureStoneWallBump=new X;this._unusedGeometries=[];this._inUseGeometries=[];this._shader=new N("ChunksRenderer",{vertexSrc:ce.vertex,fragmentSrc:ce.fragment,attributes:["a_vertex_position","a_vertex_normal","a_offset_origin"],uniforms:["u_composedMatrix","u_eyePosition","u_sceneScale","u_tileRepeat","u_texture_dirt","u_texture_grass","u_texture_stoneWall","u_texture_stoneWallBump"]});let t=new L.GeometryBuilder;t.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_normal","vec3f").setStride(6*4).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_origin","vec3f").setStride(3*4),this._geometryDefinition=t.getDef()}async initialize(){await Promise.all([this._textureDirt.load("assets/dirt.png"),this._textureGrass.load("assets/grass.png"),this._textureStoneWall.load("assets/stone-wall.png"),this._textureStoneWallBump.load("assets/stone-wall-bump.png")])}acquireGeometry(t){if(this._unusedGeometries.length>0){let n=this._unusedGeometries.pop();return this._inUseGeometries.push(n),n}let r=new je(this._shader,this._geometryDefinition,t);return this._inUseGeometries.push(r),r}releaseGeometry(t){let r=this._inUseGeometries.indexOf(t);r<0||(this._unusedGeometries.push(t),this._inUseGeometries.splice(r,1))}render(t,r){let n=t.getEye();this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",t.getComposedMatrix()),this._shader.setFloat3Uniform("u_eyePosition",n[0],n[1],n[2]),this._shader.setFloat1Uniform("u_sceneScale",r),this._shader.setFloat1Uniform("u_tileRepeat",2),this._shader.setTextureUniform("u_texture_dirt",this._textureDirt,0),this._shader.setTextureUniform("u_texture_grass",this._textureGrass,1),this._shader.setTextureUniform("u_texture_stoneWall",this._textureStoneWall,2),this._shader.setTextureUniform("u_texture_stoneWallBump",this._textureStoneWallBump,3),this._inUseGeometries.forEach(i=>i.render())})}};var le={};Y(le,{fragment:()=>cs,vertex:()=>ds});var ds="\n#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_composedMatrix;\n\nin vec3  a_vertex_position;\n\nin vec3  a_offset_center;\nin float a_offset_scale;\nin vec4  a_offset_color;\n\nflat out vec4 v_color;\n\nvoid main(void)\n{\n  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;\n\n  gl_Position = u_composedMatrix * vec4(position, 1.0);\n\n  v_color = a_offset_color;\n}\n".trim(),cs="\n#version 300 es\n\nprecision lowp float;\n\nflat in vec4 v_color;\n\nout vec4 out_color;\n\nvoid main(void)\n{\n  out_color = v_color;\n}\n\n".trim();var W=(e,t)=>{let r=[],n=t[0]*.5,i=t[1]*.5,s=t[2]*.5,a=[[e[0]-n,e[1]-i,e[2]-s],[e[0]+n,e[1]-i,e[2]-s],[e[0]-n,e[1]+i,e[2]-s],[e[0]+n,e[1]+i,e[2]-s],[e[0]-n,e[1]-i,e[2]+s],[e[0]+n,e[1]-i,e[2]+s],[e[0]-n,e[1]+i,e[2]+s],[e[0]+n,e[1]+i,e[2]+s]],o=[];o.push(0,2,1),o.push(2,3,1),o.push(4,5,6),o.push(6,5,7),o.push(1,3,5),o.push(5,3,7),o.push(0,4,2),o.push(4,6,2),o.push(2,6,3),o.push(6,7,3),o.push(0,1,4),o.push(4,1,5);for(let f of o)r.push(a[f]);return r},hs=e=>{let t=.001953125,r=.5-t*.5,n=[...W([e*-r,e*-r,0],[t,t,1]),...W([e*+r,e*-r,0],[t,t,1]),...W([e*+r,e*+r,0],[t,t,1]),...W([e*-r,e*+r,0],[t,t,1]),...W([e*-r,0,e*-r],[t,1,t]),...W([e*+r,0,e*-r],[t,1,t]),...W([e*+r,0,e*+r],[t,1,t]),...W([e*-r,0,e*+r],[t,1,t]),...W([0,e*-r,e*-r],[1,t,t]),...W([0,e*+r,e*-r],[1,t,t]),...W([0,e*+r,e*+r],[1,t,t]),...W([0,e*-r,e*+r],[1,t,t])],i=[];return n.forEach(s=>{i.push(s[0],s[1],s[2])}),i},Xt=8*1024*4,Le=class{constructor(){this._buffer=new Float32Array(Xt);this._currentSize=0;this._shader=new N("TriangleCubesRenderer",{vertexSrc:le.vertex,fragmentSrc:le.fragment,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});let t=new L.GeometryBuilder;t.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(3*4).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(8*4);let r=hs(1);this._geometry=new L.Geometry(this._shader,t.getDef()),this._geometry.updateBuffer(0,r,r.length),this._geometry.setPrimitiveCount(r.length/3),this._geometry.setFloatBufferSize(1,Xt)}pushCenteredCube(t,r,n){this._currentSize+8>=this._buffer.length||(this._buffer[this._currentSize++]=t[0],this._buffer[this._currentSize++]=t[1],this._buffer[this._currentSize++]=t[2],this._buffer[this._currentSize++]=r,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=n[2],this._buffer[this._currentSize++]=n[3]||1)}pushOriginBoundCube(t,r,n){if(this._currentSize+8>=this._buffer.length)return;let i=r*.5;this._buffer[this._currentSize++]=t[0]+i,this._buffer[this._currentSize++]=t[1]+i,this._buffer[this._currentSize++]=t[2]+i,this._buffer[this._currentSize++]=r,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=n[2],this._buffer[this._currentSize++]=n[3]||1}flush(t){this._currentSize<=0||(this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",t.getComposedMatrix()),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear())}clear(){this._currentSize=0}};var he={};Y(he,{fragment:()=>ps,vertex:()=>us});var us="\n#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_composedMatrix;\n\nin vec3 a_vertex_position;\nin vec4 a_vertex_color;\n\nflat out vec4 v_color;\n\nvoid main(void)\n{\n  gl_Position = u_composedMatrix * vec4(a_vertex_position, 1.0);\n\n  v_color = a_vertex_color;\n}\n".trim(),ps="\n#version 300 es\n\nprecision lowp float;\n\nflat in vec4 v_color;\n\nout vec4 o_color;\n\nvoid main(void)\n{\n  o_color = v_color;\n}\n\n".trim();var Yt=14*1024,ze=class{constructor(t,r){this._buffer=new Float32Array(Yt);this._currentSize=0;let n=ye(ee({},r),{primitiveType:L.PrimitiveType.lines});this._geometry=new L.Geometry(t,n),this._geometry.setFloatBufferSize(0,Yt)}pushLine(t,r,n){var s;if(this._currentSize+7*2>=this._buffer.length)return;let i=(s=n[3])!=null?s:1;this._buffer[this._currentSize+0]=t[0],this._buffer[this._currentSize+1]=t[1],this._buffer[this._currentSize+2]=t[2],this._buffer[this._currentSize+3]=n[0],this._buffer[this._currentSize+4]=n[1],this._buffer[this._currentSize+5]=n[2],this._buffer[this._currentSize+6]=i,this._currentSize+=7,this._buffer[this._currentSize+0]=r[0],this._buffer[this._currentSize+1]=r[1],this._buffer[this._currentSize+2]=r[2],this._buffer[this._currentSize+3]=n[0],this._buffer[this._currentSize+4]=n[1],this._buffer[this._currentSize+5]=n[2],this._buffer[this._currentSize+6]=i,this._currentSize+=7}canRender(){return this._currentSize>0}flush(){this.canRender()&&(this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear())}clear(){this._currentSize=0}};var Ht=7*1024,Pe=class{constructor(t,r){this._buffer=new Float32Array(Ht);this._currentSize=0;let n=ye(ee({},r),{primitiveType:L.PrimitiveType.triangles});this._geometry=new L.Geometry(t,n),this._geometry.setFloatBufferSize(0,Ht)}pushTriangle(t,r,n,i){var a;if(this._currentSize+7*6>=this._buffer.length)return;let s=(a=i[3])!=null?a:1;this._buffer[this._currentSize+0]=t[0],this._buffer[this._currentSize+1]=t[1],this._buffer[this._currentSize+2]=t[2],this._buffer[this._currentSize+3]=i[0],this._buffer[this._currentSize+4]=i[1],this._buffer[this._currentSize+5]=i[2],this._buffer[this._currentSize+6]=s,this._currentSize+=7,this._buffer[this._currentSize+0]=r[0],this._buffer[this._currentSize+1]=r[1],this._buffer[this._currentSize+2]=r[2],this._buffer[this._currentSize+3]=i[0],this._buffer[this._currentSize+4]=i[1],this._buffer[this._currentSize+5]=i[2],this._buffer[this._currentSize+6]=s,this._currentSize+=7,this._buffer[this._currentSize+0]=n[0],this._buffer[this._currentSize+1]=n[1],this._buffer[this._currentSize+2]=n[2],this._buffer[this._currentSize+3]=i[0],this._buffer[this._currentSize+4]=i[1],this._buffer[this._currentSize+5]=i[2],this._buffer[this._currentSize+6]=s,this._currentSize+=7}pushLine(t,r,n,i){if(this._currentSize+7*6>=this._buffer.length)return;let s=r[0]-t[0],a=r[1]-t[1],o=Math.atan2(a,s)+Math.PI*.5,f=Math.cos(o)*n*.5,d=Math.sin(o)*n*.5;this.pushTriangle([t[0]-f,t[1]-d,t[2]],[r[0]-f,r[1]-d,r[2]],[r[0]+f,r[1]+d,r[2]],i),this.pushTriangle([t[0]-f,t[1]-d,t[2]],[r[0]+f,r[1]+d,r[2]],[t[0]+f,t[1]+d,t[2]],i)}pushRotatedLine(t,r,n,i,s){this.pushLine([t[0]-n*Math.cos(r),t[1]-n*Math.sin(r),t[2]],[t[0]+n*Math.cos(r),t[1]+n*Math.sin(r),t[2]],i,s)}pushOriginBoundRectangle(t,r,n){if(this._currentSize+7*6>=this._buffer.length)return;let i=[t[0]+r[0],t[1]+r[1]];this.pushTriangle([t[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],n),this.pushTriangle([t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],n)}pushCenteredRectangle(t,r,n){let i=[t[0]-r[0]*.5,t[1]-r[1]*.5,t[2]];this.pushOriginBoundRectangle(i,r,n)}canRender(){return this._currentSize>0}flush(){this.canRender()&&(this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear())}clear(){this._currentSize=0}};var Fe=class{constructor(){this._shader=new N("StackRenderers",{vertexSrc:he.vertex,fragmentSrc:he.fragment,attributes:["a_vertex_position","a_vertex_color"],uniforms:["u_composedMatrix"]});let t=new L.GeometryBuilder;t.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_color","vec4f").setStride(7*4),this._wireFramesStackRenderer=new ze(this._shader,t.getDef()),this._trianglesStackRenderer=new Pe(this._shader,t.getDef())}pushLine(t,r,n){this._wireFramesStackRenderer.pushLine(t,r,n)}pushCross(t,r,n){let i=[[t[0]-r,t[1],t[2]],[t[0]+r,t[1],t[2]],[t[0],t[1]-r,t[2]],[t[0],t[1]+r,t[2]],[t[0],t[1],t[2]-r],[t[0],t[1],t[2]+r]],s=[0,1,2,3,4,5];for(let a=0;a<s.length;a+=2){let o=i[a+0],f=i[a+1];this._wireFramesStackRenderer.pushLine(o,f,n)}}pushThickLine(t,r,n,i){this._trianglesStackRenderer.pushLine(t,r,n,i)}pushRotatedLine(t,r,n,i,s){this._trianglesStackRenderer.pushRotatedLine(t,r,n,i,s)}pushOriginBoundRectangle(t,r,n){this._trianglesStackRenderer.pushOriginBoundRectangle(t,r,n)}pushCenteredRectangle(t,r,n){this._trianglesStackRenderer.pushCenteredRectangle(t,r,n)}pushTriangle(t,r,n,i){this._trianglesStackRenderer.pushTriangle(t,r,n,i)}flush(t){!this._wireFramesStackRenderer.canRender()&&!this._trianglesStackRenderer.canRender()||this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",t),this._wireFramesStackRenderer.flush(),this._trianglesStackRenderer.flush()})}clear(){this._wireFramesStackRenderer.clear(),this._trianglesStackRenderer.clear()}};var me={};Y(me,{fragment:()=>gs,vertex:()=>vs});var vs="\n#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_composedMatrix;\n\nin vec2 a_vertex_position;\nin vec2 a_vertex_texCoord;\nin vec3 a_offset_position;\nin vec2 a_offset_texCoord;\nin vec3 a_offset_color;\nin float a_offset_scale;\n\nout vec2 v_texCoord;\nflat out vec3 v_color;\n\nvoid main(void)\n{\n  vec3 position = vec3(a_vertex_position, 0.0) * a_offset_scale + a_offset_position;\n\n  gl_Position = u_composedMatrix * vec4(position, 1.0);\n\n  v_texCoord = a_vertex_texCoord + a_offset_texCoord;\n  v_color = a_offset_color;\n}\n".trim(),gs="\n#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D u_texture;\n\nin vec2 v_texCoord;\nflat in vec3 v_color;\n\nout vec4 o_color;\n\nvoid main(void)\n{\n  vec4 textureColor = texture(u_texture, v_texCoord);\n  if (textureColor.a < 0.5)\n  {\n    discard;\n  }\n  else\n  {\n    o_color = vec4(v_color, textureColor.a);\n  }\n}\n\n".trim();var Ke="7e7e28fd03fd07fe04fe0aff02ff7e4dfd0cfd03fd07fe04fe0aff02ff1afc0dfd10fc08fc0ffe55ff15fb0bfd03fd07fe04fe08f707fd04ff07fe02fe0cfd0ffd0cfd0aff03fe03ff0afe44fe15fb0bfd03fd04f204f607fd03fe07fe02fe0cfd0efd0efd0aff02fe02ff0bfe43fd15fb0cfe03fe05f204fe01ff02ff0afd02fd07fe02fe0bfd0efd10fd0afa0cfe42fd16fb1bfe04fe07fe01ff02ff0efd09fc1cfd12fd09fa0cfe41fd17fb1bfe04fe07f70bfd0afc04ff17fd12fd06f405f616f61cfd19fd1cfe04fe08f709fd0bfb02fe17fd12fd06f405f616f61bfd1afd1cfe04fe0aff02ff01fe08fd0bfe02fa17fd12fd09fa0cfe3efd37f207ff02ff01fe07fd02fd07fe03fc19fd10fd0afa0cfe3dfd38f204f607fe03fd07fe03fd1bfd0efd0aff02fe02ff0bfe0cfd1dfd0dfd1dfd1cfe04fe07f708ff04fd07fe02fb1bfd0cfd0aff03fe03ff0afe0cfd1dfd0cfd1efd1cfe04fe0aff02ff1afb02fe1bfc08fc0ffe1cfd1dfd0bfd1ffd1cfe04fe0aff02ff7afd7e7e7e7e7e7e0efd17fd10fc0af80bfe0bf909f90dfd08f609fb08f506f808f82cfd19fd0df807fd04fd0afe0afd03fd07fd03fd0bfc08fd0ffd0bfd05fd05fd04fd06fd04fd2afd1bfd0bfc02fc06fd03fc09fd0afd04fd06fd04fd09fb08fd0efd0cfd05fd05fd04fd06fd04fd09fd0cfd0efd1dfd0afe05fd06fd02fb06fa11fd0dfd08fe01fd08fd0dfd0dfd05fd05fd04fd06fd04fd09fd0cfd0dfd0af409fd10fd06fd02fb06fa10fd0dfd08fe02fd08fd0dfd15fd05fb02fd06fd04fd09fd0cfd0cfd0bf40afd0efd07fd01fe01fd09fd0ffd0bfb08fe03fd08f808f70efd08fa08f626fd23fd0cfd08fd01fe01fd09fd0efd0cfb08f606f707f60cfd09fa09f726fd23fd0bfd09fb02fd09fd0dfd10fd07f60cfc06fd04fd0bfd08fd02fb0dfd09fd0cfd0cfd0bf40afd0cfd09fb02fd09fd0cfd12fd0bfd0ffd06fd04fd0afd09fd04fd0dfd09fd0cfd0dfd0af409fd19fc03fd09fd0bfd03fd06fd04fd0bfd08fd04fd06fd04fd09fd0afd04fd0cfd0afd0cfd0efd1dfd1afd04fd09fd0afd04fd06fd03fd0cfd08fd03fd07fd04fd09fd0afd04fd0bfd19fd10fd1bfd0ffd0af807f707f607f90bf907f909f80afd0bf809fb2efd19fd10fd7e51fd17fd11fd7e7e7e7e13f87e78fd05fd08fc09f709f907f808f606f608f907fd03fd07f90df905fc03fd06fb0bfd05fd05fd05fd08fb08fd05fd07fa09fd03fd07fd03fd07fd02fd08fd04fe07fd04fe07fd03fd06fd03fd09fd11fd08fd03fd07fd0cfc03fc05fd05fd07fd01fd07fd05fd06fd02fd08fd03fd06fd04fd07fd03fd07fd05ff07fd05ff06fd04fd06fd03fd09fd11fd08fd02fd08fd0cfb01fb05fc04fd06fd03fd06fd05fd05fd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd11fd08fd01fd09fd0cf505fb03fd05fd05fd05fd02fa05fd04fd07fd03fd06fd0efd03fd07fd03fe08fd03fe07fd0dfd03fd09fd11fd08fa0afd0cf505fa02fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd01fd01fd05fd01fd01fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd02ff02fd05fd02fa05fd05fd05fd02fa05f607fd03fd06fd0efd03fd07fd03fe08fd03fe07fd02fb06fd03fd09fd0bfd03fd08fa0afd0cfd05fd05fd03fb05fd05fd05fd0dfd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd0bfd03fd08fd01fd09fd05ff06fd05fd05fd04fc05fd05fd05fd0dfd04fd07fd03fd06fd04fd07fd03fd07fd05ff07fd0cfd04fd06fd03fd09fd0bfd03fd08fd02fd08fd04fe06fd05fd05fd05fd06fd03fd06fd0dfd04fd07fd03fd07fd03fd07fd02fd08fd04fe07fd0dfd03fd06fd03fd09fd0bfd03fd08fd03fd07fd03fd06fd05fd05fd05fd07fd01fd07fd0dfd04fd06f709f907f808f606fb0df806fd03fd07f90af908fc03fd06f606fd05fd05fd05fd08fb0af87e7e7e7e7e7e7e68fe1af70afb08f708f807f505fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07f608f907ff11f90afc1afd03fd07fc01fc07fd03fd06fd04fd06fe02fd02fe05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fd04fd08fd0bfe14fd09fa19fd03fd07fd03fd07fd03fd06fd04fd06ff03fd03ff05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fe05fd08fd0bfd13fd08fd02fd18fd03fd06fd05fd06fd03fd06fd04fd0afd09fd03fd07fd03fd07fd05fd06fd01fd08fd03fd07ff05fd09fd0cfd12fd07fd04fd17fd03fd06fd05fd06fd03fd06fd11fd09fd03fd07fd03fd07fd05fd07fb09fd03fd0cfd0afd0dfd11fd28f807fd05fd06f808f90cfd09fd03fd07fd03fd07fd02ff02fd08fd0bfd01fd0cfd0bfd0efd10fd28f807fd05fd06f809f90bfd09fd03fd07fd03fd07fd02ff02fd08fd0cfb0cfd0cfd0ffd0ffd28fd0cfd03fb06fd02fd0efd0afd09fd03fd07fd03fd07fd02ff02fd07fb0cfd0cfd0dfd10fd0efd28fd0cfd02fa06fd03fd06fd04fd0afd09fd03fd07fd03fd08f707fd01fd0bfd0bfd05ff08fd11fd0dfd28fd0df707fd03fd06fd04fd0afd09fd03fd08fd01fd09fc01fc06fd03fd0afd0afd05fe08fd12fd0cfd28fd0df707fd03fd06fd04fd0afd09fd03fd09fb0bfd01fd07fd03fd0afd0afd04fd08fd13fd0bfd27fb12fd06fc03fd07f809f908f90bfd0cfd01fd07fd03fd08f908f608f910fd06f93cfa7e54f07e72f07e7e7e7e0bfd1dfc21fb19fb18fc10fd0ffd07fc0dfa39fd1efd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd1cfd2dfd10fd4af909f808f909f808f90afd0cfb02fe07fd01fc08fa0cfa08fd03fd0afd09f606f809f91efd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd1dfd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd18f808fd03fd06fd0dfd03fd07f709fd0bfd03fd08fd03fd0afd0ffd08fa0dfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd0dfd03fd07fd0ffd0bfd03fd08fd03fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0cf808fd03fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0df908fd03fd0afd0ffd08fd03fd0afd09fd02ff02fd05fd03fd07fd03fd18fb02fe06fe02fb08f909fb02fe07f908f90ffd07fc03fd07f706fd03fd07fc03fd07f706fd05fd05fd03fd08f978fd03fd27fd03fd7e4af92afa7e7e7e7e7e7e18fa09fc09fa1efe4eff6efd0dfc0dfd1cfc4cfe6efd0dfc0dfd1bfa4afd6efd0dfc0dfd1afd02fd07fe02fb07fb02fe07fc02fd08f908f707fd03fd07fd03fd07fd05fd05fd02fd09fd03fd06f80afd0efc0efd08fb03fd05fd04fd07fd03fd05fd03fd09f706fd04fe09fd0bfd03fd07fd03fd07fd05fd05fd02fd09fd03fd06fe03fd08fd24fd05fd01fd02fd05fe06fe07fd03fd05fd03fd09fc02fd06fd04fe09fd0bfd03fd07fd03fd07fd05fd06fa0afd03fd06ff03fd09fd24fd05fd02fd01fd05fe06fe07fd03fd05fd03fd09fd0dfb0cfd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd09fd0cfd0efc0efd07fd03fb06fe06fe07fd03fd05fd03fd09fd0ffb0afd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd08fd0efd0dfc0dfd19fe06fe07fd03fd05fd03fd09fd0cfe04fd09fd01fd07fd03fd08fd01fd09fc01fc07fa0bf908fd03ff0bfd0dfc0dfd19fe06fe07f807f809fd0cfe04fd09fd01fd07fd03fd09fb0bfd01fd07fd02fd0bfb08fd03fe0bfd0dfc0dfd19f607fd11fd08fb0cf90bfb09fb02fe09fd0cfd01fd07fd02fd0dfd08f80cfa09fc09fa1af607fd11fd7cfd69fb0ffb77fa";var qt=[16,6],l=[1/qt[0],1/qt[1]],jt=9*1024*4,Ie=class{constructor(){this._texture=new X;this._buffer=new Float32Array(jt);this._currentSize=0;this._textScale=14;this._textColor=[1,1,1];this._horizontalTextAlign="left";this._verticalTextAlign="top";this._shader=new N("TextRenderer",{vertexSrc:me.vertex,fragmentSrc:me.fragment,attributes:["a_vertex_position","a_vertex_texCoord","a_offset_position","a_offset_texCoord","a_offset_color","a_offset_scale"],uniforms:["u_composedMatrix","u_texture"]});let t=new L.GeometryBuilder;t.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec2f").addVboAttribute("a_vertex_texCoord","vec2f").setStride(4*4).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_position","vec3f").addVboAttribute("a_offset_texCoord","vec2f").addVboAttribute("a_offset_color","vec3f").addVboAttribute("a_offset_scale","float").setStride(9*4),this._geometry=new L.Geometry(this._shader,t.getDef());let r=[{position:[.5,-.5],texCoord:[l[0]*1,l[1]*1]},{position:[-.5,-.5],texCoord:[l[0]*0,l[1]*1]},{position:[.5,.5],texCoord:[l[0]*1,l[1]*0]},{position:[-.5,.5],texCoord:[l[0]*0,l[1]*0]}],n=[1,0,2,1,2,3],i=[];for(let f of n){let d=r[f];i.push(d.position[0],d.position[1],d.texCoord[0],d.texCoord[1])}this._geometry.updateBuffer(0,i,i.length),this._geometry.setPrimitiveCount(i.length/4),this._geometry.setFloatBufferSize(1,jt),this._texCoordMap=new Map([[" ",[0*l[0],0*l[1]]],["!",[1*l[0],0*l[1]]],['"',[2*l[0],0*l[1]]],["#",[3*l[0],0*l[1]]],["$",[4*l[0],0*l[1]]],["%",[5*l[0],0*l[1]]],["&",[6*l[0],0*l[1]]],["'",[7*l[0],0*l[1]]],["(",[8*l[0],0*l[1]]],[")",[9*l[0],0*l[1]]],["*",[10*l[0],0*l[1]]],["+",[11*l[0],0*l[1]]],[",",[12*l[0],0*l[1]]],["-",[13*l[0],0*l[1]]],[".",[14*l[0],0*l[1]]],["/",[15*l[0],0*l[1]]],["0",[0*l[0],1*l[1]]],["1",[1*l[0],1*l[1]]],["2",[2*l[0],1*l[1]]],["3",[3*l[0],1*l[1]]],["4",[4*l[0],1*l[1]]],["5",[5*l[0],1*l[1]]],["6",[6*l[0],1*l[1]]],["7",[7*l[0],1*l[1]]],["8",[8*l[0],1*l[1]]],["9",[9*l[0],1*l[1]]],[":",[10*l[0],1*l[1]]],[";",[11*l[0],1*l[1]]],["<",[12*l[0],1*l[1]]],["=",[13*l[0],1*l[1]]],[">",[14*l[0],1*l[1]]],["?",[15*l[0],1*l[1]]],["@",[0*l[0],2*l[1]]],["A",[1*l[0],2*l[1]]],["B",[2*l[0],2*l[1]]],["C",[3*l[0],2*l[1]]],["D",[4*l[0],2*l[1]]],["E",[5*l[0],2*l[1]]],["F",[6*l[0],2*l[1]]],["G",[7*l[0],2*l[1]]],["H",[8*l[0],2*l[1]]],["I",[9*l[0],2*l[1]]],["J",[10*l[0],2*l[1]]],["K",[11*l[0],2*l[1]]],["L",[12*l[0],2*l[1]]],["M",[13*l[0],2*l[1]]],["N",[14*l[0],2*l[1]]],["O",[15*l[0],2*l[1]]],["P",[0*l[0],3*l[1]]],["Q",[1*l[0],3*l[1]]],["R",[2*l[0],3*l[1]]],["S",[3*l[0],3*l[1]]],["T",[4*l[0],3*l[1]]],["U",[5*l[0],3*l[1]]],["V",[6*l[0],3*l[1]]],["W",[7*l[0],3*l[1]]],["X",[8*l[0],3*l[1]]],["Y",[9*l[0],3*l[1]]],["Z",[10*l[0],3*l[1]]],["[",[11*l[0],3*l[1]]],["\\",[12*l[0],3*l[1]]],["]",[13*l[0],3*l[1]]],["^",[14*l[0],3*l[1]]],["_",[15*l[0],3*l[1]]],["`",[0*l[0],4*l[1]]],["a",[1*l[0],4*l[1]]],["b",[2*l[0],4*l[1]]],["c",[3*l[0],4*l[1]]],["d",[4*l[0],4*l[1]]],["e",[5*l[0],4*l[1]]],["f",[6*l[0],4*l[1]]],["g",[7*l[0],4*l[1]]],["h",[8*l[0],4*l[1]]],["i",[9*l[0],4*l[1]]],["j",[10*l[0],4*l[1]]],["k",[11*l[0],4*l[1]]],["l",[12*l[0],4*l[1]]],["m",[13*l[0],4*l[1]]],["n",[14*l[0],4*l[1]]],["o",[15*l[0],4*l[1]]],["p",[0*l[0],5*l[1]]],["q",[1*l[0],5*l[1]]],["r",[2*l[0],5*l[1]]],["s",[3*l[0],5*l[1]]],["t",[4*l[0],5*l[1]]],["u",[5*l[0],5*l[1]]],["v",[6*l[0],5*l[1]]],["w",[7*l[0],5*l[1]]],["x",[8*l[0],5*l[1]]],["y",[9*l[0],5*l[1]]],["z",[10*l[0],5*l[1]]],["{",[11*l[0],5*l[1]]],["|",[12*l[0],5*l[1]]],["}",[13*l[0],5*l[1]]],["~",[14*l[0],5*l[1]]]]);let s=256,a=96,o=new Uint8Array(s*a*4);{let f=0;for(let d=0;d<Ke.length;d+=2){let c=parseInt("".concat(Ke.substring(d,d+2),"000000"),16)>>24,h=0;c<0&&(c=-c,h=255);for(let u=0;u<c;++u)o[f*4+0]=h,o[f*4+1]=h,o[f*4+2]=h,o[f*4+3]=h,++f}}this._texture.loadFromMemory(s,a,o,!0)}setTextAlign(t,r){return this._horizontalTextAlign=t,this._verticalTextAlign=r,this}setTextScale(t){return this._textScale=t,this}setTextColor(t,r,n){return this._textColor[0]=t,this._textColor[1]=r,this._textColor[2]=n,this}pushText(t,r){if(t.length===0)return this;if(this._textScale<=0)return this;let n=[0];for(let o=0;o<t.length;++o)t[o]=="\n"?n.push(0):n[n.length-1]+=1;if(n.length===0)return this;let i=0,s=[0,0],a=this._textScale*.5;switch(this._horizontalTextAlign){case"left":s[0]=r[0];break;case"centered":s[0]=r[0]-n[i]*a+a;break;case"right":s[0]=r[0]-n[i]*this._textScale+this._textScale;break}switch(this._verticalTextAlign){case"top":s[1]=r[1];break;case"centered":s[1]=r[1]+n.length*a-a;break;case"bottom":s[1]=r[1]-(n.length-1)*this._textScale;break}for(let o=0;o<t.length;++o){let f=t[o];if(f=="\n"){switch(i+=1,this._horizontalTextAlign){case"left":s[0]=r[0];break;case"centered":s[0]=r[0]-n[i]*a+a;break;case"right":s[0]=r[0]-n[i]*this._textScale+this._textScale;break}s[1]-=this._textScale}else this._pushLetter(f,s),s[0]+=this._textScale}return this}_pushLetter(t,r){if(this._currentSize+9*10>=this._buffer.length)return;let n=this._texCoordMap.get(t);if(!n)throw new Error("fail to find a letter, letter=".concat(t));for(let i=-1;i<=1;++i)for(let s=-1;s<=1;++s)this._buffer[this._currentSize++]=r[0]+2*s,this._buffer[this._currentSize++]=r[1]+2*i,this._buffer[this._currentSize++]=-.1,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=this._textScale;this._buffer[this._currentSize++]=r[0],this._buffer[this._currentSize++]=r[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=this._textColor[0],this._buffer[this._currentSize++]=this._textColor[1],this._buffer[this._currentSize++]=this._textColor[2],this._buffer[this._currentSize++]=this._textScale}flush(t){return this._currentSize===0?this:(this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",t),this._shader.setTextureUniform("u_texture",this._texture,0),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/9),this._geometry.render()}),X.unbind(),this.clear(),this)}clear(){return this._currentSize=0,this}};var ue={};Y(ue,{fragment:()=>ys,vertex:()=>bs});var bs="\n#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_composedMatrix;\n\nin vec3  a_vertex_position;\n\nin vec3  a_offset_center;\nin float a_offset_scale;\nin vec4  a_offset_color;\n\nflat out vec4 v_color;\n\nvoid main(void)\n{\n  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;\n\n  gl_Position = u_composedMatrix * vec4(position, 1.0);\n\n  v_color = a_offset_color;\n}\n".trim(),ys="\n#version 300 es\n\nprecision lowp float;\n\nflat in vec4 v_color;\n\nout vec4 out_color;\n\nvoid main(void)\n{\n  out_color = v_color;\n}\n\n".trim();var Rs=e=>{let t=e*.5,r=[];r.push([+t,+t,+t]),r.push([-t,+t,+t]),r.push([+t,-t,+t]),r.push([-t,-t,+t]),r.push([+t,+t,-t]),r.push([-t,+t,-t]),r.push([+t,-t,-t]),r.push([-t,-t,-t]);let n=[];n.push(0,1,1,3,3,2,2,0),n.push(4,5,5,7,7,6,6,4),n.push(0,4,1,5,3,7,2,6);let i=[];for(let s=0;s<n.length;++s){let a=r[n[s]];i.push(a[0],a[1],a[2])}return i},Kt=8*1024*4,Ge=class{constructor(){this._buffer=new Float32Array(Kt);this._currentSize=0;this._shader=new N("WireFrameCubesRenderer",{vertexSrc:ue.vertex,fragmentSrc:ue.fragment,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});let t=new L.GeometryBuilder;t.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(3*4).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(8*4);let r=Rs(1);this._geometry=new L.Geometry(this._shader,t.getDef()),this._geometry.updateBuffer(0,r,r.length),this._geometry.setPrimitiveCount(r.length/3),this._geometry.setFloatBufferSize(1,Kt)}pushCenteredCube(t,r,n){this._currentSize+8>=this._buffer.length||(this._buffer[this._currentSize++]=t[0],this._buffer[this._currentSize++]=t[1],this._buffer[this._currentSize++]=t[2],this._buffer[this._currentSize++]=r,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=n[2],this._buffer[this._currentSize++]=n[3]||1)}pushOriginBoundCube(t,r,n){if(this._currentSize+8>=this._buffer.length)return;let i=r*.5;this._buffer[this._currentSize++]=t[0]+i,this._buffer[this._currentSize++]=t[1]+i,this._buffer[this._currentSize++]=t[2]+i,this._buffer[this._currentSize++]=r,this._buffer[this._currentSize++]=n[0],this._buffer[this._currentSize++]=n[1],this._buffer[this._currentSize++]=n[2],this._buffer[this._currentSize++]=n[3]||1}flush(t){this._currentSize<=0||(this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",t),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear())}clear(){this._currentSize=0}};var{WebGLContext:ne,ShaderProgram:Es}=ge,Ue=class{constructor(t){this._viewportSize=q.create();this._frustumCulling=new Ve;this._mainCamera=new oe;this._mainHudCamera=new oe;this.onContextLost=null;this.onContextRestored=null;this._def=t,this.resize(this._def.canvasDomElement.width,this._def.canvasDomElement.height),ne.initialize(this._def.canvasDomElement);let r=i=>{i.preventDefault(),console.log("context is lost"),this.onContextLost&&this.onContextLost()},n=()=>{console.log("context is restored"),ne.initialize(this._def.canvasDomElement),this.onContextRestored&&this.onContextRestored()};this._def.canvasDomElement.addEventListener("webglcontextlost",r,!1),this._def.canvasDomElement.addEventListener("webglcontextrestored",n,!1),this._scene={chunksRenderer:new De,triangleCubesRenderer:new Le},this._hud={textRenderer:new Ie,stackRenderers:new Fe,wireFrameCubesRenderer:new Ge}}resize(t,r){this._viewportSize[0]=t,this._viewportSize[1]=r,this._mainCamera.setViewportSize(t,r),this._mainCamera.setAsPerspective({fovy:70,near:.1,far:70}),this._mainHudCamera.setViewportSize(t,r),this._mainHudCamera.setAsOrthogonal({left:-t*.5,right:+t*.5,top:-r*.5,bottom:+r*.5,near:-200,far:200}),this._mainHudCamera.setEye([+t*.5,+r*.5,1]),this._mainHudCamera.setTarget([+t*.5,+r*.5,0]),this._mainHudCamera.setUpAxis([0,1,0]),this._mainHudCamera.computeMatrices()}toggleContextLoss(){let t=ne.getContext(),r=ne.getExtensionLoseContext();r&&(t.isContextLost()?r.restoreContext():r.loseContext())}contextIsLost(){return ne.getContext().isContextLost()}setOnContextLost(t){this.onContextLost=t}setOnContextRestored(t){this.onContextRestored=t}async init(){let t=ne.getContext();t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.disable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR),t.activeTexture(t.TEXTURE0),t.enable(t.CULL_FACE),await this._scene.chunksRenderer.initialize()}getSize(){return this._viewportSize}lookAt(t,r,n){this._mainCamera.setEye(t),this._mainCamera.setTarget(r),this._mainCamera.setUpAxis(n),this._mainCamera.computeMatrices()}update(){te.resetDelta(),O.resetDeltas(),this._frustumCulling.calculateFrustum(this._mainCamera.getProjectionMatrix(),this._mainCamera.getViewMatrix())}renderScene(t){let r=ne.getContext(),n=this._mainCamera.getViewportPos(),i=this._mainCamera.getViewportSize();r.viewport(n[0],n[1],i[0],i[1]),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this._scene.chunksRenderer.render(this._mainCamera,t),this._scene.triangleCubesRenderer.flush(this._mainCamera)}renderHUD(){let t=ne.getContext(),r=this._mainHudCamera.getViewportPos(),n=this._mainHudCamera.getViewportSize();t.viewport(r[0],r[1],n[0],n[1]),t.clear(t.DEPTH_BUFFER_BIT),Es.unbind()}get mainCamera(){return this._mainCamera}get hudCamera(){return this._mainHudCamera}get wireFrameCubesRenderer(){return this._hud.wireFrameCubesRenderer}get triangleCubesRenderer(){return this._scene.triangleCubesRenderer}get stackRenderers(){return this._hud.stackRenderers}get textRenderer(){return this._hud.textRenderer}get frustumCulling(){return this._frustumCulling}get chunksRenderer(){return this._scene.chunksRenderer}};var ie=[.2,.2,.2],se=[.2,.6,.2],Ss=(e,t)=>{e.push({center:[t[0],t[1]],size:[40,40],text:"A\nQ",color:I.isPressed("A","Q")?se:ie}),e.push({center:[t[0]+45*1,t[1]],size:[40,40],text:"S",color:I.isPressed("S")?se:ie}),e.push({center:[t[0]+45*1,t[1]+45],size:[40,40],text:"W\nZ",color:I.isPressed("W","Z")?se:ie}),e.push({center:[t[0]+45*2,t[1]],size:[40,40],text:"D",color:I.isPressed("D")?se:ie})},Cs=(e,t)=>{e.push({center:[t[0],t[1]],size:[40,40],lines:[{a:[15,0],b:[-8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[-12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[-12,2],thickness:6,color:[1,1,1]}],color:I.isPressed("ArrowLeft")?se:ie}),e.push({center:[t[0]+45,t[1]],size:[40,40],lines:[{a:[0,15],b:[0,-8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,-12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,-12],thickness:6,color:[1,1,1]}],color:I.isPressed("ArrowDown")?se:ie}),e.push({center:[t[0]+45,t[1]+45],size:[40,40],lines:[{a:[0,-15],b:[0,8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,12],thickness:6,color:[1,1,1]}],color:I.isPressed("ArrowUp")?se:ie}),e.push({center:[t[0]+45*2,t[1]],size:[40,40],lines:[{a:[-15,0],b:[8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[12,2],thickness:6,color:[1,1,1]}],color:I.isPressed("ArrowRight")?se:ie})},ks=(e,t,r)=>{O.isSupported(t)?e.push({center:[r[0]+115,r[1]],size:[230,60],text:"Touch Events\nSupported\n(double tap)",color:[0,.5,0]}):e.push({center:[r[0]+115,r[1]],size:[230,60],text:"Touch Events\nNot Supported",color:[.5,0,0]}),re.canBePointerLocked(t)?e.push({center:[r[0]+105,r[1]+70],size:[210,60],text:"Mouse\nSupported",color:[0,.5,0]}):e.push({center:[r[0]+105,r[1]+70],size:[210,60],text:"Mouse Events\nNot Supported",color:[.5,0,0]})},$t=(e,t,r)=>{let n=[],i=[27,165],s=[7+20,260],a=[7,35];Ss(n,i),Cs(n,s),ks(n,e,a),n.forEach(o=>{let{center:f}=o;t.pushCenteredRectangle(R.fromValues(f[0],f[1],-.3),o.size,[0,0,0]),t.pushCenteredRectangle(R.fromValues(f[0],f[1],-.2),[o.size[0]-2,o.size[1]-2],o.color),o.text&&r.setTextScale(16).setTextAlign("centered","centered").pushText(o.text,f).setTextAlign("left","top"),o.lines&&o.lines.forEach(d=>{t.pushThickLine([f[0]+d.a[0],f[1]+d.a[1],0],[f[0]+d.b[0],f[1]+d.b[1],0],d.thickness,d.color)})})};var Zt=(e,t,r,n)=>{let i=[Math.floor(r[0]/t),Math.floor(r[1]/t),Math.floor(r[2]/t)],s=["Coordinates:","X: ".concat(i[0]),"Y: ".concat(i[1]),"Z: ".concat(i[2])],a=[14,e[1]-200];n.setTextScale(14).setTextAlign("left","top").pushText(s.join("\n"),a)};var $e=(e,t,r,n,i,s=!1)=>{let o=Math.ceil(r.maxDelta/5)*5;{n.pushOriginBoundRectangle(e,t,[0,0,0,.5]);let f=[[e[0]+t[0]*0,e[1]+t[1]*0,0],[e[0]+t[0]*1,e[1]+t[1]*0,0],[e[0]+t[0]*1,e[1]+t[1]*1,0],[e[0]+t[0]*0,e[1]+t[1]*1,0]];n.pushLine(f[0],f[1],[1,1,1]),n.pushLine(f[1],f[2],[1,1,1]),n.pushLine(f[2],f[3],[1,1,1]),n.pushLine(f[3],f[0],[1,1,1])}for(let f=5;f<o;f+=5){let d=f/o,c=[e[0]+0,e[1]+t[1]*d,0],h=[e[0]+t[0],e[1]+t[1]*d,0];n.pushLine(c,h,[.5,.5,.5])}if(r.framesDelta.length>=2){let f=t[0]/r.framesDelta.length,d=r.framesDelta[0],c=0,h=t[1]*d/o;for(let u=1;u<r.framesDelta.length;++u){let p=r.framesDelta[u],_=u*f,v=t[1]*p/o,m=[e[0]+c,e[1]+h,0],g=[e[0]+_,e[1]+v,0];n.pushLine(m,g,[1,1,1]),d=p,c=_,h=v}}{let c=r.averageDelta,h=r.maxDelta,u=r.minDelta,p="~".concat(c.toFixed(0),"ms"),_="<".concat(h,"ms"),v=">".concat(u,"ms");if(s===!0){let m=g=>g<999?g.toFixed(0):"???";p+="\n~".concat(m(1e3/c),"fps"),_+="\n<".concat(m(1e3/h),"fps"),v+="\n>".concat(m(1e3/u),"fps")}i.setTextScale(14).setTextAlign("left","top").setTextColor(1,1,.75).pushText(p,[e[0]+7,e[1]-8]).setTextAlign("left","centered").setTextColor(1,.75,.75).pushText(_,[e[0]+t[0]+7,e[1]+t[1]-7*1]).setTextColor(.75,1,.75).pushText(v,[e[0]+t[0]+7,e[1]+7*1]).setTextColor(1,1,1)}};var Qt=(e,t,r,n,i)=>{let s=[e[0]-10,e[1]-10],a=["Chunks\nGenerated:\n".concat(t," <"),"","Chunks\nDiscarded:\n".concat(r," <"),"","Live\nChunks:\n".concat(t-r," <"),"","Visible\nChunks:\n".concat(n," <")].join("\n");i.setTextScale(14).setTextAlign("right","top").pushText(a,s)};var Jt=(e,t,r,n,i,s,a,o)=>{let f=Math.tan(e/360*Math.PI)*r,d=f*t,c=-d,h=+d,u=+f,p=-f,_=n*Math.sin(e*Math.PI/180),v=_*t,m=[];m.push([r,c,u]),m.push([r,h,u]),m.push([r,c,p]),m.push([r,h,p]),m.push([n,-v,+_]),m.push([n,+v,+_]),m.push([n,-v,-_]),m.push([n,+v,-_]),m.push([0,0,0]),m.push([100,0,0]),m.push([0,100,0]),m.push([0,0,100]);{let g=F.identity(F.create());F.translate(g,g,i),F.rotate(g,g,s,[0,0,1]),F.rotate(g,g,a,[0,-1,0]);for(let T=0;T<m.length;++T)m[T]=R.transformMat4(m[T],m[T],g)}{let g=[];g.push(0,1,1,3,3,2,2,0),g.push(0,4,1,5,2,6,3,7),g.push(4,5,5,7,7,6,6,4);let T=[1,1,0];for(let x=0;x<g.length;x+=2){let b=m[g[x+0]],y=m[g[x+1]];o.pushLine(b,y,T)}{let x=m[8],b=m[9],y=m[10],M=m[11];o.pushLine(x,b,[1,0,0]),o.pushLine(x,y,[0,1,0]),o.pushLine(x,M,[0,0,1])}}};var er=(e,t,r,n,i,s,a,o,f)=>{let d=S.getContext(),[c,h]=s,u=new oe,p=Math.min(c,h)*.5,_=Math.max(p,t),v=Math.max(p,t),m=c-_;u.setViewportPos(m,0),u.setViewportSize(_,v);let g=_/v,T=g>=1?r:r*(1/g),x=T*g;u.setAsOrthogonal({left:-x,right:+x,top:-T,bottom:+T,near:-r,far:+r}),u.setUpAxis([0,0,1]);let b=e.getEye(),y=e.getTarget(),M=R.sub(R.create(),y,b),A=Math.atan2(M[1],M[0]),k=Math.atan2(M[2],q.length(q.fromValues(M[1],M[0]))),w=A-Math.PI*.25,V=k+Math.PI*.5,D=Math.cos(w),z=Math.sin(w),G=Math.sin(V),E=R.copy(R.create(),b);E[0]-=D*20,E[1]-=z*20,E[2]+=G*10,u.setEye(E),u.setTarget(b),u.computeMatrices();let B=u.getViewportPos(),J=u.getViewportSize();d.viewport(B[0],B[1],J[0],J[1]),d.clear(d.DEPTH_BUFFER_BIT),d.disable(d.DEPTH_TEST),d.enable(d.BLEND),o.clear();let ae=R.fromValues(1,1,1),xe=Z.fromValues(1,0,0,.8),be=R.fromValues(0,1,0),ve=i*.5,j=R.create(),Ze=R.fromValues(ve,ve,ve);if(n.forEach(K=>{R.copy(j,K.realPosition),R.add(j,j,Ze),K.isVisible?o.pushCenteredCube(j,ve,ae):o.pushCenteredCube(j,ve,xe)}),a.length>0){let K=i*1.2;a.forEach(rr=>{R.copy(j,rr),R.add(j,j,Ze),o.pushCenteredCube(j,K,be)})}o.flush(u.getComposedMatrix()),f.flush(u.getComposedMatrix());{let K=e.getPerspectiveData();Jt(K.fovy,K.aspectRatio,K.near,K.far,b,A,k,f),f.flush(u.getComposedMatrix())}d.disable(d.BLEND),d.enable(d.DEPTH_TEST)};var pe=new Map,tr=(e,t,r)=>{let n=O.getTouchData();if(n.length===0)pe.clear();else{let i=new Set,s=[1,0,0],a=[0,1,0],o=n.length>1?s:a;n.forEach(d=>{i.add(d.id);let c=pe.get(d.id);c===void 0&&(c=0,pe.set(d.id,c));let h=[0,.5];r&&h.push(.25,.75);for(let u of h){let p=c+u*Math.PI,_=[d.positionX,e[1]-d.positionY,0];t.pushRotatedLine(_,p,150,15,o)}c+=.1,pe.set(d.id,c)});let f=new Set;pe.forEach((d,c)=>{i.has(c)||f.add(c)}),f.forEach(d=>{pe.delete(d)})}};var Be=class{constructor(t){this._chunksCreated=0;this._chunksDiscarded=0;this._currFrameTime=0;this._frameProfiler=new de;this._canvasElement=t,this._freeFlyController=new Ee({position:R.fromValues(0,0,0),coordinates:["X","Y","Z"],theta:0,phi:0,mouseSensibility:.1,movingSpeed:32,keyboardSensibility:ot,touchSensibility:ft}),this._renderer=new Ue({canvasDomElement:t}),this._chunkGenerator=new Ae({chunkGraphicSize:20,chunkGenerationRange:3,chunkLogicSize:10,workerTotal:ct,workerFile:dt,chunkIsVisible:r=>{let n=20*.5;return this._renderer.frustumCulling.cubeInFrustum(r[0]+n,r[1]+n,r[2]+n,n)},acquireGeometry:r=>this._renderer.chunksRenderer.acquireGeometry(r),releaseGeometry:r=>{this._renderer.chunksRenderer.releaseGeometry(r)},onChunkCreated:()=>{++this._chunksCreated},onChunkDiscarded:()=>{++this._chunksDiscarded}}),I.activate(),O.activate(this._canvasElement),re.allowPointerLockedOnClickEvent(t),re.addOnLockChange(()=>{re.isPointerLocked(t)?te.activate():(te.deactivate(),re.allowPointerLockedOnClickEvent(t))}),re.addOnLockError(r=>{}),this._running=!1,this._errorGraphicContext=!1,this._renderer.setOnContextLost(()=>{console.log("on_context_lost"),this._errorGraphicContext=!0,this.stop()}),this._renderer.setOnContextRestored(()=>{console.log("on_context_restored"),this._errorGraphicContext=!1,this.start()})}async init(){await this._renderer.init()}resize(t,r,n){let i=t,s=r;n?(this._canvasElement.style.position="absolute",i=window.innerWidth,s=window.innerHeight):this._canvasElement.style.position="relative",this._canvasElement.style.left="0px",this._canvasElement.style.top="0px",this._canvasElement.style.width="".concat(i,"px"),this._canvasElement.style.height="".concat(s,"px"),this._canvasElement.width=i,this._canvasElement.height=s,this._renderer.resize(i,s)}start(){this.isRunning()||(this._running=!0,this._chunkGenerator.start(),this._tick())}stop(){this._running=!1,this._chunkGenerator.stop()}isRunning(){return this._running&&!this._errorGraphicContext}_tick(){let t=()=>{!this._running||this._errorGraphicContext||(window.requestAnimationFrame(t),this._mainLoop())};t()}_mainLoop(){let t=Date.now(),r=Math.min(t-this._currFrameTime,30);this._currFrameTime=t,this._frameProfiler.pushDelta(r),this._freeFlyController.update(r/1e3,(o,f,d)=>!1),this._renderer.lookAt(this._freeFlyController.getPosition(),this._freeFlyController.getTarget(),this._freeFlyController.getUpAxis()),this._renderer.update();let n=this._freeFlyController.getPosition();this._chunkGenerator.update(n);let i=0;this._renderer.wireFrameCubesRenderer.clear(),this._chunkGenerator.getChunks().forEach(o=>{o.isVisible&&(++i,this._renderer.triangleCubesRenderer.pushOriginBoundCube(o.realPosition,20,[1,1,1]))}),this._renderer.renderScene(20),this._renderer.renderHUD(),this._renderer.stackRenderers.clear(),this._renderer.textRenderer.clear(),Qt(this._renderer.getSize(),this._chunksCreated,this._chunksDiscarded,i,this._renderer.textRenderer),Zt(this._renderer.getSize(),20,n,this._renderer.textRenderer),$t(this._canvasElement,this._renderer.stackRenderers,this._renderer.textRenderer),$e([10,this._canvasElement.height-60,0],[100,50],this._frameProfiler,this._renderer.stackRenderers,this._renderer.textRenderer,!0),$e([10,this._canvasElement.height-150,0],[100,50],this._chunkGenerator.getFrameProfiler(),this._renderer.stackRenderers,this._renderer.textRenderer),tr(this._renderer.getSize(),this._renderer.stackRenderers,this._freeFlyController.getTouchMoveForward()),this._renderer.stackRenderers.flush(this._renderer.hudCamera.getComposedMatrix()),this._renderer.textRenderer.flush(this._renderer.hudCamera.getComposedMatrix());let s=300,a=150;er(this._renderer.mainCamera,s,a,this._chunkGenerator.getChunks(),20,this._renderer.getSize(),this._chunkGenerator.getProcessingRealPositions(),this._renderer.wireFrameCubesRenderer,this._renderer.stackRenderers)}};var zs=async()=>{let e=null,t=async()=>{e&&e.stop()};window.addEventListener("error",t);let r=document.querySelector("#main-canvas");if(!r)throw new Error("main-canvas not found");let n=document.querySelector("#gui_toggle_start");if(!n)throw new Error("guiToggleStart not found");let i=document.querySelector("#gui_fullscreen");if(!i)throw new Error("guiFullscreen not found");if(!it())throw new Error("missing WebGL2 feature (unsupported)");if(!nt())throw new Error("missing WebWorker feature (unsupported)");n.addEventListener("click",()=>{e&&(e.isRunning()?e.stop():e.start())}),i.addEventListener("click",()=>{e&&Me.requestFullScreen(r)}),Me.addOnFullScreenChange(()=>{if(!e)return;let s=800,a=600,o=Me.isFullScreen(r);o?(r.style.position="absolute",s=window.innerWidth,a=window.innerHeight):r.style.position="relative",r.style.left="0px",r.style.top="0px",r.style.width="".concat(s,"px"),r.style.height="".concat(a,"px"),r.width=s,r.height=a,e.resize(s,a,o)}),e=new Be(r),await e.init(),e.start()};window.addEventListener("load",zs);})();
