var $$=Object.defineProperty;var s=(Q,$)=>{for(var J in $)$$(Q,J,{get:$[J],enumerable:!0,configurable:!0,set:(U)=>$[J]=()=>U})};var b0=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],J$=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"];class l0{_onFullScreenChangeCallbacks=[];_isInitialized=!1;_initialize(){if(this._isInitialized)return;this._isInitialized=!0;const Q=()=>{this._onFullScreenChangeCallbacks.forEach(($)=>$())};for(let $ of J$)document.addEventListener($,Q,!1)}isCompatible(Q){for(let $ of b0)if($ in Q)return!0;return!1}isFullScreen(Q){return document.fullscreenElement===Q}async requestFullScreen(Q){if(this.isFullScreen(Q))return{success:!1,message:"element already in full screen"};this._initialize();for(let $ of b0)if($ in Q)return Q[$](),{success:!0,message:"request for full screen done"};return{success:!1,message:"unsupported request for full screen"}}addOnFullScreenChange(Q){this._onFullScreenChangeCallbacks.push(Q)}removeOnFullScreenChange(Q){const $=this._onFullScreenChangeCallbacks.indexOf(Q);if($<0)return;this._onFullScreenChangeCallbacks.splice($,1)}}var W0=new l0;var G0={Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,BackQuote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Shift:16,Ctrl:17,Alt:18,CapsLock:20,Tab:9,Enter:13,Pause:19,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,PrintScreen:44,Insert:45,Delete:46,ContextMenu:93,ScrollLock:145,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,NumPadMultiply:106,NumPadAdd:107,NumPadSubtract:109,NumPadDecimal:110,NumPadDivide:111,NumLock:144,NumPadComma:194,NumPadEqual:12};class r0{_pressedKeysSet=new Set;_preventDefaultKeysSet=new Set;_activated=!1;_handleKeyDown;_handleKeyUp;constructor(){const Q=(J)=>{const{keyCode:U}=J;if(this._preventDefaultKeysSet.has(U))J.preventDefault();this._pressedKeysSet.add(U)},$=(J)=>{const{keyCode:U}=J;if(this._preventDefaultKeysSet.has(U))J.preventDefault();this._pressedKeysSet.delete(U)};this._activated=!1,this._handleKeyDown=Q.bind(this),this._handleKeyUp=$.bind(this)}isPressed(...Q){for(let $ of Q)if(this._pressedKeysSet.has(G0[$]))return!0;return!1}preventDefault(Q){this._preventDefaultKeysSet.add(G0[Q])}enableDefault(Q){this._preventDefaultKeysSet.delete(G0[Q])}activate(){if(this._activated)return;this._pressedKeysSet.clear(),document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("keyup",this._handleKeyUp),this._activated=!0}deactivate(){if(!this._activated)return;this._pressedKeysSet.clear(),document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("keyup",this._handleKeyUp),this._activated=!1}}var C=new r0;var U$={Left:0,Middle:1,Right:2};class n0{_pressedButtonsSet=new Set;_activated=!1;_handleMouseDown;_handleMouseUp;_handleMouseMove;_deltaX=0;_deltaY=0;constructor(){const Q=(U)=>{this._pressedButtonsSet.add(U.button)},$=(U)=>{this._pressedButtonsSet.delete(U.button)},J=(U)=>{this._deltaX+=U.movementX||U.mozMovementX||U.webkitMovementX||0,this._deltaY+=U.movementY||U.mozMovementY||U.webkitMovementY||0};this._activated=!1,this._handleMouseDown=Q.bind(this),this._handleMouseUp=$.bind(this),this._handleMouseMove=J.bind(this)}activate(){if(this._activated)return;this._pressedButtonsSet.clear(),document.addEventListener("mousedown",this._handleMouseDown),document.addEventListener("mouseup",this._handleMouseUp),document.addEventListener("mousemove",this._handleMouseMove),this._activated=!0}deactivate(){if(!this._activated)return;this._pressedButtonsSet.clear(),document.removeEventListener("mousedown",this._handleMouseDown),document.removeEventListener("mouseup",this._handleMouseUp),document.removeEventListener("mousemove",this._handleMouseMove),this._activated=!1}isButtonPressed(Q){return this._pressedButtonsSet.has(U$[Q])}deltaX(){return this._deltaX}deltaY(){return this._deltaY}resetDelta(){this._deltaX=0,this._deltaY=0}}var t=new n0;var u0=["requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock"],N$=["exitPointerLock","mozExitPointerLock","webkitExitPointerLock"],Z$=["pointerLockElement","mozPointerLockElement","webkitPointerLockElement"],j$=[{methodName:"onpointerlockchange",propertyName:"pointerlockchange"},{methodName:"onmozpointerlockchange",propertyName:"mozpointerlockchange"},{methodName:"onwebkitpointerlockchange",propertyName:"webkitpointerlockchange"}],K$=[{methodName:"onpointerlockerror",propertyName:"pointerlockerror"},{methodName:"onmozpointerlockerror",propertyName:"mozpointerlockerror"},{methodName:"onwebkitpointerlockerror",propertyName:"webkitpointerlockerror"}];class i0{_onLockChangeCallbacks=[];_onLockErrorCallbacks=[];_timeSinceLastLockChange=0;_latestRequestHtmlElement;_isInitialized=!1;_initialize(){if(this._isInitialized)return;this._isInitialized=!0;const Q=()=>{this._timeSinceLastLockChange=Date.now(),this._onLockChangeCallbacks.forEach((J)=>J())},$=(J)=>{this._timeSinceLastLockChange=Date.now(),this._onLockErrorCallbacks.forEach((U)=>U(J))};for(let J of j$)if(J.methodName in document){document.addEventListener(J.propertyName,Q,!1);break}for(let J of K$)if(J.methodName in document){document.addEventListener(J.propertyName,$,!1);break}}canBePointerLocked(Q){for(let $ of u0)if($ in Q)return!0;return!1}isPointerLocked(Q){for(let $ of Z$)if($ in document)return document[$]===Q;return!1}async requestPointerLock(Q){if(this.isPointerLocked(Q))return{success:!1,message:"element already locked"};if(this._initialize(),this._timeSinceLastLockChange>0){const $=(Date.now()-this._timeSinceLastLockChange)/1000;if($<1.1)return{success:!1,message:`request for lock was too early, time to wait: ${$.toFixed(2)}sec`}}this._timeSinceLastLockChange=Date.now();for(let $ of u0)if($ in Q){const J={unadjustedMovement:!1};try{await Q[$](J)}catch(U){return{success:!1,message:`request for lock was too early, time to wait: ${((Date.now()-this._timeSinceLastLockChange)/1000).toFixed(2)}sec`}}return this._timeSinceLastLockChange=Date.now(),{success:!0,message:"request for lock done"}}return{success:!1,message:"unsupported request for lock"}}allowPointerLockedOnClickEvent(Q){if(Q===this._latestRequestHtmlElement)return;this._latestRequestHtmlElement=Q;const $=async()=>{Q.removeEventListener("click",$);const J=await this.requestPointerLock(Q);if(this._latestRequestHtmlElement=void 0,!J.success)this.allowPointerLockedOnClickEvent(Q)};Q.addEventListener("click",$)}exitPointerLock(){for(let Q of N$)if(Q in document){document[Q]();break}}addOnLockChange(Q){this._onLockChangeCallbacks.push(Q)}removeOnLockChange(Q){const $=this._onLockChangeCallbacks.indexOf(Q);if($<0)return;this._onLockChangeCallbacks.splice($,1)}addOnLockError(Q){this._onLockErrorCallbacks.push(Q)}removeOnLockError(Q){const $=this._onLockErrorCallbacks.indexOf(Q);if($<0)return;this._onLockErrorCallbacks.splice($,1)}}var Q0=new i0;class a0{id;createdAt=Date.now();positionX;positionY;deltaX=0;deltaY=0;constructor(Q,$,J){this.id=Q,this.positionX=$,this.positionY=J}resetDelta(){this.deltaX=0,this.deltaY=0}}class e0{_activated=!1;_allTouchDataMap=new Map;_allCachedTouchDataArray=[];_handleTouchStart;_handleTouchEnd;_handleTouchMove;constructor(){const Q=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z,pageX:j,pageY:K}=U.changedTouches[N],X=new a0(Z,j,K);this._allTouchDataMap.set(`${Z}`,X),this._allCachedTouchDataArray.length=0}},$=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z}=U.changedTouches[N];this._allTouchDataMap.delete(`${Z}`),this._allCachedTouchDataArray.length=0}},J=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z,pageX:j,pageY:K}=U.changedTouches[N],X=this._allTouchDataMap.get(`${Z}`);if(!X)continue;const Y=j-X.positionX,I=K-X.positionY;X.deltaX+=Y,X.deltaY+=I,X.positionX=j,X.positionY=K}};this._activated=!1,this._handleTouchStart=Q.bind(this),this._handleTouchEnd=$.bind(this),this._handleTouchMove=J.bind(this)}isSupported(Q){return"ontouchstart"in Q}activate(Q){if(!this.isSupported(Q))return;if(this._activated)return;this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,Q.addEventListener("touchstart",this._handleTouchStart),Q.addEventListener("touchend",this._handleTouchEnd),Q.addEventListener("touchcancel",this._handleTouchEnd),Q.addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._activated=!0}deactivate(Q){if(!this._activated)return;this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,Q.removeEventListener("touchstart",this._handleTouchStart),Q.removeEventListener("touchend",this._handleTouchEnd),Q.removeEventListener("touchcancel",this._handleTouchEnd),Q.removeEventListener("touchmove",this._handleTouchMove),this._activated=!1}_refreshCache(){if(this._allCachedTouchDataArray.length===0)this._allCachedTouchDataArray=[...this._allTouchDataMap.values()]}getTouchData(){return this._refreshCache(),this._allCachedTouchDataArray}resetDeltas(){this._refreshCache(),this._allCachedTouchDataArray.forEach((Q)=>Q.resetDelta())}}var d=new e0;var o0=()=>{return!!window.Worker};var t0=()=>{return!!window.WebGL2RenderingContext};var A0={};s(A0,{WebGLContext:()=>{{return _}},Texture:()=>{{return b}},ShaderProgram:()=>{{return x}},GeometryWrapper:()=>{{return P}},FrameBuffer:()=>{{return QQ}},DepthTextureType:()=>{{return w0}},ColorTextureType:()=>{{return B0}}});class _{static _gl=null;static _extensionLoseContext=null;static initialize(Q){const $={alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!1};if(_._gl=Q.getContext("webgl2",$),!_._gl)throw new Error("could not create webgl context");_._extensionLoseContext=_._gl.getExtension("WEBGL_lose_context"),_._gl.getExtension("EXT_color_buffer_float"),_._gl.getExtension("EXT_float_blend")}static getContext(){if(!_._gl)throw new Error("webgl context not initialized");return _._gl}static getExtensionLoseContext(){return _._extensionLoseContext}static getExtensionLoseContextStrict(){if(!_._extensionLoseContext)throw new Error("lose context extension not available");return _._extensionLoseContext}}var B0;(function(J){J[J["RBGA_UBYTES"]=0]="RBGA_UBYTES";J[J["RBGA_FLOAT"]=1]="RBGA_FLOAT"})(B0||(B0={}));var w0;(function($){$[$["FLOAT"]=0]="FLOAT"})(w0||(w0={}));class QQ{_def;_fbo;_depthTex;_colorsTex=[];constructor(Q){this._def={...Q};const $=_.getContext(),J=$.createFramebuffer();if(J===null)throw new Error("null frame buffer object");this._fbo=J,$.bindFramebuffer($.FRAMEBUFFER,this._fbo);{const N=$.createTexture();if(N===null)throw new Error("null texture object");this._depthTex=N;const Z=0,j=0,K=$.DEPTH_COMPONENT,X=$.DEPTH_COMPONENT32F,Y=$.FLOAT;$.bindTexture($.TEXTURE_2D,this._depthTex),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texImage2D($.TEXTURE_2D,Z,X,this._def.width,this._def.height,j,K,Y,null),$.bindFramebuffer($.FRAMEBUFFER,this._fbo),$.framebufferTexture2D($.FRAMEBUFFER,$.DEPTH_ATTACHMENT,$.TEXTURE_2D,this._depthTex,0)}this._def.colorTextures.forEach((N)=>{const Z=$.createTexture();if(Z===null)throw new Error("null texture object");this._colorsTex.push(Z);const j=0,K=0,X=$.RGBA;let{RGBA32F:Y,FLOAT:I}=$;if(N.type===B0.RBGA_UBYTES)Y=$.RGBA,I=$.UNSIGNED_BYTE;$.bindTexture($.TEXTURE_2D,Z),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texImage2D($.TEXTURE_2D,j,Y,this._def.width,this._def.height,K,X,I,null),$.bindFramebuffer($.FRAMEBUFFER,this._fbo),$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0+N.index,$.TEXTURE_2D,Z,0)});{const N=$.checkFramebufferStatus($.FRAMEBUFFER);if(N==$.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(N==$.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");if(N==$.FRAMEBUFFER_UNSUPPORTED)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_UNSUPPORTED");if(N==$.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("Framebuffer incomplete -> gl.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE");if(N!=$.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer incomplete -> ???")}const U=Q.colorTextures.map((N)=>$.COLOR_ATTACHMENT0+N.index);$.drawBuffers(U),$.bindFramebuffer($.FRAMEBUFFER,null)}resize(Q,$){this._def.width=Q,this._def.height=$;const J=_.getContext();{const{DEPTH_COMPONENT:Z,DEPTH_COMPONENT32F:j,FLOAT:K}=J;J.bindTexture(J.TEXTURE_2D,this._depthTex),J.texImage2D(J.TEXTURE_2D,0,j,this._def.width,this._def.height,0,Z,K,null)}{const Z=J.RGBA;this._colorsTex.forEach((j,K)=>{let{RGBA32F:X,FLOAT:Y}=J;if(this._def.colorTextures[K].type===B0.RBGA_UBYTES)X=J.RGBA,Y=J.UNSIGNED_BYTE;J.bindTexture(J.TEXTURE_2D,j),J.texImage2D(J.TEXTURE_2D,0,X,this._def.width,this._def.height,0,Z,Y,null)})}}bind(){const Q=_.getContext();Q.bindFramebuffer(Q.FRAMEBUFFER,this._fbo)}static unbind(){const Q=_.getContext();Q.bindFramebuffer(Q.FRAMEBUFFER,null)}get depthTexture(){return this._depthTex}get colorsTextures(){return this._colorsTex}get width(){return this._def.width}get height(){return this._def.height}}var P;(function(K0){K0.BytesPerPixel=4;let $;(function(q){q[q["float"]=0]="float";q[q["vec2f"]=1]="vec2f";q[q["vec3f"]=2]="vec3f";q[q["vec4f"]=3]="vec4f";q[q["mat3f"]=4]="mat3f";q[q["mat4f"]=5]="mat4f"})($=K0.AttributeType||(K0.AttributeType={}));const J=(j)=>{switch(j){case $.float:return 1;case $.vec2f:return 2;case $.vec3f:return 3;case $.vec4f:return 4;case $.mat3f:return 9;case $.mat4f:return 16}};let U;(function(Y){Y[Y["lines"]=0]="lines";Y[Y["triangles"]=1]="triangles";Y[Y["triangleStrip"]=2]="triangleStrip"})(U=K0.PrimitiveType||(K0.PrimitiveType={}));class N{_def;_vao;_vbos;_primitiveType;_primitiveStart=0;_primitiveCount=0;_instanceCount=0;_isInstanced=!1;constructor(j,K){const X=_.getContext();if(K.vbos.length===0)throw new Error("empty vbo definition");for(let I of K.vbos){if(I.attrs.length===0)throw new Error("empty vbo attribute definition");for(let B of I.attrs)if(!j.hasAttribute(B.name))throw new Error(`attribute not found, name="${B.name}"`)}switch(this._def=K,K.primitiveType){case U.lines:this._primitiveType=X.LINES;break;case U.triangles:this._primitiveType=X.TRIANGLES;break;case U.triangleStrip:this._primitiveType=X.TRIANGLE_STRIP;break;default:throw new Error("primitive type not found")}const Y=X.createVertexArray();if(!Y)throw new Error("fail o create a vao unit");this._vao=Y,X.bindVertexArray(this._vao),this._vbos=[];for(let I of this._def.vbos){const B=X.createBuffer();if(!B)throw new Error("fail o create a vbo unit");this._vbos.push({object:B,maxSize:0,dynamic:I.dynamic||!1}),X.bindBuffer(X.ARRAY_BUFFER,B);let q=I.stride||0;if(!q){for(let O of I.attrs)switch(O.type){case $.float:q+=1;break;case $.vec2f:q+=2;break;case $.vec3f:q+=3;break;case $.vec4f:q+=4;break;case $.mat3f:q+=9;break;case $.mat4f:q+=16;break}q*=4}for(let O of I.attrs){let D=1,E=1;switch(O.type){case $.float:D=1,E=1;break;case $.vec2f:D=2,E=1;break;case $.vec3f:D=3,E=1;break;case $.vec4f:D=4,E=1;break;case $.mat3f:D=3,E=3;break;case $.mat4f:D=4,E=4;break}const R=j.getAttribute(O.name);for(let F=0;F<E;++F){const A=R+F,L=(O.index+F*D)*4;if(X.enableVertexAttribArray(A),X.vertexAttribPointer(A,D,X.FLOAT,!1,q,L),I.instanced===!0)X.vertexAttribDivisor(A,1),this._isInstanced=!0}}}X.bindVertexArray(null)}dispose(){const j=_.getContext();for(let K of this._vbos)j.deleteBuffer(K.object);this._vbos.length=0,j.deleteVertexArray(this._vao)}setBufferSize(j,K){if(j<0||j>=this._vbos.length)throw new Error("no buffer available to that index");if(K<=0)return;const X=this._vbos[j];if(K<X.maxSize)return;X.maxSize=K;const Y=_.getContext(),I=X.dynamic?Y.DYNAMIC_DRAW:Y.STATIC_DRAW;Y.bindBuffer(Y.ARRAY_BUFFER,X.object),Y.bufferData(Y.ARRAY_BUFFER,K,I),Y.bindBuffer(Y.ARRAY_BUFFER,null)}setFloatBufferSize(j,K){this.setBufferSize(j,K*4)}updateBuffer(j,K,X){if(j<0||j>=this._vbos.length)throw new Error("no buffer available to that index");if(X<=0)return;const Y=_.getContext(),I=K instanceof Float32Array?K:new Float32Array(K),B=this._vbos[j];if(Y.bindBuffer(Y.ARRAY_BUFFER,B.object),X>B.maxSize){B.maxSize=X;const q=B.dynamic?Y.DYNAMIC_DRAW:Y.STATIC_DRAW;Y.bufferData(Y.ARRAY_BUFFER,I,q,0,X)}else Y.bufferSubData(Y.ARRAY_BUFFER,0,I,0,X);Y.bindBuffer(Y.ARRAY_BUFFER,null)}render(){if(this._primitiveCount==0)return;if(this._isInstanced&&this._instanceCount==0)return;const j=_.getContext();if(j.bindVertexArray(this._vao),this._isInstanced===!0)j.drawArraysInstanced(this._primitiveType,this._primitiveStart,this._primitiveCount,this._instanceCount);else j.drawArrays(this._primitiveType,this._primitiveStart,this._primitiveCount);j.bindVertexArray(null)}setPrimitiveStart(j){this._primitiveStart=j}setPrimitiveCount(j){this._primitiveCount=j}setInstancedCount(j){this._instanceCount=j}}K0.Geometry=N;class Z{_def={vbos:[],primitiveType:U.lines};reset(){return this._def={vbos:[],primitiveType:U.lines},this}getDef(){return this._def}setPrimitiveType(j){return this._def.primitiveType=U[j],this}addVbo(){return this._def.vbos.push({attrs:[],instanced:!1}),this}setVboAsInstanced(){return this._getLastVbo().instanced=!0,this}setVboAsDynamic(){return this._getLastVbo().dynamic=!0,this}setStride(j){return this._getLastVbo().stride=j,this}addVboAttribute(j,K){const X=this._getLastVbo(),Y=X.attrs.length>0?X.attrs[X.attrs.length-1]:null;return X.attrs.push({name:j,type:$[K],index:Y?Y.index+J(Y.type):0}),this}_getLastVbo(){if(this._def.vbos.length===0)throw new Error("no VBO setup");return this._def.vbos[this._def.vbos.length-1]}}K0.GeometryBuilder=Z})(P||(P={}));class x{static _isBound=null;_name;_program;_attributes=new Map;_uniforms=new Map;constructor(Q,$){this._name=Q;const J=_.getContext(),U=this._getShader($.vertexSrc,J.VERTEX_SHADER),N=this._getShader($.fragmentSrc,J.FRAGMENT_SHADER),Z=J.createProgram();if(!Z)throw new Error("could not create a shader program");if(J.attachShader(Z,U),J.attachShader(Z,N),J.linkProgram(Z),J.deleteShader(U),J.deleteShader(N),!J.getProgramParameter(Z,J.LINK_STATUS)){const j=J.getProgramInfoLog(Z);throw new Error("Failed to initialized shaders, Error linking:"+j)}this._program=Z,this.bind(()=>{this._getAttributes($.attributes),this._getUniforms($.uniforms)})}async bind(Q){if(x._isBound!==null)throw new Error(`Double shader binding (bound: ${x._isBound._name}, binding: ${this._name})`);x._isBound=this,_.getContext().useProgram(this._program),Q(),x.unbind()}static unbind(){_.getContext().useProgram(null),x._isBound=null}isBound(){return x._isBound===this}hasAttribute(Q){return this._attributes.has(Q)}getAttribute(Q){const $=this._attributes.get(Q);if($===void 0)throw new Error(`attribute not found: ${Q}`);return $}getUniform(Q){const $=this._uniforms.get(Q);if($===void 0)throw new Error(`uniform not found: ${Q}`);return $}setTextureUniform(Q,$,J){const U=_.getContext();U.activeTexture(U.TEXTURE0+J),U.uniform1i(this.getUniform(Q),J),$.bind()}setInteger1Uniform(Q,$){_.getContext().uniform1i(this.getUniform(Q),$)}setInteger2Uniform(Q,$,J){_.getContext().uniform2i(this.getUniform(Q),$,J)}setInteger3Uniform(Q,$,J,U){_.getContext().uniform3i(this.getUniform(Q),$,J,U)}setFloat1Uniform(Q,$){_.getContext().uniform1f(this.getUniform(Q),$)}setFloat2Uniform(Q,$,J){_.getContext().uniform2f(this.getUniform(Q),$,J)}setFloat3Uniform(Q,$,J,U){_.getContext().uniform3f(this.getUniform(Q),$,J,U)}setMatrix4Uniform(Q,$){_.getContext().uniformMatrix4fv(this.getUniform(Q),!1,$)}_getAttributes(Q){const $=_.getContext();for(let J=0;J<Q.length;++J){const U=$.getAttribLocation(this._program,Q[J]);if(U<0)throw new Error(`attribute not found => ${Q[J]}`);this._attributes.set(Q[J],U)}}_getUniforms(Q){const $=_.getContext();for(let J=0;J<Q.length;++J){const U=$.getUniformLocation(this._program,Q[J]);if(U===null)throw new Error(`uniform not found => ${Q[J]}`);this._uniforms.set(Q[J],U)}}_getShader(Q,$){const J=_.getContext(),U=J.createShader($);if(!U)throw new Error("could not create a shader");if(J.shaderSource(U,Q),J.compileShader(U),!J.getShaderParameter(U,J.COMPILE_STATUS)){let N=J.getShaderInfoLog(U);if(!N)N="failed to compile a shader";throw new Error(N)}return U}}class b{_width=0;_height=0;_texture=null;constructor(){}async load(Q,$=!1){const J=_.getContext();this._texture=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this._texture);const U=0,N=J.RGBA,Z=1,j=1,K=0,X=J.RGBA,Y=J.UNSIGNED_BYTE,I=new Uint8Array([0,0,255,255]);return J.texImage2D(J.TEXTURE_2D,U,N,Z,j,K,X,Y,I),J.bindTexture(J.TEXTURE_2D,null),new Promise((B,q)=>{const O=new Image;O.onerror=q,O.onload=()=>{this._width=O.width,this._height=O.height,J.bindTexture(J.TEXTURE_2D,this._texture),J.texImage2D(J.TEXTURE_2D,U,N,X,Y,O),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE);const D=$?J.NEAREST:J.LINEAR;J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,D),J.bindTexture(J.TEXTURE_2D,null),B()},O.src=Q})}loadFromMemory(Q,$,J,U=!1){const N=_.getContext();this._texture=N.createTexture(),N.bindTexture(N.TEXTURE_2D,this._texture),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE);const Z=U?N.NEAREST:N.LINEAR;N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,Z),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,Z);const j=0,K=N.RGBA,X=0,Y=N.RGBA,I=N.UNSIGNED_BYTE;N.texImage2D(N.TEXTURE_2D,j,K,Q,$,X,Y,I,J),N.bindTexture(N.TEXTURE_2D,null)}getWidth(){if(!this._texture)throw new Error("texture not initialized");return this._width}getHeight(){if(!this._texture)throw new Error("texture not initialized");return this._height}bind(){if(!this._texture)throw new Error("texture not initialized");const Q=_.getContext();Q.bindTexture(Q.TEXTURE_2D,this._texture)}static unbind(){const Q=_.getContext();Q.bindTexture(Q.TEXTURE_2D,null)}}var j0=20,$Q=10;var JQ=3,UQ=32,NQ=0.1,ZQ=Math.PI*0.45,jQ=0.3,KQ="./dist/worker.js",XQ=2;var T=0.000001,S=typeof Float32Array!=="undefined"?Float32Array:Array,l=Math.random,N9=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var Q=0,$=arguments.length;while($--)Q+=arguments[$]*arguments[$];return Math.sqrt(Q)};var y={};s(y,{transpose:()=>{{return R$}},translate:()=>{{return F$}},targetTo:()=>{{return s$}},subtract:()=>{{return OQ}},sub:()=>{{return o$}},str:()=>{{return b$}},set:()=>{{return B$}},scale:()=>{{return L$}},rotateZ:()=>{{return G$}},rotateY:()=>{{return W$}},rotateX:()=>{{return M$}},rotate:()=>{{return V$}},perspectiveZO:()=>{{return g$}},perspectiveNO:()=>{{return BQ}},perspectiveFromFieldOfView:()=>{{return x$}},perspective:()=>{{return C$}},orthoZO:()=>{{return c$}},orthoNO:()=>{{return RQ}},ortho:()=>{{return m$}},multiplyScalarAndAdd:()=>{{return u$}},multiplyScalar:()=>{{return n$}},multiply:()=>{{return HQ}},mul:()=>{{return e$}},lookAt:()=>{{return d$}},invert:()=>{{return O$}},identity:()=>{{return YQ}},getTranslation:()=>{{return p$}},getScaling:()=>{{return qQ}},getRotation:()=>{{return P$}},frustum:()=>{{return z$}},fromZRotation:()=>{{return v$}},fromYRotation:()=>{{return f$}},fromXRotation:()=>{{return T$}},fromValues:()=>{{return q$}},fromTranslation:()=>{{return A$}},fromScaling:()=>{{return _$}},fromRotationTranslationScaleOrigin:()=>{{return S$}},fromRotationTranslationScale:()=>{{return k$}},fromRotationTranslation:()=>{{return IQ}},fromRotation:()=>{{return w$}},fromQuat2:()=>{{return h$}},fromQuat:()=>{{return y$}},frob:()=>{{return l$}},exactEquals:()=>{{return i$}},equals:()=>{{return a$}},determinant:()=>{{return E$}},create:()=>{{return Y$}},copy:()=>{{return I$}},clone:()=>{{return H$}},adjoint:()=>{{return D$}},add:()=>{{return r$}}});function Y$(){var Q=new S(16);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0;return Q[0]=1,Q[5]=1,Q[10]=1,Q[15]=1,Q}function H$(Q){var $=new S(16);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$[4]=Q[4],$[5]=Q[5],$[6]=Q[6],$[7]=Q[7],$[8]=Q[8],$[9]=Q[9],$[10]=Q[10],$[11]=Q[11],$[12]=Q[12],$[13]=Q[13],$[14]=Q[14],$[15]=Q[15],$}function I$(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function q$(Q,$,J,U,N,Z,j,K,X,Y,I,B,q,O,D,E){var R=new S(16);return R[0]=Q,R[1]=$,R[2]=J,R[3]=U,R[4]=N,R[5]=Z,R[6]=j,R[7]=K,R[8]=X,R[9]=Y,R[10]=I,R[11]=B,R[12]=q,R[13]=O,R[14]=D,R[15]=E,R}function B$(Q,$,J,U,N,Z,j,K,X,Y,I,B,q,O,D,E,R){return Q[0]=$,Q[1]=J,Q[2]=U,Q[3]=N,Q[4]=Z,Q[5]=j,Q[6]=K,Q[7]=X,Q[8]=Y,Q[9]=I,Q[10]=B,Q[11]=q,Q[12]=O,Q[13]=D,Q[14]=E,Q[15]=R,Q}function YQ(Q){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function R$(Q,$){if(Q===$){var J=$[1],U=$[2],N=$[3],Z=$[6],j=$[7],K=$[11];Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=J,Q[6]=$[9],Q[7]=$[13],Q[8]=U,Q[9]=Z,Q[11]=$[14],Q[12]=N,Q[13]=j,Q[14]=K}else Q[0]=$[0],Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=$[1],Q[5]=$[5],Q[6]=$[9],Q[7]=$[13],Q[8]=$[2],Q[9]=$[6],Q[10]=$[10],Q[11]=$[14],Q[12]=$[3],Q[13]=$[7],Q[14]=$[11],Q[15]=$[15];return Q}function O$(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=$[4],K=$[5],X=$[6],Y=$[7],I=$[8],B=$[9],q=$[10],O=$[11],D=$[12],E=$[13],R=$[14],F=$[15],A=J*K-U*j,L=J*X-N*j,M=J*Y-Z*j,G=U*X-N*K,W=U*Y-Z*K,f=N*Y-Z*X,v=I*E-B*D,h=I*R-q*D,p=I*F-O*D,k=B*R-q*E,z=B*F-O*E,g=q*F-O*R,w=A*g-L*z+M*k+G*p-W*h+f*v;if(!w)return null;return w=1/w,Q[0]=(K*g-X*z+Y*k)*w,Q[1]=(N*z-U*g-Z*k)*w,Q[2]=(E*f-R*W+F*G)*w,Q[3]=(q*W-B*f-O*G)*w,Q[4]=(X*p-j*g-Y*h)*w,Q[5]=(J*g-N*p+Z*h)*w,Q[6]=(R*M-D*f-F*L)*w,Q[7]=(I*f-q*M+O*L)*w,Q[8]=(j*z-K*p+Y*v)*w,Q[9]=(U*p-J*z-Z*v)*w,Q[10]=(D*W-E*M+F*A)*w,Q[11]=(B*M-I*W-O*A)*w,Q[12]=(K*h-j*k-X*v)*w,Q[13]=(J*k-U*h+N*v)*w,Q[14]=(E*L-D*G-R*A)*w,Q[15]=(I*G-B*L+q*A)*w,Q}function D$(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=$[4],K=$[5],X=$[6],Y=$[7],I=$[8],B=$[9],q=$[10],O=$[11],D=$[12],E=$[13],R=$[14],F=$[15];return Q[0]=K*(q*F-O*R)-B*(X*F-Y*R)+E*(X*O-Y*q),Q[1]=-(U*(q*F-O*R)-B*(N*F-Z*R)+E*(N*O-Z*q)),Q[2]=U*(X*F-Y*R)-K*(N*F-Z*R)+E*(N*Y-Z*X),Q[3]=-(U*(X*O-Y*q)-K*(N*O-Z*q)+B*(N*Y-Z*X)),Q[4]=-(j*(q*F-O*R)-I*(X*F-Y*R)+D*(X*O-Y*q)),Q[5]=J*(q*F-O*R)-I*(N*F-Z*R)+D*(N*O-Z*q),Q[6]=-(J*(X*F-Y*R)-j*(N*F-Z*R)+D*(N*Y-Z*X)),Q[7]=J*(X*O-Y*q)-j*(N*O-Z*q)+I*(N*Y-Z*X),Q[8]=j*(B*F-O*E)-I*(K*F-Y*E)+D*(K*O-Y*B),Q[9]=-(J*(B*F-O*E)-I*(U*F-Z*E)+D*(U*O-Z*B)),Q[10]=J*(K*F-Y*E)-j*(U*F-Z*E)+D*(U*Y-Z*K),Q[11]=-(J*(K*O-Y*B)-j*(U*O-Z*B)+I*(U*Y-Z*K)),Q[12]=-(j*(B*R-q*E)-I*(K*R-X*E)+D*(K*q-X*B)),Q[13]=J*(B*R-q*E)-I*(U*R-N*E)+D*(U*q-N*B),Q[14]=-(J*(K*R-X*E)-j*(U*R-N*E)+D*(U*X-N*K)),Q[15]=J*(K*q-X*B)-j*(U*q-N*B)+I*(U*X-N*K),Q}function E$(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3],Z=Q[4],j=Q[5],K=Q[6],X=Q[7],Y=Q[8],I=Q[9],B=Q[10],q=Q[11],O=Q[12],D=Q[13],E=Q[14],R=Q[15],F=$*j-J*Z,A=$*K-U*Z,L=$*X-N*Z,M=J*K-U*j,G=J*X-N*j,W=U*X-N*K,f=Y*D-I*O,v=Y*E-B*O,h=Y*R-q*O,p=I*E-B*D,k=I*R-q*D,z=B*R-q*E;return F*z-A*k+L*p+M*h-G*v+W*f}function HQ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3],K=$[4],X=$[5],Y=$[6],I=$[7],B=$[8],q=$[9],O=$[10],D=$[11],E=$[12],R=$[13],F=$[14],A=$[15],L=J[0],M=J[1],G=J[2],W=J[3];return Q[0]=L*U+M*K+G*B+W*E,Q[1]=L*N+M*X+G*q+W*R,Q[2]=L*Z+M*Y+G*O+W*F,Q[3]=L*j+M*I+G*D+W*A,L=J[4],M=J[5],G=J[6],W=J[7],Q[4]=L*U+M*K+G*B+W*E,Q[5]=L*N+M*X+G*q+W*R,Q[6]=L*Z+M*Y+G*O+W*F,Q[7]=L*j+M*I+G*D+W*A,L=J[8],M=J[9],G=J[10],W=J[11],Q[8]=L*U+M*K+G*B+W*E,Q[9]=L*N+M*X+G*q+W*R,Q[10]=L*Z+M*Y+G*O+W*F,Q[11]=L*j+M*I+G*D+W*A,L=J[12],M=J[13],G=J[14],W=J[15],Q[12]=L*U+M*K+G*B+W*E,Q[13]=L*N+M*X+G*q+W*R,Q[14]=L*Z+M*Y+G*O+W*F,Q[15]=L*j+M*I+G*D+W*A,Q}function F$(Q,$,J){var U=J[0],N=J[1],Z=J[2],j,K,X,Y,I,B,q,O,D,E,R,F;if($===Q)Q[12]=$[0]*U+$[4]*N+$[8]*Z+$[12],Q[13]=$[1]*U+$[5]*N+$[9]*Z+$[13],Q[14]=$[2]*U+$[6]*N+$[10]*Z+$[14],Q[15]=$[3]*U+$[7]*N+$[11]*Z+$[15];else j=$[0],K=$[1],X=$[2],Y=$[3],I=$[4],B=$[5],q=$[6],O=$[7],D=$[8],E=$[9],R=$[10],F=$[11],Q[0]=j,Q[1]=K,Q[2]=X,Q[3]=Y,Q[4]=I,Q[5]=B,Q[6]=q,Q[7]=O,Q[8]=D,Q[9]=E,Q[10]=R,Q[11]=F,Q[12]=j*U+I*N+D*Z+$[12],Q[13]=K*U+B*N+E*Z+$[13],Q[14]=X*U+q*N+R*Z+$[14],Q[15]=Y*U+O*N+F*Z+$[15];return Q}function L$(Q,$,J){var U=J[0],N=J[1],Z=J[2];return Q[0]=$[0]*U,Q[1]=$[1]*U,Q[2]=$[2]*U,Q[3]=$[3]*U,Q[4]=$[4]*N,Q[5]=$[5]*N,Q[6]=$[6]*N,Q[7]=$[7]*N,Q[8]=$[8]*Z,Q[9]=$[9]*Z,Q[10]=$[10]*Z,Q[11]=$[11]*Z,Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function V$(Q,$,J,U){var N=U[0],Z=U[1],j=U[2],K=Math.hypot(N,Z,j),X,Y,I,B,q,O,D,E,R,F,A,L,M,G,W,f,v,h,p,k,z,g,w,m;if(K<T)return null;if(K=1/K,N*=K,Z*=K,j*=K,X=Math.sin(J),Y=Math.cos(J),I=1-Y,B=$[0],q=$[1],O=$[2],D=$[3],E=$[4],R=$[5],F=$[6],A=$[7],L=$[8],M=$[9],G=$[10],W=$[11],f=N*N*I+Y,v=Z*N*I+j*X,h=j*N*I-Z*X,p=N*Z*I-j*X,k=Z*Z*I+Y,z=j*Z*I+N*X,g=N*j*I+Z*X,w=Z*j*I-N*X,m=j*j*I+Y,Q[0]=B*f+E*v+L*h,Q[1]=q*f+R*v+M*h,Q[2]=O*f+F*v+G*h,Q[3]=D*f+A*v+W*h,Q[4]=B*p+E*k+L*z,Q[5]=q*p+R*k+M*z,Q[6]=O*p+F*k+G*z,Q[7]=D*p+A*k+W*z,Q[8]=B*g+E*w+L*m,Q[9]=q*g+R*w+M*m,Q[10]=O*g+F*w+G*m,Q[11]=D*g+A*w+W*m,$!==Q)Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q}function M$(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[4],j=$[5],K=$[6],X=$[7],Y=$[8],I=$[9],B=$[10],q=$[11];if($!==Q)Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[4]=Z*N+Y*U,Q[5]=j*N+I*U,Q[6]=K*N+B*U,Q[7]=X*N+q*U,Q[8]=Y*N-Z*U,Q[9]=I*N-j*U,Q[10]=B*N-K*U,Q[11]=q*N-X*U,Q}function W$(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[0],j=$[1],K=$[2],X=$[3],Y=$[8],I=$[9],B=$[10],q=$[11];if($!==Q)Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=Z*N-Y*U,Q[1]=j*N-I*U,Q[2]=K*N-B*U,Q[3]=X*N-q*U,Q[8]=Z*U+Y*N,Q[9]=j*U+I*N,Q[10]=K*U+B*N,Q[11]=X*U+q*N,Q}function G$(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[0],j=$[1],K=$[2],X=$[3],Y=$[4],I=$[5],B=$[6],q=$[7];if($!==Q)Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=Z*N+Y*U,Q[1]=j*N+I*U,Q[2]=K*N+B*U,Q[3]=X*N+q*U,Q[4]=Y*N-Z*U,Q[5]=I*N-j*U,Q[6]=B*N-K*U,Q[7]=q*N-X*U,Q}function A$(Q,$){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=$[0],Q[13]=$[1],Q[14]=$[2],Q[15]=1,Q}function _$(Q,$){return Q[0]=$[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=$[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=$[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function w$(Q,$,J){var U=J[0],N=J[1],Z=J[2],j=Math.hypot(U,N,Z),K,X,Y;if(j<T)return null;return j=1/j,U*=j,N*=j,Z*=j,K=Math.sin($),X=Math.cos($),Y=1-X,Q[0]=U*U*Y+X,Q[1]=N*U*Y+Z*K,Q[2]=Z*U*Y-N*K,Q[3]=0,Q[4]=U*N*Y-Z*K,Q[5]=N*N*Y+X,Q[6]=Z*N*Y+U*K,Q[7]=0,Q[8]=U*Z*Y+N*K,Q[9]=N*Z*Y-U*K,Q[10]=Z*Z*Y+X,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function T$(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=U,Q[6]=J,Q[7]=0,Q[8]=0,Q[9]=-J,Q[10]=U,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function f$(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=U,Q[1]=0,Q[2]=-J,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=J,Q[9]=0,Q[10]=U,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function v$(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=U,Q[1]=J,Q[2]=0,Q[3]=0,Q[4]=-J,Q[5]=U,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function IQ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3],K=U+U,X=N+N,Y=Z+Z,I=U*K,B=U*X,q=U*Y,O=N*X,D=N*Y,E=Z*Y,R=j*K,F=j*X,A=j*Y;return Q[0]=1-(O+E),Q[1]=B+A,Q[2]=q-F,Q[3]=0,Q[4]=B-A,Q[5]=1-(I+E),Q[6]=D+R,Q[7]=0,Q[8]=q+F,Q[9]=D-R,Q[10]=1-(I+O),Q[11]=0,Q[12]=J[0],Q[13]=J[1],Q[14]=J[2],Q[15]=1,Q}function h$(Q,$){var J=new S(3),U=-$[0],N=-$[1],Z=-$[2],j=$[3],K=$[4],X=$[5],Y=$[6],I=$[7],B=U*U+N*N+Z*Z+j*j;if(B>0)J[0]=(K*j+I*U+X*Z-Y*N)*2/B,J[1]=(X*j+I*N+Y*U-K*Z)*2/B,J[2]=(Y*j+I*Z+K*N-X*U)*2/B;else J[0]=(K*j+I*U+X*Z-Y*N)*2,J[1]=(X*j+I*N+Y*U-K*Z)*2,J[2]=(Y*j+I*Z+K*N-X*U)*2;return IQ(Q,$,J),Q}function p$(Q,$){return Q[0]=$[12],Q[1]=$[13],Q[2]=$[14],Q}function qQ(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[4],j=$[5],K=$[6],X=$[8],Y=$[9],I=$[10];return Q[0]=Math.hypot(J,U,N),Q[1]=Math.hypot(Z,j,K),Q[2]=Math.hypot(X,Y,I),Q}function P$(Q,$){var J=new S(3);qQ(J,$);var U=1/J[0],N=1/J[1],Z=1/J[2],j=$[0]*U,K=$[1]*N,X=$[2]*Z,Y=$[4]*U,I=$[5]*N,B=$[6]*Z,q=$[8]*U,O=$[9]*N,D=$[10]*Z,E=j+I+D,R=0;if(E>0)R=Math.sqrt(E+1)*2,Q[3]=0.25*R,Q[0]=(B-O)/R,Q[1]=(q-X)/R,Q[2]=(K-Y)/R;else if(j>I&&j>D)R=Math.sqrt(1+j-I-D)*2,Q[3]=(B-O)/R,Q[0]=0.25*R,Q[1]=(K+Y)/R,Q[2]=(q+X)/R;else if(I>D)R=Math.sqrt(1+I-j-D)*2,Q[3]=(q-X)/R,Q[0]=(K+Y)/R,Q[1]=0.25*R,Q[2]=(B+O)/R;else R=Math.sqrt(1+D-j-I)*2,Q[3]=(K-Y)/R,Q[0]=(q+X)/R,Q[1]=(B+O)/R,Q[2]=0.25*R;return Q}function k$(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=$[3],X=N+N,Y=Z+Z,I=j+j,B=N*X,q=N*Y,O=N*I,D=Z*Y,E=Z*I,R=j*I,F=K*X,A=K*Y,L=K*I,M=U[0],G=U[1],W=U[2];return Q[0]=(1-(D+R))*M,Q[1]=(q+L)*M,Q[2]=(O-A)*M,Q[3]=0,Q[4]=(q-L)*G,Q[5]=(1-(B+R))*G,Q[6]=(E+F)*G,Q[7]=0,Q[8]=(O+A)*W,Q[9]=(E-F)*W,Q[10]=(1-(B+D))*W,Q[11]=0,Q[12]=J[0],Q[13]=J[1],Q[14]=J[2],Q[15]=1,Q}function S$(Q,$,J,U,N){var Z=$[0],j=$[1],K=$[2],X=$[3],Y=Z+Z,I=j+j,B=K+K,q=Z*Y,O=Z*I,D=Z*B,E=j*I,R=j*B,F=K*B,A=X*Y,L=X*I,M=X*B,G=U[0],W=U[1],f=U[2],v=N[0],h=N[1],p=N[2],k=(1-(E+F))*G,z=(O+M)*G,g=(D-L)*G,w=(O-M)*W,m=(1-(q+F))*W,o=(R+A)*W,Z0=(D+L)*f,V0=(R-A)*f,M0=(1-(q+E))*f;return Q[0]=k,Q[1]=z,Q[2]=g,Q[3]=0,Q[4]=w,Q[5]=m,Q[6]=o,Q[7]=0,Q[8]=Z0,Q[9]=V0,Q[10]=M0,Q[11]=0,Q[12]=J[0]+v-(k*v+w*h+Z0*p),Q[13]=J[1]+h-(z*v+m*h+V0*p),Q[14]=J[2]+p-(g*v+o*h+M0*p),Q[15]=1,Q}function y$(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=J+J,K=U+U,X=N+N,Y=J*j,I=U*j,B=U*K,q=N*j,O=N*K,D=N*X,E=Z*j,R=Z*K,F=Z*X;return Q[0]=1-B-D,Q[1]=I+F,Q[2]=q-R,Q[3]=0,Q[4]=I-F,Q[5]=1-Y-D,Q[6]=O+E,Q[7]=0,Q[8]=q+R,Q[9]=O-E,Q[10]=1-Y-B,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function z$(Q,$,J,U,N,Z,j){var K=1/(J-$),X=1/(N-U),Y=1/(Z-j);return Q[0]=Z*2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z*2*X,Q[6]=0,Q[7]=0,Q[8]=(J+$)*K,Q[9]=(N+U)*X,Q[10]=(j+Z)*Y,Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=j*Z*2*Y,Q[15]=0,Q}function BQ(Q,$,J,U,N){var Z=1/Math.tan($/2),j;if(Q[0]=Z/J,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,N!=null&&N!==Infinity)j=1/(U-N),Q[10]=(N+U)*j,Q[14]=2*N*U*j;else Q[10]=-1,Q[14]=-2*U;return Q}function g$(Q,$,J,U,N){var Z=1/Math.tan($/2),j;if(Q[0]=Z/J,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,N!=null&&N!==Infinity)j=1/(U-N),Q[10]=N*j,Q[14]=N*U*j;else Q[10]=-1,Q[14]=-U;return Q}function x$(Q,$,J,U){var N=Math.tan($.upDegrees*Math.PI/180),Z=Math.tan($.downDegrees*Math.PI/180),j=Math.tan($.leftDegrees*Math.PI/180),K=Math.tan($.rightDegrees*Math.PI/180),X=2/(j+K),Y=2/(N+Z);return Q[0]=X,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Y,Q[6]=0,Q[7]=0,Q[8]=-((j-K)*X*0.5),Q[9]=(N-Z)*Y*0.5,Q[10]=U/(J-U),Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=U*J/(J-U),Q[15]=0,Q}function RQ(Q,$,J,U,N,Z,j){var K=1/($-J),X=1/(U-N),Y=1/(Z-j);return Q[0]=-2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*X,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=2*Y,Q[11]=0,Q[12]=($+J)*K,Q[13]=(N+U)*X,Q[14]=(j+Z)*Y,Q[15]=1,Q}function c$(Q,$,J,U,N,Z,j){var K=1/($-J),X=1/(U-N),Y=1/(Z-j);return Q[0]=-2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*X,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=Y,Q[11]=0,Q[12]=($+J)*K,Q[13]=(N+U)*X,Q[14]=Z*Y,Q[15]=1,Q}function d$(Q,$,J,U){var N,Z,j,K,X,Y,I,B,q,O,D=$[0],E=$[1],R=$[2],F=U[0],A=U[1],L=U[2],M=J[0],G=J[1],W=J[2];if(Math.abs(D-M)<T&&Math.abs(E-G)<T&&Math.abs(R-W)<T)return YQ(Q);if(I=D-M,B=E-G,q=R-W,O=1/Math.hypot(I,B,q),I*=O,B*=O,q*=O,N=A*q-L*B,Z=L*I-F*q,j=F*B-A*I,O=Math.hypot(N,Z,j),!O)N=0,Z=0,j=0;else O=1/O,N*=O,Z*=O,j*=O;if(K=B*j-q*Z,X=q*N-I*j,Y=I*Z-B*N,O=Math.hypot(K,X,Y),!O)K=0,X=0,Y=0;else O=1/O,K*=O,X*=O,Y*=O;return Q[0]=N,Q[1]=K,Q[2]=I,Q[3]=0,Q[4]=Z,Q[5]=X,Q[6]=B,Q[7]=0,Q[8]=j,Q[9]=Y,Q[10]=q,Q[11]=0,Q[12]=-(N*D+Z*E+j*R),Q[13]=-(K*D+X*E+Y*R),Q[14]=-(I*D+B*E+q*R),Q[15]=1,Q}function s$(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=U[0],X=U[1],Y=U[2],I=N-J[0],B=Z-J[1],q=j-J[2],O=I*I+B*B+q*q;if(O>0)O=1/Math.sqrt(O),I*=O,B*=O,q*=O;var D=X*q-Y*B,E=Y*I-K*q,R=K*B-X*I;if(O=D*D+E*E+R*R,O>0)O=1/Math.sqrt(O),D*=O,E*=O,R*=O;return Q[0]=D,Q[1]=E,Q[2]=R,Q[3]=0,Q[4]=B*R-q*E,Q[5]=q*D-I*R,Q[6]=I*E-B*D,Q[7]=0,Q[8]=I,Q[9]=B,Q[10]=q,Q[11]=0,Q[12]=N,Q[13]=Z,Q[14]=j,Q[15]=1,Q}function b$(Q){return"mat4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+", "+Q[4]+", "+Q[5]+", "+Q[6]+", "+Q[7]+", "+Q[8]+", "+Q[9]+", "+Q[10]+", "+Q[11]+", "+Q[12]+", "+Q[13]+", "+Q[14]+", "+Q[15]+")"}function l$(Q){return Math.hypot(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15])}function r$(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q[3]=$[3]+J[3],Q[4]=$[4]+J[4],Q[5]=$[5]+J[5],Q[6]=$[6]+J[6],Q[7]=$[7]+J[7],Q[8]=$[8]+J[8],Q[9]=$[9]+J[9],Q[10]=$[10]+J[10],Q[11]=$[11]+J[11],Q[12]=$[12]+J[12],Q[13]=$[13]+J[13],Q[14]=$[14]+J[14],Q[15]=$[15]+J[15],Q}function OQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q[3]=$[3]-J[3],Q[4]=$[4]-J[4],Q[5]=$[5]-J[5],Q[6]=$[6]-J[6],Q[7]=$[7]-J[7],Q[8]=$[8]-J[8],Q[9]=$[9]-J[9],Q[10]=$[10]-J[10],Q[11]=$[11]-J[11],Q[12]=$[12]-J[12],Q[13]=$[13]-J[13],Q[14]=$[14]-J[14],Q[15]=$[15]-J[15],Q}function n$(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q[3]=$[3]*J,Q[4]=$[4]*J,Q[5]=$[5]*J,Q[6]=$[6]*J,Q[7]=$[7]*J,Q[8]=$[8]*J,Q[9]=$[9]*J,Q[10]=$[10]*J,Q[11]=$[11]*J,Q[12]=$[12]*J,Q[13]=$[13]*J,Q[14]=$[14]*J,Q[15]=$[15]*J,Q}function u$(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q[3]=$[3]+J[3]*U,Q[4]=$[4]+J[4]*U,Q[5]=$[5]+J[5]*U,Q[6]=$[6]+J[6]*U,Q[7]=$[7]+J[7]*U,Q[8]=$[8]+J[8]*U,Q[9]=$[9]+J[9]*U,Q[10]=$[10]+J[10]*U,Q[11]=$[11]+J[11]*U,Q[12]=$[12]+J[12]*U,Q[13]=$[13]+J[13]*U,Q[14]=$[14]+J[14]*U,Q[15]=$[15]+J[15]*U,Q}function i$(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]&&Q[4]===$[4]&&Q[5]===$[5]&&Q[6]===$[6]&&Q[7]===$[7]&&Q[8]===$[8]&&Q[9]===$[9]&&Q[10]===$[10]&&Q[11]===$[11]&&Q[12]===$[12]&&Q[13]===$[13]&&Q[14]===$[14]&&Q[15]===$[15]}function a$(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=Q[3],j=Q[4],K=Q[5],X=Q[6],Y=Q[7],I=Q[8],B=Q[9],q=Q[10],O=Q[11],D=Q[12],E=Q[13],R=Q[14],F=Q[15],A=$[0],L=$[1],M=$[2],G=$[3],W=$[4],f=$[5],v=$[6],h=$[7],p=$[8],k=$[9],z=$[10],g=$[11],w=$[12],m=$[13],o=$[14],Z0=$[15];return Math.abs(J-A)<=T*Math.max(1,Math.abs(J),Math.abs(A))&&Math.abs(U-L)<=T*Math.max(1,Math.abs(U),Math.abs(L))&&Math.abs(N-M)<=T*Math.max(1,Math.abs(N),Math.abs(M))&&Math.abs(Z-G)<=T*Math.max(1,Math.abs(Z),Math.abs(G))&&Math.abs(j-W)<=T*Math.max(1,Math.abs(j),Math.abs(W))&&Math.abs(K-f)<=T*Math.max(1,Math.abs(K),Math.abs(f))&&Math.abs(X-v)<=T*Math.max(1,Math.abs(X),Math.abs(v))&&Math.abs(Y-h)<=T*Math.max(1,Math.abs(Y),Math.abs(h))&&Math.abs(I-p)<=T*Math.max(1,Math.abs(I),Math.abs(p))&&Math.abs(B-k)<=T*Math.max(1,Math.abs(B),Math.abs(k))&&Math.abs(q-z)<=T*Math.max(1,Math.abs(q),Math.abs(z))&&Math.abs(O-g)<=T*Math.max(1,Math.abs(O),Math.abs(g))&&Math.abs(D-w)<=T*Math.max(1,Math.abs(D),Math.abs(w))&&Math.abs(E-m)<=T*Math.max(1,Math.abs(E),Math.abs(m))&&Math.abs(R-o)<=T*Math.max(1,Math.abs(R),Math.abs(o))&&Math.abs(F-Z0)<=T*Math.max(1,Math.abs(F),Math.abs(Z0))}var C$=BQ,m$=RQ,e$=HQ,o$=OQ;var V={};s(V,{zero:()=>{{return w7}},transformQuat:()=>{{return M7}},transformMat4:()=>{{return L7}},transformMat3:()=>{{return V7}},subtract:()=>{{return FQ}},sub:()=>{{return h7}},str:()=>{{return T7}},squaredLength:()=>{{return GQ}},squaredDistance:()=>{{return WQ}},sqrLen:()=>{{return z7}},sqrDist:()=>{{return S7}},set:()=>{{return J7}},scaleAndAdd:()=>{{return H7}},scale:()=>{{return Y7}},round:()=>{{return X7}},rotateZ:()=>{{return A7}},rotateY:()=>{{return G7}},rotateX:()=>{{return W7}},random:()=>{{return F7}},normalize:()=>{{return B7}},negate:()=>{{return I7}},multiply:()=>{{return LQ}},mul:()=>{{return p7}},min:()=>{{return j7}},max:()=>{{return K7}},lerp:()=>{{return O7}},length:()=>{{return EQ}},len:()=>{{return y7}},inverse:()=>{{return q7}},hermite:()=>{{return D7}},fromValues:()=>{{return Q7}},forEach:()=>{{return C7}},floor:()=>{{return Z7}},exactEquals:()=>{{return f7}},equals:()=>{{return v7}},dot:()=>{{return AQ}},divide:()=>{{return VQ}},div:()=>{{return P7}},distance:()=>{{return MQ}},dist:()=>{{return k7}},cross:()=>{{return R7}},create:()=>{{return DQ}},copy:()=>{{return $7}},clone:()=>{{return t$}},ceil:()=>{{return N7}},bezier:()=>{{return E7}},angle:()=>{{return _7}},add:()=>{{return U7}}});function DQ(){var Q=new S(3);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q}function t$(Q){var $=new S(3);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$}function EQ(Q){var $=Q[0],J=Q[1],U=Q[2];return Math.hypot($,J,U)}function Q7(Q,$,J){var U=new S(3);return U[0]=Q,U[1]=$,U[2]=J,U}function $7(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q}function J7(Q,$,J,U){return Q[0]=$,Q[1]=J,Q[2]=U,Q}function U7(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q}function FQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q}function LQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q[2]=$[2]*J[2],Q}function VQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q[2]=$[2]/J[2],Q}function N7(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q[2]=Math.ceil($[2]),Q}function Z7(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q[2]=Math.floor($[2]),Q}function j7(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q[2]=Math.min($[2],J[2]),Q}function K7(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q[2]=Math.max($[2],J[2]),Q}function X7(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q[2]=Math.round($[2]),Q}function Y7(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q}function H7(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q}function MQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2];return Math.hypot(J,U,N)}function WQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2];return J*J+U*U+N*N}function GQ(Q){var $=Q[0],J=Q[1],U=Q[2];return $*$+J*J+U*U}function I7(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q}function q7(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q[2]=1/$[2],Q}function B7(Q,$){var J=$[0],U=$[1],N=$[2],Z=J*J+U*U+N*N;if(Z>0)Z=1/Math.sqrt(Z);return Q[0]=$[0]*Z,Q[1]=$[1]*Z,Q[2]=$[2]*Z,Q}function AQ(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]}function R7(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[0],K=J[1],X=J[2];return Q[0]=N*X-Z*K,Q[1]=Z*j-U*X,Q[2]=U*K-N*j,Q}function O7(Q,$,J,U){var N=$[0],Z=$[1],j=$[2];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q[2]=j+U*(J[2]-j),Q}function D7(Q,$,J,U,N,Z){var j=Z*Z,K=j*(2*Z-3)+1,X=j*(Z-2)+Z,Y=j*(Z-1),I=j*(3-2*Z);return Q[0]=$[0]*K+J[0]*X+U[0]*Y+N[0]*I,Q[1]=$[1]*K+J[1]*X+U[1]*Y+N[1]*I,Q[2]=$[2]*K+J[2]*X+U[2]*Y+N[2]*I,Q}function E7(Q,$,J,U,N,Z){var j=1-Z,K=j*j,X=Z*Z,Y=K*j,I=3*Z*K,B=3*X*j,q=X*Z;return Q[0]=$[0]*Y+J[0]*I+U[0]*B+N[0]*q,Q[1]=$[1]*Y+J[1]*I+U[1]*B+N[1]*q,Q[2]=$[2]*Y+J[2]*I+U[2]*B+N[2]*q,Q}function F7(Q,$){$=$||1;var J=l()*2*Math.PI,U=l()*2-1,N=Math.sqrt(1-U*U)*$;return Q[0]=Math.cos(J)*N,Q[1]=Math.sin(J)*N,Q[2]=U*$,Q}function L7(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[3]*U+J[7]*N+J[11]*Z+J[15];return j=j||1,Q[0]=(J[0]*U+J[4]*N+J[8]*Z+J[12])/j,Q[1]=(J[1]*U+J[5]*N+J[9]*Z+J[13])/j,Q[2]=(J[2]*U+J[6]*N+J[10]*Z+J[14])/j,Q}function V7(Q,$,J){var U=$[0],N=$[1],Z=$[2];return Q[0]=U*J[0]+N*J[3]+Z*J[6],Q[1]=U*J[1]+N*J[4]+Z*J[7],Q[2]=U*J[2]+N*J[5]+Z*J[8],Q}function M7(Q,$,J){var U=J[0],N=J[1],Z=J[2],j=J[3],K=$[0],X=$[1],Y=$[2],I=N*Y-Z*X,B=Z*K-U*Y,q=U*X-N*K,O=N*q-Z*B,D=Z*I-U*q,E=U*B-N*I,R=j*2;return I*=R,B*=R,q*=R,O*=2,D*=2,E*=2,Q[0]=K+I+O,Q[1]=X+B+D,Q[2]=Y+q+E,Q}function W7(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[0],Z[1]=N[1]*Math.cos(U)-N[2]*Math.sin(U),Z[2]=N[1]*Math.sin(U)+N[2]*Math.cos(U),Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function G7(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[2]*Math.sin(U)+N[0]*Math.cos(U),Z[1]=N[1],Z[2]=N[2]*Math.cos(U)-N[0]*Math.sin(U),Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function A7(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[0]*Math.cos(U)-N[1]*Math.sin(U),Z[1]=N[0]*Math.sin(U)+N[1]*Math.cos(U),Z[2]=N[2],Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function _7(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=$[0],j=$[1],K=$[2],X=Math.sqrt(J*J+U*U+N*N),Y=Math.sqrt(Z*Z+j*j+K*K),I=X*Y,B=I&&AQ(Q,$)/I;return Math.acos(Math.min(Math.max(B,-1),1))}function w7(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q}function T7(Q){return"vec3("+Q[0]+", "+Q[1]+", "+Q[2]+")"}function f7(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]}function v7(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=$[0],j=$[1],K=$[2];return Math.abs(J-Z)<=T*Math.max(1,Math.abs(J),Math.abs(Z))&&Math.abs(U-j)<=T*Math.max(1,Math.abs(U),Math.abs(j))&&Math.abs(N-K)<=T*Math.max(1,Math.abs(N),Math.abs(K))}var h7=FQ,p7=LQ,P7=VQ,k7=MQ,S7=WQ,y7=EQ,z7=GQ,C7=function(){var Q=DQ();return function($,J,U,N,Z,j){var K,X;if(!J)J=3;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Q[2]=$[K+2],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1],$[K+2]=Q[2];return $}}();var e={};s(e,{zero:()=>{{return ZJ}},transformQuat:()=>{{return NJ}},transformMat4:()=>{{return UJ}},subtract:()=>{{return wQ}},sub:()=>{{return YJ}},str:()=>{{return jJ}},squaredLength:()=>{{return PQ}},squaredDistance:()=>{{return hQ}},sqrLen:()=>{{return OJ}},sqrDist:()=>{{return BJ}},set:()=>{{return c7}},scaleAndAdd:()=>{{return i7}},scale:()=>{{return u7}},round:()=>{{return n7}},random:()=>{{return JJ}},normalize:()=>{{return o7}},negate:()=>{{return a7}},multiply:()=>{{return TQ}},mul:()=>{{return HJ}},min:()=>{{return l7}},max:()=>{{return r7}},lerp:()=>{{return $J}},length:()=>{{return pQ}},len:()=>{{return RJ}},inverse:()=>{{return e7}},fromValues:()=>{{return x7}},forEach:()=>{{return DJ}},floor:()=>{{return b7}},exactEquals:()=>{{return KJ}},equals:()=>{{return XJ}},dot:()=>{{return t7}},divide:()=>{{return fQ}},div:()=>{{return IJ}},distance:()=>{{return vQ}},dist:()=>{{return qJ}},cross:()=>{{return QJ}},create:()=>{{return _Q}},copy:()=>{{return m7}},clone:()=>{{return g7}},ceil:()=>{{return s7}},add:()=>{{return d7}}});function _Q(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0;return Q}function g7(Q){var $=new S(4);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$}function x7(Q,$,J,U){var N=new S(4);return N[0]=Q,N[1]=$,N[2]=J,N[3]=U,N}function m7(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q}function c7(Q,$,J,U,N){return Q[0]=$,Q[1]=J,Q[2]=U,Q[3]=N,Q}function d7(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q[3]=$[3]+J[3],Q}function wQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q[3]=$[3]-J[3],Q}function TQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q[2]=$[2]*J[2],Q[3]=$[3]*J[3],Q}function fQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q[2]=$[2]/J[2],Q[3]=$[3]/J[3],Q}function s7(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q[2]=Math.ceil($[2]),Q[3]=Math.ceil($[3]),Q}function b7(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q[2]=Math.floor($[2]),Q[3]=Math.floor($[3]),Q}function l7(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q[2]=Math.min($[2],J[2]),Q[3]=Math.min($[3],J[3]),Q}function r7(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q[2]=Math.max($[2],J[2]),Q[3]=Math.max($[3],J[3]),Q}function n7(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q[2]=Math.round($[2]),Q[3]=Math.round($[3]),Q}function u7(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q[3]=$[3]*J,Q}function i7(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q[3]=$[3]+J[3]*U,Q}function vQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2],Z=$[3]-Q[3];return Math.hypot(J,U,N,Z)}function hQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2],Z=$[3]-Q[3];return J*J+U*U+N*N+Z*Z}function pQ(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3];return Math.hypot($,J,U,N)}function PQ(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3];return $*$+J*J+U*U+N*N}function a7(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q[3]=-$[3],Q}function e7(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q[2]=1/$[2],Q[3]=1/$[3],Q}function o7(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=J*J+U*U+N*N+Z*Z;if(j>0)j=1/Math.sqrt(j);return Q[0]=J*j,Q[1]=U*j,Q[2]=N*j,Q[3]=Z*j,Q}function t7(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]+Q[3]*$[3]}function QJ(Q,$,J,U){var N=J[0]*U[1]-J[1]*U[0],Z=J[0]*U[2]-J[2]*U[0],j=J[0]*U[3]-J[3]*U[0],K=J[1]*U[2]-J[2]*U[1],X=J[1]*U[3]-J[3]*U[1],Y=J[2]*U[3]-J[3]*U[2],I=$[0],B=$[1],q=$[2],O=$[3];return Q[0]=B*Y-q*X+O*K,Q[1]=-(I*Y)+q*j-O*Z,Q[2]=I*X-B*j+O*N,Q[3]=-(I*K)+B*Z-q*N,Q}function $J(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=$[3];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q[2]=j+U*(J[2]-j),Q[3]=K+U*(J[3]-K),Q}function JJ(Q,$){$=$||1;var J,U,N,Z,j,K;do J=l()*2-1,U=l()*2-1,j=J*J+U*U;while(j>=1);do N=l()*2-1,Z=l()*2-1,K=N*N+Z*Z;while(K>=1);var X=Math.sqrt((1-j)/K);return Q[0]=$*J,Q[1]=$*U,Q[2]=$*N*X,Q[3]=$*Z*X,Q}function UJ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3];return Q[0]=J[0]*U+J[4]*N+J[8]*Z+J[12]*j,Q[1]=J[1]*U+J[5]*N+J[9]*Z+J[13]*j,Q[2]=J[2]*U+J[6]*N+J[10]*Z+J[14]*j,Q[3]=J[3]*U+J[7]*N+J[11]*Z+J[15]*j,Q}function NJ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[0],K=J[1],X=J[2],Y=J[3],I=Y*U+K*Z-X*N,B=Y*N+X*U-j*Z,q=Y*Z+j*N-K*U,O=-j*U-K*N-X*Z;return Q[0]=I*Y+O*-j+B*-X-q*-K,Q[1]=B*Y+O*-K+q*-j-I*-X,Q[2]=q*Y+O*-X+I*-K-B*-j,Q[3]=$[3],Q}function ZJ(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0,Q}function jJ(Q){return"vec4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}function KJ(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]}function XJ(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=Q[3],j=$[0],K=$[1],X=$[2],Y=$[3];return Math.abs(J-j)<=T*Math.max(1,Math.abs(J),Math.abs(j))&&Math.abs(U-K)<=T*Math.max(1,Math.abs(U),Math.abs(K))&&Math.abs(N-X)<=T*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(Z-Y)<=T*Math.max(1,Math.abs(Z),Math.abs(Y))}var YJ=wQ,HJ=TQ,IJ=fQ,qJ=vQ,BJ=hQ,RJ=pQ,OJ=PQ,DJ=function(){var Q=_Q();return function($,J,U,N,Z,j){var K,X;if(!J)J=4;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Q[2]=$[K+2],Q[3]=$[K+3],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1],$[K+2]=Q[2],$[K+3]=Q[3];return $}}();var r={};s(r,{zero:()=>{{return dJ}},transformMat4:()=>{{return xJ}},transformMat3:()=>{{return gJ}},transformMat2d:()=>{{return CJ}},transformMat2:()=>{{return zJ}},subtract:()=>{{return SQ}},sub:()=>{{return nJ}},str:()=>{{return sJ}},squaredLength:()=>{{return mQ}},squaredDistance:()=>{{return gQ}},sqrLen:()=>{{return oJ}},sqrDist:()=>{{return eJ}},set:()=>{{return VJ}},scaleAndAdd:()=>{{return fJ}},scale:()=>{{return TJ}},round:()=>{{return wJ}},rotate:()=>{{return mJ}},random:()=>{{return yJ}},normalize:()=>{{return pJ}},negate:()=>{{return vJ}},multiply:()=>{{return yQ}},mul:()=>{{return uJ}},min:()=>{{return AJ}},max:()=>{{return _J}},lerp:()=>{{return SJ}},length:()=>{{return xQ}},len:()=>{{return rJ}},inverse:()=>{{return hJ}},fromValues:()=>{{return FJ}},forEach:()=>{{return tJ}},floor:()=>{{return GJ}},exactEquals:()=>{{return bJ}},equals:()=>{{return lJ}},dot:()=>{{return PJ}},divide:()=>{{return zQ}},div:()=>{{return iJ}},distance:()=>{{return CQ}},dist:()=>{{return aJ}},cross:()=>{{return kJ}},create:()=>{{return kQ}},copy:()=>{{return LJ}},clone:()=>{{return EJ}},ceil:()=>{{return WJ}},angle:()=>{{return cJ}},add:()=>{{return MJ}}});function kQ(){var Q=new S(2);if(S!=Float32Array)Q[0]=0,Q[1]=0;return Q}function EJ(Q){var $=new S(2);return $[0]=Q[0],$[1]=Q[1],$}function FJ(Q,$){var J=new S(2);return J[0]=Q,J[1]=$,J}function LJ(Q,$){return Q[0]=$[0],Q[1]=$[1],Q}function VJ(Q,$,J){return Q[0]=$,Q[1]=J,Q}function MJ(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q}function SQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q}function yQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q}function zQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q}function WJ(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q}function GJ(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q}function AJ(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q}function _J(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q}function wJ(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q}function TJ(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q}function fJ(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q}function CQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1];return Math.hypot(J,U)}function gQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1];return J*J+U*U}function xQ(Q){var $=Q[0],J=Q[1];return Math.hypot($,J)}function mQ(Q){var $=Q[0],J=Q[1];return $*$+J*J}function vJ(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q}function hJ(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q}function pJ(Q,$){var J=$[0],U=$[1],N=J*J+U*U;if(N>0)N=1/Math.sqrt(N);return Q[0]=$[0]*N,Q[1]=$[1]*N,Q}function PJ(Q,$){return Q[0]*$[0]+Q[1]*$[1]}function kJ(Q,$,J){var U=$[0]*J[1]-$[1]*J[0];return Q[0]=Q[1]=0,Q[2]=U,Q}function SJ(Q,$,J,U){var N=$[0],Z=$[1];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q}function yJ(Q,$){$=$||1;var J=l()*2*Math.PI;return Q[0]=Math.cos(J)*$,Q[1]=Math.sin(J)*$,Q}function zJ(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[2]*N,Q[1]=J[1]*U+J[3]*N,Q}function CJ(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[2]*N+J[4],Q[1]=J[1]*U+J[3]*N+J[5],Q}function gJ(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[3]*N+J[6],Q[1]=J[1]*U+J[4]*N+J[7],Q}function xJ(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[4]*N+J[12],Q[1]=J[1]*U+J[5]*N+J[13],Q}function mJ(Q,$,J,U){var N=$[0]-J[0],Z=$[1]-J[1],j=Math.sin(U),K=Math.cos(U);return Q[0]=N*K-Z*j+J[0],Q[1]=N*j+Z*K+J[1],Q}function cJ(Q,$){var J=Q[0],U=Q[1],N=$[0],Z=$[1],j=Math.sqrt(J*J+U*U)*Math.sqrt(N*N+Z*Z),K=j&&(J*N+U*Z)/j;return Math.acos(Math.min(Math.max(K,-1),1))}function dJ(Q){return Q[0]=0,Q[1]=0,Q}function sJ(Q){return"vec2("+Q[0]+", "+Q[1]+")"}function bJ(Q,$){return Q[0]===$[0]&&Q[1]===$[1]}function lJ(Q,$){var J=Q[0],U=Q[1],N=$[0],Z=$[1];return Math.abs(J-N)<=T*Math.max(1,Math.abs(J),Math.abs(N))&&Math.abs(U-Z)<=T*Math.max(1,Math.abs(U),Math.abs(Z))}var rJ=xQ,nJ=SQ,uJ=yQ,iJ=zQ,aJ=CQ,eJ=gQ,oJ=mQ,tJ=function(){var Q=kQ();return function($,J,U,N,Z,j){var K,X;if(!J)J=2;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1];return $}}();var X0={X:0,Y:1,Z:2};class T0{_isActivated=!1;_theta=0;_phi=0;_mouseSensibility;_keyboardSensibility;_touchSensibility;_movingSpeed;_touchWasActive=!1;_touchStartTime=0;_touchMoveForward=!1;_axisIndices;_position=V.fromValues(0,0,0);_target=V.fromValues(0,0,0);_forwardAxis=V.fromValues(1,0,0);_leftAxis=V.fromValues(0,0,1);_upAxis=V.fromValues(0,1,0);constructor(Q){this._mouseSensibility=Q.mouseSensibility,this._keyboardSensibility=Q.keyboardSensibility,this._touchSensibility=Q.touchSensibility,this._movingSpeed=Q.movingSpeed,V.copy(this._position,Q.position),this._axisIndices=[Q.coordinates?X0[Q.coordinates[0]]:X0.X,Q.coordinates?X0[Q.coordinates[1]]:X0.Y,Q.coordinates?X0[Q.coordinates[2]]:X0.Z],this._theta=Q.theta,this._phi=Q.phi}isActivated(){return this._isActivated}update(Q,$){let J=!1,U=!1,N=!1,Z=!1,j=0,K=0;const X=Math.PI/180;{const f=t.deltaX()*this._mouseSensibility,v=t.deltaY()*this._mouseSensibility;j-=f*X,K-=v*X}const Y=d.getTouchData().length>0;if(Y){if(!this._touchWasActive){const p=Date.now();if((p-this._touchStartTime)/1000<0.25)this._touchMoveForward=!0;else this._touchStartTime=p}const f=d.getTouchData()[0],v=f.deltaX*this._touchSensibility,h=f.deltaY*this._touchSensibility;j-=v*X,K-=h*X}else this._touchMoveForward=!1;if(this._touchWasActive=Y,this._touchMoveForward)J=!0;const I=this._movingSpeed*Q,B=V.fromValues(0,0,0);V.scale(B,this._forwardAxis,I);const q=V.fromValues(0,0,0);if(V.scale(q,this._leftAxis,I),C.isPressed("Z","W"))J=!0;if(C.isPressed("S"))U=!0;if(C.isPressed("A","Q"))N=!0;if(C.isPressed("D"))Z=!0;const O=this._keyboardSensibility*Q;if(C.isPressed("ArrowUp"))K+=O;else if(C.isPressed("ArrowDown"))K-=O;if(C.isPressed("ArrowLeft"))j+=O;else if(C.isPressed("ArrowRight"))j-=O;this._theta+=j,this._phi+=K;const D=Math.PI*0.5,E=D*0.95;this._phi=Math.min(Math.max(this._phi,-E),+E);const R=Math.cos(this._theta),F=Math.sin(this._theta),[A,L,M]=this._axisIndices,G=Math.cos(this._phi+D);this._upAxis[A]=G*R,this._upAxis[L]=G*F,this._upAxis[M]=Math.sin(this._phi+D);const W=Math.cos(this._phi);if(this._forwardAxis[A]=W*R,this._forwardAxis[L]=W*F,this._forwardAxis[M]=Math.sin(this._phi),V.cross(this._leftAxis,this._upAxis,this._forwardAxis),J)V.add(this._position,this._position,B);else if(U)V.sub(this._position,this._position,B);if(N)V.add(this._position,this._position,q);else if(Z)V.sub(this._position,this._position,q);V.add(this._target,this._position,this._forwardAxis)}getPosition(){return this._position}setPosition(Q){V.copy(this._position,Q)}getTarget(){return this._target}getForwardAxis(){return this._forwardAxis}getLeftAxis(){return this._leftAxis}getUpAxis(){return this._upAxis}getTheta(){return this._theta}getPhi(){return this._phi}getTouchMoveForward(){return this._touchMoveForward}}class Y0{_hashSet=new Set;clear(){this._hashSet.clear()}add(Q){this._hashSet.add(Y0._getName(Q))}delete(Q){this._hashSet.delete(Y0._getName(Q))}has(Q){this._hashSet.has(Y0._getName(Q))}static _getName(Q){return`${Q[0]}/${Q[1]}/${Q[2]}`}}class f0{_unusedWorkers=[];_inUseWorkers=[];_onWorkerResult;constructor(Q){this._onWorkerResult=Q}areAllWorkerAvailable(){return this._inUseWorkers.length===0}isWorkerAvailable(){return this._unusedWorkers.length>0}getInUseWorkersData(){return this._inUseWorkers.map((Q)=>Q.data)}pushTask(Q){if(!this.isWorkerAvailable())return!1;const $=this._unusedWorkers.pop();return this._inUseWorkers.push($),Q($.data,(J,U)=>{$.instance.postMessage(J,U)}),!0}addOneWorker(Q,$){const J={instance:new Worker(Q),data:$};this._unusedWorkers.push(J);const U=(N)=>{const Z=this._inUseWorkers.indexOf(J);if(Z>=0)this._unusedWorkers.push(J),this._inUseWorkers.splice(Z,1);this._onWorkerResult(J.data,N.data)};J.instance.addEventListener("message",U,!1)}}class v0{_def;_cameraPosition=V.fromValues(0,0,0);_chunkPositionQueue=[];_savedIndex=[999,999,999];_unusedChunks=[];_usedChunks=[];_usedSet=new Y0;constructor(Q){this._def=Q}clear(){this._chunkPositionQueue.length=0,this._unusedChunks.forEach((Q)=>this._def.releaseGeometry(Q.geometry)),this._unusedChunks.length=0,this._usedChunks.forEach((Q)=>this._def.releaseGeometry(Q.geometry)),this._usedChunks.length=0,this._usedSet.clear()}isEmpty(){return this._usedChunks.length===0}isNotDone(){return this._chunkPositionQueue.length>0}getChunks(){return this._usedChunks}pushNew(Q,$,J,U,N){const Z=this._def.acquireGeometry(U);if(this._unusedChunks.length===0)this._usedChunks.push({realPosition:[...$],indexPosition:[...Q],geometry:Z,isVisible:!1,isDirty:!0,geometryFloat32buffer:new Float32Array(J.slice(0,N)),geometryBufferSizeUsed:N});else{const j=this._unusedChunks.pop();j.realPosition=[...$],j.indexPosition=[...Q],j.isVisible=!1,j.isDirty=!0,j.geometryFloat32buffer=new Float32Array(J.slice(0,N)),j.geometryBufferSizeUsed=N,this._usedChunks.push(j)}this._usedSet.add(Q),this._def.onChunkCreated()}update(Q,$){this._updateGeneration(Q,$);for(let J of this._usedChunks){const U=this._def.chunkIsVisible(J.realPosition);J.isVisible=U}for(let J of this._usedChunks){if(!J.isVisible||!J.isDirty)continue;J.geometry.update(J.realPosition,this._def.chunkGraphicSize,J.geometryFloat32buffer,J.geometryBufferSizeUsed),J.isDirty=!1;break}}_updateGeneration(Q,$){V.copy(this._cameraPosition,Q);const J=[Math.floor(Q[0]/this._def.chunkGraphicSize),Math.floor(Q[1]/this._def.chunkGraphicSize),Math.floor(Q[2]/this._def.chunkGraphicSize)];let U=!1;if(this._usedChunks.length===0&&$.areAllWorkerAvailable())U=!0;if(!U&&!V.exactEquals(J,this._savedIndex))U=!0;if(U===!1)return;V.copy(this._savedIndex,J),this._chunkPositionQueue.length=0;const{chunkGenerationRange:N}=this._def,Z=[Math.floor(J[0]-N),Math.floor(J[1]-N),Math.floor(J[2]-N)],j=[Math.floor(J[0]+N),Math.floor(J[1]+N),Math.floor(J[2]+N)];for(let X=0;X<this._usedChunks.length;){const{indexPosition:Y}=this._usedChunks[X];if(Y[0]<Z[0]||Y[0]>j[0]||Y[1]<Z[1]||Y[1]>j[1]||Y[2]<Z[2]||Y[2]>j[2]){this._def.releaseGeometry(this._usedChunks[X].geometry);const B=this._usedChunks.splice(X,1);this._unusedChunks.push(B[0]),this._usedSet.delete(Y),this._def.onChunkDiscarded()}else++X}const K=[0,0,0];for(K[2]=Z[2];K[2]<=j[2];++K[2])for(K[1]=Z[1];K[1]<=j[1];++K[1])for(K[0]=Z[0];K[0]<=j[0];++K[0]){if(this._usedChunks.findIndex((Y)=>{return this._usedSet.has(Y.indexPosition)})>=0)return;if($.getInUseWorkersData().findIndex((Y)=>{return V.exactEquals(Y.processing.indexPosition,K)})>=0)return;this._chunkPositionQueue.push({indexPosition:[...K],realPosition:[K[0]*this._def.chunkGraphicSize,K[1]*this._def.chunkGraphicSize,K[2]*this._def.chunkGraphicSize]})}}getBestNextChunkPosition(){if(this._chunkPositionQueue.length===0)return;const Q=(U)=>{const N=this._def.chunkGraphicSize*0.5,Z=[this._cameraPosition[0]-(U[0]+N),this._cameraPosition[1]-(U[1]+N),this._cameraPosition[2]-(U[2]+N)];return V.length(Z)};let $=-1,J=-1;for(let U=0;U<this._chunkPositionQueue.length;++U){const{realPosition:N}=this._chunkPositionQueue[U];if(!this._def.chunkIsVisible(N))continue;const Z=Q(N);if(J>=0&&J<Z)continue;$=U,J=Z}if($<0)return;return this._chunkPositionQueue.splice($,1)[0]}}class R0{_framesDelta=[];_averageDelta=0;_minDelta=0;_maxDelta=0;pushDelta(Q){if(this._framesDelta.length>=100)this._framesDelta.shift();this._framesDelta.push(Q),this._minDelta=999999999,this._maxDelta=-999999999,this._averageDelta=0;for(let $ of this._framesDelta)this._minDelta=Math.min(this._minDelta,$),this._maxDelta=Math.max(this._maxDelta,$),this._averageDelta+=$;this._averageDelta/=this._framesDelta.length}get framesDelta(){return this._framesDelta}get averageDelta(){return this._averageDelta}get minDelta(){return this._minDelta}get maxDelta(){return this._maxDelta}}class h0{_def;_geometryBufferSize;_dataBufferSize;_running=!1;_chunkManager;_workerManager;_frameProfiler=new R0;constructor(Q){this._def=Q,this._chunkManager=new v0({chunkGraphicSize:Q.chunkGraphicSize,chunkGenerationRange:Q.chunkGenerationRange,chunkLogicSize:Q.chunkLogicSize,chunkIsVisible:Q.chunkIsVisible,acquireGeometry:Q.acquireGeometry,releaseGeometry:Q.releaseGeometry,onChunkCreated:Q.onChunkCreated,onChunkDiscarded:Q.onChunkDiscarded});const $=(J,U)=>{const{indexPosition:N,realPosition:Z,geometryFloat32buffer:j,geometryBufferSize:K,sizeUsed:X}=U,I=Date.now()-U.time;if(this._frameProfiler.pushDelta(I),J.geometryFloat32buffer=j,J.processing=void 0,!this._running)return;this._chunkManager.pushNew(N,Z,J.geometryFloat32buffer,K,X),this._launchWorker()};this._workerManager=new f0($),this._dataBufferSize=Math.pow(this._def.chunkLogicSize+1+1,3),this._geometryBufferSize=this._dataBufferSize*20*6*3;for(let J=0;J<this._def.workerTotal;++J)this._workerManager.addOneWorker(this._def.workerFile,{geometryFloat32buffer:new Float32Array(this._geometryBufferSize)})}start(){this._running=!0}stop(){if(!this._running)return;this._running=!1,this._chunkManager.clear()}update(Q){if(!this._running)return;this._chunkManager.update(Q,this._workerManager),this._launchWorker()}_launchWorker(){while(this._chunkManager.isNotDone()&&this._workerManager.isWorkerAvailable()){const Q=this._chunkManager.getBestNextChunkPosition();if(!Q)break;this._workerManager.pushTask(($,J)=>{$.processing=Q;const U={realPosition:Q.realPosition,indexPosition:Q.indexPosition,geometryFloat32buffer:$.geometryFloat32buffer,geometryBufferSize:this._geometryBufferSize,sizeUsed:0,time:Date.now()},N=[$.geometryFloat32buffer.buffer];J(U,N)})}}getChunks(){return this._chunkManager.getChunks()}getFrameProfiler(){return this._frameProfiler}getProcessingRealPositions(){return this._workerManager.getInUseWorkersData().map((Q)=>Q.processing.realPosition)}}var $0;(function(j){j[j["Right"]=0]="Right";j[j["Left"]=1]="Left";j[j["Bottom"]=2]="Bottom";j[j["Top"]=3]="Top";j[j["Back"]=4]="Back";j[j["Front"]=5]="Front"})($0||($0={}));class p0{_frustum=new Float32Array(24);_setPlane(Q,$,J,U){const N=Q*4;this._frustum[N+0]=$[0]+J[0]*U,this._frustum[N+1]=$[1]+J[1]*U,this._frustum[N+2]=$[2]+J[2]*U,this._frustum[N+3]=$[3]+J[3]*U;const Z=Math.sqrt(this._frustum[N+0]*this._frustum[N+0]+this._frustum[N+1]*this._frustum[N+1]+this._frustum[N+2]*this._frustum[N+2]);if(Z===0)return;this._frustum[N+0]/=Z,this._frustum[N+1]/=Z,this._frustum[N+2]/=Z,this._frustum[N+3]/=Z}calculateFrustum(Q,$){const J=y.multiply(y.create(),Q,$),U=e.fromValues(J[0],J[4],J[8],J[12]),N=e.fromValues(J[1],J[5],J[9],J[13]),Z=e.fromValues(J[2],J[6],J[10],J[14]),j=e.fromValues(J[3],J[7],J[11],J[15]);this._setPlane($0.Right,j,U,-1),this._setPlane($0.Left,j,U,1),this._setPlane($0.Bottom,j,N,1),this._setPlane($0.Top,j,N,-1),this._setPlane($0.Back,j,Z,-1),this._setPlane($0.Front,j,Z,1)}sphereInFrustum(Q,$,J,U){for(let N=0;N<6;++N){const Z=N*4;if(this._frustum[Z+0]*Q+this._frustum[Z+1]*$+this._frustum[Z+2]*J+this._frustum[Z+3]<=-U)return!1}return!0}pointInFrustum(Q,$,J){return this.sphereInFrustum(Q,$,J,0)}cubeInFrustumVec3(Q,$){return this.cubeInFrustum(Q[0],Q[1],Q[2],$)}cubeInFrustum(Q,$,J,U){const N=U*0.5,Z=Q-N,j=$-N,K=J-N,X=Q+N,Y=$+N,I=J+N;for(let B=0;B<6;++B){const q=B*4,O=this._frustum[q+0],D=this._frustum[q+1],E=this._frustum[q+2],R=this._frustum[q+3];if(O*Z+D*j+E*K+R>0||O*X+D*j+E*K+R>0||O*Z+D*Y+E*K+R>0||O*X+D*Y+E*K+R>0||O*Z+D*j+E*I+R>0||O*X+D*j+E*I+R>0||O*Z+D*Y+E*I+R>0||O*X+D*Y+E*I+R>0)continue;return!1}return!0}}var u;(function(J){J[J["perspective"]=0]="perspective";J[J["orthogonal"]=1]="orthogonal"})(u||(u={}));class H0{_projectionType=u.perspective;_perspectiveData;_orthogonalData;_viewportPos=r.fromValues(0,0);_viewportSize=r.fromValues(0,0);_projectionMatrix=y.create();_viewMatrix=y.create();_composedMatrix=y.create();_eye=V.fromValues(0,0,0);_target=V.fromValues(0,0,0);_upAxis=V.fromValues(0,0,0);setAsPerspective(Q){this._projectionType=u.perspective;let $=Q.aspectRatio;if($===void 0)$=this._viewportSize[0]/this._viewportSize[1];this._perspectiveData={fovy:Q.fovy,aspectRatio:$,near:Q.near,far:Q.far}}setAsOrthogonal(Q){this._projectionType=u.orthogonal,this._orthogonalData={...Q}}setViewportPos(Q,$){this._viewportPos[0]=Q,this._viewportPos[1]=$}getViewportPos(){return this._viewportPos}setViewportSize(Q,$){if(this._viewportSize[0]=Q,this._viewportSize[1]=$,this._projectionType!==u.perspective&&this._perspectiveData)this._perspectiveData.aspectRatio=this._viewportSize[0]/this._viewportSize[1]}getViewportSize(){return this._viewportSize}lookAt(Q,$,J){V.copy(this._eye,Q),V.copy(this._target,$),V.copy(this._upAxis,J)}setEye(Q){V.copy(this._eye,Q)}setTarget(Q){V.copy(this._target,Q)}setUpAxis(Q){V.copy(this._upAxis,Q)}getEye(){return this._eye}getTarget(){return this._target}getUpAxis(){return this._upAxis}computeMatrices(){if(this._projectionType===u.perspective){const{fovy:Q,aspectRatio:$,near:J,far:U}=this._perspectiveData;y.perspective(this._projectionMatrix,Q,$,J,U)}else if(this._projectionType===u.orthogonal){const{left:Q,right:$,top:J,bottom:U,near:N,far:Z}=this._orthogonalData;y.ortho(this._projectionMatrix,Q,$,J,U,N,Z)}y.lookAt(this._viewMatrix,this._eye,this._target,this._upAxis),this.computeComposedMatrix()}computeComposedMatrix(){y.multiply(this._composedMatrix,this._projectionMatrix,this._viewMatrix)}setProjectionMatrix(Q){y.copy(this._projectionMatrix,Q)}setViewMatrix(Q){y.copy(this._viewMatrix,Q)}setComposedMatrix(Q){y.copy(this._composedMatrix,Q)}getProjectionMatrix(){return this._projectionMatrix}getViewMatrix(){return this._viewMatrix}getComposedMatrix(){return this._composedMatrix}getPerspectiveData(){if(this._projectionType!==u.perspective)throw new Error("not a perspective projection");return this._perspectiveData}getOrthogonalData(){if(this._projectionType!==u.orthogonal)throw new Error("not an orthogonal projection");return this._orthogonalData}}var O0={};s(O0,{vertex:()=>{{return Q8}},fragment:()=>{{return $8}}});var Q8=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;
uniform float u_sceneScale;
uniform float u_tileRepeat;

in vec3 a_vertex_position;
in vec3 a_vertex_normal;
in vec3 a_offset_origin;

out vec3 v_chunkSpacePosition;
out vec3 v_worldSpacePosition;
out vec3 v_worldSpaceNormal;

void main(void)
{
  vec3 chunkSpacePosition = a_vertex_position * u_sceneScale;

  v_chunkSpacePosition = a_vertex_position * u_tileRepeat;
  v_worldSpacePosition = a_offset_origin + chunkSpacePosition;
  v_worldSpaceNormal = a_vertex_normal;

  gl_Position = u_composedMatrix * vec4(v_worldSpacePosition, 1.0);
}
`.trim(),$8=`
#version 300 es

precision lowp float;

const float k_ambiantCoef = 0.1;
const vec3 k_specColor = vec3(1.0, 1.0, 1.0);

uniform sampler2D u_texture_dirt;
uniform sampler2D u_texture_grass;
uniform sampler2D u_texture_stoneWall;
uniform sampler2D u_texture_stoneWallBump;
uniform vec3 u_eyePosition;

in vec3 v_chunkSpacePosition;
in vec3 v_worldSpacePosition;
in vec3 v_worldSpaceNormal;

out vec4 o_color;

vec4 _getColorValue()
{

  // current 3d texture coordinate
  vec3 flooredPos = vec3(
    v_chunkSpacePosition.x - floor(v_chunkSpacePosition.x),
    v_chunkSpacePosition.y - floor(v_chunkSpacePosition.y),
    v_chunkSpacePosition.z - floor(v_chunkSpacePosition.z)
  );

  vec3 blendWeights = abs( normalize( v_worldSpaceNormal.xyz ) );
  blendWeights = max( ( blendWeights - 0.2 ) * 7.0, 0.0 );
  blendWeights /= ( blendWeights.x + blendWeights.y + blendWeights.z );

  // horizontal texture coordinates -> should be a wall
  vec2 texCoordX = vec2(flooredPos.y, flooredPos.z);
  vec2 texCoordY = vec2(flooredPos.x, flooredPos.z);

  // vertical texture coord -> should be green grass
  vec2 texCoordZ = vec2(flooredPos.x, flooredPos.y);

  // horizontal color
  vec3 texColorX = texture( u_texture_stoneWall, texCoordX ).rgb;
  vec3 texColorY = texture( u_texture_stoneWall, texCoordY ).rgb;

  float specularRatioX = texture( u_texture_stoneWallBump, texCoordX ).r * blendWeights.x;
  float specularRatioY = texture( u_texture_stoneWallBump, texCoordY ).r * blendWeights.y;
  float specularRatio = max( specularRatioX, specularRatioY );

  // vertical color
  vec3 texColorZ = vec3(0.0);
  if (v_worldSpaceNormal.z < 0.0)
  {
    texColorZ = texture( u_texture_dirt, texCoordZ ).rgb;
  }
  else
  {
    texColorZ = texture( u_texture_grass, texCoordZ ).rgb;
  }

  return vec4(
    texColorX * blendWeights.xxx +
    texColorY * blendWeights.yyy +
    texColorZ * blendWeights.zzz,
    specularRatio
  );
}

vec3 _getLightColor(vec4 currentColor)
{
  vec3 normal = normalize(v_worldSpaceNormal);
  vec3 lightDir = normalize(u_eyePosition - v_worldSpacePosition);

  float diffuseCoef = max(dot(lightDir,v_worldSpaceNormal.xyz), 0.0);
  float specularCoef = 0.0;

  if (diffuseCoef > 0.0)
  {
    // specular

    vec3 reflectDir = reflect(-lightDir, normal);
    vec3 viewDir = normalize(u_eyePosition - v_worldSpacePosition);

    float specAngle = max(dot(reflectDir, viewDir), 0.0);
    specularCoef = pow(specAngle, 16.0);
  }

  vec3 diffuseColor = currentColor.rgb * (k_ambiantCoef + diffuseCoef);
  vec3 specularColor = k_specColor * specularCoef * currentColor.a;

  return diffuseColor + specularColor;
}

void main(void)
{
  o_color = vec4(_getLightColor(_getColorValue()), 1.0);
}
`.trim();class cQ{_origin=V.fromValues(0,0,0);_size=0;_geometry;constructor(Q,$,J){this._geometry=new P.Geometry(Q,$),this._geometry.setFloatBufferSize(0,J)}update(Q,$,J,U){V.copy(this._origin,Q),this._size=$,this._geometry.updateBuffer(0,J,U),this._geometry.setPrimitiveCount(U/6);const N=new Float32Array([Q[0],Q[1],Q[2]]);this._geometry.updateBuffer(1,N,N.length),this._geometry.setInstancedCount(1)}render(){this._geometry.render()}getOrigin(){return this._origin}getSize(){return this._size}}class P0{_shader;_textureDirt=new b;_textureGrass=new b;_textureStoneWall=new b;_textureStoneWallBump=new b;_geometryDefinition;_unusedGeometries=[];_inUseGeometries=[];constructor(){this._shader=new x("ChunksRenderer",{vertexSrc:O0.vertex,fragmentSrc:O0.fragment,attributes:["a_vertex_position","a_vertex_normal","a_offset_origin"],uniforms:["u_composedMatrix","u_eyePosition","u_sceneScale","u_tileRepeat","u_texture_dirt","u_texture_grass","u_texture_stoneWall","u_texture_stoneWallBump"]});const Q=new P.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_normal","vec3f").setStride(24).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_origin","vec3f").setStride(12),this._geometryDefinition=Q.getDef()}async initialize(){await Promise.all([this._textureDirt.load("assets/dirt.png"),this._textureGrass.load("assets/grass.png"),this._textureStoneWall.load("assets/stone-wall.png"),this._textureStoneWallBump.load("assets/stone-wall-bump.png")])}acquireGeometry(Q){if(this._unusedGeometries.length>0){const J=this._unusedGeometries.pop();return this._inUseGeometries.push(J),J}const $=new cQ(this._shader,this._geometryDefinition,Q);return this._inUseGeometries.push($),$}releaseGeometry(Q){const $=this._inUseGeometries.indexOf(Q);if($<0)return;this._unusedGeometries.push(Q),this._inUseGeometries.splice($,1)}render(Q,$,J){const U=Q.getEye();this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q.getComposedMatrix()),this._shader.setFloat3Uniform("u_eyePosition",U[0],U[1],U[2]),this._shader.setFloat1Uniform("u_sceneScale",J),this._shader.setFloat1Uniform("u_tileRepeat",2),this._shader.setTextureUniform("u_texture_dirt",this._textureDirt,0),this._shader.setTextureUniform("u_texture_grass",this._textureGrass,1),this._shader.setTextureUniform("u_texture_stoneWall",this._textureStoneWall,2),this._shader.setTextureUniform("u_texture_stoneWallBump",this._textureStoneWallBump,3),this._inUseGeometries.map((Z)=>{const K=Z.getSize()*0.5,X=Z.getOrigin()[0]+K,Y=Z.getOrigin()[1]+K,I=Z.getOrigin()[2]+K;return{geometry:Z,center:[X,Y,I],distance:0}}).filter(({center:Z,geometry:j})=>$.cubeInFrustumVec3(Z,j.getSize())).map((Z)=>{return Z.distance=V.distance(Z.center,Q.getEye()),Z}).sort((Z,j)=>Z.distance-j.distance).forEach((Z)=>Z.geometry.render())})}}var D0={};s(D0,{vertex:()=>{{return U8}},fragment:()=>{{return N8}}});var U8=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3  a_vertex_position;

in vec3  a_offset_center;
in float a_offset_scale;
in vec4  a_offset_color;

flat out vec4 v_color;

void main(void)
{
  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_color = a_offset_color;
}
`.trim(),N8=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 out_color;

void main(void)
{
  out_color = v_color;
}

`.trim();var c=(Q,$)=>{const J=[],U=$[0]*0.5,N=$[1]*0.5,Z=$[2]*0.5,j=[[Q[0]-U,Q[1]-N,Q[2]-Z],[Q[0]+U,Q[1]-N,Q[2]-Z],[Q[0]-U,Q[1]+N,Q[2]-Z],[Q[0]+U,Q[1]+N,Q[2]-Z],[Q[0]-U,Q[1]-N,Q[2]+Z],[Q[0]+U,Q[1]-N,Q[2]+Z],[Q[0]-U,Q[1]+N,Q[2]+Z],[Q[0]+U,Q[1]+N,Q[2]+Z]],K=[];K.push(0,2,1),K.push(2,3,1),K.push(4,5,6),K.push(6,5,7),K.push(1,3,5),K.push(5,3,7),K.push(0,4,2),K.push(4,6,2),K.push(2,6,3),K.push(6,7,3),K.push(0,1,4),K.push(4,1,5);for(let X of K)J.push(j[X]);return J},j8=(Q)=>{const U=[...c([Q*-0.4990234375,Q*-0.4990234375,0],[0.001953125,0.001953125,1]),...c([Q*0.4990234375,Q*-0.4990234375,0],[0.001953125,0.001953125,1]),...c([Q*0.4990234375,Q*0.4990234375,0],[0.001953125,0.001953125,1]),...c([Q*-0.4990234375,Q*0.4990234375,0],[0.001953125,0.001953125,1]),...c([Q*-0.4990234375,0,Q*-0.4990234375],[0.001953125,1,0.001953125]),...c([Q*0.4990234375,0,Q*-0.4990234375],[0.001953125,1,0.001953125]),...c([Q*0.4990234375,0,Q*0.4990234375],[0.001953125,1,0.001953125]),...c([Q*-0.4990234375,0,Q*0.4990234375],[0.001953125,1,0.001953125]),...c([0,Q*-0.4990234375,Q*-0.4990234375],[1,0.001953125,0.001953125]),...c([0,Q*0.4990234375,Q*-0.4990234375],[1,0.001953125,0.001953125]),...c([0,Q*0.4990234375,Q*0.4990234375],[1,0.001953125,0.001953125]),...c([0,Q*-0.4990234375,Q*0.4990234375],[1,0.001953125,0.001953125])],N=[];return U.forEach((Z)=>{N.push(Z[0],Z[1],Z[2])}),N},dQ=32768;class k0{_shader;_geometry;_buffer=new Float32Array(dQ);_currentSize=0;constructor(){this._shader=new x("TriangleCubesRenderer",{vertexSrc:D0.vertex,fragmentSrc:D0.fragment,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});const Q=new P.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(12).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(32);const $=j8(1);this._geometry=new P.Geometry(this._shader,Q.getDef()),this._geometry.updateBuffer(0,$,$.length),this._geometry.setPrimitiveCount($.length/3),this._geometry.setFloatBufferSize(1,dQ)}pushCenteredCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;this._buffer[this._currentSize++]=Q[0],this._buffer[this._currentSize++]=Q[1],this._buffer[this._currentSize++]=Q[2],this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}pushOriginBoundCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;const U=$*0.5;this._buffer[this._currentSize++]=Q[0]+U,this._buffer[this._currentSize++]=Q[1]+U,this._buffer[this._currentSize++]=Q[2]+U,this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}flush(Q){if(this._currentSize<=0)return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q.getComposedMatrix()),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear()}clear(){this._currentSize=0}}var E0={};s(E0,{vertex:()=>{{return X8}},fragment:()=>{{return Y8}}});var X8=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3 a_vertex_position;
in vec4 a_vertex_color;

flat out vec4 v_color;

void main(void)
{
  gl_Position = u_composedMatrix * vec4(a_vertex_position, 1.0);

  v_color = a_vertex_color;
}
`.trim(),Y8=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 o_color;

void main(void)
{
  o_color = v_color;
}

`.trim();var sQ=14336;class S0{_geometry;_buffer=new Float32Array(sQ);_currentSize=0;constructor(Q,$){const J={...$,primitiveType:P.PrimitiveType.lines};this._geometry=new P.Geometry(Q,J),this._geometry.setFloatBufferSize(0,sQ)}pushLine(Q,$,J){if(this._currentSize+14>=this._buffer.length)return;const U=J[3]??1;this._buffer[this._currentSize+0]=Q[0],this._buffer[this._currentSize+1]=Q[1],this._buffer[this._currentSize+2]=Q[2],this._buffer[this._currentSize+3]=J[0],this._buffer[this._currentSize+4]=J[1],this._buffer[this._currentSize+5]=J[2],this._buffer[this._currentSize+6]=U,this._currentSize+=7,this._buffer[this._currentSize+0]=$[0],this._buffer[this._currentSize+1]=$[1],this._buffer[this._currentSize+2]=$[2],this._buffer[this._currentSize+3]=J[0],this._buffer[this._currentSize+4]=J[1],this._buffer[this._currentSize+5]=J[2],this._buffer[this._currentSize+6]=U,this._currentSize+=7}canRender(){return this._currentSize>0}flush(){if(!this.canRender())return;this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear()}clear(){this._currentSize=0}}var bQ=7168;class y0{_geometry;_buffer=new Float32Array(bQ);_currentSize=0;constructor(Q,$){const J={...$,primitiveType:P.PrimitiveType.triangles};this._geometry=new P.Geometry(Q,J),this._geometry.setFloatBufferSize(0,bQ)}pushTriangle(Q,$,J,U){if(this._currentSize+42>=this._buffer.length)return;const N=U[3]??1;this._buffer[this._currentSize+0]=Q[0],this._buffer[this._currentSize+1]=Q[1],this._buffer[this._currentSize+2]=Q[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7,this._buffer[this._currentSize+0]=$[0],this._buffer[this._currentSize+1]=$[1],this._buffer[this._currentSize+2]=$[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7,this._buffer[this._currentSize+0]=J[0],this._buffer[this._currentSize+1]=J[1],this._buffer[this._currentSize+2]=J[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7}pushLine(Q,$,J,U){if(this._currentSize+42>=this._buffer.length)return;const N=$[0]-Q[0],Z=$[1]-Q[1],j=Math.atan2(Z,N)+Math.PI*0.5,K=Math.cos(j)*J*0.5,X=Math.sin(j)*J*0.5;this.pushTriangle([Q[0]-K,Q[1]-X,Q[2]],[$[0]-K,$[1]-X,$[2]],[$[0]+K,$[1]+X,$[2]],U),this.pushTriangle([Q[0]-K,Q[1]-X,Q[2]],[$[0]+K,$[1]+X,$[2]],[Q[0]+K,Q[1]+X,Q[2]],U)}pushRotatedLine(Q,$,J,U,N){this.pushLine([Q[0]-J*Math.cos($),Q[1]-J*Math.sin($),Q[2]],[Q[0]+J*Math.cos($),Q[1]+J*Math.sin($),Q[2]],U,N)}pushOriginBoundRectangle(Q,$,J){if(this._currentSize+42>=this._buffer.length)return;const U=[Q[0]+$[0],Q[1]+$[1]];this.pushTriangle([Q[0],Q[1],Q[2]],[U[0],U[1],Q[2]],[Q[0],U[1],Q[2]],J),this.pushTriangle([Q[0],Q[1],Q[2]],[U[0],Q[1],Q[2]],[U[0],U[1],Q[2]],J)}pushCenteredRectangle(Q,$,J){const U=[Q[0]-$[0]*0.5,Q[1]-$[1]*0.5,Q[2]];this.pushOriginBoundRectangle(U,$,J)}canRender(){return this._currentSize>0}flush(){if(!this.canRender())return;this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear()}clear(){this._currentSize=0}}class z0{_shader;_wireFramesStackRenderer;_trianglesStackRenderer;constructor(){this._shader=new x("StackRenderers",{vertexSrc:E0.vertex,fragmentSrc:E0.fragment,attributes:["a_vertex_position","a_vertex_color"],uniforms:["u_composedMatrix"]});const Q=new P.GeometryBuilder;Q.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_color","vec4f").setStride(28),this._wireFramesStackRenderer=new S0(this._shader,Q.getDef()),this._trianglesStackRenderer=new y0(this._shader,Q.getDef())}pushLine(Q,$,J){this._wireFramesStackRenderer.pushLine(Q,$,J)}pushCross(Q,$,J){const U=[[Q[0]-$,Q[1],Q[2]],[Q[0]+$,Q[1],Q[2]],[Q[0],Q[1]-$,Q[2]],[Q[0],Q[1]+$,Q[2]],[Q[0],Q[1],Q[2]-$],[Q[0],Q[1],Q[2]+$]],N=[0,1,2,3,4,5];for(let Z=0;Z<N.length;Z+=2){const j=U[Z+0],K=U[Z+1];this._wireFramesStackRenderer.pushLine(j,K,J)}}pushThickLine(Q,$,J,U){this._trianglesStackRenderer.pushLine(Q,$,J,U)}pushRotatedLine(Q,$,J,U,N){this._trianglesStackRenderer.pushRotatedLine(Q,$,J,U,N)}pushOriginBoundRectangle(Q,$,J){this._trianglesStackRenderer.pushOriginBoundRectangle(Q,$,J)}pushCenteredRectangle(Q,$,J){this._trianglesStackRenderer.pushCenteredRectangle(Q,$,J)}pushTriangle(Q,$,J,U){this._trianglesStackRenderer.pushTriangle(Q,$,J,U)}flush(Q){if(!this._wireFramesStackRenderer.canRender()&&!this._trianglesStackRenderer.canRender())return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q),this._wireFramesStackRenderer.flush(),this._trianglesStackRenderer.flush()})}clear(){this._wireFramesStackRenderer.clear(),this._trianglesStackRenderer.clear()}}var F0={};s(F0,{vertex:()=>{{return I8}},fragment:()=>{{return q8}}});var I8=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec2 a_vertex_position;
in vec2 a_vertex_texCoord;
in vec3 a_offset_position;
in vec2 a_offset_texCoord;
in vec3 a_offset_color;
in float a_offset_scale;

out vec2 v_texCoord;
flat out vec3 v_color;

void main(void)
{
  vec3 position = vec3(a_vertex_position, 0.0) * a_offset_scale + a_offset_position;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_texCoord = a_vertex_texCoord + a_offset_texCoord;
  v_color = a_offset_color;
}
`.trim(),q8=`
#version 300 es

precision mediump float;

uniform sampler2D u_texture;

in vec2 v_texCoord;
flat in vec3 v_color;

out vec4 o_color;

void main(void)
{
  vec4 textureColor = texture(u_texture, v_texCoord);
  if (textureColor.a < 0.5)
  {
    discard;
  }
  else
  {
    o_color = vec4(v_color, textureColor.a);
  }
}

`.trim();var C0="7e7e28fd03fd07fe04fe0aff02ff7e4dfd0cfd03fd07fe04fe0aff02ff1afc0dfd10fc08fc0ffe55ff15fb0bfd03fd07fe04fe08f707fd04ff07fe02fe0cfd0ffd0cfd0aff03fe03ff0afe44fe15fb0bfd03fd04f204f607fd03fe07fe02fe0cfd0efd0efd0aff02fe02ff0bfe43fd15fb0cfe03fe05f204fe01ff02ff0afd02fd07fe02fe0bfd0efd10fd0afa0cfe42fd16fb1bfe04fe07fe01ff02ff0efd09fc1cfd12fd09fa0cfe41fd17fb1bfe04fe07f70bfd0afc04ff17fd12fd06f405f616f61cfd19fd1cfe04fe08f709fd0bfb02fe17fd12fd06f405f616f61bfd1afd1cfe04fe0aff02ff01fe08fd0bfe02fa17fd12fd09fa0cfe3efd37f207ff02ff01fe07fd02fd07fe03fc19fd10fd0afa0cfe3dfd38f204f607fe03fd07fe03fd1bfd0efd0aff02fe02ff0bfe0cfd1dfd0dfd1dfd1cfe04fe07f708ff04fd07fe02fb1bfd0cfd0aff03fe03ff0afe0cfd1dfd0cfd1efd1cfe04fe0aff02ff1afb02fe1bfc08fc0ffe1cfd1dfd0bfd1ffd1cfe04fe0aff02ff7afd7e7e7e7e7e7e0efd17fd10fc0af80bfe0bf909f90dfd08f609fb08f506f808f82cfd19fd0df807fd04fd0afe0afd03fd07fd03fd0bfc08fd0ffd0bfd05fd05fd04fd06fd04fd2afd1bfd0bfc02fc06fd03fc09fd0afd04fd06fd04fd09fb08fd0efd0cfd05fd05fd04fd06fd04fd09fd0cfd0efd1dfd0afe05fd06fd02fb06fa11fd0dfd08fe01fd08fd0dfd0dfd05fd05fd04fd06fd04fd09fd0cfd0dfd0af409fd10fd06fd02fb06fa10fd0dfd08fe02fd08fd0dfd15fd05fb02fd06fd04fd09fd0cfd0cfd0bf40afd0efd07fd01fe01fd09fd0ffd0bfb08fe03fd08f808f70efd08fa08f626fd23fd0cfd08fd01fe01fd09fd0efd0cfb08f606f707f60cfd09fa09f726fd23fd0bfd09fb02fd09fd0dfd10fd07f60cfc06fd04fd0bfd08fd02fb0dfd09fd0cfd0cfd0bf40afd0cfd09fb02fd09fd0cfd12fd0bfd0ffd06fd04fd0afd09fd04fd0dfd09fd0cfd0dfd0af409fd19fc03fd09fd0bfd03fd06fd04fd0bfd08fd04fd06fd04fd09fd0afd04fd0cfd0afd0cfd0efd1dfd1afd04fd09fd0afd04fd06fd03fd0cfd08fd03fd07fd04fd09fd0afd04fd0bfd19fd10fd1bfd0ffd0af807f707f607f90bf907f909f80afd0bf809fb2efd19fd10fd7e51fd17fd11fd7e7e7e7e13f87e78fd05fd08fc09f709f907f808f606f608f907fd03fd07f90df905fc03fd06fb0bfd05fd05fd05fd08fb08fd05fd07fa09fd03fd07fd03fd07fd02fd08fd04fe07fd04fe07fd03fd06fd03fd09fd11fd08fd03fd07fd0cfc03fc05fd05fd07fd01fd07fd05fd06fd02fd08fd03fd06fd04fd07fd03fd07fd05ff07fd05ff06fd04fd06fd03fd09fd11fd08fd02fd08fd0cfb01fb05fc04fd06fd03fd06fd05fd05fd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd11fd08fd01fd09fd0cf505fb03fd05fd05fd05fd02fa05fd04fd07fd03fd06fd0efd03fd07fd03fe08fd03fe07fd0dfd03fd09fd11fd08fa0afd0cf505fa02fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd01fd01fd05fd01fd01fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd02ff02fd05fd02fa05fd05fd05fd02fa05f607fd03fd06fd0efd03fd07fd03fe08fd03fe07fd02fb06fd03fd09fd0bfd03fd08fa0afd0cfd05fd05fd03fb05fd05fd05fd0dfd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd0bfd03fd08fd01fd09fd05ff06fd05fd05fd04fc05fd05fd05fd0dfd04fd07fd03fd06fd04fd07fd03fd07fd05ff07fd0cfd04fd06fd03fd09fd0bfd03fd08fd02fd08fd04fe06fd05fd05fd05fd06fd03fd06fd0dfd04fd07fd03fd07fd03fd07fd02fd08fd04fe07fd0dfd03fd06fd03fd09fd0bfd03fd08fd03fd07fd03fd06fd05fd05fd05fd07fd01fd07fd0dfd04fd06f709f907f808f606fb0df806fd03fd07f90af908fc03fd06f606fd05fd05fd05fd08fb0af87e7e7e7e7e7e7e68fe1af70afb08f708f807f505fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07f608f907ff11f90afc1afd03fd07fc01fc07fd03fd06fd04fd06fe02fd02fe05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fd04fd08fd0bfe14fd09fa19fd03fd07fd03fd07fd03fd06fd04fd06ff03fd03ff05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fe05fd08fd0bfd13fd08fd02fd18fd03fd06fd05fd06fd03fd06fd04fd0afd09fd03fd07fd03fd07fd05fd06fd01fd08fd03fd07ff05fd09fd0cfd12fd07fd04fd17fd03fd06fd05fd06fd03fd06fd11fd09fd03fd07fd03fd07fd05fd07fb09fd03fd0cfd0afd0dfd11fd28f807fd05fd06f808f90cfd09fd03fd07fd03fd07fd02ff02fd08fd0bfd01fd0cfd0bfd0efd10fd28f807fd05fd06f809f90bfd09fd03fd07fd03fd07fd02ff02fd08fd0cfb0cfd0cfd0ffd0ffd28fd0cfd03fb06fd02fd0efd0afd09fd03fd07fd03fd07fd02ff02fd07fb0cfd0cfd0dfd10fd0efd28fd0cfd02fa06fd03fd06fd04fd0afd09fd03fd07fd03fd08f707fd01fd0bfd0bfd05ff08fd11fd0dfd28fd0df707fd03fd06fd04fd0afd09fd03fd08fd01fd09fc01fc06fd03fd0afd0afd05fe08fd12fd0cfd28fd0df707fd03fd06fd04fd0afd09fd03fd09fb0bfd01fd07fd03fd0afd0afd04fd08fd13fd0bfd27fb12fd06fc03fd07f809f908f90bfd0cfd01fd07fd03fd08f908f608f910fd06f93cfa7e54f07e72f07e7e7e7e0bfd1dfc21fb19fb18fc10fd0ffd07fc0dfa39fd1efd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd1cfd2dfd10fd4af909f808f909f808f90afd0cfb02fe07fd01fc08fa0cfa08fd03fd0afd09f606f809f91efd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd1dfd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd18f808fd03fd06fd0dfd03fd07f709fd0bfd03fd08fd03fd0afd0ffd08fa0dfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd0dfd03fd07fd0ffd0bfd03fd08fd03fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0cf808fd03fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0df908fd03fd0afd0ffd08fd03fd0afd09fd02ff02fd05fd03fd07fd03fd18fb02fe06fe02fb08f909fb02fe07f908f90ffd07fc03fd07f706fd03fd07fc03fd07f706fd05fd05fd03fd08f978fd03fd27fd03fd7e4af92afa7e7e7e7e7e7e18fa09fc09fa1efe4eff6efd0dfc0dfd1cfc4cfe6efd0dfc0dfd1bfa4afd6efd0dfc0dfd1afd02fd07fe02fb07fb02fe07fc02fd08f908f707fd03fd07fd03fd07fd05fd05fd02fd09fd03fd06f80afd0efc0efd08fb03fd05fd04fd07fd03fd05fd03fd09f706fd04fe09fd0bfd03fd07fd03fd07fd05fd05fd02fd09fd03fd06fe03fd08fd24fd05fd01fd02fd05fe06fe07fd03fd05fd03fd09fc02fd06fd04fe09fd0bfd03fd07fd03fd07fd05fd06fa0afd03fd06ff03fd09fd24fd05fd02fd01fd05fe06fe07fd03fd05fd03fd09fd0dfb0cfd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd09fd0cfd0efc0efd07fd03fb06fe06fe07fd03fd05fd03fd09fd0ffb0afd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd08fd0efd0dfc0dfd19fe06fe07fd03fd05fd03fd09fd0cfe04fd09fd01fd07fd03fd08fd01fd09fc01fc07fa0bf908fd03ff0bfd0dfc0dfd19fe06fe07f807f809fd0cfe04fd09fd01fd07fd03fd09fb0bfd01fd07fd02fd0bfb08fd03fe0bfd0dfc0dfd19f607fd11fd08fb0cf90bfb09fb02fe09fd0cfd01fd07fd02fd0dfd08f80cfa09fc09fa1af607fd11fd7cfd69fb0ffb77fa";var lQ=[16,6],H=[1/lQ[0],1/lQ[1]],rQ=36864;class g0{_shader;_geometry;_texture=new b;_texCoordMap;_buffer=new Float32Array(rQ);_currentSize=0;_textScale=14;_textColor=[1,1,1];_horizontalTextAlign="left";_verticalTextAlign="top";constructor(){this._shader=new x("TextRenderer",{vertexSrc:F0.vertex,fragmentSrc:F0.fragment,attributes:["a_vertex_position","a_vertex_texCoord","a_offset_position","a_offset_texCoord","a_offset_color","a_offset_scale"],uniforms:["u_composedMatrix","u_texture"]});const Q=new P.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec2f").addVboAttribute("a_vertex_texCoord","vec2f").setStride(16).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_position","vec3f").addVboAttribute("a_offset_texCoord","vec2f").addVboAttribute("a_offset_color","vec3f").addVboAttribute("a_offset_scale","float").setStride(36),this._geometry=new P.Geometry(this._shader,Q.getDef());const $=[{position:[0.5,-0.5],texCoord:[H[0]*1,H[1]*1]},{position:[-0.5,-0.5],texCoord:[H[0]*0,H[1]*1]},{position:[0.5,0.5],texCoord:[H[0]*1,H[1]*0]},{position:[-0.5,0.5],texCoord:[H[0]*0,H[1]*0]}],J=[1,0,2,1,2,3],U=[];for(let K of J){const X=$[K];U.push(X.position[0],X.position[1],X.texCoord[0],X.texCoord[1])}this._geometry.updateBuffer(0,U,U.length),this._geometry.setPrimitiveCount(U.length/4),this._geometry.setFloatBufferSize(1,rQ),this._texCoordMap=new Map([[" ",[0*H[0],0*H[1]]],["!",[1*H[0],0*H[1]]],['"',[2*H[0],0*H[1]]],["#",[3*H[0],0*H[1]]],["$",[4*H[0],0*H[1]]],["%",[5*H[0],0*H[1]]],["&",[6*H[0],0*H[1]]],["'",[7*H[0],0*H[1]]],["(",[8*H[0],0*H[1]]],[")",[9*H[0],0*H[1]]],["*",[10*H[0],0*H[1]]],["+",[11*H[0],0*H[1]]],[",",[12*H[0],0*H[1]]],["-",[13*H[0],0*H[1]]],[".",[14*H[0],0*H[1]]],["/",[15*H[0],0*H[1]]],["0",[0*H[0],1*H[1]]],["1",[1*H[0],1*H[1]]],["2",[2*H[0],1*H[1]]],["3",[3*H[0],1*H[1]]],["4",[4*H[0],1*H[1]]],["5",[5*H[0],1*H[1]]],["6",[6*H[0],1*H[1]]],["7",[7*H[0],1*H[1]]],["8",[8*H[0],1*H[1]]],["9",[9*H[0],1*H[1]]],[":",[10*H[0],1*H[1]]],[";",[11*H[0],1*H[1]]],["<",[12*H[0],1*H[1]]],["=",[13*H[0],1*H[1]]],[">",[14*H[0],1*H[1]]],["?",[15*H[0],1*H[1]]],["@",[0*H[0],2*H[1]]],["A",[1*H[0],2*H[1]]],["B",[2*H[0],2*H[1]]],["C",[3*H[0],2*H[1]]],["D",[4*H[0],2*H[1]]],["E",[5*H[0],2*H[1]]],["F",[6*H[0],2*H[1]]],["G",[7*H[0],2*H[1]]],["H",[8*H[0],2*H[1]]],["I",[9*H[0],2*H[1]]],["J",[10*H[0],2*H[1]]],["K",[11*H[0],2*H[1]]],["L",[12*H[0],2*H[1]]],["M",[13*H[0],2*H[1]]],["N",[14*H[0],2*H[1]]],["O",[15*H[0],2*H[1]]],["P",[0*H[0],3*H[1]]],["Q",[1*H[0],3*H[1]]],["R",[2*H[0],3*H[1]]],["S",[3*H[0],3*H[1]]],["T",[4*H[0],3*H[1]]],["U",[5*H[0],3*H[1]]],["V",[6*H[0],3*H[1]]],["W",[7*H[0],3*H[1]]],["X",[8*H[0],3*H[1]]],["Y",[9*H[0],3*H[1]]],["Z",[10*H[0],3*H[1]]],["[",[11*H[0],3*H[1]]],["\\",[12*H[0],3*H[1]]],["]",[13*H[0],3*H[1]]],["^",[14*H[0],3*H[1]]],["_",[15*H[0],3*H[1]]],["`",[0*H[0],4*H[1]]],["a",[1*H[0],4*H[1]]],["b",[2*H[0],4*H[1]]],["c",[3*H[0],4*H[1]]],["d",[4*H[0],4*H[1]]],["e",[5*H[0],4*H[1]]],["f",[6*H[0],4*H[1]]],["g",[7*H[0],4*H[1]]],["h",[8*H[0],4*H[1]]],["i",[9*H[0],4*H[1]]],["j",[10*H[0],4*H[1]]],["k",[11*H[0],4*H[1]]],["l",[12*H[0],4*H[1]]],["m",[13*H[0],4*H[1]]],["n",[14*H[0],4*H[1]]],["o",[15*H[0],4*H[1]]],["p",[0*H[0],5*H[1]]],["q",[1*H[0],5*H[1]]],["r",[2*H[0],5*H[1]]],["s",[3*H[0],5*H[1]]],["t",[4*H[0],5*H[1]]],["u",[5*H[0],5*H[1]]],["v",[6*H[0],5*H[1]]],["w",[7*H[0],5*H[1]]],["x",[8*H[0],5*H[1]]],["y",[9*H[0],5*H[1]]],["z",[10*H[0],5*H[1]]],["{",[11*H[0],5*H[1]]],["|",[12*H[0],5*H[1]]],["}",[13*H[0],5*H[1]]],["~",[14*H[0],5*H[1]]]]);const N=256,Z=96,j=new Uint8Array(N*Z*4);{let K=0;for(let X=0;X<C0.length;X+=2){let Y=parseInt(`${C0.substring(X,X+2)}000000`,16)>>24,I=0;if(Y<0)Y=-Y,I=255;for(let B=0;B<Y;++B)j[K*4+0]=I,j[K*4+1]=I,j[K*4+2]=I,j[K*4+3]=I,++K}}this._texture.loadFromMemory(N,Z,j,!0)}setTextAlign(Q,$){return this._horizontalTextAlign=Q,this._verticalTextAlign=$,this}setTextScale(Q){return this._textScale=Q,this}setTextColor(Q,$,J){return this._textColor[0]=Q,this._textColor[1]=$,this._textColor[2]=J,this}pushText(Q,$){if(Q.length===0)return this;if(this._textScale<=0)return this;const J=[0];for(let j=0;j<Q.length;++j)if(Q[j]=="\n")J.push(0);else J[J.length-1]+=1;if(J.length===0)return this;let U=0;const N=[0,0],Z=this._textScale*0.5;switch(this._horizontalTextAlign){case"left":N[0]=$[0];break;case"centered":N[0]=$[0]-J[U]*Z+Z;break;case"right":N[0]=$[0]-J[U]*this._textScale+this._textScale;break}switch(this._verticalTextAlign){case"top":N[1]=$[1];break;case"centered":N[1]=$[1]+J.length*Z-Z;break;case"bottom":N[1]=$[1]-(J.length-1)*this._textScale;break}for(let j=0;j<Q.length;++j){const K=Q[j];if(K=="\n"){switch(U+=1,this._horizontalTextAlign){case"left":N[0]=$[0];break;case"centered":N[0]=$[0]-J[U]*Z+Z;break;case"right":N[0]=$[0]-J[U]*this._textScale+this._textScale;break}N[1]-=this._textScale}else this._pushLetter(K,N),N[0]+=this._textScale}return this}_pushLetter(Q,$){if(this._currentSize+90>=this._buffer.length)return;const J=this._texCoordMap.get(Q);if(!J)throw new Error(`fail to find a letter, letter=${Q}`);for(let U=-1;U<=1;++U)for(let N=-1;N<=1;++N)this._buffer[this._currentSize++]=$[0]+2*N,this._buffer[this._currentSize++]=$[1]+2*U,this._buffer[this._currentSize++]=-0.1,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=this._textScale;this._buffer[this._currentSize++]=$[0],this._buffer[this._currentSize++]=$[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=this._textColor[0],this._buffer[this._currentSize++]=this._textColor[1],this._buffer[this._currentSize++]=this._textColor[2],this._buffer[this._currentSize++]=this._textScale}flush(Q){if(this._currentSize===0)return this;return this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q),this._shader.setTextureUniform("u_texture",this._texture,0),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/9),this._geometry.render()}),b.unbind(),this.clear(),this}clear(){return this._currentSize=0,this}}var L0={};s(L0,{vertex:()=>{{return R8}},fragment:()=>{{return O8}}});var R8=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3  a_vertex_position;

in vec3  a_offset_center;
in float a_offset_scale;
in vec4  a_offset_color;

flat out vec4 v_color;

void main(void)
{
  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_color = a_offset_color;
}
`.trim(),O8=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 out_color;

void main(void)
{
  out_color = v_color;
}

`.trim();var E8=(Q)=>{const $=Q*0.5,J=[];J.push([+$,+$,+$]),J.push([-$,+$,+$]),J.push([+$,-$,+$]),J.push([-$,-$,+$]),J.push([+$,+$,-$]),J.push([-$,+$,-$]),J.push([+$,-$,-$]),J.push([-$,-$,-$]);const U=[];U.push(0,1,1,3,3,2,2,0),U.push(4,5,5,7,7,6,6,4),U.push(0,4,1,5,3,7,2,6);const N=[];for(let Z=0;Z<U.length;++Z){const j=J[U[Z]];N.push(j[0],j[1],j[2])}return N},nQ=32768;class x0{_shader;_geometry;_buffer=new Float32Array(nQ);_currentSize=0;constructor(){this._shader=new x("WireFrameCubesRenderer",{vertexSrc:L0.vertex,fragmentSrc:L0.fragment,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});const Q=new P.GeometryBuilder;Q.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(12).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(32);const $=E8(1);this._geometry=new P.Geometry(this._shader,Q.getDef()),this._geometry.updateBuffer(0,$,$.length),this._geometry.setPrimitiveCount($.length/3),this._geometry.setFloatBufferSize(1,nQ)}pushCenteredCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;this._buffer[this._currentSize++]=Q[0],this._buffer[this._currentSize++]=Q[1],this._buffer[this._currentSize++]=Q[2],this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}pushOriginBoundCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;const U=$*0.5;this._buffer[this._currentSize++]=Q[0]+U,this._buffer[this._currentSize++]=Q[1]+U,this._buffer[this._currentSize++]=Q[2]+U,this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}flush(Q){if(this._currentSize<=0)return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear()}clear(){this._currentSize=0}}var{WebGLContext:J0,ShaderProgram:L8}=A0;class m0{_def;_viewportSize=r.create();_frustumCulling=new p0;_mainCamera=new H0;_mainHudCamera=new H0;onContextLost=null;onContextRestored=null;_scene;_hud;constructor(Q){this._def=Q,this.resize(this._def.canvasDomElement.width,this._def.canvasDomElement.height),J0.initialize(this._def.canvasDomElement);const $=(U)=>{if(U.preventDefault(),console.log("context is lost"),this.onContextLost)this.onContextLost()},J=()=>{if(console.log("context is restored"),J0.initialize(this._def.canvasDomElement),this.onContextRestored)this.onContextRestored()};this._def.canvasDomElement.addEventListener("webglcontextlost",$,!1),this._def.canvasDomElement.addEventListener("webglcontextrestored",J,!1),this._scene={chunksRenderer:new P0,triangleCubesRenderer:new k0},this._hud={textRenderer:new g0,stackRenderers:new z0,wireFrameCubesRenderer:new x0}}resize(Q,$){this._viewportSize[0]=Q,this._viewportSize[1]=$,this._mainCamera.setViewportSize(Q,$),this._mainCamera.setAsPerspective({fovy:70,near:0.1,far:70}),this._mainHudCamera.setViewportSize(Q,$),this._mainHudCamera.setAsOrthogonal({left:-Q*0.5,right:+Q*0.5,top:-$*0.5,bottom:+$*0.5,near:-200,far:200}),this._mainHudCamera.setEye([+Q*0.5,+$*0.5,1]),this._mainHudCamera.setTarget([+Q*0.5,+$*0.5,0]),this._mainHudCamera.setUpAxis([0,1,0]),this._mainHudCamera.computeMatrices()}toggleContextLoss(){const Q=J0.getContext(),$=J0.getExtensionLoseContext();if($)if(Q.isContextLost())$.restoreContext();else $.loseContext()}contextIsLost(){return J0.getContext().isContextLost()}setOnContextLost(Q){this.onContextLost=Q}setOnContextRestored(Q){this.onContextRestored=Q}async init(){const Q=J0.getContext();Q.clearColor(0,0,0,1),Q.enable(Q.DEPTH_TEST),Q.depthFunc(Q.LESS),Q.disable(Q.BLEND),Q.blendFunc(Q.SRC_ALPHA,Q.ONE_MINUS_SRC_COLOR),Q.activeTexture(Q.TEXTURE0),Q.enable(Q.CULL_FACE),await this._scene.chunksRenderer.initialize()}getSize(){return this._viewportSize}lookAt(Q,$,J){this._mainCamera.setEye(Q),this._mainCamera.setTarget($),this._mainCamera.setUpAxis(J),this._mainCamera.computeMatrices()}update(){t.resetDelta(),d.resetDeltas(),this._frustumCulling.calculateFrustum(this._mainCamera.getProjectionMatrix(),this._mainCamera.getViewMatrix())}renderScene(Q){const $=J0.getContext(),J=this._mainCamera.getViewportPos(),U=this._mainCamera.getViewportSize();$.viewport(J[0],J[1],U[0],U[1]),$.clearColor(0,0,0,1),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT),this._scene.chunksRenderer.render(this._mainCamera,this._frustumCulling,Q),this._scene.triangleCubesRenderer.flush(this._mainCamera)}renderHUD(){const Q=J0.getContext(),$=this._mainHudCamera.getViewportPos(),J=this._mainHudCamera.getViewportSize();Q.viewport($[0],$[1],J[0],J[1]),Q.clear(Q.DEPTH_BUFFER_BIT),L8.unbind()}get mainCamera(){return this._mainCamera}get hudCamera(){return this._mainHudCamera}get wireFrameCubesRenderer(){return this._hud.wireFrameCubesRenderer}get triangleCubesRenderer(){return this._scene.triangleCubesRenderer}get stackRenderers(){return this._hud.stackRenderers}get textRenderer(){return this._hud.textRenderer}get frustumCulling(){return this._frustumCulling}get chunksRenderer(){return this._scene.chunksRenderer}}var U0=[0.2,0.2,0.2],N0=[0.2,0.6,0.2],V8=(Q,$)=>{Q.push({center:[$[0],$[1]],size:[40,40],text:"A\nQ",color:C.isPressed("A","Q")?N0:U0}),Q.push({center:[$[0]+45,$[1]],size:[40,40],text:"S",color:C.isPressed("S")?N0:U0}),Q.push({center:[$[0]+45,$[1]+45],size:[40,40],text:"W\nZ",color:C.isPressed("W","Z")?N0:U0}),Q.push({center:[$[0]+90,$[1]],size:[40,40],text:"D",color:C.isPressed("D")?N0:U0})},M8=(Q,$)=>{Q.push({center:[$[0],$[1]],size:[40,40],lines:[{a:[15,0],b:[-8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[-12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[-12,2],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowLeft")?N0:U0}),Q.push({center:[$[0]+45,$[1]],size:[40,40],lines:[{a:[0,15],b:[0,-8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,-12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,-12],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowDown")?N0:U0}),Q.push({center:[$[0]+45,$[1]+45],size:[40,40],lines:[{a:[0,-15],b:[0,8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,12],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowUp")?N0:U0}),Q.push({center:[$[0]+90,$[1]],size:[40,40],lines:[{a:[-15,0],b:[8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[12,2],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowRight")?N0:U0})},W8=(Q,$,J)=>{if(d.isSupported($))Q.push({center:[J[0]+115,J[1]],size:[230,60],text:"Touch Events\nSupported\n(double tap)",color:[0,0.5,0]});else Q.push({center:[J[0]+115,J[1]],size:[230,60],text:"Touch Events\nNot Supported",color:[0.5,0,0]});if(Q0.canBePointerLocked($))Q.push({center:[J[0]+105,J[1]+70],size:[210,60],text:"Mouse\nSupported",color:[0,0.5,0]});else Q.push({center:[J[0]+105,J[1]+70],size:[210,60],text:"Mouse Events\nNot Supported",color:[0.5,0,0]})},uQ=(Q,$,J)=>{const U=[],N=[27,165],Z=[27,260],j=[7,35];V8(U,N),M8(U,Z),W8(U,Q,j),U.forEach((K)=>{const{center:X}=K;if($.pushCenteredRectangle(V.fromValues(X[0],X[1],-0.3),K.size,[0,0,0]),$.pushCenteredRectangle(V.fromValues(X[0],X[1],-0.2),[K.size[0]-2,K.size[1]-2],K.color),K.text)J.setTextScale(16).setTextAlign("centered","centered").pushText(K.text,X).setTextAlign("left","top");if(K.lines)K.lines.forEach((Y)=>{$.pushThickLine([X[0]+Y.a[0],X[1]+Y.a[1],0],[X[0]+Y.b[0],X[1]+Y.b[1],0],Y.thickness,Y.color)})})};var iQ=(Q,$,J,U)=>{const N=[Math.floor(J[0]/$),Math.floor(J[1]/$),Math.floor(J[2]/$)],Z=["Coordinates:",`X: ${N[0]}`,`Y: ${N[1]}`,`Z: ${N[2]}`],j=[14,Q[1]-200];U.setTextScale(14).setTextAlign("left","top").pushText(Z.join("\n"),j)};var c0=(Q,$,J,U,N,Z=!1)=>{const K=Math.ceil(J.maxDelta/5)*5;{U.pushOriginBoundRectangle(Q,$,[0,0,0,0.5]);const X=[[Q[0]+$[0]*0,Q[1]+$[1]*0,0],[Q[0]+$[0]*1,Q[1]+$[1]*0,0],[Q[0]+$[0]*1,Q[1]+$[1]*1,0],[Q[0]+$[0]*0,Q[1]+$[1]*1,0]];U.pushLine(X[0],X[1],[1,1,1]),U.pushLine(X[1],X[2],[1,1,1]),U.pushLine(X[2],X[3],[1,1,1]),U.pushLine(X[3],X[0],[1,1,1])}for(let X=5;X<K;X+=5){const Y=X/K,I=[Q[0]+0,Q[1]+$[1]*Y,0],B=[Q[0]+$[0],Q[1]+$[1]*Y,0];U.pushLine(I,B,[0.5,0.5,0.5])}if(J.framesDelta.length>=2){const X=$[0]/J.framesDelta.length;let Y=J.framesDelta[0],I=0,B=$[1]*Y/K;for(let q=1;q<J.framesDelta.length;++q){const O=J.framesDelta[q],D=q*X,E=$[1]*O/K,R=[Q[0]+I,Q[1]+B,0],F=[Q[0]+D,Q[1]+E,0];U.pushLine(R,F,[1,1,1]),Y=O,I=D,B=E}}{const{averageDelta:I,maxDelta:B,minDelta:q}=J;let O=`~${I.toFixed(0)}ms`,D=`<${B}ms`,E=`>${q}ms`;if(Z===!0){const R=(F)=>F<999?F.toFixed(0):"???";O+=`\n~${R(1000/I)}fps`,D+=`\n<${R(1000/B)}fps`,E+=`\n>${R(1000/q)}fps`}N.setTextScale(14).setTextAlign("left","top").setTextColor(1,1,0.75).pushText(O,[Q[0]+7,Q[1]-8]).setTextAlign("left","centered").setTextColor(1,0.75,0.75).pushText(D,[Q[0]+$[0]+7,Q[1]+$[1]-7]).setTextColor(0.75,1,0.75).pushText(E,[Q[0]+$[0]+7,Q[1]+7]).setTextColor(1,1,1)}};var aQ=(Q,$,J,U,N)=>{const Z=[Q[0]-10,Q[1]-10],j=[`Chunks\nGenerated:\n${$} <`,"",`Chunks\nDiscarded:\n${J} <`,"",`Live\nChunks:\n${$-J} <`,"",`Visible\nChunks:\n${U} <`].join("\n");N.setTextScale(14).setTextAlign("right","top").pushText(j,Z)};var eQ=(Q,$,J,U,N,Z,j,K)=>{const X=Math.tan(Q/360*Math.PI)*J,Y=X*$,I=-Y,B=+Y,q=+X,O=-X,D=U*Math.sin(Q*Math.PI/180),E=D*$,R=[];R.push([J,I,q]),R.push([J,B,q]),R.push([J,I,O]),R.push([J,B,O]),R.push([U,-E,+D]),R.push([U,+E,+D]),R.push([U,-E,-D]),R.push([U,+E,-D]),R.push([0,0,0]),R.push([100,0,0]),R.push([0,100,0]),R.push([0,0,100]);{const F=y.identity(y.create());y.translate(F,F,N),y.rotate(F,F,Z,[0,0,1]),y.rotate(F,F,j,[0,-1,0]);for(let A=0;A<R.length;++A)R[A]=V.transformMat4(R[A],R[A],F)}{const F=[];F.push(0,1,1,3,3,2,2,0),F.push(0,4,1,5,2,6,3,7),F.push(4,5,5,7,7,6,6,4);const A=[1,1,0];for(let L=0;L<F.length;L+=2){const M=R[F[L+0]],G=R[F[L+1]];K.pushLine(M,G,A)}{const L=R[8],M=R[9],G=R[10],W=R[11];K.pushLine(L,M,[1,0,0]),K.pushLine(L,G,[0,1,0]),K.pushLine(L,W,[0,0,1])}}};var oQ=(Q,$,J,U,N,Z,j,K,X)=>{const Y=_.getContext(),[I,B]=Z,q=new H0,O=Math.min(I,B)*0.5,D=Math.max(O,$),E=Math.max(O,$),R=I-D;q.setViewportPos(R,0),q.setViewportSize(D,E);const F=D/E,A=F>=1?J:J*(1/F),L=A*F;q.setAsOrthogonal({left:-L,right:+L,top:-A,bottom:+A,near:-J,far:+J}),q.setUpAxis([0,0,1]);const M=Q.getEye(),G=Q.getTarget(),W=V.sub(V.create(),G,M),f=Math.atan2(W[1],W[0]),v=Math.atan2(W[2],r.length(r.fromValues(W[1],W[0]))),h=f-Math.PI*0.25,p=v+Math.PI*0.5,k=Math.cos(h),z=Math.sin(h),g=Math.sin(p),w=V.copy(V.create(),M);w[0]-=k*20,w[1]-=z*20,w[2]+=g*10,q.setEye(w),q.setTarget(M),q.computeMatrices();const m=q.getViewportPos(),o=q.getViewportSize();Y.viewport(m[0],m[1],o[0],o[1]),Y.clear(Y.DEPTH_BUFFER_BIT),Y.disable(Y.DEPTH_TEST),Y.enable(Y.BLEND),K.clear();const Z0=V.fromValues(1,1,1),V0=e.fromValues(1,0,0,0.8),M0=V.fromValues(0,1,0),q0=N*0.5,i=V.create(),s0=V.fromValues(q0,q0,q0);if(U.forEach((a)=>{if(V.copy(i,a.realPosition),V.add(i,i,s0),a.isVisible)K.pushCenteredCube(i,q0,Z0);else K.pushCenteredCube(i,q0,V0)}),j.length>0){const a=N*1.2;j.forEach((Q$)=>{V.copy(i,Q$),V.add(i,i,s0),K.pushCenteredCube(i,a,M0)})}K.flush(q.getComposedMatrix()),X.flush(q.getComposedMatrix());{const a=Q.getPerspectiveData();eQ(a.fovy,a.aspectRatio,a.near,a.far,M,f,v,X),X.flush(q.getComposedMatrix())}Y.disable(Y.BLEND),Y.enable(Y.DEPTH_TEST)};var I0=new Map,tQ=(Q,$,J)=>{const U=d.getTouchData();if(U.length===0)I0.clear();else{const N=new Set,Z=[1,0,0],j=[0,1,0],K=U.length>1?Z:j;U.forEach((Y)=>{N.add(Y.id);let I=I0.get(Y.id);if(I===void 0)I=0,I0.set(Y.id,I);const B=[0,0.5];if(J)B.push(0.25,0.75);for(let q of B){const O=I+q*Math.PI,D=[Y.positionX,Q[1]-Y.positionY,0];$.pushRotatedLine(D,O,150,15,K)}I+=0.1,I0.set(Y.id,I)});const X=new Set;I0.forEach((Y,I)=>{if(!N.has(I))X.add(I)}),X.forEach((Y)=>{I0.delete(Y)})}};class d0{_canvasElement;_freeFlyController;_renderer;_chunkGenerator;_running;_errorGraphicContext;_chunksCreated=0;_chunksDiscarded=0;_currFrameTime=0;_frameProfiler=new R0;constructor(Q){this._canvasElement=Q,this._freeFlyController=new T0({position:V.fromValues(0,0,0),coordinates:["X","Y","Z"],theta:0,phi:0,mouseSensibility:NQ,movingSpeed:UQ,keyboardSensibility:ZQ,touchSensibility:jQ}),this._renderer=new m0({canvasDomElement:Q}),this._chunkGenerator=new h0({chunkGraphicSize:j0,chunkGenerationRange:JQ,chunkLogicSize:$Q,workerTotal:XQ,workerFile:KQ,chunkIsVisible:($)=>{const J=j0,U=J*0.5;return this._renderer.frustumCulling.cubeInFrustum($[0]+U,$[1]+U,$[2]+U,J)},acquireGeometry:($)=>{return this._renderer.chunksRenderer.acquireGeometry($)},releaseGeometry:($)=>{this._renderer.chunksRenderer.releaseGeometry($)},onChunkCreated:()=>{++this._chunksCreated},onChunkDiscarded:()=>{++this._chunksDiscarded}}),C.activate(),d.activate(this._canvasElement),Q0.allowPointerLockedOnClickEvent(Q),Q0.addOnLockChange(()=>{if(Q0.isPointerLocked(Q))t.activate();else t.deactivate(),Q0.allowPointerLockedOnClickEvent(Q)}),Q0.addOnLockError(($)=>{}),this._running=!1,this._errorGraphicContext=!1,this._renderer.setOnContextLost(()=>{console.log("on_context_lost"),this._errorGraphicContext=!0,this.stop()}),this._renderer.setOnContextRestored(()=>{console.log("on_context_restored"),this._errorGraphicContext=!1,this.start()})}async init(){await this._renderer.init()}resize(Q,$,J){let U=Q,N=$;if(J)this._canvasElement.style.position="absolute",U=window.innerWidth,N=window.innerHeight;else this._canvasElement.style.position="relative";this._canvasElement.style.left="0px",this._canvasElement.style.top="0px",this._canvasElement.style.width=`${U}px`,this._canvasElement.style.height=`${N}px`,this._canvasElement.width=U,this._canvasElement.height=N,this._renderer.resize(U,N)}start(){if(this.isRunning())return;this._running=!0,this._chunkGenerator.start(),this._tick()}stop(){this._running=!1,this._chunkGenerator.stop()}isRunning(){return this._running&&!this._errorGraphicContext}_tick(){const Q=()=>{if(!this._running||this._errorGraphicContext)return;window.requestAnimationFrame(Q),this._mainLoop()};Q()}_mainLoop(){const Q=Date.now(),$=Math.min(Q-this._currFrameTime,30);this._currFrameTime=Q,this._frameProfiler.pushDelta($),this._freeFlyController.update($/1000,(j,K,X)=>{return!1}),this._renderer.lookAt(this._freeFlyController.getPosition(),this._freeFlyController.getTarget(),this._freeFlyController.getUpAxis()),this._renderer.update();const J=this._freeFlyController.getPosition();this._chunkGenerator.update(J);let U=0;this._renderer.wireFrameCubesRenderer.clear(),this._chunkGenerator.getChunks().forEach((j)=>{if(!j.isVisible)return;++U,this._renderer.triangleCubesRenderer.pushOriginBoundCube(j.realPosition,j0,[1,1,1])}),this._renderer.renderScene(j0),this._renderer.renderHUD(),this._renderer.stackRenderers.clear(),this._renderer.textRenderer.clear(),aQ(this._renderer.getSize(),this._chunksCreated,this._chunksDiscarded,U,this._renderer.textRenderer),iQ(this._renderer.getSize(),j0,J,this._renderer.textRenderer),uQ(this._canvasElement,this._renderer.stackRenderers,this._renderer.textRenderer),c0([10,this._canvasElement.height-60,0],[100,50],this._frameProfiler,this._renderer.stackRenderers,this._renderer.textRenderer,!0),c0([10,this._canvasElement.height-150,0],[100,50],this._chunkGenerator.getFrameProfiler(),this._renderer.stackRenderers,this._renderer.textRenderer),tQ(this._renderer.getSize(),this._renderer.stackRenderers,this._freeFlyController.getTouchMoveForward()),this._renderer.stackRenderers.flush(this._renderer.hudCamera.getComposedMatrix()),this._renderer.textRenderer.flush(this._renderer.hudCamera.getComposedMatrix());const N=300,Z=150;oQ(this._renderer.mainCamera,N,Z,this._chunkGenerator.getChunks(),j0,this._renderer.getSize(),this._chunkGenerator.getProcessingRealPositions(),this._renderer.wireFrameCubesRenderer,this._renderer.stackRenderers)}}var A8=async()=>{let Q=null;const $=async()=>{if(Q)Q.stop()};window.addEventListener("error",$);const J=document.querySelector("#main-canvas");if(!J)throw new Error("main-canvas not found");const U=document.querySelector("#gui_toggle_start");if(!U)throw new Error("guiToggleStart not found");const N=document.querySelector("#gui_fullscreen");if(!N)throw new Error("guiFullscreen not found");if(!t0())throw new Error("missing WebGL2 feature (unsupported)");if(!o0())throw new Error("missing WebWorker feature (unsupported)");U.addEventListener("click",()=>{if(!Q)return;if(Q.isRunning())Q.stop();else Q.start()}),N.addEventListener("click",()=>{if(!Q)return;W0.requestFullScreen(J)}),W0.addOnFullScreenChange(()=>{if(!Q)return;let Z=800,j=600;const K=W0.isFullScreen(J);if(K)J.style.position="absolute",Z=window.innerWidth,j=window.innerHeight;else J.style.position="relative";J.style.left="0px",J.style.top="0px",J.style.width=`${Z}px`,J.style.height=`${j}px`,J.width=Z,J.height=j,Q.resize(Z,j,K)}),Q=new d0(J),await Q.init(),Q.start()};window.addEventListener("load",A8);
