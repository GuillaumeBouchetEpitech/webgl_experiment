var j7=Object.defineProperty;var q0=(Q,$)=>{for(var J in $)j7(Q,J,{get:$[J],enumerable:!0,configurable:!0,set:(U)=>$[J]=()=>U})};var x0=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],K7=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"];class c0{_onFullScreenChangeCallbacks=[];_isInitialized=!1;_initialize(){if(this._isInitialized)return;this._isInitialized=!0;const Q=()=>{this._onFullScreenChangeCallbacks.forEach(($)=>$())};for(let $ of K7)document.addEventListener($,Q,!1)}isCompatible(Q){for(let $ of x0)if($ in Q)return!0;return!1}isFullScreen(Q){return document.fullscreenElement===Q}async requestFullScreen(Q){if(this.isFullScreen(Q))return{success:!1,message:"element already in full screen"};this._initialize();for(let $ of x0)if($ in Q)return Q[$](),{success:!0,message:"request for full screen done"};return{success:!1,message:"unsupported request for full screen"}}addOnFullScreenChange(Q){this._onFullScreenChangeCallbacks.push(Q)}removeOnFullScreenChange(Q){const $=this._onFullScreenChangeCallbacks.indexOf(Q);if($<0)return;this._onFullScreenChangeCallbacks.splice($,1)}}var E0=new c0;var F0={Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,BackQuote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Shift:16,Ctrl:17,Alt:18,CapsLock:20,Tab:9,Enter:13,Pause:19,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,PrintScreen:44,Insert:45,Delete:46,ContextMenu:93,ScrollLock:145,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,NumPadMultiply:106,NumPadAdd:107,NumPadSubtract:109,NumPadDecimal:110,NumPadDivide:111,NumLock:144,NumPadComma:194,NumPadEqual:12};class d0{_pressedKeysSet=new Set;_preventDefaultKeysSet=new Set;_activated=!1;_handleKeyDown;_handleKeyUp;constructor(){const Q=(J)=>{const{keyCode:U}=J;if(this._preventDefaultKeysSet.has(U))J.preventDefault();this._pressedKeysSet.add(U)},$=(J)=>{const{keyCode:U}=J;if(this._preventDefaultKeysSet.has(U))J.preventDefault();this._pressedKeysSet.delete(U)};this._activated=!1,this._handleKeyDown=Q.bind(this),this._handleKeyUp=$.bind(this)}isPressed(...Q){for(let $ of Q)if(this._pressedKeysSet.has(F0[$]))return!0;return!1}preventDefault(Q){this._preventDefaultKeysSet.add(F0[Q])}enableDefault(Q){this._preventDefaultKeysSet.delete(F0[Q])}activate(){if(this._activated)return;this._pressedKeysSet.clear(),document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("keyup",this._handleKeyUp),this._activated=!0}deactivate(){if(!this._activated)return;this._pressedKeysSet.clear(),document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("keyup",this._handleKeyUp),this._activated=!1}}var C=new d0;var X7={Left:0,Middle:1,Right:2};class s0{_pressedButtonsSet=new Set;_activated=!1;_handleMouseDown;_handleMouseUp;_handleMouseMove;_deltaX=0;_deltaY=0;constructor(){const Q=(U)=>{this._pressedButtonsSet.add(U.button)},$=(U)=>{this._pressedButtonsSet.delete(U.button)},J=(U)=>{this._deltaX+=U.movementX||U.mozMovementX||U.webkitMovementX||0,this._deltaY+=U.movementY||U.mozMovementY||U.webkitMovementY||0};this._activated=!1,this._handleMouseDown=Q.bind(this),this._handleMouseUp=$.bind(this),this._handleMouseMove=J.bind(this)}activate(){if(this._activated)return;this._pressedButtonsSet.clear(),document.addEventListener("mousedown",this._handleMouseDown),document.addEventListener("mouseup",this._handleMouseUp),document.addEventListener("mousemove",this._handleMouseMove),this._activated=!0}deactivate(){if(!this._activated)return;this._pressedButtonsSet.clear(),document.removeEventListener("mousedown",this._handleMouseDown),document.removeEventListener("mouseup",this._handleMouseUp),document.removeEventListener("mousemove",this._handleMouseMove),this._activated=!1}isButtonPressed(Q){return this._pressedButtonsSet.has(X7[Q])}deltaX(){return this._deltaX}deltaY(){return this._deltaY}resetDelta(){this._deltaX=0,this._deltaY=0}}var t=new s0;var b0=["requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock"],Y7=["exitPointerLock","mozExitPointerLock","webkitExitPointerLock"],H7=["pointerLockElement","mozPointerLockElement","webkitPointerLockElement"],I7=[{methodName:"onpointerlockchange",propertyName:"pointerlockchange"},{methodName:"onmozpointerlockchange",propertyName:"mozpointerlockchange"},{methodName:"onwebkitpointerlockchange",propertyName:"webkitpointerlockchange"}],B7=[{methodName:"onpointerlockerror",propertyName:"pointerlockerror"},{methodName:"onmozpointerlockerror",propertyName:"mozpointerlockerror"},{methodName:"onwebkitpointerlockerror",propertyName:"webkitpointerlockerror"}];class l0{_onLockChangeCallbacks=[];_onLockErrorCallbacks=[];_timeSinceLastLockChange=0;_latestRequestHtmlElement;_isInitialized=!1;_initialize(){if(this._isInitialized)return;this._isInitialized=!0;const Q=()=>{this._timeSinceLastLockChange=Date.now(),this._onLockChangeCallbacks.forEach((J)=>J())},$=(J)=>{this._timeSinceLastLockChange=Date.now(),this._onLockErrorCallbacks.forEach((U)=>U(J))};for(let J of I7)if(J.methodName in document){document.addEventListener(J.propertyName,Q,!1);break}for(let J of B7)if(J.methodName in document){document.addEventListener(J.propertyName,$,!1);break}}canBePointerLocked(Q){for(let $ of b0)if($ in Q)return!0;return!1}isPointerLocked(Q){for(let $ of H7)if($ in document)return document[$]===Q;return!1}async requestPointerLock(Q){if(this.isPointerLocked(Q))return{success:!1,message:"element already locked"};if(this._initialize(),this._timeSinceLastLockChange>0){const $=(Date.now()-this._timeSinceLastLockChange)/1000;if($<1.1)return{success:!1,message:`request for lock was too early, time to wait: ${$.toFixed(2)}sec`}}this._timeSinceLastLockChange=Date.now();for(let $ of b0)if($ in Q){const J={unadjustedMovement:!1};try{await Q[$](J)}catch(U){return{success:!1,message:`request for lock was too early, time to wait: ${((Date.now()-this._timeSinceLastLockChange)/1000).toFixed(2)}sec`}}return this._timeSinceLastLockChange=Date.now(),{success:!0,message:"request for lock done"}}return{success:!1,message:"unsupported request for lock"}}allowPointerLockedOnClickEvent(Q){if(Q===this._latestRequestHtmlElement)return;this._latestRequestHtmlElement=Q;const $=async()=>{Q.removeEventListener("click",$);const J=await this.requestPointerLock(Q);if(this._latestRequestHtmlElement=void 0,!J.success)this.allowPointerLockedOnClickEvent(Q)};Q.addEventListener("click",$)}exitPointerLock(){for(let Q of Y7)if(Q in document){document[Q]();break}}addOnLockChange(Q){this._onLockChangeCallbacks.push(Q)}removeOnLockChange(Q){const $=this._onLockChangeCallbacks.indexOf(Q);if($<0)return;this._onLockChangeCallbacks.splice($,1)}addOnLockError(Q){this._onLockErrorCallbacks.push(Q)}removeOnLockError(Q){const $=this._onLockErrorCallbacks.indexOf(Q);if($<0)return;this._onLockErrorCallbacks.splice($,1)}}var Q0=new l0;class r0{id;createdAt=Date.now();positionX;positionY;deltaX=0;deltaY=0;constructor(Q,$,J){this.id=Q,this.positionX=$,this.positionY=J}resetDelta(){this.deltaX=0,this.deltaY=0}}class n0{_activated=!1;_allTouchDataMap=new Map;_allCachedTouchDataArray=[];_handleTouchStart;_handleTouchEnd;_handleTouchMove;constructor(){const Q=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z,pageX:j,pageY:K}=U.changedTouches[N],X=new r0(Z,j,K);this._allTouchDataMap.set(`${Z}`,X),this._allCachedTouchDataArray.length=0}},$=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z}=U.changedTouches[N];this._allTouchDataMap.delete(`${Z}`),this._allCachedTouchDataArray.length=0}},J=(U)=>{U.preventDefault();for(let N=0;N<U.changedTouches.length;++N){const{identifier:Z,pageX:j,pageY:K}=U.changedTouches[N],X=this._allTouchDataMap.get(`${Z}`);if(!X)continue;const Y=j-X.positionX,I=K-X.positionY;X.deltaX+=Y,X.deltaY+=I,X.positionX=j,X.positionY=K}};this._activated=!1,this._handleTouchStart=Q.bind(this),this._handleTouchEnd=$.bind(this),this._handleTouchMove=J.bind(this)}isSupported(Q){return"ontouchstart"in Q}activate(Q){if(!this.isSupported(Q))return;if(this._activated)return;this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,Q.addEventListener("touchstart",this._handleTouchStart),Q.addEventListener("touchend",this._handleTouchEnd),Q.addEventListener("touchcancel",this._handleTouchEnd),Q.addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._activated=!0}deactivate(Q){if(!this._activated)return;this._allTouchDataMap.clear(),this._allCachedTouchDataArray.length=0,Q.removeEventListener("touchstart",this._handleTouchStart),Q.removeEventListener("touchend",this._handleTouchEnd),Q.removeEventListener("touchcancel",this._handleTouchEnd),Q.removeEventListener("touchmove",this._handleTouchMove),this._activated=!1}_refreshCache(){if(this._allCachedTouchDataArray.length===0)this._allCachedTouchDataArray=[...this._allTouchDataMap.values()]}getTouchData(){return this._refreshCache(),this._allCachedTouchDataArray}resetDeltas(){this._refreshCache(),this._allCachedTouchDataArray.forEach((Q)=>Q.resetDelta())}}var s=new n0;var u0=()=>{return!!window.Worker};var i0=()=>{return!!window.WebGL2RenderingContext};var V0={};q0(V0,{WebGLContext:()=>{{return W}},Texture:()=>{{return x}},ShaderProgram:()=>{{return m}},GeometryWrapper:()=>{{return h}},FrameBuffer:()=>{{return G0}},CubeMapType:()=>{{return a}},CubeMap:()=>{{return L0}}});class W{static _gl=null;static _extensionLoseContext=null;static initialize(Q){const $={alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!1};if(W._gl=Q.getContext("webgl2",$),!W._gl)throw new Error("could not create webgl context");W._extensionLoseContext=W._gl.getExtension("WEBGL_lose_context"),W._gl.getExtension("EXT_color_buffer_float"),W._gl.getExtension("EXT_float_blend")}static getContext(){if(!W._gl)throw new Error("webgl context not initialized");return W._gl}static getExtensionLoseContext(){return W._extensionLoseContext}static getExtensionLoseContextStrict(){if(!W._extensionLoseContext)throw new Error("lose context extension not available");return W._extensionLoseContext}}var a;(function(j){j[j["positiveX"]=0]="positiveX";j[j["negativeX"]=1]="negativeX";j[j["positiveY"]=2]="positiveY";j[j["negativeY"]=3]="negativeY";j[j["positiveZ"]=4]="positiveZ";j[j["negativeZ"]=5]="negativeZ"})(a||(a={}));class L0{_width=0;_height=0;_minBufferSize=0;_texture=null;initialize(Q,$){if(Q<1)throw new Error(`cube map: width is < 1, input: ${Q}`);if($<1)throw new Error(`cube map: height is < 1, input: ${$}`);const J=W.getContext();this._texture=J.createTexture(),this._width=Q,this._height=$,this._minBufferSize=this._width*this._height*4}rawBind(){if(!this._texture)throw new Error("cube map: not initialized");const Q=W.getContext();Q.bindTexture(Q.TEXTURE_CUBE_MAP,this._texture)}bind(Q){this.rawBind(),Q(this),L0.unbind()}static unbind(){const Q=W.getContext();Q.bindTexture(Q.TEXTURE_CUBE_MAP,null)}loadFromMemory(Q,$){if(!this._texture)throw new Error("cube map: not initialized");if($.length<this._minBufferSize)throw new Error(`cube map: miss-matching pixels buffer size, input: ${$.length}`);const J=W.getContext(),U=0,N=J.RGBA,Z=0,j=J.RGBA,K=J.UNSIGNED_BYTE;J.texImage2D(L0._getType(Q),U,N,this._width,this._height,Z,j,K,$)}complete(){const Q=W.getContext();Q.generateMipmap(Q.TEXTURE_CUBE_MAP),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR_MIPMAP_LINEAR)}getWidth(){if(!this._texture)throw new Error("cube map: not initialized");return this._width}getHeight(){if(!this._texture)throw new Error("cube map: not initialized");return this._height}static _getType(Q){const $=W.getContext();switch(Q){case a.positiveX:return $.TEXTURE_CUBE_MAP_POSITIVE_X;case a.negativeX:return $.TEXTURE_CUBE_MAP_NEGATIVE_X;case a.positiveY:return $.TEXTURE_CUBE_MAP_POSITIVE_Y;case a.negativeY:return $.TEXTURE_CUBE_MAP_NEGATIVE_Y;case a.positiveZ:return $.TEXTURE_CUBE_MAP_POSITIVE_Z;case a.negativeZ:return $.TEXTURE_CUBE_MAP_NEGATIVE_Z}}}class G0{_frameBuffer;constructor(){const $=W.getContext().createFramebuffer();if($===null)throw new Error("null frame buffer object");this._frameBuffer=$}rawBind(){const Q=W.getContext();Q.bindFramebuffer(Q.FRAMEBUFFER,this._frameBuffer)}bind(Q){this.rawBind(),Q(this),G0.unbind()}static unbind(){const Q=W.getContext();Q.bindFramebuffer(Q.FRAMEBUFFER,null)}attachTexture(Q){const $=W.getContext();$.bindFramebuffer($.FRAMEBUFFER,this._frameBuffer),Q.rawBind();const J=0;$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,Q.getRawObject(),J)}getPixels(Q,$,J,U,N){const Z=W.getContext();Z.readPixels(Q,$,J,U,Z.RGBA,Z.UNSIGNED_BYTE,N)}}var h;(function(K0){K0.BytesPerPixel=4;let $;(function(B){B[B["float"]=0]="float";B[B["vec2f"]=1]="vec2f";B[B["vec3f"]=2]="vec3f";B[B["vec4f"]=3]="vec4f";B[B["mat3f"]=4]="mat3f";B[B["mat4f"]=5]="mat4f"})($=K0.AttributeType||(K0.AttributeType={}));const J=(j)=>{switch(j){case $.float:return 1;case $.vec2f:return 2;case $.vec3f:return 3;case $.vec4f:return 4;case $.mat3f:return 9;case $.mat4f:return 16}};let U;(function(Y){Y[Y["lines"]=0]="lines";Y[Y["triangles"]=1]="triangles";Y[Y["triangleStrip"]=2]="triangleStrip"})(U=K0.PrimitiveType||(K0.PrimitiveType={}));class N{_def;_vao;_vbos;_primitiveType;_primitiveStart=0;_primitiveCount=0;_instanceCount=0;_isInstanced=!1;constructor(j,K){const X=W.getContext();if(K.vbos.length===0)throw new Error("empty vbo definition");for(let I of K.vbos){if(I.attrs.length===0)throw new Error("empty vbo attribute definition");for(let q of I.attrs)if(!j.hasAttribute(q.name))throw new Error(`attribute not found, name="${q.name}"`)}switch(this._def=K,K.primitiveType){case U.lines:this._primitiveType=X.LINES;break;case U.triangles:this._primitiveType=X.TRIANGLES;break;case U.triangleStrip:this._primitiveType=X.TRIANGLE_STRIP;break;default:throw new Error("primitive type not found")}const Y=X.createVertexArray();if(!Y)throw new Error("fail o create a vao unit");this._vao=Y,X.bindVertexArray(this._vao),this._vbos=[];for(let I of this._def.vbos){const q=X.createBuffer();if(!q)throw new Error("fail o create a vbo unit");this._vbos.push({object:q,maxSize:0,dynamic:I.dynamic||!1}),X.bindBuffer(X.ARRAY_BUFFER,q);let B=I.stride||0;if(!B){for(let O of I.attrs)switch(O.type){case $.float:B+=1;break;case $.vec2f:B+=2;break;case $.vec3f:B+=3;break;case $.vec4f:B+=4;break;case $.mat3f:B+=9;break;case $.mat4f:B+=16;break}B*=4}for(let O of I.attrs){let R=1,E=1;switch(O.type){case $.float:R=1,E=1;break;case $.vec2f:R=2,E=1;break;case $.vec3f:R=3,E=1;break;case $.vec4f:R=4,E=1;break;case $.mat3f:R=3,E=3;break;case $.mat4f:R=4,E=4;break}const D=j.getAttribute(O.name);for(let F=0;F<E;++F){const _=D+F,L=(O.index+F*R)*4;if(X.enableVertexAttribArray(_),X.vertexAttribPointer(_,R,X.FLOAT,!1,B,L),I.instanced===!0)X.vertexAttribDivisor(_,1),this._isInstanced=!0}}}X.bindVertexArray(null)}dispose(){const j=W.getContext();for(let K of this._vbos)j.deleteBuffer(K.object);this._vbos.length=0,j.deleteVertexArray(this._vao)}setBufferSize(j,K){if(j<0||j>=this._vbos.length)throw new Error("no buffer available to that index");if(K<=0)return;const X=this._vbos[j];if(K<X.maxSize)return;X.maxSize=K;const Y=W.getContext(),I=X.dynamic?Y.DYNAMIC_DRAW:Y.STATIC_DRAW;Y.bindBuffer(Y.ARRAY_BUFFER,X.object),Y.bufferData(Y.ARRAY_BUFFER,K,I),Y.bindBuffer(Y.ARRAY_BUFFER,null)}setFloatBufferSize(j,K){this.setBufferSize(j,K*4)}updateBuffer(j,K,X){if(j<0||j>=this._vbos.length)throw new Error("no buffer available to that index");if(X<=0)return;const Y=W.getContext(),I=K instanceof Float32Array?K:new Float32Array(K),q=this._vbos[j];if(Y.bindBuffer(Y.ARRAY_BUFFER,q.object),X>q.maxSize){q.maxSize=X;const B=q.dynamic?Y.DYNAMIC_DRAW:Y.STATIC_DRAW;Y.bufferData(Y.ARRAY_BUFFER,I,B,0,X)}else Y.bufferSubData(Y.ARRAY_BUFFER,0,I,0,X);Y.bindBuffer(Y.ARRAY_BUFFER,null)}render(){if(this._primitiveCount==0)return;if(this._isInstanced&&this._instanceCount==0)return;const j=W.getContext();if(j.bindVertexArray(this._vao),this._isInstanced===!0)j.drawArraysInstanced(this._primitiveType,this._primitiveStart,this._primitiveCount,this._instanceCount);else j.drawArrays(this._primitiveType,this._primitiveStart,this._primitiveCount);j.bindVertexArray(null)}setPrimitiveStart(j){this._primitiveStart=j}setPrimitiveCount(j){this._primitiveCount=j}setInstancedCount(j){this._instanceCount=j}}K0.Geometry=N;class Z{_def={vbos:[],primitiveType:U.lines};reset(){return this._def={vbos:[],primitiveType:U.lines},this}getDef(){return this._def}setPrimitiveType(j){return this._def.primitiveType=U[j],this}addVbo(){return this._def.vbos.push({attrs:[],instanced:!1}),this}setVboAsInstanced(){return this._getLastVbo().instanced=!0,this}setVboAsDynamic(){return this._getLastVbo().dynamic=!0,this}setStride(j){return this._getLastVbo().stride=j,this}addVboAttribute(j,K){const X=this._getLastVbo(),Y=X.attrs.length>0?X.attrs[X.attrs.length-1]:null;return X.attrs.push({name:j,type:$[K],index:Y?Y.index+J(Y.type):0}),this}_getLastVbo(){if(this._def.vbos.length===0)throw new Error("no VBO setup");return this._def.vbos[this._def.vbos.length-1]}}K0.GeometryBuilder=Z})(h||(h={}));class m{static _isBound=null;_name;_program;_attributes=new Map;_uniforms=new Map;constructor(Q,$){this._name=Q;const J=W.getContext(),U=this._getShader($.vertexSrc,J.VERTEX_SHADER),N=this._getShader($.fragmentSrc,J.FRAGMENT_SHADER),Z=J.createProgram();if(!Z)throw new Error("could not create a shader program");if(J.attachShader(Z,U),J.attachShader(Z,N),J.linkProgram(Z),J.deleteShader(U),J.deleteShader(N),!J.getProgramParameter(Z,J.LINK_STATUS)){const j=J.getProgramInfoLog(Z);throw new Error("Failed to initialized shaders, Error linking:"+j)}this._program=Z,this.bind(()=>{this._getAttributes($.attributes),this._getUniforms($.uniforms)})}rawBind(){W.getContext().useProgram(this._program)}bind(Q){if(m._isBound!==null)throw new Error(`Double shader binding (bound: ${m._isBound._name}, binding: ${this._name})`);m._isBound=this,this.rawBind(),Q(this),m.unbind()}static unbind(){W.getContext().useProgram(null),m._isBound=null}isBound(){return m._isBound===this}hasAttribute(Q){return this._attributes.has(Q)}getAttribute(Q){const $=this._attributes.get(Q);if($===void 0)throw new Error(`attribute not found: ${Q}`);return $}getUniform(Q){const $=this._uniforms.get(Q);if($===void 0)throw new Error(`uniform not found: ${Q}`);return $}setTextureUniform(Q,$,J){const U=W.getContext();U.activeTexture(U.TEXTURE0+J),U.uniform1i(this.getUniform(Q),J),$.rawBind()}setInteger1Uniform(Q,$){W.getContext().uniform1i(this.getUniform(Q),$)}setInteger2Uniform(Q,$,J){W.getContext().uniform2i(this.getUniform(Q),$,J)}setInteger3Uniform(Q,$,J,U){W.getContext().uniform3i(this.getUniform(Q),$,J,U)}setFloat1Uniform(Q,$){W.getContext().uniform1f(this.getUniform(Q),$)}setFloat2Uniform(Q,$,J){W.getContext().uniform2f(this.getUniform(Q),$,J)}setFloat3Uniform(Q,$,J,U){W.getContext().uniform3f(this.getUniform(Q),$,J,U)}setMatrix4Uniform(Q,$){W.getContext().uniformMatrix4fv(this.getUniform(Q),!1,$)}_getAttributes(Q){const $=W.getContext();for(let J=0;J<Q.length;++J){const U=$.getAttribLocation(this._program,Q[J]);if(U<0)throw new Error(`attribute not found => ${Q[J]}`);this._attributes.set(Q[J],U)}}_getUniforms(Q){const $=W.getContext();for(let J=0;J<Q.length;++J){const U=$.getUniformLocation(this._program,Q[J]);if(U===null)throw new Error(`uniform not found => ${Q[J]}`);this._uniforms.set(Q[J],U)}}_getShader(Q,$){const J=W.getContext(),U=J.createShader($);if(!U)throw new Error("could not create a shader");if(J.shaderSource(U,Q),J.compileShader(U),!J.getShaderParameter(U,J.COMPILE_STATUS)){let N=J.getShaderInfoLog(U);if(!N)N="failed to compile a shader";throw new Error(N)}return U}}class x{_width=0;_height=0;_texture=null;initialize(){if(this._texture)throw new Error("texture: already initialized");const Q=W.getContext();this._texture=Q.createTexture()}rawBind(){if(!this._texture)throw new Error("texture: not initialized");const Q=W.getContext();Q.bindTexture(Q.TEXTURE_2D,this._texture)}bind(Q){this.rawBind(),Q(this),x.unbind()}static unbind(){const Q=W.getContext();Q.bindTexture(Q.TEXTURE_2D,null)}load(Q){if(!this._texture)throw new Error("texture: not initialized");const $=W.getContext();this._width=Q.width,this._height=Q.height,$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST);const J=0,U=$.RGBA,N=$.RGBA,Z=$.UNSIGNED_BYTE;$.texImage2D($.TEXTURE_2D,J,U,N,Z,Q)}loadFromMemory(Q,$,J){this._allocate(Q,$,J)}allocate(Q,$){this._allocate(Q,$)}resize(Q,$){this._allocate(Q,$)}_allocate(Q,$,J=null){if(!this._texture)throw new Error("texture: not initialized");const U=W.getContext();this._width=Q,this._height=$,U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST);const N=0,Z=U.RGBA,j=0,K=U.RGBA,X=U.UNSIGNED_BYTE;U.texImage2D(U.TEXTURE_2D,N,Z,Q,$,j,K,X,J)}getWidth(){if(!this._texture)throw new Error("texture not initialized");return this._width}getHeight(){if(!this._texture)throw new Error("texture not initialized");return this._height}getRawObject(){if(!this._texture)throw new Error("texture not initialized");return this._texture}static getImageFromUrl(Q){return new Promise(($,J)=>{const U=new Image;U.onerror=J,U.onload=()=>{$(U)},U.src=Q})}}var j0=20,a0=10;var o0=3,e0=32,t0=0.1,QQ=Math.PI*0.45,$Q=0.3,JQ="./dist/worker.js",UQ=2;var T=0.000001,S=typeof Float32Array!=="undefined"?Float32Array:Array,b=Math.random,oJ=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var Q=0,$=arguments.length;while($--)Q+=arguments[$]*arguments[$];return Math.sqrt(Q)};var y={};q0(y,{transpose:()=>{{return L7}},translate:()=>{{return M7}},targetTo:()=>{{return u7}},subtract:()=>{{return HQ}},sub:()=>{{return U$}},str:()=>{{return i7}},set:()=>{{return F7}},scale:()=>{{return W7}},rotateZ:()=>{{return f7}},rotateY:()=>{{return T7}},rotateX:()=>{{return w7}},rotate:()=>{{return _7}},perspectiveZO:()=>{{return s7}},perspectiveNO:()=>{{return XQ}},perspectiveFromFieldOfView:()=>{{return b7}},perspective:()=>{{return d7}},orthoZO:()=>{{return r7}},orthoNO:()=>{{return YQ}},ortho:()=>{{return l7}},multiplyScalarAndAdd:()=>{{return t7}},multiplyScalar:()=>{{return e7}},multiply:()=>{{return ZQ}},mul:()=>{{return J$}},lookAt:()=>{{return n7}},invert:()=>{{return V7}},identity:()=>{{return NQ}},getTranslation:()=>{{return z7}},getScaling:()=>{{return KQ}},getRotation:()=>{{return C7}},frustum:()=>{{return c7}},fromZRotation:()=>{{return S7}},fromYRotation:()=>{{return k7}},fromXRotation:()=>{{return h7}},fromValues:()=>{{return E7}},fromTranslation:()=>{{return v7}},fromScaling:()=>{{return p7}},fromRotationTranslationScaleOrigin:()=>{{return m7}},fromRotationTranslationScale:()=>{{return g7}},fromRotationTranslation:()=>{{return jQ}},fromRotation:()=>{{return P7}},fromQuat2:()=>{{return y7}},fromQuat:()=>{{return x7}},frob:()=>{{return a7}},exactEquals:()=>{{return Q$}},equals:()=>{{return $$}},determinant:()=>{{return G7}},create:()=>{{return D7}},copy:()=>{{return R7}},clone:()=>{{return O7}},adjoint:()=>{{return A7}},add:()=>{{return o7}}});function D7(){var Q=new S(16);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0;return Q[0]=1,Q[5]=1,Q[10]=1,Q[15]=1,Q}function O7(Q){var $=new S(16);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$[4]=Q[4],$[5]=Q[5],$[6]=Q[6],$[7]=Q[7],$[8]=Q[8],$[9]=Q[9],$[10]=Q[10],$[11]=Q[11],$[12]=Q[12],$[13]=Q[13],$[14]=Q[14],$[15]=Q[15],$}function R7(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function E7(Q,$,J,U,N,Z,j,K,X,Y,I,q,B,O,R,E){var D=new S(16);return D[0]=Q,D[1]=$,D[2]=J,D[3]=U,D[4]=N,D[5]=Z,D[6]=j,D[7]=K,D[8]=X,D[9]=Y,D[10]=I,D[11]=q,D[12]=B,D[13]=O,D[14]=R,D[15]=E,D}function F7(Q,$,J,U,N,Z,j,K,X,Y,I,q,B,O,R,E,D){return Q[0]=$,Q[1]=J,Q[2]=U,Q[3]=N,Q[4]=Z,Q[5]=j,Q[6]=K,Q[7]=X,Q[8]=Y,Q[9]=I,Q[10]=q,Q[11]=B,Q[12]=O,Q[13]=R,Q[14]=E,Q[15]=D,Q}function NQ(Q){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function L7(Q,$){if(Q===$){var J=$[1],U=$[2],N=$[3],Z=$[6],j=$[7],K=$[11];Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=J,Q[6]=$[9],Q[7]=$[13],Q[8]=U,Q[9]=Z,Q[11]=$[14],Q[12]=N,Q[13]=j,Q[14]=K}else Q[0]=$[0],Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=$[1],Q[5]=$[5],Q[6]=$[9],Q[7]=$[13],Q[8]=$[2],Q[9]=$[6],Q[10]=$[10],Q[11]=$[14],Q[12]=$[3],Q[13]=$[7],Q[14]=$[11],Q[15]=$[15];return Q}function V7(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=$[4],K=$[5],X=$[6],Y=$[7],I=$[8],q=$[9],B=$[10],O=$[11],R=$[12],E=$[13],D=$[14],F=$[15],_=J*K-U*j,L=J*X-N*j,A=J*Y-Z*j,M=U*X-N*K,G=U*Y-Z*K,f=N*Y-Z*X,v=I*E-q*R,p=I*D-B*R,P=I*F-O*R,k=q*D-B*E,z=q*F-O*E,g=B*F-O*D,w=_*g-L*z+A*k+M*P-G*p+f*v;if(!w)return null;return w=1/w,Q[0]=(K*g-X*z+Y*k)*w,Q[1]=(N*z-U*g-Z*k)*w,Q[2]=(E*f-D*G+F*M)*w,Q[3]=(B*G-q*f-O*M)*w,Q[4]=(X*P-j*g-Y*p)*w,Q[5]=(J*g-N*P+Z*p)*w,Q[6]=(D*A-R*f-F*L)*w,Q[7]=(I*f-B*A+O*L)*w,Q[8]=(j*z-K*P+Y*v)*w,Q[9]=(U*P-J*z-Z*v)*w,Q[10]=(R*G-E*A+F*_)*w,Q[11]=(q*A-I*G-O*_)*w,Q[12]=(K*p-j*k-X*v)*w,Q[13]=(J*k-U*p+N*v)*w,Q[14]=(E*L-R*M-D*_)*w,Q[15]=(I*M-q*L+B*_)*w,Q}function A7(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=$[4],K=$[5],X=$[6],Y=$[7],I=$[8],q=$[9],B=$[10],O=$[11],R=$[12],E=$[13],D=$[14],F=$[15];return Q[0]=K*(B*F-O*D)-q*(X*F-Y*D)+E*(X*O-Y*B),Q[1]=-(U*(B*F-O*D)-q*(N*F-Z*D)+E*(N*O-Z*B)),Q[2]=U*(X*F-Y*D)-K*(N*F-Z*D)+E*(N*Y-Z*X),Q[3]=-(U*(X*O-Y*B)-K*(N*O-Z*B)+q*(N*Y-Z*X)),Q[4]=-(j*(B*F-O*D)-I*(X*F-Y*D)+R*(X*O-Y*B)),Q[5]=J*(B*F-O*D)-I*(N*F-Z*D)+R*(N*O-Z*B),Q[6]=-(J*(X*F-Y*D)-j*(N*F-Z*D)+R*(N*Y-Z*X)),Q[7]=J*(X*O-Y*B)-j*(N*O-Z*B)+I*(N*Y-Z*X),Q[8]=j*(q*F-O*E)-I*(K*F-Y*E)+R*(K*O-Y*q),Q[9]=-(J*(q*F-O*E)-I*(U*F-Z*E)+R*(U*O-Z*q)),Q[10]=J*(K*F-Y*E)-j*(U*F-Z*E)+R*(U*Y-Z*K),Q[11]=-(J*(K*O-Y*q)-j*(U*O-Z*q)+I*(U*Y-Z*K)),Q[12]=-(j*(q*D-B*E)-I*(K*D-X*E)+R*(K*B-X*q)),Q[13]=J*(q*D-B*E)-I*(U*D-N*E)+R*(U*B-N*q),Q[14]=-(J*(K*D-X*E)-j*(U*D-N*E)+R*(U*X-N*K)),Q[15]=J*(K*B-X*q)-j*(U*B-N*q)+I*(U*X-N*K),Q}function G7(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3],Z=Q[4],j=Q[5],K=Q[6],X=Q[7],Y=Q[8],I=Q[9],q=Q[10],B=Q[11],O=Q[12],R=Q[13],E=Q[14],D=Q[15],F=$*j-J*Z,_=$*K-U*Z,L=$*X-N*Z,A=J*K-U*j,M=J*X-N*j,G=U*X-N*K,f=Y*R-I*O,v=Y*E-q*O,p=Y*D-B*O,P=I*E-q*R,k=I*D-B*R,z=q*D-B*E;return F*z-_*k+L*P+A*p-M*v+G*f}function ZQ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3],K=$[4],X=$[5],Y=$[6],I=$[7],q=$[8],B=$[9],O=$[10],R=$[11],E=$[12],D=$[13],F=$[14],_=$[15],L=J[0],A=J[1],M=J[2],G=J[3];return Q[0]=L*U+A*K+M*q+G*E,Q[1]=L*N+A*X+M*B+G*D,Q[2]=L*Z+A*Y+M*O+G*F,Q[3]=L*j+A*I+M*R+G*_,L=J[4],A=J[5],M=J[6],G=J[7],Q[4]=L*U+A*K+M*q+G*E,Q[5]=L*N+A*X+M*B+G*D,Q[6]=L*Z+A*Y+M*O+G*F,Q[7]=L*j+A*I+M*R+G*_,L=J[8],A=J[9],M=J[10],G=J[11],Q[8]=L*U+A*K+M*q+G*E,Q[9]=L*N+A*X+M*B+G*D,Q[10]=L*Z+A*Y+M*O+G*F,Q[11]=L*j+A*I+M*R+G*_,L=J[12],A=J[13],M=J[14],G=J[15],Q[12]=L*U+A*K+M*q+G*E,Q[13]=L*N+A*X+M*B+G*D,Q[14]=L*Z+A*Y+M*O+G*F,Q[15]=L*j+A*I+M*R+G*_,Q}function M7(Q,$,J){var U=J[0],N=J[1],Z=J[2],j,K,X,Y,I,q,B,O,R,E,D,F;if($===Q)Q[12]=$[0]*U+$[4]*N+$[8]*Z+$[12],Q[13]=$[1]*U+$[5]*N+$[9]*Z+$[13],Q[14]=$[2]*U+$[6]*N+$[10]*Z+$[14],Q[15]=$[3]*U+$[7]*N+$[11]*Z+$[15];else j=$[0],K=$[1],X=$[2],Y=$[3],I=$[4],q=$[5],B=$[6],O=$[7],R=$[8],E=$[9],D=$[10],F=$[11],Q[0]=j,Q[1]=K,Q[2]=X,Q[3]=Y,Q[4]=I,Q[5]=q,Q[6]=B,Q[7]=O,Q[8]=R,Q[9]=E,Q[10]=D,Q[11]=F,Q[12]=j*U+I*N+R*Z+$[12],Q[13]=K*U+q*N+E*Z+$[13],Q[14]=X*U+B*N+D*Z+$[14],Q[15]=Y*U+O*N+F*Z+$[15];return Q}function W7(Q,$,J){var U=J[0],N=J[1],Z=J[2];return Q[0]=$[0]*U,Q[1]=$[1]*U,Q[2]=$[2]*U,Q[3]=$[3]*U,Q[4]=$[4]*N,Q[5]=$[5]*N,Q[6]=$[6]*N,Q[7]=$[7]*N,Q[8]=$[8]*Z,Q[9]=$[9]*Z,Q[10]=$[10]*Z,Q[11]=$[11]*Z,Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function _7(Q,$,J,U){var N=U[0],Z=U[1],j=U[2],K=Math.hypot(N,Z,j),X,Y,I,q,B,O,R,E,D,F,_,L,A,M,G,f,v,p,P,k,z,g,w,c;if(K<T)return null;if(K=1/K,N*=K,Z*=K,j*=K,X=Math.sin(J),Y=Math.cos(J),I=1-Y,q=$[0],B=$[1],O=$[2],R=$[3],E=$[4],D=$[5],F=$[6],_=$[7],L=$[8],A=$[9],M=$[10],G=$[11],f=N*N*I+Y,v=Z*N*I+j*X,p=j*N*I-Z*X,P=N*Z*I-j*X,k=Z*Z*I+Y,z=j*Z*I+N*X,g=N*j*I+Z*X,w=Z*j*I-N*X,c=j*j*I+Y,Q[0]=q*f+E*v+L*p,Q[1]=B*f+D*v+A*p,Q[2]=O*f+F*v+M*p,Q[3]=R*f+_*v+G*p,Q[4]=q*P+E*k+L*z,Q[5]=B*P+D*k+A*z,Q[6]=O*P+F*k+M*z,Q[7]=R*P+_*k+G*z,Q[8]=q*g+E*w+L*c,Q[9]=B*g+D*w+A*c,Q[10]=O*g+F*w+M*c,Q[11]=R*g+_*w+G*c,$!==Q)Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q}function w7(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[4],j=$[5],K=$[6],X=$[7],Y=$[8],I=$[9],q=$[10],B=$[11];if($!==Q)Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[4]=Z*N+Y*U,Q[5]=j*N+I*U,Q[6]=K*N+q*U,Q[7]=X*N+B*U,Q[8]=Y*N-Z*U,Q[9]=I*N-j*U,Q[10]=q*N-K*U,Q[11]=B*N-X*U,Q}function T7(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[0],j=$[1],K=$[2],X=$[3],Y=$[8],I=$[9],q=$[10],B=$[11];if($!==Q)Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=Z*N-Y*U,Q[1]=j*N-I*U,Q[2]=K*N-q*U,Q[3]=X*N-B*U,Q[8]=Z*U+Y*N,Q[9]=j*U+I*N,Q[10]=K*U+q*N,Q[11]=X*U+B*N,Q}function f7(Q,$,J){var U=Math.sin(J),N=Math.cos(J),Z=$[0],j=$[1],K=$[2],X=$[3],Y=$[4],I=$[5],q=$[6],B=$[7];if($!==Q)Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=Z*N+Y*U,Q[1]=j*N+I*U,Q[2]=K*N+q*U,Q[3]=X*N+B*U,Q[4]=Y*N-Z*U,Q[5]=I*N-j*U,Q[6]=q*N-K*U,Q[7]=B*N-X*U,Q}function v7(Q,$){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=$[0],Q[13]=$[1],Q[14]=$[2],Q[15]=1,Q}function p7(Q,$){return Q[0]=$[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=$[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=$[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function P7(Q,$,J){var U=J[0],N=J[1],Z=J[2],j=Math.hypot(U,N,Z),K,X,Y;if(j<T)return null;return j=1/j,U*=j,N*=j,Z*=j,K=Math.sin($),X=Math.cos($),Y=1-X,Q[0]=U*U*Y+X,Q[1]=N*U*Y+Z*K,Q[2]=Z*U*Y-N*K,Q[3]=0,Q[4]=U*N*Y-Z*K,Q[5]=N*N*Y+X,Q[6]=Z*N*Y+U*K,Q[7]=0,Q[8]=U*Z*Y+N*K,Q[9]=N*Z*Y-U*K,Q[10]=Z*Z*Y+X,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function h7(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=U,Q[6]=J,Q[7]=0,Q[8]=0,Q[9]=-J,Q[10]=U,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function k7(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=U,Q[1]=0,Q[2]=-J,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=J,Q[9]=0,Q[10]=U,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function S7(Q,$){var J=Math.sin($),U=Math.cos($);return Q[0]=U,Q[1]=J,Q[2]=0,Q[3]=0,Q[4]=-J,Q[5]=U,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function jQ(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3],K=U+U,X=N+N,Y=Z+Z,I=U*K,q=U*X,B=U*Y,O=N*X,R=N*Y,E=Z*Y,D=j*K,F=j*X,_=j*Y;return Q[0]=1-(O+E),Q[1]=q+_,Q[2]=B-F,Q[3]=0,Q[4]=q-_,Q[5]=1-(I+E),Q[6]=R+D,Q[7]=0,Q[8]=B+F,Q[9]=R-D,Q[10]=1-(I+O),Q[11]=0,Q[12]=J[0],Q[13]=J[1],Q[14]=J[2],Q[15]=1,Q}function y7(Q,$){var J=new S(3),U=-$[0],N=-$[1],Z=-$[2],j=$[3],K=$[4],X=$[5],Y=$[6],I=$[7],q=U*U+N*N+Z*Z+j*j;if(q>0)J[0]=(K*j+I*U+X*Z-Y*N)*2/q,J[1]=(X*j+I*N+Y*U-K*Z)*2/q,J[2]=(Y*j+I*Z+K*N-X*U)*2/q;else J[0]=(K*j+I*U+X*Z-Y*N)*2,J[1]=(X*j+I*N+Y*U-K*Z)*2,J[2]=(Y*j+I*Z+K*N-X*U)*2;return jQ(Q,$,J),Q}function z7(Q,$){return Q[0]=$[12],Q[1]=$[13],Q[2]=$[14],Q}function KQ(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[4],j=$[5],K=$[6],X=$[8],Y=$[9],I=$[10];return Q[0]=Math.hypot(J,U,N),Q[1]=Math.hypot(Z,j,K),Q[2]=Math.hypot(X,Y,I),Q}function C7(Q,$){var J=new S(3);KQ(J,$);var U=1/J[0],N=1/J[1],Z=1/J[2],j=$[0]*U,K=$[1]*N,X=$[2]*Z,Y=$[4]*U,I=$[5]*N,q=$[6]*Z,B=$[8]*U,O=$[9]*N,R=$[10]*Z,E=j+I+R,D=0;if(E>0)D=Math.sqrt(E+1)*2,Q[3]=0.25*D,Q[0]=(q-O)/D,Q[1]=(B-X)/D,Q[2]=(K-Y)/D;else if(j>I&&j>R)D=Math.sqrt(1+j-I-R)*2,Q[3]=(q-O)/D,Q[0]=0.25*D,Q[1]=(K+Y)/D,Q[2]=(B+X)/D;else if(I>R)D=Math.sqrt(1+I-j-R)*2,Q[3]=(B-X)/D,Q[0]=(K+Y)/D,Q[1]=0.25*D,Q[2]=(q+O)/D;else D=Math.sqrt(1+R-j-I)*2,Q[3]=(K-Y)/D,Q[0]=(B+X)/D,Q[1]=(q+O)/D,Q[2]=0.25*D;return Q}function g7(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=$[3],X=N+N,Y=Z+Z,I=j+j,q=N*X,B=N*Y,O=N*I,R=Z*Y,E=Z*I,D=j*I,F=K*X,_=K*Y,L=K*I,A=U[0],M=U[1],G=U[2];return Q[0]=(1-(R+D))*A,Q[1]=(B+L)*A,Q[2]=(O-_)*A,Q[3]=0,Q[4]=(B-L)*M,Q[5]=(1-(q+D))*M,Q[6]=(E+F)*M,Q[7]=0,Q[8]=(O+_)*G,Q[9]=(E-F)*G,Q[10]=(1-(q+R))*G,Q[11]=0,Q[12]=J[0],Q[13]=J[1],Q[14]=J[2],Q[15]=1,Q}function m7(Q,$,J,U,N){var Z=$[0],j=$[1],K=$[2],X=$[3],Y=Z+Z,I=j+j,q=K+K,B=Z*Y,O=Z*I,R=Z*q,E=j*I,D=j*q,F=K*q,_=X*Y,L=X*I,A=X*q,M=U[0],G=U[1],f=U[2],v=N[0],p=N[1],P=N[2],k=(1-(E+F))*M,z=(O+A)*M,g=(R-L)*M,w=(O-A)*G,c=(1-(B+F))*G,e=(D+_)*G,Z0=(R+L)*f,O0=(D-_)*f,R0=(1-(B+E))*f;return Q[0]=k,Q[1]=z,Q[2]=g,Q[3]=0,Q[4]=w,Q[5]=c,Q[6]=e,Q[7]=0,Q[8]=Z0,Q[9]=O0,Q[10]=R0,Q[11]=0,Q[12]=J[0]+v-(k*v+w*p+Z0*P),Q[13]=J[1]+p-(z*v+c*p+O0*P),Q[14]=J[2]+P-(g*v+e*p+R0*P),Q[15]=1,Q}function x7(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=J+J,K=U+U,X=N+N,Y=J*j,I=U*j,q=U*K,B=N*j,O=N*K,R=N*X,E=Z*j,D=Z*K,F=Z*X;return Q[0]=1-q-R,Q[1]=I+F,Q[2]=B-D,Q[3]=0,Q[4]=I-F,Q[5]=1-Y-R,Q[6]=O+E,Q[7]=0,Q[8]=B+D,Q[9]=O-E,Q[10]=1-Y-q,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function c7(Q,$,J,U,N,Z,j){var K=1/(J-$),X=1/(N-U),Y=1/(Z-j);return Q[0]=Z*2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z*2*X,Q[6]=0,Q[7]=0,Q[8]=(J+$)*K,Q[9]=(N+U)*X,Q[10]=(j+Z)*Y,Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=j*Z*2*Y,Q[15]=0,Q}function XQ(Q,$,J,U,N){var Z=1/Math.tan($/2),j;if(Q[0]=Z/J,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,N!=null&&N!==Infinity)j=1/(U-N),Q[10]=(N+U)*j,Q[14]=2*N*U*j;else Q[10]=-1,Q[14]=-2*U;return Q}function s7(Q,$,J,U,N){var Z=1/Math.tan($/2),j;if(Q[0]=Z/J,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,N!=null&&N!==Infinity)j=1/(U-N),Q[10]=N*j,Q[14]=N*U*j;else Q[10]=-1,Q[14]=-U;return Q}function b7(Q,$,J,U){var N=Math.tan($.upDegrees*Math.PI/180),Z=Math.tan($.downDegrees*Math.PI/180),j=Math.tan($.leftDegrees*Math.PI/180),K=Math.tan($.rightDegrees*Math.PI/180),X=2/(j+K),Y=2/(N+Z);return Q[0]=X,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Y,Q[6]=0,Q[7]=0,Q[8]=-((j-K)*X*0.5),Q[9]=(N-Z)*Y*0.5,Q[10]=U/(J-U),Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=U*J/(J-U),Q[15]=0,Q}function YQ(Q,$,J,U,N,Z,j){var K=1/($-J),X=1/(U-N),Y=1/(Z-j);return Q[0]=-2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*X,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=2*Y,Q[11]=0,Q[12]=($+J)*K,Q[13]=(N+U)*X,Q[14]=(j+Z)*Y,Q[15]=1,Q}function r7(Q,$,J,U,N,Z,j){var K=1/($-J),X=1/(U-N),Y=1/(Z-j);return Q[0]=-2*K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*X,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=Y,Q[11]=0,Q[12]=($+J)*K,Q[13]=(N+U)*X,Q[14]=Z*Y,Q[15]=1,Q}function n7(Q,$,J,U){var N,Z,j,K,X,Y,I,q,B,O,R=$[0],E=$[1],D=$[2],F=U[0],_=U[1],L=U[2],A=J[0],M=J[1],G=J[2];if(Math.abs(R-A)<T&&Math.abs(E-M)<T&&Math.abs(D-G)<T)return NQ(Q);if(I=R-A,q=E-M,B=D-G,O=1/Math.hypot(I,q,B),I*=O,q*=O,B*=O,N=_*B-L*q,Z=L*I-F*B,j=F*q-_*I,O=Math.hypot(N,Z,j),!O)N=0,Z=0,j=0;else O=1/O,N*=O,Z*=O,j*=O;if(K=q*j-B*Z,X=B*N-I*j,Y=I*Z-q*N,O=Math.hypot(K,X,Y),!O)K=0,X=0,Y=0;else O=1/O,K*=O,X*=O,Y*=O;return Q[0]=N,Q[1]=K,Q[2]=I,Q[3]=0,Q[4]=Z,Q[5]=X,Q[6]=q,Q[7]=0,Q[8]=j,Q[9]=Y,Q[10]=B,Q[11]=0,Q[12]=-(N*R+Z*E+j*D),Q[13]=-(K*R+X*E+Y*D),Q[14]=-(I*R+q*E+B*D),Q[15]=1,Q}function u7(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=U[0],X=U[1],Y=U[2],I=N-J[0],q=Z-J[1],B=j-J[2],O=I*I+q*q+B*B;if(O>0)O=1/Math.sqrt(O),I*=O,q*=O,B*=O;var R=X*B-Y*q,E=Y*I-K*B,D=K*q-X*I;if(O=R*R+E*E+D*D,O>0)O=1/Math.sqrt(O),R*=O,E*=O,D*=O;return Q[0]=R,Q[1]=E,Q[2]=D,Q[3]=0,Q[4]=q*D-B*E,Q[5]=B*R-I*D,Q[6]=I*E-q*R,Q[7]=0,Q[8]=I,Q[9]=q,Q[10]=B,Q[11]=0,Q[12]=N,Q[13]=Z,Q[14]=j,Q[15]=1,Q}function i7(Q){return"mat4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+", "+Q[4]+", "+Q[5]+", "+Q[6]+", "+Q[7]+", "+Q[8]+", "+Q[9]+", "+Q[10]+", "+Q[11]+", "+Q[12]+", "+Q[13]+", "+Q[14]+", "+Q[15]+")"}function a7(Q){return Math.hypot(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15])}function o7(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q[3]=$[3]+J[3],Q[4]=$[4]+J[4],Q[5]=$[5]+J[5],Q[6]=$[6]+J[6],Q[7]=$[7]+J[7],Q[8]=$[8]+J[8],Q[9]=$[9]+J[9],Q[10]=$[10]+J[10],Q[11]=$[11]+J[11],Q[12]=$[12]+J[12],Q[13]=$[13]+J[13],Q[14]=$[14]+J[14],Q[15]=$[15]+J[15],Q}function HQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q[3]=$[3]-J[3],Q[4]=$[4]-J[4],Q[5]=$[5]-J[5],Q[6]=$[6]-J[6],Q[7]=$[7]-J[7],Q[8]=$[8]-J[8],Q[9]=$[9]-J[9],Q[10]=$[10]-J[10],Q[11]=$[11]-J[11],Q[12]=$[12]-J[12],Q[13]=$[13]-J[13],Q[14]=$[14]-J[14],Q[15]=$[15]-J[15],Q}function e7(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q[3]=$[3]*J,Q[4]=$[4]*J,Q[5]=$[5]*J,Q[6]=$[6]*J,Q[7]=$[7]*J,Q[8]=$[8]*J,Q[9]=$[9]*J,Q[10]=$[10]*J,Q[11]=$[11]*J,Q[12]=$[12]*J,Q[13]=$[13]*J,Q[14]=$[14]*J,Q[15]=$[15]*J,Q}function t7(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q[3]=$[3]+J[3]*U,Q[4]=$[4]+J[4]*U,Q[5]=$[5]+J[5]*U,Q[6]=$[6]+J[6]*U,Q[7]=$[7]+J[7]*U,Q[8]=$[8]+J[8]*U,Q[9]=$[9]+J[9]*U,Q[10]=$[10]+J[10]*U,Q[11]=$[11]+J[11]*U,Q[12]=$[12]+J[12]*U,Q[13]=$[13]+J[13]*U,Q[14]=$[14]+J[14]*U,Q[15]=$[15]+J[15]*U,Q}function Q$(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]&&Q[4]===$[4]&&Q[5]===$[5]&&Q[6]===$[6]&&Q[7]===$[7]&&Q[8]===$[8]&&Q[9]===$[9]&&Q[10]===$[10]&&Q[11]===$[11]&&Q[12]===$[12]&&Q[13]===$[13]&&Q[14]===$[14]&&Q[15]===$[15]}function $$(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=Q[3],j=Q[4],K=Q[5],X=Q[6],Y=Q[7],I=Q[8],q=Q[9],B=Q[10],O=Q[11],R=Q[12],E=Q[13],D=Q[14],F=Q[15],_=$[0],L=$[1],A=$[2],M=$[3],G=$[4],f=$[5],v=$[6],p=$[7],P=$[8],k=$[9],z=$[10],g=$[11],w=$[12],c=$[13],e=$[14],Z0=$[15];return Math.abs(J-_)<=T*Math.max(1,Math.abs(J),Math.abs(_))&&Math.abs(U-L)<=T*Math.max(1,Math.abs(U),Math.abs(L))&&Math.abs(N-A)<=T*Math.max(1,Math.abs(N),Math.abs(A))&&Math.abs(Z-M)<=T*Math.max(1,Math.abs(Z),Math.abs(M))&&Math.abs(j-G)<=T*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(K-f)<=T*Math.max(1,Math.abs(K),Math.abs(f))&&Math.abs(X-v)<=T*Math.max(1,Math.abs(X),Math.abs(v))&&Math.abs(Y-p)<=T*Math.max(1,Math.abs(Y),Math.abs(p))&&Math.abs(I-P)<=T*Math.max(1,Math.abs(I),Math.abs(P))&&Math.abs(q-k)<=T*Math.max(1,Math.abs(q),Math.abs(k))&&Math.abs(B-z)<=T*Math.max(1,Math.abs(B),Math.abs(z))&&Math.abs(O-g)<=T*Math.max(1,Math.abs(O),Math.abs(g))&&Math.abs(R-w)<=T*Math.max(1,Math.abs(R),Math.abs(w))&&Math.abs(E-c)<=T*Math.max(1,Math.abs(E),Math.abs(c))&&Math.abs(D-e)<=T*Math.max(1,Math.abs(D),Math.abs(e))&&Math.abs(F-Z0)<=T*Math.max(1,Math.abs(F),Math.abs(Z0))}var d7=XQ,l7=YQ,J$=ZQ,U$=HQ;var V={};q0(V,{zero:()=>{{return P$}},transformQuat:()=>{{return w$}},transformMat4:()=>{{return W$}},transformMat3:()=>{{return _$}},subtract:()=>{{return qQ}},sub:()=>{{return y$}},str:()=>{{return h$}},squaredLength:()=>{{return FQ}},squaredDistance:()=>{{return EQ}},sqrLen:()=>{{return c$}},sqrDist:()=>{{return m$}},set:()=>{{return K$}},scaleAndAdd:()=>{{return O$}},scale:()=>{{return D$}},round:()=>{{return q$}},rotateZ:()=>{{return v$}},rotateY:()=>{{return f$}},rotateX:()=>{{return T$}},random:()=>{{return M$}},normalize:()=>{{return F$}},negate:()=>{{return R$}},multiply:()=>{{return DQ}},mul:()=>{{return z$}},min:()=>{{return I$}},max:()=>{{return B$}},lerp:()=>{{return V$}},length:()=>{{return BQ}},len:()=>{{return x$}},inverse:()=>{{return E$}},hermite:()=>{{return A$}},fromValues:()=>{{return Z$}},forEach:()=>{{return d$}},floor:()=>{{return H$}},exactEquals:()=>{{return k$}},equals:()=>{{return S$}},dot:()=>{{return LQ}},divide:()=>{{return OQ}},div:()=>{{return C$}},distance:()=>{{return RQ}},dist:()=>{{return g$}},cross:()=>{{return L$}},create:()=>{{return IQ}},copy:()=>{{return j$}},clone:()=>{{return N$}},ceil:()=>{{return Y$}},bezier:()=>{{return G$}},angle:()=>{{return p$}},add:()=>{{return X$}}});function IQ(){var Q=new S(3);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q}function N$(Q){var $=new S(3);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$}function BQ(Q){var $=Q[0],J=Q[1],U=Q[2];return Math.hypot($,J,U)}function Z$(Q,$,J){var U=new S(3);return U[0]=Q,U[1]=$,U[2]=J,U}function j$(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q}function K$(Q,$,J,U){return Q[0]=$,Q[1]=J,Q[2]=U,Q}function X$(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q}function qQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q}function DQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q[2]=$[2]*J[2],Q}function OQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q[2]=$[2]/J[2],Q}function Y$(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q[2]=Math.ceil($[2]),Q}function H$(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q[2]=Math.floor($[2]),Q}function I$(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q[2]=Math.min($[2],J[2]),Q}function B$(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q[2]=Math.max($[2],J[2]),Q}function q$(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q[2]=Math.round($[2]),Q}function D$(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q}function O$(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q}function RQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2];return Math.hypot(J,U,N)}function EQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2];return J*J+U*U+N*N}function FQ(Q){var $=Q[0],J=Q[1],U=Q[2];return $*$+J*J+U*U}function R$(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q}function E$(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q[2]=1/$[2],Q}function F$(Q,$){var J=$[0],U=$[1],N=$[2],Z=J*J+U*U+N*N;if(Z>0)Z=1/Math.sqrt(Z);return Q[0]=$[0]*Z,Q[1]=$[1]*Z,Q[2]=$[2]*Z,Q}function LQ(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]}function L$(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[0],K=J[1],X=J[2];return Q[0]=N*X-Z*K,Q[1]=Z*j-U*X,Q[2]=U*K-N*j,Q}function V$(Q,$,J,U){var N=$[0],Z=$[1],j=$[2];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q[2]=j+U*(J[2]-j),Q}function A$(Q,$,J,U,N,Z){var j=Z*Z,K=j*(2*Z-3)+1,X=j*(Z-2)+Z,Y=j*(Z-1),I=j*(3-2*Z);return Q[0]=$[0]*K+J[0]*X+U[0]*Y+N[0]*I,Q[1]=$[1]*K+J[1]*X+U[1]*Y+N[1]*I,Q[2]=$[2]*K+J[2]*X+U[2]*Y+N[2]*I,Q}function G$(Q,$,J,U,N,Z){var j=1-Z,K=j*j,X=Z*Z,Y=K*j,I=3*Z*K,q=3*X*j,B=X*Z;return Q[0]=$[0]*Y+J[0]*I+U[0]*q+N[0]*B,Q[1]=$[1]*Y+J[1]*I+U[1]*q+N[1]*B,Q[2]=$[2]*Y+J[2]*I+U[2]*q+N[2]*B,Q}function M$(Q,$){$=$||1;var J=b()*2*Math.PI,U=b()*2-1,N=Math.sqrt(1-U*U)*$;return Q[0]=Math.cos(J)*N,Q[1]=Math.sin(J)*N,Q[2]=U*$,Q}function W$(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[3]*U+J[7]*N+J[11]*Z+J[15];return j=j||1,Q[0]=(J[0]*U+J[4]*N+J[8]*Z+J[12])/j,Q[1]=(J[1]*U+J[5]*N+J[9]*Z+J[13])/j,Q[2]=(J[2]*U+J[6]*N+J[10]*Z+J[14])/j,Q}function _$(Q,$,J){var U=$[0],N=$[1],Z=$[2];return Q[0]=U*J[0]+N*J[3]+Z*J[6],Q[1]=U*J[1]+N*J[4]+Z*J[7],Q[2]=U*J[2]+N*J[5]+Z*J[8],Q}function w$(Q,$,J){var U=J[0],N=J[1],Z=J[2],j=J[3],K=$[0],X=$[1],Y=$[2],I=N*Y-Z*X,q=Z*K-U*Y,B=U*X-N*K,O=N*B-Z*q,R=Z*I-U*B,E=U*q-N*I,D=j*2;return I*=D,q*=D,B*=D,O*=2,R*=2,E*=2,Q[0]=K+I+O,Q[1]=X+q+R,Q[2]=Y+B+E,Q}function T$(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[0],Z[1]=N[1]*Math.cos(U)-N[2]*Math.sin(U),Z[2]=N[1]*Math.sin(U)+N[2]*Math.cos(U),Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function f$(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[2]*Math.sin(U)+N[0]*Math.cos(U),Z[1]=N[1],Z[2]=N[2]*Math.cos(U)-N[0]*Math.sin(U),Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function v$(Q,$,J,U){var N=[],Z=[];return N[0]=$[0]-J[0],N[1]=$[1]-J[1],N[2]=$[2]-J[2],Z[0]=N[0]*Math.cos(U)-N[1]*Math.sin(U),Z[1]=N[0]*Math.sin(U)+N[1]*Math.cos(U),Z[2]=N[2],Q[0]=Z[0]+J[0],Q[1]=Z[1]+J[1],Q[2]=Z[2]+J[2],Q}function p$(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=$[0],j=$[1],K=$[2],X=Math.sqrt(J*J+U*U+N*N),Y=Math.sqrt(Z*Z+j*j+K*K),I=X*Y,q=I&&LQ(Q,$)/I;return Math.acos(Math.min(Math.max(q,-1),1))}function P$(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q}function h$(Q){return"vec3("+Q[0]+", "+Q[1]+", "+Q[2]+")"}function k$(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]}function S$(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=$[0],j=$[1],K=$[2];return Math.abs(J-Z)<=T*Math.max(1,Math.abs(J),Math.abs(Z))&&Math.abs(U-j)<=T*Math.max(1,Math.abs(U),Math.abs(j))&&Math.abs(N-K)<=T*Math.max(1,Math.abs(N),Math.abs(K))}var y$=qQ,z$=DQ,C$=OQ,g$=RQ,m$=EQ,x$=BQ,c$=FQ,d$=function(){var Q=IQ();return function($,J,U,N,Z,j){var K,X;if(!J)J=3;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Q[2]=$[K+2],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1],$[K+2]=Q[2];return $}}();var o={};q0(o,{zero:()=>{{return H8}},transformQuat:()=>{{return Y8}},transformMat4:()=>{{return X8}},subtract:()=>{{return AQ}},sub:()=>{{return D8}},str:()=>{{return I8}},squaredLength:()=>{{return TQ}},squaredDistance:()=>{{return _Q}},sqrLen:()=>{{return V8}},sqrDist:()=>{{return F8}},set:()=>{{return r$}},scaleAndAdd:()=>{{return Q8}},scale:()=>{{return t$}},round:()=>{{return e$}},random:()=>{{return K8}},normalize:()=>{{return U8}},negate:()=>{{return $8}},multiply:()=>{{return GQ}},mul:()=>{{return O8}},min:()=>{{return a$}},max:()=>{{return o$}},lerp:()=>{{return j8}},length:()=>{{return wQ}},len:()=>{{return L8}},inverse:()=>{{return J8}},fromValues:()=>{{return b$}},forEach:()=>{{return A8}},floor:()=>{{return i$}},exactEquals:()=>{{return B8}},equals:()=>{{return q8}},dot:()=>{{return N8}},divide:()=>{{return MQ}},div:()=>{{return R8}},distance:()=>{{return WQ}},dist:()=>{{return E8}},cross:()=>{{return Z8}},create:()=>{{return VQ}},copy:()=>{{return l$}},clone:()=>{{return s$}},ceil:()=>{{return u$}},add:()=>{{return n$}}});function VQ(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0;return Q}function s$(Q){var $=new S(4);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$}function b$(Q,$,J,U){var N=new S(4);return N[0]=Q,N[1]=$,N[2]=J,N[3]=U,N}function l$(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q}function r$(Q,$,J,U,N){return Q[0]=$,Q[1]=J,Q[2]=U,Q[3]=N,Q}function n$(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q[2]=$[2]+J[2],Q[3]=$[3]+J[3],Q}function AQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q[2]=$[2]-J[2],Q[3]=$[3]-J[3],Q}function GQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q[2]=$[2]*J[2],Q[3]=$[3]*J[3],Q}function MQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q[2]=$[2]/J[2],Q[3]=$[3]/J[3],Q}function u$(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q[2]=Math.ceil($[2]),Q[3]=Math.ceil($[3]),Q}function i$(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q[2]=Math.floor($[2]),Q[3]=Math.floor($[3]),Q}function a$(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q[2]=Math.min($[2],J[2]),Q[3]=Math.min($[3],J[3]),Q}function o$(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q[2]=Math.max($[2],J[2]),Q[3]=Math.max($[3],J[3]),Q}function e$(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q[2]=Math.round($[2]),Q[3]=Math.round($[3]),Q}function t$(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q[3]=$[3]*J,Q}function Q8(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q[2]=$[2]+J[2]*U,Q[3]=$[3]+J[3]*U,Q}function WQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2],Z=$[3]-Q[3];return Math.hypot(J,U,N,Z)}function _Q(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1],N=$[2]-Q[2],Z=$[3]-Q[3];return J*J+U*U+N*N+Z*Z}function wQ(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3];return Math.hypot($,J,U,N)}function TQ(Q){var $=Q[0],J=Q[1],U=Q[2],N=Q[3];return $*$+J*J+U*U+N*N}function $8(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q[3]=-$[3],Q}function J8(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q[2]=1/$[2],Q[3]=1/$[3],Q}function U8(Q,$){var J=$[0],U=$[1],N=$[2],Z=$[3],j=J*J+U*U+N*N+Z*Z;if(j>0)j=1/Math.sqrt(j);return Q[0]=J*j,Q[1]=U*j,Q[2]=N*j,Q[3]=Z*j,Q}function N8(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]+Q[3]*$[3]}function Z8(Q,$,J,U){var N=J[0]*U[1]-J[1]*U[0],Z=J[0]*U[2]-J[2]*U[0],j=J[0]*U[3]-J[3]*U[0],K=J[1]*U[2]-J[2]*U[1],X=J[1]*U[3]-J[3]*U[1],Y=J[2]*U[3]-J[3]*U[2],I=$[0],q=$[1],B=$[2],O=$[3];return Q[0]=q*Y-B*X+O*K,Q[1]=-(I*Y)+B*j-O*Z,Q[2]=I*X-q*j+O*N,Q[3]=-(I*K)+q*Z-B*N,Q}function j8(Q,$,J,U){var N=$[0],Z=$[1],j=$[2],K=$[3];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q[2]=j+U*(J[2]-j),Q[3]=K+U*(J[3]-K),Q}function K8(Q,$){$=$||1;var J,U,N,Z,j,K;do J=b()*2-1,U=b()*2-1,j=J*J+U*U;while(j>=1);do N=b()*2-1,Z=b()*2-1,K=N*N+Z*Z;while(K>=1);var X=Math.sqrt((1-j)/K);return Q[0]=$*J,Q[1]=$*U,Q[2]=$*N*X,Q[3]=$*Z*X,Q}function X8(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=$[3];return Q[0]=J[0]*U+J[4]*N+J[8]*Z+J[12]*j,Q[1]=J[1]*U+J[5]*N+J[9]*Z+J[13]*j,Q[2]=J[2]*U+J[6]*N+J[10]*Z+J[14]*j,Q[3]=J[3]*U+J[7]*N+J[11]*Z+J[15]*j,Q}function Y8(Q,$,J){var U=$[0],N=$[1],Z=$[2],j=J[0],K=J[1],X=J[2],Y=J[3],I=Y*U+K*Z-X*N,q=Y*N+X*U-j*Z,B=Y*Z+j*N-K*U,O=-j*U-K*N-X*Z;return Q[0]=I*Y+O*-j+q*-X-B*-K,Q[1]=q*Y+O*-K+B*-j-I*-X,Q[2]=B*Y+O*-X+I*-K-q*-j,Q[3]=$[3],Q}function H8(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0,Q}function I8(Q){return"vec4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}function B8(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]}function q8(Q,$){var J=Q[0],U=Q[1],N=Q[2],Z=Q[3],j=$[0],K=$[1],X=$[2],Y=$[3];return Math.abs(J-j)<=T*Math.max(1,Math.abs(J),Math.abs(j))&&Math.abs(U-K)<=T*Math.max(1,Math.abs(U),Math.abs(K))&&Math.abs(N-X)<=T*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(Z-Y)<=T*Math.max(1,Math.abs(Z),Math.abs(Y))}var D8=AQ,O8=GQ,R8=MQ,E8=WQ,F8=_Q,L8=wQ,V8=TQ,A8=function(){var Q=VQ();return function($,J,U,N,Z,j){var K,X;if(!J)J=4;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Q[2]=$[K+2],Q[3]=$[K+3],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1],$[K+2]=Q[2],$[K+3]=Q[3];return $}}();var l={};q0(l,{zero:()=>{{return n8}},transformMat4:()=>{{return b8}},transformMat3:()=>{{return s8}},transformMat2d:()=>{{return d8}},transformMat2:()=>{{return c8}},subtract:()=>{{return vQ}},sub:()=>{{return e8}},str:()=>{{return u8}},squaredLength:()=>{{return yQ}},squaredDistance:()=>{{return kQ}},sqrLen:()=>{{return UJ}},sqrDist:()=>{{return JJ}},set:()=>{{return _8}},scaleAndAdd:()=>{{return k8}},scale:()=>{{return h8}},round:()=>{{return P8}},rotate:()=>{{return l8}},random:()=>{{return x8}},normalize:()=>{{return z8}},negate:()=>{{return S8}},multiply:()=>{{return pQ}},mul:()=>{{return t8}},min:()=>{{return v8}},max:()=>{{return p8}},lerp:()=>{{return m8}},length:()=>{{return SQ}},len:()=>{{return o8}},inverse:()=>{{return y8}},fromValues:()=>{{return M8}},forEach:()=>{{return NJ}},floor:()=>{{return f8}},exactEquals:()=>{{return i8}},equals:()=>{{return a8}},dot:()=>{{return C8}},divide:()=>{{return PQ}},div:()=>{{return QJ}},distance:()=>{{return hQ}},dist:()=>{{return $J}},cross:()=>{{return g8}},create:()=>{{return fQ}},copy:()=>{{return W8}},clone:()=>{{return G8}},ceil:()=>{{return T8}},angle:()=>{{return r8}},add:()=>{{return w8}}});function fQ(){var Q=new S(2);if(S!=Float32Array)Q[0]=0,Q[1]=0;return Q}function G8(Q){var $=new S(2);return $[0]=Q[0],$[1]=Q[1],$}function M8(Q,$){var J=new S(2);return J[0]=Q,J[1]=$,J}function W8(Q,$){return Q[0]=$[0],Q[1]=$[1],Q}function _8(Q,$,J){return Q[0]=$,Q[1]=J,Q}function w8(Q,$,J){return Q[0]=$[0]+J[0],Q[1]=$[1]+J[1],Q}function vQ(Q,$,J){return Q[0]=$[0]-J[0],Q[1]=$[1]-J[1],Q}function pQ(Q,$,J){return Q[0]=$[0]*J[0],Q[1]=$[1]*J[1],Q}function PQ(Q,$,J){return Q[0]=$[0]/J[0],Q[1]=$[1]/J[1],Q}function T8(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q}function f8(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q}function v8(Q,$,J){return Q[0]=Math.min($[0],J[0]),Q[1]=Math.min($[1],J[1]),Q}function p8(Q,$,J){return Q[0]=Math.max($[0],J[0]),Q[1]=Math.max($[1],J[1]),Q}function P8(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q}function h8(Q,$,J){return Q[0]=$[0]*J,Q[1]=$[1]*J,Q}function k8(Q,$,J,U){return Q[0]=$[0]+J[0]*U,Q[1]=$[1]+J[1]*U,Q}function hQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1];return Math.hypot(J,U)}function kQ(Q,$){var J=$[0]-Q[0],U=$[1]-Q[1];return J*J+U*U}function SQ(Q){var $=Q[0],J=Q[1];return Math.hypot($,J)}function yQ(Q){var $=Q[0],J=Q[1];return $*$+J*J}function S8(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q}function y8(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q}function z8(Q,$){var J=$[0],U=$[1],N=J*J+U*U;if(N>0)N=1/Math.sqrt(N);return Q[0]=$[0]*N,Q[1]=$[1]*N,Q}function C8(Q,$){return Q[0]*$[0]+Q[1]*$[1]}function g8(Q,$,J){var U=$[0]*J[1]-$[1]*J[0];return Q[0]=Q[1]=0,Q[2]=U,Q}function m8(Q,$,J,U){var N=$[0],Z=$[1];return Q[0]=N+U*(J[0]-N),Q[1]=Z+U*(J[1]-Z),Q}function x8(Q,$){$=$||1;var J=b()*2*Math.PI;return Q[0]=Math.cos(J)*$,Q[1]=Math.sin(J)*$,Q}function c8(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[2]*N,Q[1]=J[1]*U+J[3]*N,Q}function d8(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[2]*N+J[4],Q[1]=J[1]*U+J[3]*N+J[5],Q}function s8(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[3]*N+J[6],Q[1]=J[1]*U+J[4]*N+J[7],Q}function b8(Q,$,J){var U=$[0],N=$[1];return Q[0]=J[0]*U+J[4]*N+J[12],Q[1]=J[1]*U+J[5]*N+J[13],Q}function l8(Q,$,J,U){var N=$[0]-J[0],Z=$[1]-J[1],j=Math.sin(U),K=Math.cos(U);return Q[0]=N*K-Z*j+J[0],Q[1]=N*j+Z*K+J[1],Q}function r8(Q,$){var J=Q[0],U=Q[1],N=$[0],Z=$[1],j=Math.sqrt(J*J+U*U)*Math.sqrt(N*N+Z*Z),K=j&&(J*N+U*Z)/j;return Math.acos(Math.min(Math.max(K,-1),1))}function n8(Q){return Q[0]=0,Q[1]=0,Q}function u8(Q){return"vec2("+Q[0]+", "+Q[1]+")"}function i8(Q,$){return Q[0]===$[0]&&Q[1]===$[1]}function a8(Q,$){var J=Q[0],U=Q[1],N=$[0],Z=$[1];return Math.abs(J-N)<=T*Math.max(1,Math.abs(J),Math.abs(N))&&Math.abs(U-Z)<=T*Math.max(1,Math.abs(U),Math.abs(Z))}var o8=SQ,e8=vQ,t8=pQ,QJ=PQ,$J=hQ,JJ=kQ,UJ=yQ,NJ=function(){var Q=fQ();return function($,J,U,N,Z,j){var K,X;if(!J)J=2;if(!U)U=0;if(N)X=Math.min(N*J+U,$.length);else X=$.length;for(K=U;K<X;K+=J)Q[0]=$[K],Q[1]=$[K+1],Z(Q,Q,j),$[K]=Q[0],$[K+1]=Q[1];return $}}();var X0={X:0,Y:1,Z:2};class M0{_isActivated=!1;_theta=0;_phi=0;_mouseSensibility;_keyboardSensibility;_touchSensibility;_movingSpeed;_touchWasActive=!1;_touchStartTime=0;_touchMoveForward=!1;_axisIndices;_position=V.fromValues(0,0,0);_target=V.fromValues(0,0,0);_forwardAxis=V.fromValues(1,0,0);_leftAxis=V.fromValues(0,0,1);_upAxis=V.fromValues(0,1,0);constructor(Q){this._mouseSensibility=Q.mouseSensibility,this._keyboardSensibility=Q.keyboardSensibility,this._touchSensibility=Q.touchSensibility,this._movingSpeed=Q.movingSpeed,V.copy(this._position,Q.position),this._axisIndices=[Q.coordinates?X0[Q.coordinates[0]]:X0.X,Q.coordinates?X0[Q.coordinates[1]]:X0.Y,Q.coordinates?X0[Q.coordinates[2]]:X0.Z],this._theta=Q.theta,this._phi=Q.phi}isActivated(){return this._isActivated}update(Q,$){let J=!1,U=!1,N=!1,Z=!1,j=0,K=0;const X=Math.PI/180;{const f=t.deltaX()*this._mouseSensibility,v=t.deltaY()*this._mouseSensibility;j-=f*X,K-=v*X}const Y=s.getTouchData().length>0;if(Y){if(!this._touchWasActive){const P=Date.now();if((P-this._touchStartTime)/1000<0.25)this._touchMoveForward=!0;else this._touchStartTime=P}const f=s.getTouchData()[0],v=f.deltaX*this._touchSensibility,p=f.deltaY*this._touchSensibility;j-=v*X,K-=p*X}else this._touchMoveForward=!1;if(this._touchWasActive=Y,this._touchMoveForward)J=!0;const I=this._movingSpeed*Q,q=V.fromValues(0,0,0);V.scale(q,this._forwardAxis,I);const B=V.fromValues(0,0,0);if(V.scale(B,this._leftAxis,I),C.isPressed("Z","W"))J=!0;if(C.isPressed("S"))U=!0;if(C.isPressed("A","Q"))N=!0;if(C.isPressed("D"))Z=!0;const O=this._keyboardSensibility*Q;if(C.isPressed("ArrowUp"))K+=O;else if(C.isPressed("ArrowDown"))K-=O;if(C.isPressed("ArrowLeft"))j+=O;else if(C.isPressed("ArrowRight"))j-=O;this._theta+=j,this._phi+=K;const R=Math.PI*0.5,E=R*0.95;this._phi=Math.min(Math.max(this._phi,-E),+E);const D=Math.cos(this._theta),F=Math.sin(this._theta),[_,L,A]=this._axisIndices,M=Math.cos(this._phi+R);this._upAxis[_]=M*D,this._upAxis[L]=M*F,this._upAxis[A]=Math.sin(this._phi+R);const G=Math.cos(this._phi);if(this._forwardAxis[_]=G*D,this._forwardAxis[L]=G*F,this._forwardAxis[A]=Math.sin(this._phi),V.cross(this._leftAxis,this._upAxis,this._forwardAxis),J)V.add(this._position,this._position,q);else if(U)V.sub(this._position,this._position,q);if(N)V.add(this._position,this._position,B);else if(Z)V.sub(this._position,this._position,B);V.add(this._target,this._position,this._forwardAxis)}getPosition(){return this._position}setPosition(Q){V.copy(this._position,Q)}getTarget(){return this._target}getForwardAxis(){return this._forwardAxis}getLeftAxis(){return this._leftAxis}getUpAxis(){return this._upAxis}getTheta(){return this._theta}getPhi(){return this._phi}getTouchMoveForward(){return this._touchMoveForward}}class Y0{_hashSet=new Set;clear(){this._hashSet.clear()}add(Q){this._hashSet.add(Y0._getName(Q))}delete(Q){this._hashSet.delete(Y0._getName(Q))}has(Q){this._hashSet.has(Y0._getName(Q))}static _getName(Q){return`${Q[0]}/${Q[1]}/${Q[2]}`}}class W0{_unusedWorkers=[];_inUseWorkers=[];_onWorkerResult;constructor(Q){this._onWorkerResult=Q}areAllWorkerAvailable(){return this._inUseWorkers.length===0}isWorkerAvailable(){return this._unusedWorkers.length>0}getInUseWorkersData(){return this._inUseWorkers.map((Q)=>Q.data)}pushTask(Q){if(!this.isWorkerAvailable())return!1;const $=this._unusedWorkers.pop();return this._inUseWorkers.push($),Q($.data,(J,U)=>{$.instance.postMessage(J,U)}),!0}addOneWorker(Q,$){const J={instance:new Worker(Q),data:$};this._unusedWorkers.push(J);const U=(N)=>{const Z=this._inUseWorkers.indexOf(J);if(Z>=0)this._unusedWorkers.push(J),this._inUseWorkers.splice(Z,1);this._onWorkerResult(J.data,N.data)};J.instance.addEventListener("message",U,!1)}}class _0{_def;_cameraPosition=V.fromValues(0,0,0);_chunkPositionQueue=[];_savedIndex=[999,999,999];_unusedChunks=[];_usedChunks=[];_usedSet=new Y0;constructor(Q){this._def=Q}clear(){this._chunkPositionQueue.length=0,this._unusedChunks.forEach((Q)=>this._def.releaseGeometry(Q.geometry)),this._unusedChunks.length=0,this._usedChunks.forEach((Q)=>this._def.releaseGeometry(Q.geometry)),this._usedChunks.length=0,this._usedSet.clear()}isEmpty(){return this._usedChunks.length===0}isNotDone(){return this._chunkPositionQueue.length>0}getChunks(){return this._usedChunks}pushNew(Q,$,J,U,N){const Z=this._def.acquireGeometry(U);if(this._unusedChunks.length===0)this._usedChunks.push({realPosition:[...$],indexPosition:[...Q],geometry:Z,isVisible:!1,isDirty:!0,geometryFloat32buffer:new Float32Array(J.slice(0,N)),geometryBufferSizeUsed:N});else{const j=this._unusedChunks.pop();j.realPosition=[...$],j.indexPosition=[...Q],j.isVisible=!1,j.isDirty=!0,j.geometryFloat32buffer=new Float32Array(J.slice(0,N)),j.geometryBufferSizeUsed=N,this._usedChunks.push(j)}this._usedSet.add(Q),this._def.onChunkCreated()}update(Q,$){this._updateGeneration(Q,$);for(let J of this._usedChunks){const U=this._def.chunkIsVisible(J.realPosition);J.isVisible=U}for(let J of this._usedChunks){if(!J.isVisible||!J.isDirty)continue;J.geometry.update(J.realPosition,this._def.chunkGraphicSize,J.geometryFloat32buffer,J.geometryBufferSizeUsed),J.isDirty=!1;break}}_updateGeneration(Q,$){V.copy(this._cameraPosition,Q);const J=[Math.floor(Q[0]/this._def.chunkGraphicSize),Math.floor(Q[1]/this._def.chunkGraphicSize),Math.floor(Q[2]/this._def.chunkGraphicSize)];let U=!1;if(this._usedChunks.length===0&&$.areAllWorkerAvailable())U=!0;if(!U&&!V.exactEquals(J,this._savedIndex))U=!0;if(U===!1)return;V.copy(this._savedIndex,J),this._chunkPositionQueue.length=0;const{chunkGenerationRange:N}=this._def,Z=[Math.floor(J[0]-N),Math.floor(J[1]-N),Math.floor(J[2]-N)],j=[Math.floor(J[0]+N),Math.floor(J[1]+N),Math.floor(J[2]+N)];for(let X=0;X<this._usedChunks.length;){const{indexPosition:Y}=this._usedChunks[X];if(Y[0]<Z[0]||Y[0]>j[0]||Y[1]<Z[1]||Y[1]>j[1]||Y[2]<Z[2]||Y[2]>j[2]){this._def.releaseGeometry(this._usedChunks[X].geometry);const q=this._usedChunks.splice(X,1);this._unusedChunks.push(q[0]),this._usedSet.delete(Y),this._def.onChunkDiscarded()}else++X}const K=[0,0,0];for(K[2]=Z[2];K[2]<=j[2];++K[2])for(K[1]=Z[1];K[1]<=j[1];++K[1])for(K[0]=Z[0];K[0]<=j[0];++K[0]){if(this._usedChunks.findIndex((Y)=>{return this._usedSet.has(Y.indexPosition)})>=0)return;if($.getInUseWorkersData().findIndex((Y)=>{return V.exactEquals(Y.processing.indexPosition,K)})>=0)return;this._chunkPositionQueue.push({indexPosition:[...K],realPosition:[K[0]*this._def.chunkGraphicSize,K[1]*this._def.chunkGraphicSize,K[2]*this._def.chunkGraphicSize]})}}getBestNextChunkPosition(){if(this._chunkPositionQueue.length===0)return;const Q=(U)=>{const N=this._def.chunkGraphicSize*0.5,Z=[this._cameraPosition[0]-(U[0]+N),this._cameraPosition[1]-(U[1]+N),this._cameraPosition[2]-(U[2]+N)];return V.length(Z)};let $=-1,J=-1;for(let U=0;U<this._chunkPositionQueue.length;++U){const{realPosition:N}=this._chunkPositionQueue[U];if(!this._def.chunkIsVisible(N))continue;const Z=Q(N);if(J>=0&&J<Z)continue;$=U,J=Z}if($<0)return;return this._chunkPositionQueue.splice($,1)[0]}}class D0{_framesDelta=[];_averageDelta=0;_minDelta=0;_maxDelta=0;pushDelta(Q){if(this._framesDelta.length>=100)this._framesDelta.shift();this._framesDelta.push(Q),this._minDelta=999999999,this._maxDelta=-999999999,this._averageDelta=0;for(let $ of this._framesDelta)this._minDelta=Math.min(this._minDelta,$),this._maxDelta=Math.max(this._maxDelta,$),this._averageDelta+=$;this._averageDelta/=this._framesDelta.length}get framesDelta(){return this._framesDelta}get averageDelta(){return this._averageDelta}get minDelta(){return this._minDelta}get maxDelta(){return this._maxDelta}}class w0{_def;_geometryBufferSize;_dataBufferSize;_running=!1;_chunkManager;_workerManager;_frameProfiler=new D0;constructor(Q){this._def=Q,this._chunkManager=new _0({chunkGraphicSize:Q.chunkGraphicSize,chunkGenerationRange:Q.chunkGenerationRange,chunkLogicSize:Q.chunkLogicSize,chunkIsVisible:Q.chunkIsVisible,acquireGeometry:Q.acquireGeometry,releaseGeometry:Q.releaseGeometry,onChunkCreated:Q.onChunkCreated,onChunkDiscarded:Q.onChunkDiscarded});const $=(J,U)=>{const{indexPosition:N,realPosition:Z,geometryFloat32buffer:j,geometryBufferSize:K,sizeUsed:X}=U,I=Date.now()-U.time;if(this._frameProfiler.pushDelta(I),J.geometryFloat32buffer=j,J.processing=void 0,!this._running)return;this._chunkManager.pushNew(N,Z,J.geometryFloat32buffer,K,X),this._launchWorker()};this._workerManager=new W0($),this._dataBufferSize=Math.pow(this._def.chunkLogicSize+1+1,3),this._geometryBufferSize=this._dataBufferSize*20*6*3;for(let J=0;J<this._def.workerTotal;++J)this._workerManager.addOneWorker(this._def.workerFile,{geometryFloat32buffer:new Float32Array(this._geometryBufferSize)})}start(){this._running=!0}stop(){if(!this._running)return;this._running=!1,this._chunkManager.clear()}update(Q){if(!this._running)return;this._chunkManager.update(Q,this._workerManager),this._launchWorker()}_launchWorker(){while(this._chunkManager.isNotDone()&&this._workerManager.isWorkerAvailable()){const Q=this._chunkManager.getBestNextChunkPosition();if(!Q)break;this._workerManager.pushTask(($,J)=>{$.processing=Q;const U={realPosition:Q.realPosition,indexPosition:Q.indexPosition,geometryFloat32buffer:$.geometryFloat32buffer,geometryBufferSize:this._geometryBufferSize,sizeUsed:0,time:Date.now()},N=[$.geometryFloat32buffer.buffer];J(U,N)})}}getChunks(){return this._chunkManager.getChunks()}getFrameProfiler(){return this._frameProfiler}getProcessingRealPositions(){return this._workerManager.getInUseWorkersData().map((Q)=>Q.processing.realPosition)}}var $0;(function(j){j[j["Right"]=0]="Right";j[j["Left"]=1]="Left";j[j["Bottom"]=2]="Bottom";j[j["Top"]=3]="Top";j[j["Back"]=4]="Back";j[j["Front"]=5]="Front"})($0||($0={}));class T0{_frustum=new Float32Array(24);_setPlane(Q,$,J,U){const N=Q*4;this._frustum[N+0]=$[0]+J[0]*U,this._frustum[N+1]=$[1]+J[1]*U,this._frustum[N+2]=$[2]+J[2]*U,this._frustum[N+3]=$[3]+J[3]*U;const Z=Math.sqrt(this._frustum[N+0]*this._frustum[N+0]+this._frustum[N+1]*this._frustum[N+1]+this._frustum[N+2]*this._frustum[N+2]);if(Z===0)return;this._frustum[N+0]/=Z,this._frustum[N+1]/=Z,this._frustum[N+2]/=Z,this._frustum[N+3]/=Z}calculateFrustum(Q,$){const J=y.multiply(y.create(),Q,$),U=o.fromValues(J[0],J[4],J[8],J[12]),N=o.fromValues(J[1],J[5],J[9],J[13]),Z=o.fromValues(J[2],J[6],J[10],J[14]),j=o.fromValues(J[3],J[7],J[11],J[15]);this._setPlane($0.Right,j,U,-1),this._setPlane($0.Left,j,U,1),this._setPlane($0.Bottom,j,N,1),this._setPlane($0.Top,j,N,-1),this._setPlane($0.Back,j,Z,-1),this._setPlane($0.Front,j,Z,1)}sphereInFrustum(Q,$,J,U){for(let N=0;N<6;++N){const Z=N*4;if(this._frustum[Z+0]*Q+this._frustum[Z+1]*$+this._frustum[Z+2]*J+this._frustum[Z+3]<=-U)return!1}return!0}pointInFrustum(Q,$,J){return this.sphereInFrustum(Q,$,J,0)}cubeInFrustumVec3(Q,$){return this.cubeInFrustum(Q[0],Q[1],Q[2],$)}cubeInFrustum(Q,$,J,U){const N=U*0.5,Z=Q-N,j=$-N,K=J-N,X=Q+N,Y=$+N,I=J+N;for(let q=0;q<6;++q){const B=q*4,O=this._frustum[B+0],R=this._frustum[B+1],E=this._frustum[B+2],D=this._frustum[B+3];if(O*Z+R*j+E*K+D>0||O*X+R*j+E*K+D>0||O*Z+R*Y+E*K+D>0||O*X+R*Y+E*K+D>0||O*Z+R*j+E*I+D>0||O*X+R*j+E*I+D>0||O*Z+R*Y+E*I+D>0||O*X+R*Y+E*I+D>0)continue;return!1}return!0}}var n;(function(J){J[J["perspective"]=0]="perspective";J[J["orthogonal"]=1]="orthogonal"})(n||(n={}));class H0{_projectionType=n.perspective;_perspectiveData;_orthogonalData;_viewportPos=l.fromValues(0,0);_viewportSize=l.fromValues(0,0);_projectionMatrix=y.create();_viewMatrix=y.create();_composedMatrix=y.create();_eye=V.fromValues(0,0,0);_target=V.fromValues(0,0,0);_upAxis=V.fromValues(0,0,0);setAsPerspective(Q){this._projectionType=n.perspective;let $=Q.aspectRatio;if($===void 0)$=this._viewportSize[0]/this._viewportSize[1];this._perspectiveData={fovy:Q.fovy,aspectRatio:$,near:Q.near,far:Q.far}}setAsOrthogonal(Q){this._projectionType=n.orthogonal,this._orthogonalData={...Q}}setViewportPos(Q,$){this._viewportPos[0]=Q,this._viewportPos[1]=$}getViewportPos(){return this._viewportPos}setViewportSize(Q,$){if(this._viewportSize[0]=Q,this._viewportSize[1]=$,this._projectionType!==n.perspective&&this._perspectiveData)this._perspectiveData.aspectRatio=this._viewportSize[0]/this._viewportSize[1]}getViewportSize(){return this._viewportSize}lookAt(Q,$,J){V.copy(this._eye,Q),V.copy(this._target,$),V.copy(this._upAxis,J)}setEye(Q){V.copy(this._eye,Q)}setTarget(Q){V.copy(this._target,Q)}setUpAxis(Q){V.copy(this._upAxis,Q)}getEye(){return this._eye}getTarget(){return this._target}getUpAxis(){return this._upAxis}computeMatrices(){if(this._projectionType===n.perspective){const{fovy:Q,aspectRatio:$,near:J,far:U}=this._perspectiveData;y.perspective(this._projectionMatrix,Q,$,J,U)}else if(this._projectionType===n.orthogonal){const{left:Q,right:$,top:J,bottom:U,near:N,far:Z}=this._orthogonalData;y.ortho(this._projectionMatrix,Q,$,J,U,N,Z)}y.lookAt(this._viewMatrix,this._eye,this._target,this._upAxis),this.computeComposedMatrix()}computeComposedMatrix(){y.multiply(this._composedMatrix,this._projectionMatrix,this._viewMatrix)}setProjectionMatrix(Q){y.copy(this._projectionMatrix,Q)}setViewMatrix(Q){y.copy(this._viewMatrix,Q)}setComposedMatrix(Q){y.copy(this._composedMatrix,Q)}getProjectionMatrix(){return this._projectionMatrix}getViewMatrix(){return this._viewMatrix}getComposedMatrix(){return this._composedMatrix}getPerspectiveData(){if(this._projectionType!==n.perspective)throw new Error("not a perspective projection");return this._perspectiveData}getOrthogonalData(){if(this._projectionType!==n.orthogonal)throw new Error("not an orthogonal projection");return this._orthogonalData}}var zQ=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;
uniform float u_sceneScale;
uniform float u_tileRepeat;

in vec3 a_vertex_position;
in vec3 a_vertex_normal;
in vec3 a_offset_origin;

out vec3 v_chunkSpacePosition;
out vec3 v_worldSpacePosition;
out vec3 v_worldSpaceNormal;

void main(void)
{
  vec3 chunkSpacePosition = a_vertex_position * u_sceneScale;

  v_chunkSpacePosition = a_vertex_position * u_tileRepeat;
  v_worldSpacePosition = a_offset_origin + chunkSpacePosition;
  v_worldSpaceNormal = a_vertex_normal;

  gl_Position = u_composedMatrix * vec4(v_worldSpacePosition, 1.0);
}
`.trim();var CQ=`
#version 300 es

precision lowp float;

const float k_ambiantCoef = 0.1;
const vec3 k_specColor = vec3(1.0, 1.0, 1.0);

uniform sampler2D u_texture_dirt;
uniform sampler2D u_texture_grass;
uniform sampler2D u_texture_stoneWall;
uniform sampler2D u_texture_stoneWallBump;
uniform vec3 u_eyePosition;

in vec3 v_chunkSpacePosition;
in vec3 v_worldSpacePosition;
in vec3 v_worldSpaceNormal;

out vec4 o_color;

vec4 _getColorValue()
{

  // current 3d texture coordinate
  vec3 flooredPos = vec3(
    v_chunkSpacePosition.x - floor(v_chunkSpacePosition.x),
    v_chunkSpacePosition.y - floor(v_chunkSpacePosition.y),
    v_chunkSpacePosition.z - floor(v_chunkSpacePosition.z)
  );

  vec3 blendWeights = abs( normalize( v_worldSpaceNormal.xyz ) );
  blendWeights = max( ( blendWeights - 0.2 ) * 7.0, 0.0 );
  blendWeights /= ( blendWeights.x + blendWeights.y + blendWeights.z );

  // horizontal texture coordinates -> should be a wall
  vec2 texCoordX = vec2(flooredPos.y, flooredPos.z);
  vec2 texCoordY = vec2(flooredPos.x, flooredPos.z);

  // vertical texture coord -> should be green grass
  vec2 texCoordZ = vec2(flooredPos.x, flooredPos.y);

  // horizontal color
  vec3 texColorX = texture( u_texture_stoneWall, texCoordX ).rgb;
  vec3 texColorY = texture( u_texture_stoneWall, texCoordY ).rgb;

  float specularRatioX = texture( u_texture_stoneWallBump, texCoordX ).r * blendWeights.x;
  float specularRatioY = texture( u_texture_stoneWallBump, texCoordY ).r * blendWeights.y;
  float specularRatio = max( specularRatioX, specularRatioY );

  // vertical color
  vec3 texColorZ = vec3(0.0);
  if (v_worldSpaceNormal.z < 0.0)
  {
    texColorZ = texture( u_texture_dirt, texCoordZ ).rgb;
  }
  else
  {
    texColorZ = texture( u_texture_grass, texCoordZ ).rgb;
  }

  return vec4(
    texColorX * blendWeights.xxx +
    texColorY * blendWeights.yyy +
    texColorZ * blendWeights.zzz,
    specularRatio
  );
}

vec3 _getLightColor(vec4 currentColor)
{
  vec3 normal = normalize(v_worldSpaceNormal);
  vec3 lightDir = normalize(u_eyePosition - v_worldSpacePosition);

  float diffuseCoef = max(dot(lightDir,v_worldSpaceNormal.xyz), 0.0);
  float specularCoef = 0.0;

  if (diffuseCoef > 0.0)
  {
    // specular

    vec3 reflectDir = reflect(-lightDir, normal);
    vec3 viewDir = normalize(u_eyePosition - v_worldSpacePosition);

    float specAngle = max(dot(reflectDir, viewDir), 0.0);
    specularCoef = pow(specAngle, 16.0);
  }

  vec3 diffuseColor = currentColor.rgb * (k_ambiantCoef + diffuseCoef);
  vec3 specularColor = k_specColor * specularCoef * currentColor.a;

  return diffuseColor + specularColor;
}

void main(void)
{
  o_color = vec4(_getLightColor(_getColorValue()), 1.0);
}
`.trim();class gQ{_origin=V.fromValues(0,0,0);_size=0;_geometry;constructor(Q,$,J){this._geometry=new h.Geometry(Q,$),this._geometry.setFloatBufferSize(0,J)}update(Q,$,J,U){V.copy(this._origin,Q),this._size=$,this._geometry.updateBuffer(0,J,U),this._geometry.setPrimitiveCount(U/6);const N=new Float32Array([Q[0],Q[1],Q[2]]);this._geometry.updateBuffer(1,N,N.length),this._geometry.setInstancedCount(1)}render(){this._geometry.render()}getOrigin(){return this._origin}getSize(){return this._size}}class f0{_shader;_textureDirt=new x;_textureGrass=new x;_textureStoneWall=new x;_textureStoneWallBump=new x;_geometryDefinition;_unusedGeometries=[];_inUseGeometries=[];constructor(){this._shader=new m("ChunksRenderer",{vertexSrc:zQ,fragmentSrc:CQ,attributes:["a_vertex_position","a_vertex_normal","a_offset_origin"],uniforms:["u_composedMatrix","u_eyePosition","u_sceneScale","u_tileRepeat","u_texture_dirt","u_texture_grass","u_texture_stoneWall","u_texture_stoneWallBump"]});const Q=new h.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_normal","vec3f").setStride(24).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_origin","vec3f").setStride(12),this._geometryDefinition=Q.getDef()}async initialize(){const Q=await Promise.all([x.getImageFromUrl("assets/dirt.png"),x.getImageFromUrl("assets/grass.png"),x.getImageFromUrl("assets/stone-wall.png"),x.getImageFromUrl("assets/stone-wall-bump.png")]);this._textureDirt.initialize(),this._textureGrass.initialize(),this._textureStoneWall.initialize(),this._textureStoneWallBump.initialize(),this._textureDirt.bind(($)=>$.load(Q[0])),this._textureGrass.bind(($)=>$.load(Q[1])),this._textureStoneWall.bind(($)=>$.load(Q[2])),this._textureStoneWallBump.bind(($)=>$.load(Q[3]))}acquireGeometry(Q){if(this._unusedGeometries.length>0){const J=this._unusedGeometries.pop();return this._inUseGeometries.push(J),J}const $=new gQ(this._shader,this._geometryDefinition,Q);return this._inUseGeometries.push($),$}releaseGeometry(Q){const $=this._inUseGeometries.indexOf(Q);if($<0)return;this._unusedGeometries.push(Q),this._inUseGeometries.splice($,1)}render(Q,$,J){const U=Q.getEye();this._shader.bind((N)=>{N.setMatrix4Uniform("u_composedMatrix",Q.getComposedMatrix()),N.setFloat3Uniform("u_eyePosition",U[0],U[1],U[2]),N.setFloat1Uniform("u_sceneScale",J),N.setFloat1Uniform("u_tileRepeat",2),N.setTextureUniform("u_texture_dirt",this._textureDirt,0),N.setTextureUniform("u_texture_grass",this._textureGrass,1),N.setTextureUniform("u_texture_stoneWall",this._textureStoneWall,2),N.setTextureUniform("u_texture_stoneWallBump",this._textureStoneWallBump,3),this._inUseGeometries.map((j)=>{const X=j.getSize()*0.5,Y=j.getOrigin()[0]+X,I=j.getOrigin()[1]+X,q=j.getOrigin()[2]+X;return{geometry:j,center:[Y,I,q],distance:0}}).filter(({center:j,geometry:K})=>$.cubeInFrustumVec3(j,K.getSize())).map((j)=>{return j.distance=V.distance(j.center,Q.getEye()),j}).sort((j,K)=>j.distance-K.distance).forEach((j)=>j.geometry.render())})}}var mQ=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3  a_vertex_position;

in vec3  a_offset_center;
in float a_offset_scale;
in vec4  a_offset_color;

flat out vec4 v_color;

void main(void)
{
  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_color = a_offset_color;
}
`.trim();var xQ=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 out_color;

void main(void)
{
  out_color = v_color;
}
`.trim();var d=(Q,$)=>{const J=[],U=$[0]*0.5,N=$[1]*0.5,Z=$[2]*0.5,j=[[Q[0]-U,Q[1]-N,Q[2]-Z],[Q[0]+U,Q[1]-N,Q[2]-Z],[Q[0]-U,Q[1]+N,Q[2]-Z],[Q[0]+U,Q[1]+N,Q[2]-Z],[Q[0]-U,Q[1]-N,Q[2]+Z],[Q[0]+U,Q[1]-N,Q[2]+Z],[Q[0]-U,Q[1]+N,Q[2]+Z],[Q[0]+U,Q[1]+N,Q[2]+Z]],K=[];K.push(0,2,1),K.push(2,3,1),K.push(4,5,6),K.push(6,5,7),K.push(1,3,5),K.push(5,3,7),K.push(0,4,2),K.push(4,6,2),K.push(2,6,3),K.push(6,7,3),K.push(0,1,4),K.push(4,1,5);for(let X of K)J.push(j[X]);return J},ZJ=(Q)=>{const U=[...d([Q*-0.4990234375,Q*-0.4990234375,0],[0.001953125,0.001953125,1]),...d([Q*0.4990234375,Q*-0.4990234375,0],[0.001953125,0.001953125,1]),...d([Q*0.4990234375,Q*0.4990234375,0],[0.001953125,0.001953125,1]),...d([Q*-0.4990234375,Q*0.4990234375,0],[0.001953125,0.001953125,1]),...d([Q*-0.4990234375,0,Q*-0.4990234375],[0.001953125,1,0.001953125]),...d([Q*0.4990234375,0,Q*-0.4990234375],[0.001953125,1,0.001953125]),...d([Q*0.4990234375,0,Q*0.4990234375],[0.001953125,1,0.001953125]),...d([Q*-0.4990234375,0,Q*0.4990234375],[0.001953125,1,0.001953125]),...d([0,Q*-0.4990234375,Q*-0.4990234375],[1,0.001953125,0.001953125]),...d([0,Q*0.4990234375,Q*-0.4990234375],[1,0.001953125,0.001953125]),...d([0,Q*0.4990234375,Q*0.4990234375],[1,0.001953125,0.001953125]),...d([0,Q*-0.4990234375,Q*0.4990234375],[1,0.001953125,0.001953125])],N=[];return U.forEach((Z)=>{N.push(Z[0],Z[1],Z[2])}),N},cQ=32768;class v0{_shader;_geometry;_buffer=new Float32Array(cQ);_currentSize=0;constructor(){this._shader=new m("TriangleCubesRenderer",{vertexSrc:mQ,fragmentSrc:xQ,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});const Q=new h.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(12).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(32);const $=ZJ(1);this._geometry=new h.Geometry(this._shader,Q.getDef()),this._geometry.updateBuffer(0,$,$.length),this._geometry.setPrimitiveCount($.length/3),this._geometry.setFloatBufferSize(1,cQ)}pushCenteredCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;this._buffer[this._currentSize++]=Q[0],this._buffer[this._currentSize++]=Q[1],this._buffer[this._currentSize++]=Q[2],this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}pushOriginBoundCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;const U=$*0.5;this._buffer[this._currentSize++]=Q[0]+U,this._buffer[this._currentSize++]=Q[1]+U,this._buffer[this._currentSize++]=Q[2]+U,this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}flush(Q){if(this._currentSize<=0)return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q.getComposedMatrix()),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear()}clear(){this._currentSize=0}}var dQ=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3 a_vertex_position;
in vec4 a_vertex_color;

flat out vec4 v_color;

void main(void)
{
  gl_Position = u_composedMatrix * vec4(a_vertex_position, 1.0);

  v_color = a_vertex_color;
}
`.trim();var sQ=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 o_color;

void main(void)
{
  o_color = v_color;
}
`.trim();var bQ=14336;class p0{_geometry;_buffer=new Float32Array(bQ);_currentSize=0;constructor(Q,$){const J={...$,primitiveType:h.PrimitiveType.lines};this._geometry=new h.Geometry(Q,J),this._geometry.setFloatBufferSize(0,bQ)}pushLine(Q,$,J){if(this._currentSize+14>=this._buffer.length)return;const U=J[3]??1;this._buffer[this._currentSize+0]=Q[0],this._buffer[this._currentSize+1]=Q[1],this._buffer[this._currentSize+2]=Q[2],this._buffer[this._currentSize+3]=J[0],this._buffer[this._currentSize+4]=J[1],this._buffer[this._currentSize+5]=J[2],this._buffer[this._currentSize+6]=U,this._currentSize+=7,this._buffer[this._currentSize+0]=$[0],this._buffer[this._currentSize+1]=$[1],this._buffer[this._currentSize+2]=$[2],this._buffer[this._currentSize+3]=J[0],this._buffer[this._currentSize+4]=J[1],this._buffer[this._currentSize+5]=J[2],this._buffer[this._currentSize+6]=U,this._currentSize+=7}canRender(){return this._currentSize>0}flush(){if(!this.canRender())return;this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear()}clear(){this._currentSize=0}}var lQ=7168;class P0{_geometry;_buffer=new Float32Array(lQ);_currentSize=0;constructor(Q,$){const J={...$,primitiveType:h.PrimitiveType.triangles};this._geometry=new h.Geometry(Q,J),this._geometry.setFloatBufferSize(0,lQ)}pushTriangle(Q,$,J,U){if(this._currentSize+42>=this._buffer.length)return;const N=U[3]??1;this._buffer[this._currentSize+0]=Q[0],this._buffer[this._currentSize+1]=Q[1],this._buffer[this._currentSize+2]=Q[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7,this._buffer[this._currentSize+0]=$[0],this._buffer[this._currentSize+1]=$[1],this._buffer[this._currentSize+2]=$[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7,this._buffer[this._currentSize+0]=J[0],this._buffer[this._currentSize+1]=J[1],this._buffer[this._currentSize+2]=J[2],this._buffer[this._currentSize+3]=U[0],this._buffer[this._currentSize+4]=U[1],this._buffer[this._currentSize+5]=U[2],this._buffer[this._currentSize+6]=N,this._currentSize+=7}pushLine(Q,$,J,U){if(this._currentSize+42>=this._buffer.length)return;const N=$[0]-Q[0],Z=$[1]-Q[1],j=Math.atan2(Z,N)+Math.PI*0.5,K=Math.cos(j)*J*0.5,X=Math.sin(j)*J*0.5;this.pushTriangle([Q[0]-K,Q[1]-X,Q[2]],[$[0]-K,$[1]-X,$[2]],[$[0]+K,$[1]+X,$[2]],U),this.pushTriangle([Q[0]-K,Q[1]-X,Q[2]],[$[0]+K,$[1]+X,$[2]],[Q[0]+K,Q[1]+X,Q[2]],U)}pushRotatedLine(Q,$,J,U,N){this.pushLine([Q[0]-J*Math.cos($),Q[1]-J*Math.sin($),Q[2]],[Q[0]+J*Math.cos($),Q[1]+J*Math.sin($),Q[2]],U,N)}pushOriginBoundRectangle(Q,$,J){if(this._currentSize+42>=this._buffer.length)return;const U=[Q[0]+$[0],Q[1]+$[1]];this.pushTriangle([Q[0],Q[1],Q[2]],[U[0],U[1],Q[2]],[Q[0],U[1],Q[2]],J),this.pushTriangle([Q[0],Q[1],Q[2]],[U[0],Q[1],Q[2]],[U[0],U[1],Q[2]],J)}pushCenteredRectangle(Q,$,J){const U=[Q[0]-$[0]*0.5,Q[1]-$[1]*0.5,Q[2]];this.pushOriginBoundRectangle(U,$,J)}canRender(){return this._currentSize>0}flush(){if(!this.canRender())return;this._geometry.updateBuffer(0,this._buffer,this._currentSize),this._geometry.setPrimitiveCount(this._currentSize/7),this._geometry.render(),this.clear()}clear(){this._currentSize=0}}class h0{_shader;_wireFramesStackRenderer;_trianglesStackRenderer;constructor(){this._shader=new m("StackRenderers",{vertexSrc:dQ,fragmentSrc:sQ,attributes:["a_vertex_position","a_vertex_color"],uniforms:["u_composedMatrix"]});const Q=new h.GeometryBuilder;Q.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").addVboAttribute("a_vertex_color","vec4f").setStride(28),this._wireFramesStackRenderer=new p0(this._shader,Q.getDef()),this._trianglesStackRenderer=new P0(this._shader,Q.getDef())}pushLine(Q,$,J){this._wireFramesStackRenderer.pushLine(Q,$,J)}pushCross(Q,$,J){const U=[[Q[0]-$,Q[1],Q[2]],[Q[0]+$,Q[1],Q[2]],[Q[0],Q[1]-$,Q[2]],[Q[0],Q[1]+$,Q[2]],[Q[0],Q[1],Q[2]-$],[Q[0],Q[1],Q[2]+$]],N=[0,1,2,3,4,5];for(let Z=0;Z<N.length;Z+=2){const j=U[Z+0],K=U[Z+1];this._wireFramesStackRenderer.pushLine(j,K,J)}}pushThickLine(Q,$,J,U){this._trianglesStackRenderer.pushLine(Q,$,J,U)}pushRotatedLine(Q,$,J,U,N){this._trianglesStackRenderer.pushRotatedLine(Q,$,J,U,N)}pushOriginBoundRectangle(Q,$,J){this._trianglesStackRenderer.pushOriginBoundRectangle(Q,$,J)}pushCenteredRectangle(Q,$,J){this._trianglesStackRenderer.pushCenteredRectangle(Q,$,J)}pushTriangle(Q,$,J,U){this._trianglesStackRenderer.pushTriangle(Q,$,J,U)}flush(Q){if(!this._wireFramesStackRenderer.canRender()&&!this._trianglesStackRenderer.canRender())return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q),this._wireFramesStackRenderer.flush(),this._trianglesStackRenderer.flush()})}clear(){this._wireFramesStackRenderer.clear(),this._trianglesStackRenderer.clear()}}var rQ=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec2 a_vertex_position;
in vec2 a_vertex_texCoord;
in vec3 a_offset_position;
in vec2 a_offset_texCoord;
in vec3 a_offset_color;
in float a_offset_scale;

out vec2 v_texCoord;
flat out vec3 v_color;

void main(void)
{
  vec3 position = vec3(a_vertex_position, 0.0) * a_offset_scale + a_offset_position;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_texCoord = a_vertex_texCoord + a_offset_texCoord;
  v_color = a_offset_color;
}
`.trim();var nQ=`
#version 300 es

precision mediump float;

uniform sampler2D u_texture;

in vec2 v_texCoord;
flat in vec3 v_color;

out vec4 o_color;

void main(void)
{
  vec4 textureColor = texture(u_texture, v_texCoord);
  if (textureColor.a < 0.5)
  {
    discard;
  }
  else
  {
    o_color = vec4(v_color, textureColor.a);
  }
}
`.trim();var k0="7e7e28fd03fd07fe04fe0aff02ff7e4dfd0cfd03fd07fe04fe0aff02ff1afc0dfd10fc08fc0ffe55ff15fb0bfd03fd07fe04fe08f707fd04ff07fe02fe0cfd0ffd0cfd0aff03fe03ff0afe44fe15fb0bfd03fd04f204f607fd03fe07fe02fe0cfd0efd0efd0aff02fe02ff0bfe43fd15fb0cfe03fe05f204fe01ff02ff0afd02fd07fe02fe0bfd0efd10fd0afa0cfe42fd16fb1bfe04fe07fe01ff02ff0efd09fc1cfd12fd09fa0cfe41fd17fb1bfe04fe07f70bfd0afc04ff17fd12fd06f405f616f61cfd19fd1cfe04fe08f709fd0bfb02fe17fd12fd06f405f616f61bfd1afd1cfe04fe0aff02ff01fe08fd0bfe02fa17fd12fd09fa0cfe3efd37f207ff02ff01fe07fd02fd07fe03fc19fd10fd0afa0cfe3dfd38f204f607fe03fd07fe03fd1bfd0efd0aff02fe02ff0bfe0cfd1dfd0dfd1dfd1cfe04fe07f708ff04fd07fe02fb1bfd0cfd0aff03fe03ff0afe0cfd1dfd0cfd1efd1cfe04fe0aff02ff1afb02fe1bfc08fc0ffe1cfd1dfd0bfd1ffd1cfe04fe0aff02ff7afd7e7e7e7e7e7e0efd17fd10fc0af80bfe0bf909f90dfd08f609fb08f506f808f82cfd19fd0df807fd04fd0afe0afd03fd07fd03fd0bfc08fd0ffd0bfd05fd05fd04fd06fd04fd2afd1bfd0bfc02fc06fd03fc09fd0afd04fd06fd04fd09fb08fd0efd0cfd05fd05fd04fd06fd04fd09fd0cfd0efd1dfd0afe05fd06fd02fb06fa11fd0dfd08fe01fd08fd0dfd0dfd05fd05fd04fd06fd04fd09fd0cfd0dfd0af409fd10fd06fd02fb06fa10fd0dfd08fe02fd08fd0dfd15fd05fb02fd06fd04fd09fd0cfd0cfd0bf40afd0efd07fd01fe01fd09fd0ffd0bfb08fe03fd08f808f70efd08fa08f626fd23fd0cfd08fd01fe01fd09fd0efd0cfb08f606f707f60cfd09fa09f726fd23fd0bfd09fb02fd09fd0dfd10fd07f60cfc06fd04fd0bfd08fd02fb0dfd09fd0cfd0cfd0bf40afd0cfd09fb02fd09fd0cfd12fd0bfd0ffd06fd04fd0afd09fd04fd0dfd09fd0cfd0dfd0af409fd19fc03fd09fd0bfd03fd06fd04fd0bfd08fd04fd06fd04fd09fd0afd04fd0cfd0afd0cfd0efd1dfd1afd04fd09fd0afd04fd06fd03fd0cfd08fd03fd07fd04fd09fd0afd04fd0bfd19fd10fd1bfd0ffd0af807f707f607f90bf907f909f80afd0bf809fb2efd19fd10fd7e51fd17fd11fd7e7e7e7e13f87e78fd05fd08fc09f709f907f808f606f608f907fd03fd07f90df905fc03fd06fb0bfd05fd05fd05fd08fb08fd05fd07fa09fd03fd07fd03fd07fd02fd08fd04fe07fd04fe07fd03fd06fd03fd09fd11fd08fd03fd07fd0cfc03fc05fd05fd07fd01fd07fd05fd06fd02fd08fd03fd06fd04fd07fd03fd07fd05ff07fd05ff06fd04fd06fd03fd09fd11fd08fd02fd08fd0cfb01fb05fc04fd06fd03fd06fd05fd05fd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd11fd08fd01fd09fd0cf505fb03fd05fd05fd05fd02fa05fd04fd07fd03fd06fd0efd03fd07fd03fe08fd03fe07fd0dfd03fd09fd11fd08fa0afd0cf505fa02fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd01fd01fd05fd01fd01fd05fd05fd05fd02fa05fd04fd07f807fd0efd03fd07f808f807fd0df709fd11fd08fb0bfd0cfd02ff02fd05fd02fa05fd05fd05fd02fa05f607fd03fd06fd0efd03fd07fd03fe08fd03fe07fd02fb06fd03fd09fd0bfd03fd08fa0afd0cfd05fd05fd03fb05fd05fd05fd0dfd04fd07fd03fd06fd0efd03fd07fd0dfd0cfd04fd06fd03fd09fd0bfd03fd08fd01fd09fd05ff06fd05fd05fd04fc05fd05fd05fd0dfd04fd07fd03fd06fd04fd07fd03fd07fd05ff07fd0cfd04fd06fd03fd09fd0bfd03fd08fd02fd08fd04fe06fd05fd05fd05fd06fd03fd06fd0dfd04fd07fd03fd07fd03fd07fd02fd08fd04fe07fd0dfd03fd06fd03fd09fd0bfd03fd08fd03fd07fd03fd06fd05fd05fd05fd07fd01fd07fd0dfd04fd06f709f907f808f606fb0df806fd03fd07f90af908fc03fd06f606fd05fd05fd05fd08fb0af87e7e7e7e7e7e7e68fe1af70afb08f708f807f505fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07f608f907ff11f90afc1afd03fd07fc01fc07fd03fd06fd04fd06fe02fd02fe05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fd04fd08fd0bfe14fd09fa19fd03fd07fd03fd07fd03fd06fd04fd06ff03fd03ff05fd03fd07fd03fd07fd05fd05fd03fd07fd03fd07fe05fd08fd0bfd13fd08fd02fd18fd03fd06fd05fd06fd03fd06fd04fd0afd09fd03fd07fd03fd07fd05fd06fd01fd08fd03fd07ff05fd09fd0cfd12fd07fd04fd17fd03fd06fd05fd06fd03fd06fd11fd09fd03fd07fd03fd07fd05fd07fb09fd03fd0cfd0afd0dfd11fd28f807fd05fd06f808f90cfd09fd03fd07fd03fd07fd02ff02fd08fd0bfd01fd0cfd0bfd0efd10fd28f807fd05fd06f809f90bfd09fd03fd07fd03fd07fd02ff02fd08fd0cfb0cfd0cfd0ffd0ffd28fd0cfd03fb06fd02fd0efd0afd09fd03fd07fd03fd07fd02ff02fd07fb0cfd0cfd0dfd10fd0efd28fd0cfd02fa06fd03fd06fd04fd0afd09fd03fd07fd03fd08f707fd01fd0bfd0bfd05ff08fd11fd0dfd28fd0df707fd03fd06fd04fd0afd09fd03fd08fd01fd09fc01fc06fd03fd0afd0afd05fe08fd12fd0cfd28fd0df707fd03fd06fd04fd0afd09fd03fd09fb0bfd01fd07fd03fd0afd0afd04fd08fd13fd0bfd27fb12fd06fc03fd07f809f908f90bfd0cfd01fd07fd03fd08f908f608f910fd06f93cfa7e54f07e72f07e7e7e7e0bfd1dfc21fb19fb18fc10fd0ffd07fc0dfa39fd1efd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd01fd18fd10fd0ffd08fd10fd3bfd1cfd22fd19fd1cfd2dfd10fd4af909f808f909f808f90afd0cfb02fe07fd01fc08fa0cfa08fd03fd0afd09f606f809f91efd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd1dfd08fd03fd06fd03fd07fd03fd07fd03fd07f808fd03fd08fc02fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd18f808fd03fd06fd0dfd03fd07f709fd0bfd03fd08fd03fd0afd0ffd08fa0dfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd0dfd03fd07fd0ffd0bfd03fd08fd03fd0afd0ffd08fd01fd0cfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0cf808fd03fd0afd0ffd08fd02fd0bfd09fd02ff02fd05fd03fd07fd03fd17fd03fd08fd03fd06fd03fd07fd03fd07fd03fd09fd0df908fd03fd0afd0ffd08fd03fd0afd09fd02ff02fd05fd03fd07fd03fd18fb02fe06fe02fb08f909fb02fe07f908f90ffd07fc03fd07f706fd03fd07fc03fd07f706fd05fd05fd03fd08f978fd03fd27fd03fd7e4af92afa7e7e7e7e7e7e18fa09fc09fa1efe4eff6efd0dfc0dfd1cfc4cfe6efd0dfc0dfd1bfa4afd6efd0dfc0dfd1afd02fd07fe02fb07fb02fe07fc02fd08f908f707fd03fd07fd03fd07fd05fd05fd02fd09fd03fd06f80afd0efc0efd08fb03fd05fd04fd07fd03fd05fd03fd09f706fd04fe09fd0bfd03fd07fd03fd07fd05fd05fd02fd09fd03fd06fe03fd08fd24fd05fd01fd02fd05fe06fe07fd03fd05fd03fd09fc02fd06fd04fe09fd0bfd03fd07fd03fd07fd05fd06fa0afd03fd06ff03fd09fd24fd05fd02fd01fd05fe06fe07fd03fd05fd03fd09fd0dfb0cfd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd09fd0cfd0efc0efd07fd03fb06fe06fe07fd03fd05fd03fd09fd0ffb0afd0bfd03fd07fd03fd07fd02ff02fd07fc0bfd03fd08fd0efd0dfc0dfd19fe06fe07fd03fd05fd03fd09fd0cfe04fd09fd01fd07fd03fd08fd01fd09fc01fc07fa0bf908fd03ff0bfd0dfc0dfd19fe06fe07f807f809fd0cfe04fd09fd01fd07fd03fd09fb0bfd01fd07fd02fd0bfb08fd03fe0bfd0dfc0dfd19f607fd11fd08fb0cf90bfb09fb02fe09fd0cfd01fd07fd02fd0dfd08f80cfa09fc09fa1af607fd11fd7cfd69fb0ffb77fa";var uQ=[16,6],H=[1/uQ[0],1/uQ[1]],iQ=36864;class S0{_shader;_geometry;_texture=new x;_texCoordMap;_buffer=new Float32Array(iQ);_currentSize=0;_textScale=14;_textColor=[1,1,1];_horizontalTextAlign="left";_verticalTextAlign="top";constructor(){this._shader=new m("TextRenderer",{vertexSrc:rQ,fragmentSrc:nQ,attributes:["a_vertex_position","a_vertex_texCoord","a_offset_position","a_offset_texCoord","a_offset_color","a_offset_scale"],uniforms:["u_composedMatrix","u_texture"]});const Q=new h.GeometryBuilder;Q.reset().setPrimitiveType("triangles").addVbo().addVboAttribute("a_vertex_position","vec2f").addVboAttribute("a_vertex_texCoord","vec2f").setStride(16).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_position","vec3f").addVboAttribute("a_offset_texCoord","vec2f").addVboAttribute("a_offset_color","vec3f").addVboAttribute("a_offset_scale","float").setStride(36),this._geometry=new h.Geometry(this._shader,Q.getDef());const $=[{position:[0.5,-0.5],texCoord:[H[0]*1,H[1]*1]},{position:[-0.5,-0.5],texCoord:[H[0]*0,H[1]*1]},{position:[0.5,0.5],texCoord:[H[0]*1,H[1]*0]},{position:[-0.5,0.5],texCoord:[H[0]*0,H[1]*0]}],J=[1,0,2,1,2,3],U=[];for(let K of J){const X=$[K];U.push(X.position[0],X.position[1],X.texCoord[0],X.texCoord[1])}this._geometry.updateBuffer(0,U,U.length),this._geometry.setPrimitiveCount(U.length/4),this._geometry.setFloatBufferSize(1,iQ),this._texCoordMap=new Map([[" ",[0*H[0],0*H[1]]],["!",[1*H[0],0*H[1]]],['"',[2*H[0],0*H[1]]],["#",[3*H[0],0*H[1]]],["$",[4*H[0],0*H[1]]],["%",[5*H[0],0*H[1]]],["&",[6*H[0],0*H[1]]],["'",[7*H[0],0*H[1]]],["(",[8*H[0],0*H[1]]],[")",[9*H[0],0*H[1]]],["*",[10*H[0],0*H[1]]],["+",[11*H[0],0*H[1]]],[",",[12*H[0],0*H[1]]],["-",[13*H[0],0*H[1]]],[".",[14*H[0],0*H[1]]],["/",[15*H[0],0*H[1]]],["0",[0*H[0],1*H[1]]],["1",[1*H[0],1*H[1]]],["2",[2*H[0],1*H[1]]],["3",[3*H[0],1*H[1]]],["4",[4*H[0],1*H[1]]],["5",[5*H[0],1*H[1]]],["6",[6*H[0],1*H[1]]],["7",[7*H[0],1*H[1]]],["8",[8*H[0],1*H[1]]],["9",[9*H[0],1*H[1]]],[":",[10*H[0],1*H[1]]],[";",[11*H[0],1*H[1]]],["<",[12*H[0],1*H[1]]],["=",[13*H[0],1*H[1]]],[">",[14*H[0],1*H[1]]],["?",[15*H[0],1*H[1]]],["@",[0*H[0],2*H[1]]],["A",[1*H[0],2*H[1]]],["B",[2*H[0],2*H[1]]],["C",[3*H[0],2*H[1]]],["D",[4*H[0],2*H[1]]],["E",[5*H[0],2*H[1]]],["F",[6*H[0],2*H[1]]],["G",[7*H[0],2*H[1]]],["H",[8*H[0],2*H[1]]],["I",[9*H[0],2*H[1]]],["J",[10*H[0],2*H[1]]],["K",[11*H[0],2*H[1]]],["L",[12*H[0],2*H[1]]],["M",[13*H[0],2*H[1]]],["N",[14*H[0],2*H[1]]],["O",[15*H[0],2*H[1]]],["P",[0*H[0],3*H[1]]],["Q",[1*H[0],3*H[1]]],["R",[2*H[0],3*H[1]]],["S",[3*H[0],3*H[1]]],["T",[4*H[0],3*H[1]]],["U",[5*H[0],3*H[1]]],["V",[6*H[0],3*H[1]]],["W",[7*H[0],3*H[1]]],["X",[8*H[0],3*H[1]]],["Y",[9*H[0],3*H[1]]],["Z",[10*H[0],3*H[1]]],["[",[11*H[0],3*H[1]]],["\\",[12*H[0],3*H[1]]],["]",[13*H[0],3*H[1]]],["^",[14*H[0],3*H[1]]],["_",[15*H[0],3*H[1]]],["`",[0*H[0],4*H[1]]],["a",[1*H[0],4*H[1]]],["b",[2*H[0],4*H[1]]],["c",[3*H[0],4*H[1]]],["d",[4*H[0],4*H[1]]],["e",[5*H[0],4*H[1]]],["f",[6*H[0],4*H[1]]],["g",[7*H[0],4*H[1]]],["h",[8*H[0],4*H[1]]],["i",[9*H[0],4*H[1]]],["j",[10*H[0],4*H[1]]],["k",[11*H[0],4*H[1]]],["l",[12*H[0],4*H[1]]],["m",[13*H[0],4*H[1]]],["n",[14*H[0],4*H[1]]],["o",[15*H[0],4*H[1]]],["p",[0*H[0],5*H[1]]],["q",[1*H[0],5*H[1]]],["r",[2*H[0],5*H[1]]],["s",[3*H[0],5*H[1]]],["t",[4*H[0],5*H[1]]],["u",[5*H[0],5*H[1]]],["v",[6*H[0],5*H[1]]],["w",[7*H[0],5*H[1]]],["x",[8*H[0],5*H[1]]],["y",[9*H[0],5*H[1]]],["z",[10*H[0],5*H[1]]],["{",[11*H[0],5*H[1]]],["|",[12*H[0],5*H[1]]],["}",[13*H[0],5*H[1]]],["~",[14*H[0],5*H[1]]]]);const N=256,Z=96,j=new Uint8Array(N*Z*4);{let K=0;for(let X=0;X<k0.length;X+=2){let Y=parseInt(`${k0.substring(X,X+2)}000000`,16)>>24,I=0;if(Y<0)Y=-Y,I=255;for(let q=0;q<Y;++q)j[K*4+0]=I,j[K*4+1]=I,j[K*4+2]=I,j[K*4+3]=I,++K}}this._texture.initialize(),this._texture.bind((K)=>{K.loadFromMemory(N,Z,j)})}setTextAlign(Q,$){return this._horizontalTextAlign=Q,this._verticalTextAlign=$,this}setTextScale(Q){return this._textScale=Q,this}setTextColor(Q,$,J){return this._textColor[0]=Q,this._textColor[1]=$,this._textColor[2]=J,this}pushText(Q,$){if(Q.length===0)return this;if(this._textScale<=0)return this;const J=[0];for(let j=0;j<Q.length;++j)if(Q[j]=="\n")J.push(0);else J[J.length-1]+=1;if(J.length===0)return this;let U=0;const N=[0,0],Z=this._textScale*0.5;switch(this._horizontalTextAlign){case"left":N[0]=$[0];break;case"centered":N[0]=$[0]-J[U]*Z+Z;break;case"right":N[0]=$[0]-J[U]*this._textScale+this._textScale;break}switch(this._verticalTextAlign){case"top":N[1]=$[1];break;case"centered":N[1]=$[1]+J.length*Z-Z;break;case"bottom":N[1]=$[1]-(J.length-1)*this._textScale;break}for(let j=0;j<Q.length;++j){const K=Q[j];if(K=="\n"){switch(U+=1,this._horizontalTextAlign){case"left":N[0]=$[0];break;case"centered":N[0]=$[0]-J[U]*Z+Z;break;case"right":N[0]=$[0]-J[U]*this._textScale+this._textScale;break}N[1]-=this._textScale}else this._pushLetter(K,N),N[0]+=this._textScale}return this}_pushLetter(Q,$){if(this._currentSize+90>=this._buffer.length)return;const J=this._texCoordMap.get(Q);if(!J)throw new Error(`fail to find a letter, letter=${Q}`);for(let U=-1;U<=1;++U)for(let N=-1;N<=1;++N)this._buffer[this._currentSize++]=$[0]+2*N,this._buffer[this._currentSize++]=$[1]+2*U,this._buffer[this._currentSize++]=-0.1,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=this._textScale;this._buffer[this._currentSize++]=$[0],this._buffer[this._currentSize++]=$[1],this._buffer[this._currentSize++]=0,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=this._textColor[0],this._buffer[this._currentSize++]=this._textColor[1],this._buffer[this._currentSize++]=this._textColor[2],this._buffer[this._currentSize++]=this._textScale}flush(Q){if(this._currentSize===0)return this;return this._shader.bind(($)=>{$.setMatrix4Uniform("u_composedMatrix",Q),$.setTextureUniform("u_texture",this._texture,0),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/9),this._geometry.render()}),x.unbind(),this.clear(),this}clear(){return this._currentSize=0,this}}var aQ=`
#version 300 es

precision highp float;

uniform mat4 u_composedMatrix;

in vec3  a_vertex_position;

in vec3  a_offset_center;
in float a_offset_scale;
in vec4  a_offset_color;

flat out vec4 v_color;

void main(void)
{
  vec3 position = a_offset_center + a_vertex_position * a_offset_scale;

  gl_Position = u_composedMatrix * vec4(position, 1.0);

  v_color = a_offset_color;
}
`.trim();var oQ=`
#version 300 es

precision lowp float;

flat in vec4 v_color;

out vec4 out_color;

void main(void)
{
  out_color = v_color;
}
`.trim();var KJ=(Q)=>{const $=Q*0.5,J=[];J.push([+$,+$,+$]),J.push([-$,+$,+$]),J.push([+$,-$,+$]),J.push([-$,-$,+$]),J.push([+$,+$,-$]),J.push([-$,+$,-$]),J.push([+$,-$,-$]),J.push([-$,-$,-$]);const U=[];U.push(0,1,1,3,3,2,2,0),U.push(4,5,5,7,7,6,6,4),U.push(0,4,1,5,3,7,2,6);const N=[];for(let Z=0;Z<U.length;++Z){const j=J[U[Z]];N.push(j[0],j[1],j[2])}return N},eQ=32768;class y0{_shader;_geometry;_buffer=new Float32Array(eQ);_currentSize=0;constructor(){this._shader=new m("WireFrameCubesRenderer",{vertexSrc:aQ,fragmentSrc:oQ,attributes:["a_vertex_position","a_offset_center","a_offset_scale","a_offset_color"],uniforms:["u_composedMatrix"]});const Q=new h.GeometryBuilder;Q.reset().setPrimitiveType("lines").addVbo().addVboAttribute("a_vertex_position","vec3f").setStride(12).addVbo().setVboAsDynamic().setVboAsInstanced().addVboAttribute("a_offset_center","vec3f").addVboAttribute("a_offset_scale","float").addVboAttribute("a_offset_color","vec4f").setStride(32);const $=KJ(1);this._geometry=new h.Geometry(this._shader,Q.getDef()),this._geometry.updateBuffer(0,$,$.length),this._geometry.setPrimitiveCount($.length/3),this._geometry.setFloatBufferSize(1,eQ)}pushCenteredCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;this._buffer[this._currentSize++]=Q[0],this._buffer[this._currentSize++]=Q[1],this._buffer[this._currentSize++]=Q[2],this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}pushOriginBoundCube(Q,$,J){if(this._currentSize+8>=this._buffer.length)return;const U=$*0.5;this._buffer[this._currentSize++]=Q[0]+U,this._buffer[this._currentSize++]=Q[1]+U,this._buffer[this._currentSize++]=Q[2]+U,this._buffer[this._currentSize++]=$,this._buffer[this._currentSize++]=J[0],this._buffer[this._currentSize++]=J[1],this._buffer[this._currentSize++]=J[2],this._buffer[this._currentSize++]=J[3]||1}flush(Q){if(this._currentSize<=0)return;this._shader.bind(()=>{this._shader.setMatrix4Uniform("u_composedMatrix",Q),this._geometry.updateBuffer(1,this._buffer,this._currentSize),this._geometry.setInstancedCount(this._currentSize/8),this._geometry.render()}),this.clear()}clear(){this._currentSize=0}}var{WebGLContext:J0,ShaderProgram:YJ}=V0;class z0{_def;_viewportSize=l.create();_frustumCulling=new T0;_mainCamera=new H0;_mainHudCamera=new H0;onContextLost=null;onContextRestored=null;_scene;_hud;constructor(Q){this._def=Q,this.resize(this._def.canvasDomElement.width,this._def.canvasDomElement.height),J0.initialize(this._def.canvasDomElement);const $=(U)=>{if(U.preventDefault(),console.log("context is lost"),this.onContextLost)this.onContextLost()},J=()=>{if(console.log("context is restored"),J0.initialize(this._def.canvasDomElement),this.onContextRestored)this.onContextRestored()};this._def.canvasDomElement.addEventListener("webglcontextlost",$,!1),this._def.canvasDomElement.addEventListener("webglcontextrestored",J,!1),this._scene={chunksRenderer:new f0,triangleCubesRenderer:new v0},this._hud={textRenderer:new S0,stackRenderers:new h0,wireFrameCubesRenderer:new y0}}resize(Q,$){this._viewportSize[0]=Q,this._viewportSize[1]=$,this._mainCamera.setViewportSize(Q,$),this._mainCamera.setAsPerspective({fovy:70,near:0.1,far:70}),this._mainHudCamera.setViewportSize(Q,$),this._mainHudCamera.setAsOrthogonal({left:-Q*0.5,right:+Q*0.5,top:-$*0.5,bottom:+$*0.5,near:-200,far:200}),this._mainHudCamera.setEye([+Q*0.5,+$*0.5,1]),this._mainHudCamera.setTarget([+Q*0.5,+$*0.5,0]),this._mainHudCamera.setUpAxis([0,1,0]),this._mainHudCamera.computeMatrices()}toggleContextLoss(){const Q=J0.getContext(),$=J0.getExtensionLoseContext();if($)if(Q.isContextLost())$.restoreContext();else $.loseContext()}contextIsLost(){return J0.getContext().isContextLost()}setOnContextLost(Q){this.onContextLost=Q}setOnContextRestored(Q){this.onContextRestored=Q}async init(){const Q=J0.getContext();Q.clearColor(0,0,0,1),Q.enable(Q.DEPTH_TEST),Q.depthFunc(Q.LESS),Q.disable(Q.BLEND),Q.blendFunc(Q.SRC_ALPHA,Q.ONE_MINUS_SRC_COLOR),Q.activeTexture(Q.TEXTURE0),Q.enable(Q.CULL_FACE),await this._scene.chunksRenderer.initialize()}getSize(){return this._viewportSize}lookAt(Q,$,J){this._mainCamera.setEye(Q),this._mainCamera.setTarget($),this._mainCamera.setUpAxis(J),this._mainCamera.computeMatrices()}update(){t.resetDelta(),s.resetDeltas(),this._frustumCulling.calculateFrustum(this._mainCamera.getProjectionMatrix(),this._mainCamera.getViewMatrix())}renderScene(Q){const $=J0.getContext(),J=this._mainCamera.getViewportPos(),U=this._mainCamera.getViewportSize();$.viewport(J[0],J[1],U[0],U[1]),$.clearColor(0,0,0,1),$.clear($.COLOR_BUFFER_BIT|$.DEPTH_BUFFER_BIT),this._scene.chunksRenderer.render(this._mainCamera,this._frustumCulling,Q),this._scene.triangleCubesRenderer.flush(this._mainCamera)}renderHUD(){const Q=J0.getContext(),$=this._mainHudCamera.getViewportPos(),J=this._mainHudCamera.getViewportSize();Q.viewport($[0],$[1],J[0],J[1]),Q.clear(Q.DEPTH_BUFFER_BIT),YJ.unbind()}get mainCamera(){return this._mainCamera}get hudCamera(){return this._mainHudCamera}get wireFrameCubesRenderer(){return this._hud.wireFrameCubesRenderer}get triangleCubesRenderer(){return this._scene.triangleCubesRenderer}get stackRenderers(){return this._hud.stackRenderers}get textRenderer(){return this._hud.textRenderer}get frustumCulling(){return this._frustumCulling}get chunksRenderer(){return this._scene.chunksRenderer}}var U0=[0.2,0.2,0.2],N0=[0.2,0.6,0.2],HJ=(Q,$)=>{Q.push({center:[$[0],$[1]],size:[40,40],text:"A\nQ",color:C.isPressed("A","Q")?N0:U0}),Q.push({center:[$[0]+45,$[1]],size:[40,40],text:"S",color:C.isPressed("S")?N0:U0}),Q.push({center:[$[0]+45,$[1]+45],size:[40,40],text:"W\nZ",color:C.isPressed("W","Z")?N0:U0}),Q.push({center:[$[0]+90,$[1]],size:[40,40],text:"D",color:C.isPressed("D")?N0:U0})},IJ=(Q,$)=>{Q.push({center:[$[0],$[1]],size:[40,40],lines:[{a:[15,0],b:[-8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[-12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[-12,2],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowLeft")?N0:U0}),Q.push({center:[$[0]+45,$[1]],size:[40,40],lines:[{a:[0,15],b:[0,-8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,-12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,-12],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowDown")?N0:U0}),Q.push({center:[$[0]+45,$[1]+45],size:[40,40],lines:[{a:[0,-15],b:[0,8],thickness:6,color:[1,1,1]},{a:[10,0],b:[-2,12],thickness:6,color:[1,1,1]},{a:[-10,0],b:[2,12],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowUp")?N0:U0}),Q.push({center:[$[0]+90,$[1]],size:[40,40],lines:[{a:[-15,0],b:[8,0],thickness:6,color:[1,1,1]},{a:[0,10],b:[12,-2],thickness:6,color:[1,1,1]},{a:[0,-10],b:[12,2],thickness:6,color:[1,1,1]}],color:C.isPressed("ArrowRight")?N0:U0})},BJ=(Q,$,J)=>{if(s.isSupported($))Q.push({center:[J[0]+115,J[1]],size:[230,60],text:"Touch Events\nSupported\n(double tap)",color:[0,0.5,0]});else Q.push({center:[J[0]+115,J[1]],size:[230,60],text:"Touch Events\nNot Supported",color:[0.5,0,0]});if(Q0.canBePointerLocked($))Q.push({center:[J[0]+105,J[1]+70],size:[210,60],text:"Mouse\nSupported",color:[0,0.5,0]});else Q.push({center:[J[0]+105,J[1]+70],size:[210,60],text:"Mouse Events\nNot Supported",color:[0.5,0,0]})},tQ=(Q,$,J)=>{const U=[],N=[27,165],Z=[27,260],j=[7,35];HJ(U,N),IJ(U,Z),BJ(U,Q,j),U.forEach((K)=>{const{center:X}=K;if($.pushCenteredRectangle(V.fromValues(X[0],X[1],-0.3),K.size,[0,0,0]),$.pushCenteredRectangle(V.fromValues(X[0],X[1],-0.2),[K.size[0]-2,K.size[1]-2],K.color),K.text)J.setTextScale(16).setTextAlign("centered","centered").pushText(K.text,X).setTextAlign("left","top");if(K.lines)K.lines.forEach((Y)=>{$.pushThickLine([X[0]+Y.a[0],X[1]+Y.a[1],0],[X[0]+Y.b[0],X[1]+Y.b[1],0],Y.thickness,Y.color)})})};var Q7=(Q,$,J,U)=>{const N=[Math.floor(J[0]/$),Math.floor(J[1]/$),Math.floor(J[2]/$)],Z=["Coordinates:",`X: ${N[0]}`,`Y: ${N[1]}`,`Z: ${N[2]}`],j=[14,Q[1]-200];U.setTextScale(14).setTextAlign("left","top").pushText(Z.join("\n"),j)};var C0=(Q,$,J,U,N,Z=!1)=>{const K=Math.ceil(J.maxDelta/5)*5;{U.pushOriginBoundRectangle(Q,$,[0,0,0,0.5]);const X=[[Q[0]+$[0]*0,Q[1]+$[1]*0,0],[Q[0]+$[0]*1,Q[1]+$[1]*0,0],[Q[0]+$[0]*1,Q[1]+$[1]*1,0],[Q[0]+$[0]*0,Q[1]+$[1]*1,0]];U.pushLine(X[0],X[1],[1,1,1]),U.pushLine(X[1],X[2],[1,1,1]),U.pushLine(X[2],X[3],[1,1,1]),U.pushLine(X[3],X[0],[1,1,1])}for(let X=5;X<K;X+=5){const Y=X/K,I=[Q[0]+0,Q[1]+$[1]*Y,0],q=[Q[0]+$[0],Q[1]+$[1]*Y,0];U.pushLine(I,q,[0.5,0.5,0.5])}if(J.framesDelta.length>=2){const X=$[0]/J.framesDelta.length;let Y=J.framesDelta[0],I=0,q=$[1]*Y/K;for(let B=1;B<J.framesDelta.length;++B){const O=J.framesDelta[B],R=B*X,E=$[1]*O/K,D=[Q[0]+I,Q[1]+q,0],F=[Q[0]+R,Q[1]+E,0];U.pushLine(D,F,[1,1,1]),Y=O,I=R,q=E}}{const{averageDelta:I,maxDelta:q,minDelta:B}=J;let O=`~${I.toFixed(0)}ms`,R=`<${q}ms`,E=`>${B}ms`;if(Z===!0){const D=(F)=>F<999?F.toFixed(0):"???";O+=`\n~${D(1000/I)}fps`,R+=`\n<${D(1000/q)}fps`,E+=`\n>${D(1000/B)}fps`}N.setTextScale(14).setTextAlign("left","top").setTextColor(1,1,0.75).pushText(O,[Q[0]+7,Q[1]-8]).setTextAlign("left","centered").setTextColor(1,0.75,0.75).pushText(R,[Q[0]+$[0]+7,Q[1]+$[1]-7]).setTextColor(0.75,1,0.75).pushText(E,[Q[0]+$[0]+7,Q[1]+7]).setTextColor(1,1,1)}};var $7=(Q,$,J,U,N)=>{const Z=[Q[0]-10,Q[1]-10],j=[`Chunks\nGenerated:\n${$} <`,"",`Chunks\nDiscarded:\n${J} <`,"",`Live\nChunks:\n${$-J} <`,"",`Visible\nChunks:\n${U} <`].join("\n");N.setTextScale(14).setTextAlign("right","top").pushText(j,Z)};var J7=(Q,$,J,U,N,Z,j,K)=>{const X=Math.tan(Q/360*Math.PI)*J,Y=X*$,I=-Y,q=+Y,B=+X,O=-X,R=U*Math.sin(Q*Math.PI/180),E=R*$,D=[];D.push([J,I,B]),D.push([J,q,B]),D.push([J,I,O]),D.push([J,q,O]),D.push([U,-E,+R]),D.push([U,+E,+R]),D.push([U,-E,-R]),D.push([U,+E,-R]),D.push([0,0,0]),D.push([100,0,0]),D.push([0,100,0]),D.push([0,0,100]);{const F=y.identity(y.create());y.translate(F,F,N),y.rotate(F,F,Z,[0,0,1]),y.rotate(F,F,j,[0,-1,0]);for(let _=0;_<D.length;++_)D[_]=V.transformMat4(D[_],D[_],F)}{const F=[];F.push(0,1,1,3,3,2,2,0),F.push(0,4,1,5,2,6,3,7),F.push(4,5,5,7,7,6,6,4);const _=[1,1,0];for(let L=0;L<F.length;L+=2){const A=D[F[L+0]],M=D[F[L+1]];K.pushLine(A,M,_)}{const L=D[8],A=D[9],M=D[10],G=D[11];K.pushLine(L,A,[1,0,0]),K.pushLine(L,M,[0,1,0]),K.pushLine(L,G,[0,0,1])}}};var U7=(Q,$,J,U,N,Z,j,K,X)=>{const Y=W.getContext(),[I,q]=Z,B=new H0,O=Math.min(I,q)*0.5,R=Math.max(O,$),E=Math.max(O,$),D=I-R;B.setViewportPos(D,0),B.setViewportSize(R,E);const F=R/E,_=F>=1?J:J*(1/F),L=_*F;B.setAsOrthogonal({left:-L,right:+L,top:-_,bottom:+_,near:-J,far:+J}),B.setUpAxis([0,0,1]);const A=Q.getEye(),M=Q.getTarget(),G=V.sub(V.create(),M,A),f=Math.atan2(G[1],G[0]),v=Math.atan2(G[2],l.length(l.fromValues(G[1],G[0]))),p=f-Math.PI*0.25,P=v+Math.PI*0.5,k=Math.cos(p),z=Math.sin(p),g=Math.sin(P),w=V.copy(V.create(),A);w[0]-=k*20,w[1]-=z*20,w[2]+=g*10,B.setEye(w),B.setTarget(A),B.computeMatrices();const c=B.getViewportPos(),e=B.getViewportSize();Y.viewport(c[0],c[1],e[0],e[1]),Y.clear(Y.DEPTH_BUFFER_BIT),Y.disable(Y.DEPTH_TEST),Y.enable(Y.BLEND),K.clear();const Z0=V.fromValues(1,1,1),O0=o.fromValues(1,0,0,0.8),R0=V.fromValues(0,1,0),B0=N*0.5,u=V.create(),m0=V.fromValues(B0,B0,B0);if(U.forEach((i)=>{if(V.copy(u,i.realPosition),V.add(u,u,m0),i.isVisible)K.pushCenteredCube(u,B0,Z0);else K.pushCenteredCube(u,B0,O0)}),j.length>0){const i=N*1.2;j.forEach((Z7)=>{V.copy(u,Z7),V.add(u,u,m0),K.pushCenteredCube(u,i,R0)})}K.flush(B.getComposedMatrix()),X.flush(B.getComposedMatrix());{const i=Q.getPerspectiveData();J7(i.fovy,i.aspectRatio,i.near,i.far,A,f,v,X),X.flush(B.getComposedMatrix())}Y.disable(Y.BLEND),Y.enable(Y.DEPTH_TEST)};var I0=new Map,N7=(Q,$,J)=>{const U=s.getTouchData();if(U.length===0)I0.clear();else{const N=new Set,Z=[1,0,0],j=[0,1,0],K=U.length>1?Z:j;U.forEach((Y)=>{N.add(Y.id);let I=I0.get(Y.id);if(I===void 0)I=0,I0.set(Y.id,I);const q=[0,0.5];if(J)q.push(0.25,0.75);for(let B of q){const O=I+B*Math.PI,R=[Y.positionX,Q[1]-Y.positionY,0];$.pushRotatedLine(R,O,150,15,K)}I+=0.1,I0.set(Y.id,I)});const X=new Set;I0.forEach((Y,I)=>{if(!N.has(I))X.add(I)}),X.forEach((Y)=>{I0.delete(Y)})}};class g0{_canvasElement;_freeFlyController;_renderer;_chunkGenerator;_running;_errorGraphicContext;_chunksCreated=0;_chunksDiscarded=0;_currFrameTime=0;_frameProfiler=new D0;constructor(Q){this._canvasElement=Q,this._freeFlyController=new M0({position:V.fromValues(0,0,0),coordinates:["X","Y","Z"],theta:0,phi:0,mouseSensibility:t0,movingSpeed:e0,keyboardSensibility:QQ,touchSensibility:$Q}),this._renderer=new z0({canvasDomElement:Q}),this._chunkGenerator=new w0({chunkGraphicSize:j0,chunkGenerationRange:o0,chunkLogicSize:a0,workerTotal:UQ,workerFile:JQ,chunkIsVisible:($)=>{const J=j0,U=J*0.5;return this._renderer.frustumCulling.cubeInFrustum($[0]+U,$[1]+U,$[2]+U,J)},acquireGeometry:($)=>{return this._renderer.chunksRenderer.acquireGeometry($)},releaseGeometry:($)=>{this._renderer.chunksRenderer.releaseGeometry($)},onChunkCreated:()=>{++this._chunksCreated},onChunkDiscarded:()=>{++this._chunksDiscarded}}),C.activate(),s.activate(this._canvasElement),Q0.allowPointerLockedOnClickEvent(Q),Q0.addOnLockChange(()=>{if(Q0.isPointerLocked(Q))t.activate();else t.deactivate(),Q0.allowPointerLockedOnClickEvent(Q)}),Q0.addOnLockError(($)=>{}),this._running=!1,this._errorGraphicContext=!1,this._renderer.setOnContextLost(()=>{console.log("on_context_lost"),this._errorGraphicContext=!0,this.stop()}),this._renderer.setOnContextRestored(()=>{console.log("on_context_restored"),this._errorGraphicContext=!1,this.start()})}async init(){await this._renderer.init()}resize(Q,$,J){let U=Q,N=$;if(J)this._canvasElement.style.position="absolute",U=window.innerWidth,N=window.innerHeight;else this._canvasElement.style.position="relative";this._canvasElement.style.left="0px",this._canvasElement.style.top="0px",this._canvasElement.style.width=`${U}px`,this._canvasElement.style.height=`${N}px`,this._canvasElement.width=U,this._canvasElement.height=N,this._renderer.resize(U,N)}start(){if(this.isRunning())return;this._running=!0,this._chunkGenerator.start(),this._tick()}stop(){this._running=!1,this._chunkGenerator.stop()}isRunning(){return this._running&&!this._errorGraphicContext}_tick(){const Q=()=>{if(!this._running||this._errorGraphicContext)return;window.requestAnimationFrame(Q),this._mainLoop()};Q()}_mainLoop(){const Q=Date.now(),$=Math.min(Q-this._currFrameTime,30);this._currFrameTime=Q,this._frameProfiler.pushDelta($),this._freeFlyController.update($/1000,(j,K,X)=>{return!1}),this._renderer.lookAt(this._freeFlyController.getPosition(),this._freeFlyController.getTarget(),this._freeFlyController.getUpAxis()),this._renderer.update();const J=this._freeFlyController.getPosition();this._chunkGenerator.update(J);let U=0;this._renderer.wireFrameCubesRenderer.clear(),this._chunkGenerator.getChunks().forEach((j)=>{if(!j.isVisible)return;++U,this._renderer.triangleCubesRenderer.pushOriginBoundCube(j.realPosition,j0,[1,1,1])}),this._renderer.renderScene(j0),this._renderer.renderHUD(),this._renderer.stackRenderers.clear(),this._renderer.textRenderer.clear(),$7(this._renderer.getSize(),this._chunksCreated,this._chunksDiscarded,U,this._renderer.textRenderer),Q7(this._renderer.getSize(),j0,J,this._renderer.textRenderer),tQ(this._canvasElement,this._renderer.stackRenderers,this._renderer.textRenderer),C0([10,this._canvasElement.height-60,0],[100,50],this._frameProfiler,this._renderer.stackRenderers,this._renderer.textRenderer,!0),C0([10,this._canvasElement.height-150,0],[100,50],this._chunkGenerator.getFrameProfiler(),this._renderer.stackRenderers,this._renderer.textRenderer),N7(this._renderer.getSize(),this._renderer.stackRenderers,this._freeFlyController.getTouchMoveForward()),this._renderer.stackRenderers.flush(this._renderer.hudCamera.getComposedMatrix()),this._renderer.textRenderer.flush(this._renderer.hudCamera.getComposedMatrix());const N=300,Z=150;U7(this._renderer.mainCamera,N,Z,this._chunkGenerator.getChunks(),j0,this._renderer.getSize(),this._chunkGenerator.getProcessingRealPositions(),this._renderer.wireFrameCubesRenderer,this._renderer.stackRenderers)}}var DJ=async()=>{let Q=null;const $=async()=>{if(Q)Q.stop()};window.addEventListener("error",$);const J=document.querySelector("#main-canvas");if(!J)throw new Error("main-canvas not found");const U=document.querySelector("#gui_toggle_start");if(!U)throw new Error("guiToggleStart not found");const N=document.querySelector("#gui_fullscreen");if(!N)throw new Error("guiFullscreen not found");if(!i0())throw new Error("missing WebGL2 feature (unsupported)");if(!u0())throw new Error("missing WebWorker feature (unsupported)");U.addEventListener("click",()=>{if(!Q)return;if(Q.isRunning())Q.stop();else Q.start()}),N.addEventListener("click",()=>{if(!Q)return;E0.requestFullScreen(J)}),E0.addOnFullScreenChange(()=>{if(!Q)return;let Z=800,j=600;const K=E0.isFullScreen(J);if(K)J.style.position="absolute",Z=window.innerWidth,j=window.innerHeight;else J.style.position="relative";J.style.left="0px",J.style.top="0px",J.style.width=`${Z}px`,J.style.height=`${j}px`,J.width=Z,J.height=j,Q.resize(Z,j,K)}),Q=new g0(J),await Q.init(),Q.start()};window.addEventListener("load",DJ);
